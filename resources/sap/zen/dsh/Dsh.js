/*!
 * (c) Copyright 2010-2018 SAP SE or an SAP affiliate company.
 */
jQuery.sap.declare("sap.zen.dsh.Dsh");jQuery.sap.require("sap.zen.dsh.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.zen.dsh.Dsh",{metadata:{publicMethods:["addParameter","executeScript","getDataSource","getComponent","getPage","createPage","initializeAppStateData","initializeAppState"],library:"sap.zen.dsh",properties:{"dshAppName":{type:"string",group:"Misc",defaultValue:'0ANALYSIS'},"repoPath":{type:"string",group:"Misc",defaultValue:null},"width":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},"height":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},"deployment":{type:"string",group:"Misc",defaultValue:'bw'},"protocol":{type:"string",group:"Misc",defaultValue:null},"client":{type:"string",group:"Misc",defaultValue:null},"language":{type:"string",group:"Misc",defaultValue:null},"semanticMappings":{type:"object",group:"Misc",defaultValue:null},"appComponent":{type:"object",group:"Misc",defaultValue:null},"deferCreation":{type:"boolean",group:"Misc",defaultValue:false},"systemAlias":{type:"string",group:"Misc",defaultValue:null}}}});sap.ui.getCore().loadLibrary("sap.viz");if(require&&!require.config){sap.ui._ui5loader.config({noConflict:true});}sap.ui.define("sap/zen/dsh/Dsh",["sap/ui/thirdparty/URI","sap/zen/dsh/rt/all"],function(U){window.DSH_deployment=true;var s=s||{};window.sapbi_page=window.sapbi_page||{};sapbi_page.getParameter=sapbi_page.getParameter||function(){return"";};var a=a||"";sapbi_page.staticMimeUrlPrefix=sap.ui.resource("sap.zen.dsh","rt/");if(!window.sap){window.sap={};}if(!sap.zen){sap.zen={};}sap.zen.doReplaceDots=true;sap.zen.dsh.Dsh.prototype.init=function(){this.initial=true;this.parameters={};this.dshBaseUrl=U(sap.ui.resource("sap.zen.dsh","rt/")).absoluteTo(window.location.pathname).toString();this.dshBaseAppUrlBW="/sap/bw/Mime";};sap.zen.dsh.Dsh.prototype.doInit=function(){if(this.getDshAppName()==="0ANALYSIS"||this.getDshAppName()==="0ANALYTIC_GRID"){this.setRepoPath(U(sap.ui.resource("sap.zen.dsh","applications/")).absoluteTo(window.location.pathname).toString());}if(this.getRepoPath()!==""){this.repositoryUrl=this.getRepoPath();}if(!this.initial){return;}this.initial=false;if(jQuery.sap.debug()==="true"){jQuery.sap.require("sap.zen.dsh.rt.zen_rt_firefly.js.jszip");jQuery.sap.require("sap.zen.dsh.rt.zen_rt_firefly.js.xlsx");}var t=this;if(!this.getDeferCreation()){setTimeout(function(){t.doIt();},0);}};sap.zen.dsh.Dsh.prototype.createPage=function(){this.doIt();};sap.zen.dsh.Dsh.prototype.doIt=function(){this.doInit();sap.zen.dsh.scriptLoaded=true;var t=this;{var l=t.getLanguage();if(!l){var c=sap.ui.getCore().getConfiguration();l=c.getLocale().getSAPLogonLanguage();if(!l){l=window.navigator.userLanguage||window.navigator.language;}}var b=t.getClient();if(!b&&document.cookie){var m=/(?:sap-usercontext=)*sap-client=(\d{3})/.exec(document.cookie);if(m&&m[1]){b=m[1];}}var d=t.getDeployment();if(!d||d.length===0){d="bw";}var e=t.getDshAppName();var f=this.getStartupParameters();if(f){for(var g in f){if(this.isDshParameter(g)){if(!this.doesParameterExist(g)){this.addParameter(g,f[g][0]);}}}}var u=sap.firefly.XHashMapOfStringByString.create();for(var k in this.parameters){u.put(k,this.parameters[k]);}var h=new sap.zen.DesignStudio();h.setHost(document.location.hostname);h.setPort(document.location.port);h.setProtocol(document.location.protocol.split(":")[0]);h.setClient(b);h.setLanguage(l);if(this.repositoryUrl){h.setRepositoryUrl(this.repositoryUrl);}h.setApplicationPath(this.dshBaseAppUrlBW);h.setApplicationName(e);h.setUrlParameter(u);h.setSdkLoaderPath("");h.setHanaMode(true);h.setDshControlId(t.getId());h.setStaticMimesRootPath(this.dshBaseUrl);h.setSystemAlias(this.getSystemAlias());if(d==="bw2"||d==="bw"){h.setNewBW(true);}h.setRightToLeft(sap.ui.getCore().getConfiguration().getRTL());this._page=h.createPage();window[this._page.getPageIdForScripting()]=this._page;sapbi_page=sapbi_page||{};sapbi_page.staticMimeUrlPrefix=this.dshBaseUrl;sapbi_page.getParameter=function(){return"";};a="";if(this.getAppComponent()){sapbi_page.appComponent=this.getAppComponent();}var i=this._page.getApplicationPropertiesComponent().getCustomCSSName();if(i){var j=document.createElement('link');j.setAttribute("type","text/css");j.setAttribute("rel","stylesheet");j.setAttribute("href",U(this._page.getRelativePathToApp()+i).normalize().toString());document.getElementsByTagName("head")[0].appendChild(j);}}};sap.zen.dsh.Dsh.prototype.onAfterRendering=function(){this.doInit();};sap.zen.dsh.Dsh.prototype.logoff=function(){if(this._page&&!this.loggedOff){this.loggedOff=true;window.buddhaHasSendLock++;this._page.exec("APPLICATION.logoff();");}};sap.zen.dsh.Dsh.prototype.exit=function(){this.logoff();var r=sap.ui.getCore().byId(this.sId+"ROOT_absolutelayout");if(r){r.destroy();}};sap.zen.dsh.Dsh.prototype.addParameter=function(n,v){this.parameters[n]=v;};sap.zen.dsh.Dsh.prototype.doesParameterExist=function(n){if(this.parameters[n]){return true;}return false;};sap.zen.dsh.Dsh.prototype.getStartupParameters=function(){if(this.getAppComponent()){if(this.getAppComponent().getComponentData()){return this.getAppComponent().getComponentData().startupParameters;}}return null;};sap.zen.dsh.Dsh.prototype.isDshParameter=function(n){if(n==="XQUERY"||n==="XDISPLAY"||n==="XCHART_TYPE"||n==="XPROMPT"||n==="XVISIBLEPROMPTS"||n==="XDATALIMIT_ROWS"||n==="XDATALIMIT_COLS"){return true;}return false;};sap.zen.dsh.Dsh.prototype.executeScript=function(b){this.page.exec(b);};sap.zen.dsh.Dsh.prototype.getDataSource=function(n){return this.page.getDataSource(n);};sap.zen.dsh.Dsh.prototype.getComponent=function(n){return this.page.getComponent(n);};sap.zen.dsh.Dsh.prototype.getPage=function(){return this.page;};sap.zen.dsh.Dsh.prototype.getMapping=function(n){if(this.getSemanticMappings()&&this.getSemanticMappings()[n]){return this.getSemanticMappings()[n];}return n;};sap.zen.dsh.Dsh.prototype.initializeAppStateData=function(S,n){function b(m,v,V){if(Array.isArray(m)){for(var h in m){if(!v.hasOwnProperty(m[h])){v[m[h]]=V;}}}else{if(!v.hasOwnProperty(m)){v[m]=V;}}}n=n||{};if(S&&S.customData&&S.customData.bookmarkedAppState){this.addParameter("NAV_INITIAL_STATE",S.customData.bookmarkedAppState);}if(S&&S.selectionVariant){var o=S.selectionVariant;if(typeof o!=="object"&&typeof S.oSelectionVariant==="object"&&S.oSelectionVariant.toJSONObject){o=S.oSelectionVariant.toJSONObject();}var p=o.Parameters;var c=o.SelectOptions;if(p){for(var d=0;d<p.length;d++){var P=p[d];if(this.isDshParameter(P.PropertyName)){continue;}n[P.PropertyName]=P.PropertyValue;}}if(c){for(var i=0;i<c.length;++i){var e=c[i];if(this.isDshParameter(e.PropertyName)){continue;}var r=e.Ranges;var f=[];for(var j=0;j<r.length;++j){var g;var R=r[j];if(["EQ","BT","GE","LE","GT","LT"].indexOf(R.Option)==-1){continue;}if(R.Sign==="I"&&R.Option==="EQ"){g=R.Low;}else{g={exclude:R.Sign==="E"||undefined,operation:R.Option,from:R.Low,to:R.High};}f.push(g);}if(f.length>0){b(this.getMapping(e.PropertyName),n,f);}}}}if(!jQuery.isEmptyObject(n)){this.addParameter("NAV_PARAMS",JSON.stringify(n));}};sap.zen.dsh.Dsh.prototype.initializeAppState=function(S,n){if(S){var o={};if(S.getData&&typeof S.getData==="function"){o=S.getData();}this.initializeAppStateData(o,n);}};return sap.zen.dsh.Dsh;});
