// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.AnnotationHelper");jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ui.core.format.DateFormat");jQuery.sap.require("sap.ovp.cards.CommonUtils");sap.ovp.cards.AnnotationHelper={};sap.ovp.cards.AnnotationHelper.formatFunctions={count:0};sap.ovp.cards.AnnotationHelper.NumberFormatFunctions={};sap.ovp.cards.AnnotationHelper.DateFormatFunctions={};sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions={};sap.ovp.cards.AnnotationHelper.criticalityConstants={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};sap.ovp.cards.AnnotationHelper.AnnotationType={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement"};sap.ovp.cards.AnnotationHelper.TextArrangementType={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};sap.ovp.cards.AnnotationHelper.formatterGeo=function(i,j){var k=j.Longitude.Path;var m1=j.Latitude.Path;return"{path:'"+k+"'}; {path:'"+m1+"'}"+";0";};sap.ovp.cards.AnnotationHelper.analyticRegions=function(i,j){return"{path:'"+j.CountryCode.Path+"'}";};sap.ovp.cards.AnnotationHelper.getLabelStateFromValue=function(i){var j;switch(i){case"Default":j=sap.ui.vbm.SemanticType.Default;break;case"Error":j=sap.ui.vbm.SemanticType.Error;break;case"Warning":j=sap.ui.vbm.SemanticType.Warning;break;case"Success":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.getColorStateFromValue=function(i){var j;switch(i){case"0":j="#5E696E";break;case"1":j="#BB0000";break;case"2":j="#E78C07";break;case"3":j="#2B7D2B";break;default:j="#5E696E";break;}return j;};sap.ovp.cards.AnnotationHelper.criticalityType=function(i,j){var k=j.Criticality.Path;return"{path:'"+k+"', formatter: 'sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue' }";};sap.ovp.cards.AnnotationHelper.getCriticalityStateFromValue=function(i){var j;switch(i){case"0":j=sap.ui.vbm.SemanticType.Default;break;case"1":j=sap.ui.vbm.SemanticType.Error;break;case"2":j=sap.ui.vbm.SemanticType.Warning;break;case"3":j=sap.ui.vbm.SemanticType.Success;break;default:j=sap.ui.vbm.SemanticType.None;break;}return j;};sap.ovp.cards.AnnotationHelper.labelText=function(i,j){var k=i.getSetting('ovpCardProperties');var m1=k.getProperty('/showLabelText');if(m1==="true"){var n1=j.Address[0];if(typeof n1.country!=="undefined"){return"{path:'"+n1.country.Path+"'}";}else if(typeof n1.locality!=="undefined"){return"{path:'"+n1.locality.Path+"'}";}else if(typeof n1.street!=="undefined"){return"{path:'"+n1.street.Path+"'}";}else if(typeof n1.code!=="undefined"){return"{path:'"+n1.code.Path+"'}";}}else{return null;}};sap.ovp.cards.AnnotationHelper.getLabelForDataItem=function(i,j){if(!j){return"";}if(j.Label){return j.Label.String;}var k=i.getSetting&&i.getSetting('ovpCardProperties');var m1=k&&k.getProperty("/metaModel");var n1=k&&k.getProperty("/entityType");if(!m1||!n1){return"";}var o1;if(j.Value){o1=j.Value.Path;}if(j.Target){var p1=p(n1.$path,j);var q1=p1&&m1.getProperty(p1);o1=q1&&q1.Value.Path;}if(!o1||!o1.length>0||o1===" "){return"";}var r1=m1.getODataProperty(n1,o1);if(!r1){return"";}var s1=r1["sap:label"]||(r1["com.sap.vocabularies.Common.v1.Label"]||"").String||"";return s1;};function g(i,k){if(i.getSetting){var j=i.getSetting("_ovpCache");if(j){return j[k];}}return undefined;}function s(i,k,j){if(i.getSetting){var m1=i.getSetting("_ovpCache");if(m1){m1[k]=j;}}}function a(i,j){if(!sap.ovp.cards.AnnotationHelper.formatFunctions[j]){sap.ovp.cards.AnnotationHelper.formatFunctions[j]=0;}sap.ovp.cards.AnnotationHelper.formatFunctions[j]++;var k=j+sap.ovp.cards.AnnotationHelper.formatFunctions[j];sap.ovp.cards.AnnotationHelper.formatFunctions[k]=i;return"sap.ovp.cards.AnnotationHelper.formatFunctions."+k;}function c(i,j){var k;if(j){k=j.None;if(i&&i.EnumMember){var m1=i.EnumMember;if(e(m1,'Negative')){k=j.Negative;}else if(e(m1,'Critical')){k=j.Critical;}else if(e(m1,'Positive')){k=j.Positive;}}}return k;}function b(i){if(i=="Error"){i=1;}else if(i=="Warning"){i=2;}else if(i=="Success"){i=3;}else{i=0;}return i;}function e(i,j){return i&&i.indexOf(j,i.length-j.length)!==-1;}function d(i,j,k,m1,n1,o1,p1){var q1={};q1.EnumMember="None";if(i!==undefined){i=Number(i);if(e(j,"Minimize")||e(j,"Minimizing")){if((o1!==undefined&&o1!==null)&&(m1!=undefined&&m1!=null)){if(i<=o1){q1.EnumMember="Positive";}else if(i>m1){q1.EnumMember="Negative";}else{q1.EnumMember="Critical";}}}else if(e(j,"Maximize")||e(j,"Maximizing")){if((n1!==undefined&&n1!==null)&&(k!==undefined&&k!==null)){if(i>=n1){q1.EnumMember="Positive";}else if(i<k){q1.EnumMember="Negative";}else{q1.EnumMember="Critical";}}}else if(e(j,"Target")){if((o1!==undefined&&o1!==null)&&(m1!=undefined&&m1!=null)&&(n1!==undefined&&n1!==null)&&(k!==undefined&&k!==null)){if(i>=n1&&i<=o1){q1.EnumMember="Positive";}else if(i<k||i>m1){q1.EnumMember="Negative";}else{q1.EnumMember="Critical";}}}}return c(q1,p1);}function f(i,j,k,m1){if(!i||!j){return;}i=Number(i);if(!m1&&(i-j>=0)){return"sap-icon://trend-up";}if(!k&&(i-j<=0)){return"sap-icon://trend-down";}if(j&&m1&&(i-j>=m1)){return"sap-icon://trend-up";}if(j&&k&&(i-j<=k)){return"sap-icon://trend-down";}}function h(i,j){var k=i.getPath(0)+"-DataFields-Sorted";var m1=g(i,k);if(!m1){var n1=l(i,j);var o1=n1.map(function(p1){return p1.Value.Path;});o1=o1.filter(function(p1){return!!p1;});m1=j.filter(function(p1){if(p1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&o1.indexOf(p1.Value.Path)===-1){return true;}return false;});m1=r(m1);s(i,k,m1);}return m1;}function l(j,k,m1){var n1=j.getPath(0)+"-DataPoints-Sorted";var o1=g(j,n1);if(!o1){if(m1){o1=k.filter(n);}else{o1=k.filter(m);}o1=r(o1);var p1;for(var i=0;i<o1.length;i++){p1=j.getPath(0).substr(0,j.getPath(0).lastIndexOf("/")+1);o1[i]=j.getModel(0).getProperty(p(p1,o1[i]));p1="";}s(j,n1,o1);}return o1;}function m(i){if(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true;}return false;}function n(i){if((i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/))||(i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.Target.AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/))){return true;}return false;}function o(i){if(!i||!i.Criticality||!i.Criticality.Path){return;}return"{path:'"+i.Criticality.Path+"'}";}function p(i,j){if(i&&!e(i,'/')){i+='/';}return i+j.Target.AnnotationPath.slice(1);}function q(i){var j,k;if(i["com.sap.vocabularies.UI.v1.Importance"]){j=i["com.sap.vocabularies.UI.v1.Importance"].EnumMember;switch(j){case"com.sap.vocabularies.UI.v1.ImportanceType/High":k=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":k=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":k=3;break;}}else{k=4;}return k;}function r(i){if(i.length<2){return i;}var j=parseInt(i.length/2,10);var k=i.slice(0,j);var m1=i.slice(j,i.length);return t(r(k),r(m1));}function t(i,j){var k=[];while(i.length&&j.length){var m1=q(i[0]),n1=q(j[0]);if(m1<=n1){k.push(i.shift());}else{k.push(j.shift());}}while(i.length){k.push(i.shift());}while(j.length){k.push(j.shift());}return k;}function u(i,j,k){var m1=h(i,j)[k];if(m1){return B(i,m1);}return"";}function v(i,j,k){var m1=h(i,j)[k];return sap.ovp.cards.AnnotationHelper.getLabelForDataItem(i,m1);}function w(i,j,k){var m1=l(i,j)[k];if(m1&&m1.Title){return m1.Title.String;}return"";}function x(i,j,k){var m1=j.filter(m);m1=r(m1);if(!m1||!m1.length||!m1.length>0){return"";}return sap.ovp.cards.AnnotationHelper.getLabelForDataItem(i,m1[0]);}function y(i,j,k,m1){var n1=l(i,j)[k];if(!n1){return"";}var o1=i.getSetting('ovpCardProperties');var p1=o1.getProperty("/entityType");var q1=o1.getProperty("/metaModel");return _(i,n1,p1,q1,m1);}function z(i,j,k){var m1=l(i,j)[k];if(m1&&m1.Criticality){return true;}}function A(i,j,k){var m1=l(i,j)[k];var n1=m1.Criticality.Path;return"{path:'"+n1+"'}";}function _(i,j,k,m1,n1){if(!j||!j.Value){return"";}var o1=i.getSetting('ovpCardProperties');var p1=false;if(o1){var q1=o1.getProperty("/ignoreSapText");p1=q1==undefined?p1:q1;}var r1=m1.getODataProperty(k,j.Value.Path);var s1=false;if(p1==true){if(r1&&(r1["com.sap.vocabularies.Analytics.v1.Measure"]||r1["sap:aggregation-role"]=="measure")){s1=true;}}if(!s1&&r1){var t1;if(r1["com.sap.vocabularies.Common.v1.Text"]){t1=r1["com.sap.vocabularies.Common.v1.Text"].String?r1["com.sap.vocabularies.Common.v1.Text"].String:r1["com.sap.vocabularies.Common.v1.Text"].Path;}else if(r1["sap:text"]){t1=r1["sap:text"];}if(t1){r1=m1.getODataProperty(k,t1);j={Value:{Path:r1.name}};}}return B(i,j,n1);}function B(i,j,k,m1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var n1=i.getSetting('ovpCardProperties');var o1=n1.getProperty("/entityType");var p1=n1.getProperty("/metaModel");return D(i,j,o1,p1,k,m1);}function C(i,j,k,m1){if((!k)||(typeof m1!=='string')){return m1;}var n1=k[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT];if(!n1){return m1;}var o1,p1;o1=k[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];p1=o1&&o1.EnumMember;if(!p1){o1=n1&&n1[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];p1=o1&&o1.EnumMember;}if(!p1){o1=j&&j[sap.ovp.cards.AnnotationHelper.AnnotationType.TEXT_ARRANGEMENT];p1=o1&&o1.EnumMember;}if(!p1){return m1;}var q1=sap.ui.model.odata.AnnotationHelper.format(i,n1);if(!q1||q1===" "){return m1;}var r1;switch(p1){case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_FIRST:r1=q1+" ("+m1+")";break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_LAST:r1=m1+" ("+q1+")";break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_ONLY:r1=q1;break;case sap.ovp.cards.AnnotationHelper.TextArrangementType.TEXT_SEPARATE:r1=m1+" ("+q1+")";break;default:r1=m1;break;}return r1;}function D(i,j,k,m1,n1,o1,p1){if(j.Value.Apply){return sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}var q1=m1.getODataProperty(k,j.Value.Path),r1="",s1;var t1=i.getSetting("ovpCardProperties");var u1=t1&&t1.getProperty("/contentFragment");if(!o1){if(j.Value.Path.split("/").length>1){q1=K(m1,k,j.Value.Path);}if(!q1){return"";}if(q1["type"]==='Edm.DateTime'||q1["type"]==='Edm.DateTimeOffset'){var v1=t1&&t1.getProperty("/showDateInRelativeFormat");s1=H("dateFormatFunction",v1);r1=E([j.Value.Path?j.Value.Path:q1.name],s1);}else if((j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)||q1["scale"]){var w1=(j.ValueFormat&&j.ValueFormat.NumberOfFractionalDigits)?j.ValueFormat.NumberOfFractionalDigits.Int:0,x1;if(q1["Org.OData.Measures.V1.ISOCurrency"]){x1=q1["Org.OData.Measures.V1.ISOCurrency"].Path?q1["Org.OData.Measures.V1.ISOCurrency"].Path:q1["Org.OData.Measures.V1.ISOCurrency"].String;}else if(q1["Org.OData.Measures.V1.Unit"]){x1=q1["Org.OData.Measures.V1.Unit"].Path?q1["Org.OData.Measures.V1.Unit"].Path:q1["Org.OData.Measures.V1.Unit"].String;}else if(q1["sap:unit"]){x1=q1["sap:unit"];}var y1=x1?m1.getODataProperty(k,x1):null,z1=[j.Value.Path?j.Value.Path:q1.name];if(w1>2){w1=2;}if(q1["Org.OData.Measures.V1.ISOCurrency"]){var A1=q1["Org.OData.Measures.V1.ISOCurrency"];if(A1.Path){s1=I(w1);z1.push(A1.Path);}else if(A1.String){s1=I(w1,A1.String);}}else if(y1&&(y1["Org.OData.Measures.V1.ISOCurrency"]||y1["sap:semantics"]==="currency-code")){s1=I(w1);z1.push(x1);}else{s1=F(w1);}r1=E(z1,s1);}else{if(p1){r1=sap.ui.model.odata.AnnotationHelper.simplePath(i,j.Value);}else{r1=sap.ui.model.odata.AnnotationHelper.format(i,j.Value);}}if(u1&&u1==="sap.ovp.cards.table.Table"){r1=C(i,k,q1,r1);}if(q1["Org.OData.Measures.V1.Unit"]){var B1=q1["Org.OData.Measures.V1.Unit"];if(B1.Path){r1+=(" "+E([B1.Path]));}else if(B1.String){if(B1.String!=="%"){r1+=" ";}r1+=B1.String;}}}if(!n1){if(q1["Org.OData.Measures.V1.ISOCurrency"]){var A1=q1["Org.OData.Measures.V1.ISOCurrency"];if(A1.Path){r1+=(" "+E([A1.Path]));}else if(A1.String){r1+=(" "+A1.String);}}}if(r1[0]===" "){r1=r1.substring(1);}return r1;}function E(j,k){var m1="",n1=j.length;if(n1>1){m1="{parts:[";for(var i=0;i<n1;i++){m1+=("{path: '"+j[i]+"'}"+((i===n1-1)?"]":", "));}}else{m1="{path: '"+j[0]+"'";}m1+=(k?(", formatter: '"+k+"'"):"")+"}";return m1;}function F(i){var j="formatNumberCalculation"+i;if(!sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]){sap.ovp.cards.AnnotationHelper.NumberFormatFunctions[j]=G(Number(i));}return"sap.ovp.cards.AnnotationHelper.NumberFormatFunctions."+j;}function G(i){return function(j){var k=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});return k.format(Number(j));};}function H(i,j){var k={'relative':true,'relativeScale':'auto'};if(j!==undefined&&!j){k={'style':'medium'};}if(!sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]){sap.ovp.cards.AnnotationHelper.DateFormatFunctions[i]=function(m1){var n1=sap.ui.core.format.DateFormat.getInstance(k);if(!m1){m1="";return m1;}return n1.format(new Date(m1));};}return"sap.ovp.cards.AnnotationHelper.DateFormatFunctions."+i;}function I(i,j){var k="formatCurrencyCalculation"+(j?j+i:i);if(!sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]){sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions[k]=J(i,j);}return"sap.ovp.cards.AnnotationHelper.CurrencyFormatFunctions."+k;}function J(i,j){return function(k,m1){var n1="";var o1=sap.ui.core.format.NumberFormat.getCurrencyInstance({style:'short',showMeasure:false,minFractionDigits:i,maxFractionDigits:i});if(m1){n1=o1.format(k,m1);}else{n1=j?o1.format(k,j):o1.format(k);}return n1;};}function K(j,k,m1){var n1=m1.split("/");if(n1.length>1){for(var i=0;i<(n1.length-1);i++){var o1=j.getODataAssociationEnd(k,n1[i]);if(o1){k=j.getODataEntityType(o1.type);}}return j.getODataProperty(k,n1[n1.length-1]);}}function L(i,j,k){var m1=l(i,j);var n1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;var o1=m1[k];if(!o1){return n1.None;}if(o1.Criticality){return O(i,o1,n1);}return Q(i,o1,n1);}function M(i,j,k){var m1=l(i,j);if(m1&&m1.length){var n1=m1[0];if(n1&&(n1.Criticality||n1.CriticalityCalculation)){return true;}}return false;}sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart=function(i,j,k){if(M(i,j,k)){return'';}return'#5cbae6';};function N(i,j,k){var m1=l(i,j),n1="None",o1=sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues;if(m1.length>k){var p1=m1[k];if(p1&&p1.Criticality){n1=O(i,p1,o1);}else{n1=Q(i,p1,o1);}}return n1;}function O(i,j,k){var m1=sap.ui.core.ValueState.None;var n1;var o1=j.Criticality;if(o1){n1="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+k.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+k.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+k.Positive+"'' : "+"''"+k.None+"'' '}'";if(o1.Path){var p1='$'+sap.ui.model.odata.AnnotationHelper.simplePath(i,o1);m1=jQuery.sap.formatMessage(n1,p1);}else if(o1.EnumMember){var q1="'"+o1.EnumMember+"'";m1=jQuery.sap.formatMessage(n1,q1);}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return m1;}function P(i,j,k){var m1=l(i,j);var n1="None";if(m1.length>k){var o1=m1[k];if(o1&&o1.Criticality&&o1.Criticality.Path){n1=A(i,j,k);}else{n1=Q(i,o1,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);n1=b(n1);}}return n1;}function Q(i,j,k){var m1=k.None;if(j.Criticality){m1=c(j.Criticality,k);}else if(j.CriticalityCalculation&&j.Value&&j.Value&&j.Value.Path){m1=R(i,j,k);}return m1;}function R(i,j,k){var m1=a1(j.Value);var n1=j.CriticalityCalculation.ImprovementDirection.EnumMember;var o1=a1(j.CriticalityCalculation.DeviationRangeLowValue);var p1=a1(j.CriticalityCalculation.DeviationRangeHighValue);var q1=a1(j.CriticalityCalculation.ToleranceRangeLowValue);var r1=a1(j.CriticalityCalculation.ToleranceRangeHighValue);var s1=S(o1);var t1=S(p1);var u1=S(q1);var v1=S(r1);var w1="parts: ["+m1;w1+=s1?","+o1:"";w1+=t1?","+p1:"";w1+=u1?","+q1:"";w1+=v1?","+r1:"";w1+="]";var x1=function(){var z1=1;return d(arguments[0],n1,s1?arguments[z1++]:o1,t1?arguments[z1++]:p1,u1?arguments[z1++]:q1,v1?arguments[z1++]:r1,k);};var y1=a(x1,"formatCriticalityCalculation");return"{"+w1+", formatter: '"+y1+"'}";}function S(i){return(typeof i==="string")&&i.charAt(0)==="{";}function T(j,k,m1){var n1="";var o1=m1.split("/");if(o1.length>1){for(var i=0;i<(o1.length-1);i++){var p1=j.getODataAssociationEnd(k,o1[i]);if(p1){k=j.getODataEntityType(p1.type);if(n1){n1=n1+"/";}n1=n1+o1[i];}else{return n1;}}}return n1;}sap.ovp.cards.AnnotationHelper.formatField=function(i,j){return B(i,j);};sap.ovp.cards.AnnotationHelper.formatItems=function(i,j){var k=i.getSetting('ovpCardProperties');var m1=k.getProperty("/addODataSelect");var n1=k.getProperty("/metaModel");var o1=n1.getODataEntityType(j.entityType);var p1=o1[k.getProperty('/selectionAnnotationPath')];var q1=o1[k.getProperty('/presentationAnnotationPath')];var r1="/"+j.name;var s1=Array.prototype.slice.call(arguments,2);var t1=i.getSetting('ovpCardProperties'),u1=t1.getProperty('/parameters');if(p1||!!u1){if((p1&&p1.Parameters&&p1.Parameters.length>0)||!!u1){r1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(i.getSetting('dataModel'),j,p1,u1);}}if(k.getProperty("/cardLayout")&&k.getProperty("/cardLayout/noOfItems")){var v1="{path: '"+r1+"', length: "+ +(k.getProperty("/cardLayout/noOfItems"));}else{var v1="{path: '"+r1+"', length: "+c1(k);}var w1=[];if(m1){w1=V(i,n1,o1,s1);}var x1=U(n1,o1,s1);if(w1.length>0||x1.length>0){v1=v1+", parameters: {";if(w1.length>0){v1=v1+"select: '"+w1.join(',')+"'";}if(x1.length>0){if(w1.length>0){v1=v1+", ";}v1=v1+"expand: '"+x1.join(',')+"'";}v1=v1+"}";}var y1=X(k,q1);if(y1.length>0){v1=v1+", sorter:"+JSON.stringify(y1);}var z1=sap.ovp.cards.AnnotationHelper.getFilters(k,p1);if(z1.length>0){v1=v1+", filters:"+JSON.stringify(z1);}v1=v1+"}";return v1;};function U(k,m1,n1){var o1=[];var p1,q1,r1,s1;for(var i=0;i<n1.length;i++){if(!n1[i]){continue;}p1=m1.$path+"/"+n1[i];q1=k.createBindingContext(p1);r1=q1.getObject();r1=r1?r1:[];for(var j=0;j<r1.length;j++){if(r1[j].Value&&r1[j].Value.Path){s1=T(k,m1,r1[j].Value.Path);if(s1&&o1.indexOf(s1)===-1){o1.push(s1);}}}}return o1;}function V(m1,n1,o1,p1){var q1=[];var r1,s1,t1;for(var i=0;i<p1.length;i++){if(!p1[i]){continue;}r1=o1.$path+"/"+p1[i];s1=n1.createBindingContext(r1);var u1={};if(m1&&m1.bDummyContext){jQuery.extend(u1,m1,s1,true);}else{u1=m1;}t1=s1.getObject();if(!t1){t1=[];}else if(jQuery.isPlainObject(t1)){if(t1.Data){t1=t1.Data;}else{t1=[];}}var v1;var w1;var x1;var y1;for(var j=0;j<t1.length;j++){w1=[];v1=t1[j];x1="";y1=v1.RecordType;if(y1==="com.sap.vocabularies.UI.v1.DataField"){x1=D(u1,v1,o1,n1,undefined,undefined,true);}else if(y1==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var z1=p(o1.$path,v1);x1=_(u1,n1.getProperty(z1),o1,n1);var A1=o(n1.getProperty(z1));if(A1&&A1.length>0){x1+=A1;}}else if(y1==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&v1.Url){var B1;if(!v1.Url.UrlRef){B1=sap.ui.model.odata.AnnotationHelper.format(u1,v1.Url);}if(B1&&B1.substring(0,2)==="{="){x1=B1;}}if(x1){w1=W(x1);}if(w1&&w1.length>0){var C1;for(var k=0;k<w1.length;k++){C1=w1[k];if(!q1[C1]){q1[C1]=true;var D1=sap.ovp.cards.CommonUtils.getUnitColumn(C1,o1);if(D1&&D1!==C1){q1[D1]=true;}var E1=k1(n1,o1,C1);if(E1&&E1!==C1){q1[E1]=true;}}}}}}return Object.keys(q1);}function W(j){var i,k=0,m1=j.length,n1="",o1;for(i=0;i<m1;i++){o1=j.charAt(i);if(!o1){return;}switch(o1){case"{":k++;break;case"}":k--;break;default:if(k<=0){continue;}break;}n1+=o1;}j=n1;var p1=/\${([a-zA-Z0-9\_|\/]*)/g;var q1=/[^[{]*[a-zA-Z0-9\_]/g;var r1=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s1,t1,u1=[];if(j.indexOf("{parts:[")!==-1){j=j.replace("{parts:[","");}if(j.substring(0,2)==="{="){s1=p1;t1=1;}else if(j.indexOf("path")!==-1){var v1=q1.exec(j);while(v1){if(v1[0].indexOf("path")===-1&&v1[0].indexOf("@i18n")!==0){u1.push(v1[0]);}v1=q1.exec(j);}s1=r1;t1=1;}else{s1=q1;t1=0;}var w1=s1.exec(j);while(w1){if(w1[t1]&&w1[t1].indexOf("@i18n")!==0){u1.push(w1[t1]);}w1=s1.exec(j);}return u1;}function X(j,k){var m1=[];var n1,o1;var p1=j.getProperty("/sortBy");if(p1){var q1=j.getProperty('/sortOrder');if(q1&&q1.toLowerCase()!=='descending'){o1=false;}else{o1=true;}n1={path:p1,descending:o1};m1.push(n1);}var r1=k&&k.SortOrder||undefined;var s1,p1;if(r1){for(var i=0;i<r1.length;i++){s1=r1[i];p1=s1.Property.PropertyPath;o1=Z(s1.Descending,true);n1={path:p1,descending:o1};m1.push(n1);}}return m1;}sap.ovp.cards.AnnotationHelper.getCardSelections=function(i){var j=i.getProperty('/entityType');var k=j[i.getProperty('/selectionAnnotationPath')];return{filters:sap.ovp.cards.AnnotationHelper.getFilters(i,k),parameters:Y(k)};};sap.ovp.cards.AnnotationHelper.getCardSorters=function(j){if(!j){return;}var k=j.getProperty('/entityType');var m1=k[j.getProperty('/presentationAnnotationPath')];var n1=X(j,m1);var o1=[];var i,p1=n1.length;for(i=0;i<p1;i++){if(!n1[i].path){continue;}o1.push({Property:n1[i].path,Descending:n1[i].descending});}if(o1.length>0){return{SortOrder:o1};}};function Y(j){var k,m1=[];if(!j||!j.Parameters){return m1;}var n1=j.Parameters.length;for(var i=0;i<n1;i++){k=j.Parameters[i];if(!k.PropertyName||!k.PropertyName.PropertyPath){continue;}if(!k.PropertyValue){jQuery.sap.log.error("Missing value for parameter "+k.PropertyName.PropertyPath);continue;}m1[m1.length]={path:k.PropertyName.PropertyPath,value:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(k.PropertyValue)};}return m1;}sap.ovp.cards.AnnotationHelper.getFilters=function(k,m1){var n1=[];var o1;var p1=k.getProperty("/filters");if(p1){n1=n1.concat(p1);}if(m1&&m1.SelectOptions){o1=m1.SelectOptions;}else{o1=m1;}var q1,r1,s1;if(o1){for(var i=0;i<o1.length;i++){q1=o1[i];r1=q1.PropertyName.PropertyPath;for(var j=0;j<q1.Ranges.length;j++){s1=q1.Ranges[j];if(s1.Sign.EnumMember){var t1={path:r1,operator:s1.Option.EnumMember.split("/")[1],value1:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(s1.Low),value2:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(s1.High),sign:s1.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(t1.sign==="E"&&t1.operator!==sap.ui.model.FilterOperator.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");continue;}if(t1.sign==="E"&&t1.operator===sap.ui.model.FilterOperator.EQ){t1.operator=sap.ui.model.FilterOperator.NE;t1.sign="I";}if(t1.operator==="CP"&&t1.sign==="I"){var u1=sap.ui.model.FilterOperator.Contains;var v1=t1.value1;if(v1){var w1=v1.indexOf('*');var x1=v1.lastIndexOf('*');if(w1>-1){if((w1===0)&&(x1!==(v1.length-1))){u1=sap.ui.model.FilterOperator.EndsWith;v1=v1.substring(1,v1.length);}else if((w1!==0)&&(x1===(v1.length-1))){u1=sap.ui.model.FilterOperator.StartsWith;v1=v1.substring(0,v1.length-1);}else{v1=v1.substring(1,v1.length-1);}}}t1.operator=u1;t1.value1=v1;}n1.push(t1);}}}}return n1;};function Z(i,j){if(i&&i.Boolean){if(i.Boolean.toLowerCase()==="true"){return true;}else if(i.Boolean.toLowerCase()==="false"){return false;}}else if(i&&i.Bool){if(i.Bool.toLowerCase()==="true"){return true;}else if(i.Bool.toLowerCase()==="false"){return false;}}return j;}function $(i){var j;if(i){if(i.String){j=Number(i.String);}else if(i.Int){j=Number(i.Int);}else if(i.Decimal){j=Number(i.Decimal);}else if(i.Double){j=Number(i.Double);}else if(i.Single){j=Number(i.Single);}}return j;}sap.ovp.cards.AnnotationHelper.getPrimitiveValue=function(i){var j;if(i){if(i.String||i.String===""){j=i.String;}else if(i.Boolean||i.Bool){j=Z(i);}else{j=$(i);}}return j;};function a1(i){if(i){if(i.Path){return"{path:'"+i.Path+"'}";}else{return sap.ovp.cards.AnnotationHelper.getPrimitiveValue(i);}}else{return"";}}var b1={"List_condensed":{phone:5,tablet:5,desktop:5},"List_extended":{phone:3,tablet:3,desktop:3},"List_condensed_bar":{phone:5,tablet:5,desktop:5},"List_extended_bar":{phone:3,tablet:3,desktop:3},"Table":{phone:5,tablet:5,desktop:5},"Stack_simple":{phone:20,tablet:20,desktop:20},"Stack_complex":{phone:5,tablet:5,desktop:5}};function c1(i){var j=i.getProperty('/contentFragment');var k=i.getProperty('/listType');var m1=i.getProperty('/listFlavor');var n1;var o1="desktop";if(sap.ui.Device.system.phone){o1="phone";}else if(sap.ui.Device.system.tablet){o1="tablet";}if(j=="sap.ovp.cards.list.List"){if(k=="extended"){if(m1=="bar"){n1=b1["List_extended_bar"];}else{n1=b1["List_extended"];}}else if(m1=="bar"){n1=b1["List_condensed_bar"];}else{n1=b1["List_condensed"];}}else if(j=="sap.ovp.cards.table.Table"){n1=b1["Table"];}else if(j=="sap.ovp.cards.stack.Stack"){if(i.getProperty('/objectStreamCardsNavigationProperty')){n1=b1["Stack_complex"];}else{n1=b1["Stack_simple"];}}if(n1){return n1[o1];}return 5;}sap.ovp.cards.AnnotationHelper.removeDuplicateDataField=function(i){var j=i.getObject();var k=l(i,j,true);var m1=k.map(function(n1){if(n1&&n1.Value&&n1.Value.Path){return n1.Value.Path;}else if(n1&&n1.fn&&n1.fn.Path){return n1.fn.Path;}});j.filter(function(n1,o1){if(n1.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&m1.indexOf(n1.Value.Path)>-1){j.splice(o1,1);}});};sap.ovp.cards.AnnotationHelper.formatUrl=function(i,j){if(j.charAt(0)==='/'||j.indexOf("http")===0){return j;}var k=i.getModel(0).getProperty("/baseUrl");if(k){return k+"/"+j;}return j;};sap.ovp.cards.AnnotationHelper.getDataPointsCount=function(i,j){var k=l(i,j);return k.length;};sap.ovp.cards.AnnotationHelper.getFirstDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointValue=function(i,j){return sap.ovp.cards.AnnotationHelper.getDataPointValue(i,j,1);};sap.ovp.cards.AnnotationHelper.getDataPointValue=function(i,j,k){var m1=l(i,j),n1=m1[k];if(n1&&n1.Value&&n1.Value.Path){return n1.Value.Path;}return"";};sap.ovp.cards.AnnotationHelper.getFirstDataFieldName=function(i,j){return v(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataFieldName=function(i,j){return v(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataFieldName=function(i,j){return v(i,j,2);};sap.ovp.cards.AnnotationHelper.getFourthDataFieldName=function(i,j){return v(i,j,3);};sap.ovp.cards.AnnotationHelper.getFifthDataFieldName=function(i,j){return v(i,j,4);};sap.ovp.cards.AnnotationHelper.formatDataFieldValueOnIndex=function(i,j,k){return u(i,j,k);};sap.ovp.cards.AnnotationHelper.formatDataPointValueOnIndex=function(i,j,k){return y(i,j,k);};sap.ovp.cards.AnnotationHelper.formatDataPointOrField=function(i,j,k,m1){var n1=sap.ovp.cards.AnnotationHelper.getDataPointsCount(i,j);if(n1>0){return sap.ovp.cards.AnnotationHelper.formatDataPointValueOnIndex(i,j,k);}else{return sap.ovp.cards.AnnotationHelper.formatDataFieldValueOnIndex(i,j,m1);}};sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric=function(i,j,k){return e1(i,j,k);};sap.ovp.cards.AnnotationHelper.getFirstDataPointName=function(i,j){return w(i,j,0);};sap.ovp.cards.AnnotationHelper.getSecondDataPointName=function(i,j){return w(i,j,1);};sap.ovp.cards.AnnotationHelper.getThirdDataPointName=function(i,j){return w(i,j,2);};sap.ovp.cards.AnnotationHelper.getLabelForFirstDataPoint=function(i,j){return x(i,j,0);};sap.ovp.cards.AnnotationHelper.formatImageUrl=function(j,k){for(var i=0;i<k.length;i++){var m1=k[i];if(m1.RecordType==="com.sap.vocabularies.UI.v1.DataField"){if(m1.IconUrl&&m1.IconUrl.String){return m1.IconUrl.String;}if(m1.IconUrl&&m1.IconUrl.Path){return sap.ui.model.odata.AnnotationHelper.simplePath(j,m1.IconUrl);}}}};sap.ovp.cards.AnnotationHelper.formatUnit=function(i,j,k){var m1="";var n1;if(jQuery.isArray(j)){n1=l(i,j)[k];}else{var o1=jQuery.extend({},j);var p1=jQuery.extend({},i);n1=d1(p1,o1);}if(!n1||!n1.Value){return m1;}var q1=i.getSetting('ovpCardProperties');var r1=q1&&q1.getProperty("/entityType");var s1=q1&&q1.getProperty("/metaModel");var t1=s1&&s1.getODataProperty(r1,n1.Value.Path);var u1=t1&&t1["Org.OData.Measures.V1.ISOCurrency"];if(u1&&u1.Path){m1+=(" "+E([u1.Path]));}else if(u1&&u1.String){m1+=(" "+u1.String);}return m1;};sap.ovp.cards.AnnotationHelper.formatObjectNumber=function(i,j,k,m1){return y(i,j,k,m1);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointState=function(i,j){return L(i,j,0);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor=function(i,j){return N(i,j,0);};sap.ovp.cards.AnnotationHelper.formatSecondDataPointState=function(i,j){return L(i,j,1);};sap.ovp.cards.AnnotationHelper.formatThirdDataPointState=function(i,j){return L(i,j,2);};sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField=function(i,j){return P(i,j,0);};sap.ovp.cards.AnnotationHelper.formatKPIHeaderState=function(i,j){return Q(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.ColorValues);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality=function(i,j){return z(i,j,0);};sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticalityForTableStatus=function(i,j){var k=l(i,j)[0];if(k&&(k.Criticality||k.CriticalityCalculation)){return true;}return false;};sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality=function(i,j){return z(i,j,1);};sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality=function(i,j){return z(i,j,2);};sap.ovp.cards.AnnotationHelper.getSortedDataFields=function(i,j){return h(i,j);};sap.ovp.cards.AnnotationHelper.getSortedDataPoints=function(i,j){return l(i,j);};function d1(i,j){var k=i.getPath(0);var m1=k.slice(0,k.lastIndexOf("/"));m1=m1.slice(0,m1.lastIndexOf("/"));var n1=p(m1,j);j=i.getModel(0).getProperty(n1);return j;}sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric=function(i,j){if(!j){return"";}return B(i,j);};function e1(j,k,m1,n1){var o1;var p1=n1==undefined?m1:h(j,m1)[n1];var q1=j.getSetting('ovpCardProperties');var r1=q1.getProperty("/metaModel");var s1=r1.getODataEntityType(k.entityType);var t1=s1.property;if(t1){for(var i=0;i<t1.length;i++){if(p1.Value.Path===t1[i].name){o1=t1[i]["com.sap.vocabularies.Common.v1.SemanticObject"];if(o1){return sap.ui.model.odata.AnnotationHelper.format(j,o1);}else{return"";}}}}}sap.ovp.cards.AnnotationHelper.formatDataPointValue=function(i,j,k){if(!j){return"";}var m1=i.getSetting('ovpCardProperties');var n1=m1.getProperty("/entityType");var o1=m1.getProperty("/metaModel");var p1=jQuery.extend({},j);var q1=jQuery.extend({},i);j=d1(q1,p1);return _(i,j,n1,o1,k);};sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric=function(i,j){var k=jQuery.extend({},j);var m1=jQuery.extend({},i);var n1="None",o1=sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues;j=d1(m1,k);if(j&&j.Criticality){n1=O(i,j,o1);}else{n1=Q(i,j,o1);}return n1;};sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric=function(i,j){var k=jQuery.extend({},j);var m1=jQuery.extend({},i);j=d1(m1,k);if(j&&j.Criticality){return true;}};sap.ovp.cards.AnnotationHelper.checkCriticalityGenericForTableStatus=function(i,j){var k=jQuery.extend({},j);var m1=jQuery.extend({},i);var n1=i.getSetting('ovpCardProperties');var o1=n1.getProperty("/entityType");var p1=n1.getProperty("/metaModel");j=d1(m1,k);if(!j){return;}var q1=p1.getODataProperty(o1,j.Value.Path);if(j&&q1&&q1.type=="Edm.String"&&(j.Criticality||j.CriticalityCalculation)){return true;}};sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric=function(i,j){var k=jQuery.extend({},j);var m1=jQuery.extend({},i);j=d1(m1,k);var n1="None";if(j&&j.Criticality&&j.Criticality.Path){n1="{path:'"+j.Criticality.Path+"'}";}else{n1=Q(i,j,sap.ovp.cards.AnnotationHelper.criticalityConstants.StateValues);n1=b(n1);}return n1;};sap.ovp.cards.AnnotationHelper.hasActions=function(j,k){var m1;for(var i=0;i<k.length;i++){m1=k[i];if(m1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||m1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||m1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1;}}return 0;};sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit=function(i,j){var k=l(i,j)[0];if(k&&k.Value&&k.Value.Path){var m1=i.getPath(0).substr(0,i.getPath(0).lastIndexOf("/")+1);var n1=i.getModel(0);var o1=n1.getProperty(m1);var p1=n1.getODataProperty(o1,k.Value.Path);if(p1&&p1["Org.OData.Measures.V1.Unit"]){return p1["Org.OData.Measures.V1.Unit"].String==="%";}}return false;};sap.ovp.cards.AnnotationHelper.resolveEntityTypePath=function(i){var j=i.getObject();var k=i.getModel();var m1=k.getProperty("/metaModel");var n1=m1.getODataEntitySet(k.getProperty("/entitySet"));var o1=m1.getODataEntityType(n1.entityType);j=o1.$path+"/"+j;return m1.createBindingContext(j);};sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet=function(i,j,k,m1){jQuery.sap.require("sap.ui.model.analytics.odata4analytics");var n1="";var o1=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(i));var p1=o1.findQueryResultByName(j.name);if(!p1){n1="/"+j.name;jQuery.sap.log.error("findQueryResultByName","Entity Set not found in the QueryResultRequest");return n1;}var q1=new sap.ui.model.analytics.odata4analytics.QueryResultRequest(p1);var r1=p1.getParameterization();if(r1){var s1;q1.setParameterizationRequest(new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(r1));if(k&&k.Parameters){jQuery.each(k.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){s1=this.PropertyNameFrom.PropertyPath.split("/");q1.getParameterizationRequest().setParameterValue(s1[s1.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String);}else{s1=this.PropertyName.PropertyPath.split("/");q1.getParameterizationRequest().setParameterValue(s1[s1.length-1],this.PropertyValue.String);}});}else if(m1){jQuery.each(m1,function(){q1.getParameterizationRequest().setParameterValue(this.path,this.value);});}else{n1="/"+j.name;jQuery.sap.log.error("SelectionParameters","There are no parameters to resolve");return n1;}}try{n1=q1.getURIToQueryResultEntitySet();}catch(t1){p1=q1.getQueryResult();n1="/"+p1.getEntitySet().getQName();jQuery.sap.log.error("getEntitySetPathWithParameters","binding path with parameters failed - "+t1||t1.message);}return n1;};sap.ovp.cards.AnnotationHelper.getAssociationObject=function(j,k,ns){var m1=j.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<m1.length;i++){if(ns+"."+m1[i].name===k){return m1[i];}}};function f1(i,j){var k=i.filter(function(n1){if(n1.RecordType==="com.sap.vocabularies.UI.v1.DataField"){return true;}return false;});var m1=r(k);if(m1){return m1[j];}return;}sap.ovp.cards.AnnotationHelper.semanticObjectOfFirstDataField=function(i,j,k){if(!k||!k.length||k.length===0){return false;}k=f1(k,0);return e1(i,j,k);};sap.ovp.cards.AnnotationHelper.semanticObjectOfSecondDataField=function(i,j,k){if(!k||!k.length||k.length===0){return false;}k=f1(k,1);return e1(i,j,k);};function g1(i,j){var k=i.filter(function(n1){if(n1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&n1.Target.AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1){return true;}return false;});var m1=r(k);if(m1){return m1[j];}return;}sap.ovp.cards.AnnotationHelper.isFirstContactAnnotation=function(i){if(!i||!i.length||i.length===0){return false;}var j=g1(i,0);if(j){return true;}return false;};sap.ovp.cards.AnnotationHelper.getAggregateNumber=function(i,j,k,m1){var n1,o1,p1;if(k&&k.Value&&k.Value.Path){n1=k.Value.Path;}else if(k&&k.Description&&k.Description.Value&&k.Description.Value.Path){n1=k.Description.Value.Path;}if(k&&k.Description&&k.Description.Path){o1=k.Description.Path;}else if(k&&k.Title&&k.Title.Path){p1=k.Title.Path;}var q1="";var r1=m1&&m1.Parameters;var s1="";var t1=i.getSetting('ovpCardProperties'),u1=t1.getProperty('/parameters');r1=r1||!!u1;if(r1){var v1=i.getSetting("dataModel");var w1=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(v1,j,m1,u1);q1+="{path: '"+w1+"'";}else{q1+="{path: '/"+j.name+"'";}q1+=", length: 1";var x1=i.getSetting('ovpCardProperties');var y1=x1.getProperty("/entityType");var z1=sap.ovp.cards.CommonUtils.getUnitColumn(n1,y1);var A1=sap.ovp.cards.AnnotationHelper.getFilters(x1,m1);if(A1.length>0){s1+=", filters: "+JSON.stringify(A1);}var B1=[];B1.push(n1);if(o1){B1.push(o1);}else if(p1){B1.push(p1);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeLowValue&&k.CriticalityCalculation.DeviationRangeLowValue.Path){B1.push(k.CriticalityCalculation.DeviationRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeLowValue&&k.CriticalityCalculation.ToleranceRangeLowValue.Path){B1.push(k.CriticalityCalculation.ToleranceRangeLowValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.DeviationRangeHighValue&&k.CriticalityCalculation.DeviationRangeHighValue.Path){B1.push(k.CriticalityCalculation.DeviationRangeHighValue.Path);}if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ToleranceRangeHighValue&&k.CriticalityCalculation.ToleranceRangeHighValue.Path){B1.push(k.CriticalityCalculation.ToleranceRangeHighValue.Path);}if(z1){B1.push(z1);}if(k&&k.TrendCalculation&&k.TrendCalculation.ReferenceValue&&k.TrendCalculation.ReferenceValue.Path){B1.push(k.TrendCalculation.ReferenceValue.Path);}return q1+", parameters:{select:'"+B1.join(",")+"'}"+s1+"}";};sap.ovp.cards.AnnotationHelper.KpiValueFormatter=function(k){if(isNaN(k)){return k;}var i,j,m1=false;if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits){i=Number(this.oPropagatedProperties.oModels.ovpCardProperties.oData.NumberOfFractionalDigits);}if(this.oPropagatedProperties.oModels.ovpCardProperties.oData.percentageAvailable){m1=true;}if(!i||i<0){i=0;}else if(i>2){i=2;}j=k;if(k){var n1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:i,maxFractionDigits:i,style:"short",showScale:true,shortRefNumber:j});if(m1){return n1.format(Number(k))+" %";}else{return n1.format(Number(k));}}};sap.ovp.cards.AnnotationHelper.formThePathForAggregateNumber=function(i){if(!i||!i.Value||!i.Value.Path){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var m1=j.getProperty("/metaModel");var n1=m1.getODataProperty(k,i.Value.Path);if(n1["Org.OData.Measures.V1.Unit"]){var o1=n1["Org.OData.Measures.V1.Unit"];if(o1.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true;}}return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.KpiValueFormatter'}";};sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon=function(i,j){if(!j||!j.Value||!j.Value.Path||!j.TrendCalculation){return"";}var k=a1(j.Value);var m1=a1(j.TrendCalculation.ReferenceValue);var n1=a1(j.TrendCalculation.DownDifference);var o1=a1(j.TrendCalculation.UpDifference);var p1=S(m1);var q1=S(n1);var r1=S(o1);var s1="parts: ["+k;s1+=p1?","+m1:"";s1+=q1?","+n1:"";s1+=r1?","+o1:"";s1+="]";var t1=function(){var v1=1;return f(arguments[0],p1?arguments[v1++]:m1,q1?arguments[v1++]:n1,r1?arguments[v1++]:o1);};var u1=a(t1,"formatTrendDirection");return"{"+s1+", formatter: '"+u1+"'}";};sap.ovp.cards.AnnotationHelper.formPathForPercentageChange=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=i.ValueFormat.NumberOfFractionalDigits.Int;}if(i.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+i.Value.Path+"'}, {path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}else{return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}";}};sap.ovp.cards.AnnotationHelper.TargetValueFormatter=function(k,i){var j,m1,n1,o1,p1=false;if(isNaN(+k)){return"";}if(k==0){o1=i;}else{o1=k;}m1=this.getModel('ovpCardProperties');if(m1.getProperty("/iNumberOfFractionalDigits")){n1=+(m1.getProperty("/iNumberOfFractionalDigits"));}if(m1.getProperty("/bPercentageAvailableForTarget")){p1=true;}if(i){j=i;}else{if(m1.getProperty("/sManifestTargetValue")){j=m1.getProperty("/sManifestTargetValue");}}if(!n1||n1<0){n1=0;}else if(n1>2){n1=2;}if(j){var q1=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:n1,maxFractionDigits:n1,style:"short",showScale:true,shortRefNumber:o1});if(p1){return q1.format(+(j))+" %";}else{return q1.format(+(j));}}};sap.ovp.cards.AnnotationHelper.formPathForTargetValue=function(i){if(!i||!i.TrendCalculation||!i.TrendCalculation.ReferenceValue){return"";}if(!i||!i.Value||!i.Value.Path){return"";}var j=this.getModel('ovpCardProperties');var k=j.getProperty("/entityType");var m1=j.getProperty("/metaModel");if(i&&i.ValueFormat&&i.ValueFormat.NumberOfFractionalDigits&&i.ValueFormat.NumberOfFractionalDigits.Int){j.setProperty("/iNumberOfFractionalDigits",i.ValueFormat.NumberOfFractionalDigits.Int);}if(i.TrendCalculation.ReferenceValue){if(i.TrendCalculation.ReferenceValue.String){j.setProperty("/sManifestTargetValue",i.TrendCalculation.ReferenceValue.String);return"{parts: [{path:'"+i.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}if(i.TrendCalculation.ReferenceValue.Path){var n1=m1.getODataProperty(k,i.TrendCalculation.ReferenceValue.Path);if(n1["Org.OData.Measures.V1.Unit"]){var o1=n1["Org.OData.Measures.V1.Unit"];if(o1.String=="%"){j.setProperty("/bPercentageAvailableForTarget",true);}}return"{parts: [{path:'"+i.Value.Path+"'},{path:'"+i.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}";}}};sap.ovp.cards.AnnotationHelper.returnPercentageChange=function(k,i){jQuery.sap.require("sap.ui.core.format.NumberFormat");var j,m1,n1;if(isNaN(+k)){return"";}k=+(k);n1=this.getModel('ovpCardProperties');if(n1.getProperty("/iNumberOfFractionalDigits")){j=+(n1.getProperty("/iNumberOfFractionalDigits"));}if(i){m1=+(i);}else{if(n1.getProperty("/sManifestTargetValue")){m1=+(n1.getProperty("/sManifestTargetValue"));}}if(!j||j<0){j=0;}else if(j>2){j=2;}if(m1){var o1=((k-m1)/m1);var p1=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:j,maxFractionDigits:j,showScale:true});return p1.format(o1);}};sap.ovp.cards.AnnotationHelper.isPresentationVarientPresent=function(i){if(i&&i.GroupBy&&!(jQuery.isEmptyObject(i.GroupBy))&&i.GroupBy[0].hasOwnProperty('PropertyPath')){return true;}else{return false;}};sap.ovp.cards.AnnotationHelper.listGroupBy=function(i){var j="";var k=i&&i.GroupBy;if(!k){return j;}var m1=this.getModel('ovpCardProperties').getProperty("/metaModel");var n1=this.getModel('ovpCardProperties').getProperty("/entityType");var o1;if(i.GroupBy.constructor===Array){o1=i.GroupBy;}else if(!i.GroupBy.Collection){return j;}else{o1=i.GroupBy.Collection;}var p1;jQuery.each(o1,function(){p1=j1(m1,n1,this.PropertyPath);if(!p1){return;}j+=p1;j+=", ";});if(j[j.length-1]===" "&&j[j.length-2]===","){j=j.substring(0,j.length-2);}return j==""?"":sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("By",[j]);};sap.ovp.cards.AnnotationHelper.formTheFilterByString=function(i,j,k){var m1=true;var n1=k["SelectOptions"].length-1;if(j.PropertyName.PropertyPath===k["SelectOptions"][n1].PropertyName.PropertyPath){m1=false;}j=[j];var o1=i.getSetting('ovpCardProperties');var p1=o1.getProperty("/entityType");var q1=o1.getProperty("/metaModel");var r1=sap.ovp.cards.AnnotationHelper.getFilters(o1,j);if(r1.length==0){return"";}var s1;var t1;s1=r1[0].path;t1=k1(q1,p1,s1);if(t1!==s1){return"";}var u1=h1(r1);if(m1===true){return u1+", ";}return u1;};sap.ovp.cards.AnnotationHelper.formTheFilterByStringNotFromSelVar=function(i,j,k){var m1=!(j.index===(k.length-1));var n1=h1([k[j.index]]);if(m1===true){return n1+", ";}return n1;};sap.ovp.cards.AnnotationHelper.formTheIdForFilter=function(i){return i.id;};sap.ovp.cards.AnnotationHelper.formTheIdForFilterNotFromSelVar=function(i){return i.id;};function h1(j){var k=[];for(var i=0;i<j.length;i++){k.push(i1(j[i]));}return k.join(', ');}function i1(i){var j=false;var k=i.value1;if(i.operator[0]==="N"){j=true;}if(i.value2){k+=" - "+i.value2;}if(j){k=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("kpiHeader_Filter_NotOperator",[k]);}return k;}function j1(i,j,k){return l1(i,j,k,"com.sap.vocabularies.Common.v1.Label");}function k1(i,j,k){return l1(i,j,k,"sap:text");}function l1(i,j,k,m1){var n1=i.getODataProperty(j,k);if(!n1){jQuery.sap.log.error("No Property Found for with Name '"+k+" For Entity-Type '"+j.name+"'");return;}var o1=n1[m1];if(o1){if(m1==="com.sap.vocabularies.Common.v1.Label"){return o1.String;}return o1;}return n1.name;}sap.ovp.cards.AnnotationHelper._criticality2state=c;sap.ovp.cards.AnnotationHelper._calculateCriticalityState=d;sap.ovp.cards.AnnotationHelper._calculateTrendDirection=f;sap.ovp.cards.AnnotationHelper._getPropertiesFromBindingString=W;sap.ovp.cards.AnnotationHelper.sortCollectionByImportance=r;sap.ovp.cards.AnnotationHelper.formatterGeo.requiresIContext=true;sap.ovp.cards.AnnotationHelper.analyticRegions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.criticalityType.requiresIContext=true;sap.ovp.cards.AnnotationHelper.labelText.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formThePathForTrendIcon.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByString.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formTheFilterByStringNotFromSelVar.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getAggregateNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFourthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFifthDataFieldName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointOrField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataFieldValueOnIndex.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getDataPointsCount.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getThirdDataPointName.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointValueOnIndex.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointColor.requiresIContext=true;sap.ovp.cards.AnnotationHelper.colorPaletteForComparisonMicroChart.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatSecondDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatThirdDataPointState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatFirstDataPointStateForSmartField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatKPIHeaderState.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.hasActions.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getFirstDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatImageUrl.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSecondDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointPercentageUnit.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isFirstDataPointCriticalityForTableStatus.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isSecondDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.isThirdDataPointCriticality.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataFieldValueGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointValue.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.checkCriticalityGenericForTableStatus.requiresIContext=true;sap.ovp.cards.AnnotationHelper.removeDuplicateDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatDataPointStateForSmartFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatsemanticObjectOfDataFieldGeneric.requiresIContext=true;sap.ovp.cards.AnnotationHelper.semanticObjectOfFirstDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.semanticObjectOfSecondDataField.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataPoints.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getSortedDataFields.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getLabelForDataItem.requiresIContext=true;sap.ovp.cards.AnnotationHelper.getLabelForFirstDataPoint.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatObjectNumber.requiresIContext=true;sap.ovp.cards.AnnotationHelper.formatUnit.requiresIContext=true;}());
