// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ovp.cards.linklist.AnnotationHelper");sap.ovp.cards.linklist.AnnotationHelper={};function g(o){var s=[];var S,d;var p=o.getProperty("/sortBy");if(p){var b=o.getProperty("/sortOrder");if(b&&b.toLowerCase()!=="descending"){d=false;}else{d=true;}S={path:p,descending:d};s.push(S);}return s;}function a(o,s){var f=[];var c=o.getProperty("/filters");if(c){f=f.concat(c);}var S=s&&s.SelectOptions;var b,p,r;if(S){for(var i=0;i<S.length;i++){b=S[i];p=b.PropertyName.PropertyPath;for(var j=0;j<b.Ranges.length;j++){r=b.Ranges[j];if(r.Sign.EnumMember){var F={path:p,operator:r.Option.EnumMember.split("/")[1],value1:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(r.Low),value2:sap.ovp.cards.AnnotationHelper.getPrimitiveValue(r.High),sign:r.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(F.sign==="E"&&F.operator!==sap.ui.model.FilterOperator.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");continue;}if(F.sign==="E"&&F.operator===sap.ui.model.FilterOperator.EQ){F.operator=sap.ui.model.FilterOperator.NE;F.sign="I";}if(F.operator==="CP"&&F.sign==="I"){var I=sap.ui.model.FilterOperator.Contains;var v=F.value1;if(v){var n=v.indexOf('*');var d=v.lastIndexOf('*');if(n>-1){if((n===0)&&(d!==(v.length-1))){I=sap.ui.model.FilterOperator.EndsWith;v=v.substring(1,v.length);}else if((n!==0)&&(d===(v.length-1))){I=sap.ui.model.FilterOperator.StartsWith;v=v.substring(0,v.length-1);}else{v=v.substring(1,v.length-1);}}}F.operator=I;F.value1=v;}f.push(F);}}}}return f;}sap.ovp.cards.linklist.AnnotationHelper.formatItems=function(c,e,h){var m=c.getSetting("ovpCardProperties");var M=m.getProperty("/metaModel");var E=M.getODataEntityType(e.entityType);var s="/"+e.name;var S=E[m.getProperty("/selectionAnnotationPath")];var i;var l=m.getProperty("/layoutDetail");if(l==='resizable'){var C=m.getProperty("/cardLayout");if(C){if(m.getProperty("/listFlavor")==="standard"){var t="";for(var b in h){t+=b;}var r=m.getProperty("/cardLayout/iRowHeigthPx");if(r===undefined){r=16;}var I;if(m.getProperty("/densityStyle")==="cozy"){I=72;if((t.indexOf("Description")===-1)&&((t.indexOf("Title")>0&&t.indexOf("ImageUrl")>0)||(t.indexOf("Title")>0&&t.indexOf("TypeImageUrl")>0))){I=56;}else if((t.indexOf("Description")===-1)&&t.indexOf("Title")>0){I=48;}}else{I=60;if((t.indexOf("Description")===-1)&&((t.indexOf("Title")>0&&t.indexOf("ImageUrl")>0)||(t.indexOf("Title")>0&&t.indexOf("TypeImageUrl")>0))){I=48;}else if((t.indexOf("Description")===-1)&&t.indexOf("Title")>0){I=40;}}m.setProperty('/cardLayout/itemHeight',I);if(!m.getProperty("/defaultSpan")&&m.getProperty("/cardLayout/autoSpan")){i=m.getProperty("/cardLayout/noOfItems");var d=Math.ceil((i*I+m.getProperty("/cardLayout/headerHeight")+2*m.getProperty("/cardLayout/iCardBorderPx"))/r);m.setProperty("/cardLayout/noOfItems",d);}else{var f=Math.floor(((C.rowSpan*r)-m.getProperty("/cardLayout/headerHeight")-2*m.getProperty("/cardLayout/iCardBorderPx")));i=Math.floor(f/I)*C.colSpan;}}}}else{i=6;}var o=c.getSetting('ovpCardProperties'),p=o.getProperty('/parameters');if(S||!!p){if((S&&S.Parameters)||!!p){s=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(c.getSetting("dataModel"),e,S,p);}}var j="{path: '"+s+"', length: "+i;var k=g(m);if(k.length>0){j=j+", sorter:"+JSON.stringify(k);}var F=a(m,S);if(F.length>0){j=j+", filters:"+JSON.stringify(F);}j=j+"}";return j;};sap.ovp.cards.linklist.AnnotationHelper.formatUrl=function(c,u){var b=c.getModel().getProperty("/baseUrl");return sap.ovp.cards.linklist.AnnotationHelper.formUrl(b,u);};sap.ovp.cards.linklist.AnnotationHelper.isImageUrl=function(i,d){var I=true;var o=sap.ui.model.odata.AnnotationHelper.format(i,d);if(o.toLowerCase().indexOf("icon")>0){I=false;}return I;};sap.ovp.cards.linklist.AnnotationHelper.isImageUrlStaticData=function(d){var i=true;if(!d){return null;}else if(d.toLowerCase().indexOf("icon")>0){i=false;}return i;};sap.ovp.cards.linklist.AnnotationHelper.isValidURL=function(u){var p=new RegExp("((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?","i");return p.test(u);};sap.ovp.cards.linklist.AnnotationHelper.getIconPath=function(t){var i;if(t.hasOwnProperty("Path")){i="{"+t.Path+"}";}else{i=t.String;}return i;};sap.ovp.cards.linklist.AnnotationHelper.formatString=function(o){var p="{"+o.String+"}";return p;};sap.ovp.cards.linklist.AnnotationHelper.linkedAction=function(A){if(A){return 1;}return 0;};sap.ovp.cards.linklist.AnnotationHelper.formUrl=function(b,u){if(!u){return undefined;}else if(u.lastIndexOf(b,0)===0||u.indexOf("://")>0){return u;}else if(u.lastIndexOf("/",0)===0){return b+u;}else{return b+"/"+u;}};sap.ovp.cards.linklist.AnnotationHelper.isVisible=function(i,s,v){var f;if(typeof v==="object"){f=v[i];}else{f=(typeof v==="boolean")?v:true;}return!s[i]&&f;};sap.ovp.cards.linklist.AnnotationHelper.getApplicationName=function(l,s,b){var n="";if(l){if(s&&b){n="#"+s+"-"+b;for(var i=0;i<l.length;i++){if(l[i].value===n){return l[i].name;}}n="";}else{return l[0].name;}}return n;};sap.ovp.cards.linklist.AnnotationHelper.getImageUrl=function(c,i){return sap.ovp.cards.linklist.AnnotationHelper.formUrl(c.baseUrl,i);};sap.ovp.cards.linklist.AnnotationHelper.staticContentWithLength=function(p){var P="{"+p+", length:3}";return P;};sap.ovp.cards.linklist.AnnotationHelper.contentRowIndex=function(r){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","");};sap.ovp.cards.linklist.AnnotationHelper.isImageUrl.requiresIContext=true;sap.ovp.cards.linklist.AnnotationHelper.formatItems.requiresIContext=true;sap.ovp.cards.linklist.AnnotationHelper.formatUrl.requiresIContext=true;}());
