(function(){"use strict";var C=27,a=8,L=8,b=8,O="ovpLinkList",P="pictureCarousel",c="ovpCardHeader",A="sapMCrslActive";var d={onBeforeRendering:function(e){this.itemOnBeforeRendering(e);}};var D={onAfterRendering:function(e){this.itemOnAfterRendering(e);}};sap.ui.controller("sap.ovp.cards.linklist.LinkList",{onInit:function(){this._bInitialLoad=true;this._bListenerAttached=false;this._bListeningPopOver=false;},onBeforeRendering:function(e){var o=this.getCardPropertiesModel();if(o.getProperty("/listFlavor")==="standard"&&!o.getProperty("/staticContent")){var l=this.byId("ovpCLI");if(l){l.addEventDelegate(d,this);}}},onAfterRendering:function(e){this.attachingListenerToTheEventRefresh();var o=this.getCardPropertiesModel();var r=o.getProperty("/cardLayout/rowSpan");var i=o.getProperty("/cardLayout/colSpan");switch(o.getProperty("/listFlavor")){case"standard":if(o.getProperty("/staticContent")){if(i&&r){if(!this._bInitialLoad&&this._aLinkListIds){this._mergeAllTheDataInOneList();}if(r===1){this._aLinkListIds=[O];this._setListColumnWidthInStandardCard(1);}else{this._itemOnEventBuildStandard(o,i,r,true);}}else{this._aLinkListIds=[O];this._setListColumnWidthInStandardCard(1);}}break;case"carousel":var f=this.byId(P);if(f.getId().indexOf('.')!==-1){var $=f.$();$.off('beforeSlide');$.on('beforeSlide',this.onBeforeSlide);$.trigger('beforeSlide',[1,1]);}if(o.getProperty("/staticContent")){if(r&&!(!o.getProperty("/defaultSpan")&&o.getProperty("/cardLayout/autoSpan"))){this._setListHeightInCarouselCard(r);}else{this._setListHeightInCarouselCard(-1);}this._setCarouselImageProperties();}else{f.addEventDelegate(D,this);}break;}if(!sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)&&o.getProperty('/layoutDetail')==='resizable'){var g=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var s=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var h=document.getElementById(s);g.dashboardLayout.showOnlyHeader?h.classList.add("sapOvpMinHeightContainer"):h.classList.remove("sapOvpMinHeightContainer");}},onBeforeSlide:function(e,p,n){if(e.target!=this){return;}var s=this.id+'-pageIndicator',o=document.getElementById(s);var E=o.querySelector('[data-slide=\''+p+'\']');E.classList.remove(A);E=o.querySelector('[data-slide=\''+n+'\']');E.classList.add(A);},getCardItemsBinding:function(){var l=this.getView().byId("ovpLinkList");var e=this.getView().byId("pictureCarousel");if(l){return l.getBinding("items");}else if(e){return e.getBinding("pages");}else{return null;}},attachingListenerToTheEventRefresh:function(){var I=this.getCardItemsBinding();var o=this.getCardPropertiesModel();if(I){if(!this._bListenerAttached){I.attachRefresh(function(){if(this._aLinkListIds){for(var i=1;i<this._aLinkListIds.length;i++){var l=this.byId(this._aLinkListIds[i]);var e=l.getItems().length;l.getItems().splice(0,e);l.destroy();}this._aLinkListIds.splice(0,this._aLinkListIds.length);}if(this._oListRest){this._oListRest.destroy();}}.bind(this));I.attachChange(function(){this.settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter();if(o.getProperty("/listFlavor")==="carousel"){var e=this.byId(P);e.addEventDelegate(D,this);}if(o.getProperty("/listFlavor")==="standard"){var t=I.getLength();if(t===0){var f=this.byId(O).$().parent();f.width("100%");}}}.bind(this));}else if(this._aLinkListIds){this.settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter();}this._bListenerAttached=true;}},settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter:function(){if(this._aLinkListIds){var o=this.getCardPropertiesModel();var r=o.getProperty("/cardLayout/rowSpan");var i=o.getProperty("/cardLayout/colSpan");if(r){this._setListHeightInStandardCard(r);}if(i){this._setListColumnWidthInStandardCard(this._iVisibleColums);}else{this._setListColumnWidthInStandardCard(1);}}},itemOnBeforeRendering:function(e){var r,o=this.getCardPropertiesModel();switch(o.getProperty("/listFlavor")){case"standard":if(!o.getProperty("/defaultSpan")&&!o.getProperty("/staticContent")&&o.getProperty("/cardLayout/autoSpan")){r=o.getProperty("/cardLayout/noOfItems");}else{r=o.getProperty("/cardLayout/rowSpan");}var i=o.getProperty("/cardLayout/colSpan");var l=this.byId(O);var f=l.getItems();for(var j=0;j<f.length;j++){f[j].removeEventDelegate(d);}if(this._bInitialLoad){this._itemOnEventBuildStandard(o,i,r,true);}else{this._itemOnEventBuildStandard(o,i,r,false);}break;case"carousel":jQuery.sap.log.info("FYI: currently nothing special to handle here");break;}},getSpansWhenNoDefaultSpanMentioned:function(){var o=this.getCardPropertiesModel();var s=o.getProperty('/staticContent');var n=((s&&s.length)||(this.getCardItemsBinding()&&this.getCardItemsBinding().getLength()))||0;var l=s?this.getItemHeight(this,O,true):o.getProperty('/cardLayout/itemHeight');var h=0;var H=this.byId(c);if(H){h=H.$().outerHeight();}var r=o.getProperty("/cardLayout/iRowHeightPx");return Math.ceil((l*Math.min(n,6)+(h+L+b))/r);},itemOnAfterRendering:function(E){var o=this.getCardPropertiesModel();var r=o.getProperty("/cardLayout/rowSpan");var i=o.getProperty("/cardLayout/colSpan");switch(o.getProperty("/listFlavor")){case"standard":try{var l=this.byId(O);var f=l.getItems(this._aLinkListIds[this._aLinkListIds.length-1]);f[f.length-1].removeEventDelegate(D);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event at the last item of the last list");}if(!o.getProperty("/defaultSpan")&&o.getProperty("/cardLayout/autoSpan")){r=this.getSpansWhenNoDefaultSpanMentioned();}if(r){this._setListHeightInStandardCard(r);}if(i){this._setListColumnWidthInStandardCard(this._iVisibleColums);}else{this._setListColumnWidthInStandardCard(1);}break;case"carousel":try{var g=this.byId(P);g.removeEventDelegate(D);}catch(e){jQuery.sap.log.info("FYI: Unable to remove the delagted event on the carousel");}if(r&&!(!o.getProperty("/defaultSpan")&&o.getProperty("/cardLayout/autoSpan"))){this._setListHeightInCarouselCard(r);}else{this._setListHeightInCarouselCard(-1);}this._setCarouselImageProperties();break;}this._bInitialLoad=false;},_itemOnEventBuildStandard:function(o,e,r,I){var p;var l=this.byId(O);var f=this.getView().byId(this.getView().getId()+"--RestOfData");if(f){f.destroy();}if(I&&this._oListRest===undefined){this._oListRest=new sap.m.List(this.getView().getId()+"--RestOfData",{});}this._aLinkListIds=[O];this._iAvailableItems=l.getItems().length;var g=o.getProperty("/cardLayout/items");if(g!==undefined){this._iNoOfItemsPerColumn=g;p=g;this._iVisibleColums=1;}else{var h=o.getProperty('/staticContent')?this.getItemHeight(this,O,true):o.getProperty('/cardLayout/itemHeight');var k=this._getListHeightInStandardCard(r);this._iNoOfItemsPerColumn=Math.floor(k/h);var n=Math.ceil(this._iAvailableItems/this._iNoOfItemsPerColumn);this._iVisibleColums=Math.min(n,e);p=this._iVisibleColums*this._iNoOfItemsPerColumn;}if(p>this._iAvailableItems){p=this._iAvailableItems;}else{for(var i=p;i<this._iAvailableItems;i++){l.getItems()[i].setVisible(false);}}if(this._iVisibleColums>1){var m=this.byId("ovpListRow");var q=this._iNoOfItemsPerColumn;var s=0;for(var j=this._iNoOfItemsPerColumn;j<p;j++){if(q>=this._iNoOfItemsPerColumn){q=0;s++;var t=O+s;var N=new sap.m.List(this.getView().getId()+"--"+t,{showSeparators:l.getProperty("showSeparators")});this._aLinkListIds.push(t);if(l.hasStyleClass("_iNoOfItemsPerColumnPaddingCozy")){N.addStyleClass("sapOvpLinkListStandardPaddingCozy");}else{N.addStyleClass("sapOvpLinkListStandardPaddingCompact");}m.addItem(N);}N.addItem(l.getItems()[this._iNoOfItemsPerColumn]);q++;}if(N){var u=N.getItems();u[u.length-1].addEventDelegate(D,this);}}else{if(I){this.itemOnAfterRendering(null);}else{var v=l.getItems();v[v.length-1].addEventDelegate(D,this);}}},resizeCard:function(n){var o=this.getCardPropertiesModel();o.setProperty("/cardLayout/rowSpan",n.rowSpan);o.setProperty("/cardLayout/colSpan",n.colSpan);switch(o.getProperty("/listFlavor")){case"standard":this._resizeStandard(n,o);break;case"carousel":this._resizeCarousel(n);break;}if(this.resizeHandlerId){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerId);this.resizeHandlerId=null;}var e=this.getView().byId('ovpCardContentContainer').getDomRef();if(e){if(n.showOnlyHeader){e.classList.add('sapOvpContentHidden');}else{e.classList.remove('sapOvpContentHidden');}}},_mergeAllTheDataInOneList:function(){var l=this._aLinkListIds.length;var o=this.getView().byId("ovpLinkList");var I=-1;for(var e=0;e<o.getItems().length;e++){if(!o.getItems()[e].getVisible()){I=e;break;}}for(var i=1;i<l;i++){var f=this.getView().byId(this._aLinkListIds[i]);var g=f.getItems().length;for(var j=0;j<g;j++){if(I===-1){o.addItem(f.getItems()[0]);}else{o.insertItem(f.getItems()[0],I);I++;}}f.destroy();}},_resizeStandard:function(n,o){if(this._aLinkListIds){this._mergeAllTheDataInOneList();var l=this.getView().byId("ovpLinkList");this._aLinkListIds.splice(0,this._aLinkListIds.length);var r=this._oListRest.getItems().length;try{for(var k=0;k<r;k++){l.addItem(this._oListRest.getItems()[0]);}}catch(e){jQuery.sap.log.info("Error: "+e);}for(var s=0;s<l.getItems().length;s++){l.getItems()[s].setVisible(true);}if(!l){var f=this.byId(O).$().parent();f.width("100%");var R=o.getProperty("/cardLayout/rowSpan");if(R){this._setListHeightInStandardCard(R);}}var B=l.getBindingInfo("items");var i=o.getProperty('/staticContent')?this.getItemHeight(this,O,true):o.getProperty('/cardLayout/itemHeight');var N=this._getListHeightInStandardCard(n.rowSpan);var g=Math.floor(N/i)*n.colSpan;this._bInitialLoad=false;jQuery(this.getView().$()).find(".sapOvpWrapper").css({height:N+"px"});if(B){if(g>this._iAvailableItems&&B.length<=this._iAvailableItems){B.length=g;l.bindItems(B);this._bListenerAttached=false;this.attachingListenerToTheEventRefresh();}else{this._itemOnEventBuildStandard(o,n.colSpan,n.rowSpan,false);}}else{this._itemOnEventBuildStandard(o,n.colSpan,n.rowSpan,false);}}},_resizeCarousel:function(n){this._setListHeightInCarouselCard(n.rowSpan);this._setCarouselImageProperties();},_setListHeightInCarouselCard:function(r){var i=0,o=this.byId(P);if(r!==-1){var h=0;var H=this.byId(c);if(H){h=H.$().outerHeight();}var e=this.getCardPropertiesModel();var R=e.getProperty("/cardLayout/iRowHeightPx");i=(r*R)-(h+C+a);o.$().height(i+16);}else{var f=o.$().width(),p=null,g=o.getPages(),I=0;for(var j=0;j<g.length;j++){p=g[j];if(p&&p.getItems().length>1){I=Math.max(I,p.getItems()[0].$().outerHeight());}}var n=o.$().find(".sapMCrslControlsBottom.sapMCrslControls").outerHeight();i=f+(I+n);o.$().height(i);}},_setCarouselImageProperties:function(){var o=this.byId(P),p=o.getPages(),i=o.$().height(),n=p.length>1?o.$().find(".sapMCrslControlsBottom.sapMCrslControls").outerHeight():0,e=null,I=null,t=0,E,f;for(var g=0;g<p.length;g++){e=p[g];if(e){E=e.getAggregation('items')&&e.getItems()[0];if(E){t=E.hasStyleClass('sapOvpCarouselContentHeader')?E.$().outerHeight():0;f=e.getItems()[e.getItems().length-1];I=f.getAggregation('items')&&f.getItems()[0];if(I instanceof sap.m.Image){this._setCarouselImageHeight(I,i-t-n);}}}}},_setCarouselImageHeight:function(i,e){var f=i.getDomRef().naturalHeight;if(f!==0){f<e?i.setHeight(f+'px'):i.setHeight(e+'px');}},_setListHeightInStandardCard:function(r){var n=0;var l;var o;l=this.byId(O);if(l){n=this._getListHeightInStandardCard(r);o=l.$().parent();o.height(n);}if(this._aLinkListIds){for(var i=1;i<this._aLinkListIds.length;i++){l=this.byId(this._aLinkListIds[i]);n=this._getListHeightInStandardCard(r);o=l.$().parent();o.height(n);}}},_getListHeightInStandardCard:function(r){var l=0;var o=this.getCardPropertiesModel();if(r){var h=0;var H=this.byId(c);if(H){h=H.$().outerHeight();}var R=o.getProperty("/cardLayout/iRowHeightPx");l=(r*R)-(h+L+b);}return l;},_setListColumnWidthInStandardCard:function(i){var l;var o;var s="100%";if(this._aLinkListIds){if(this._aLinkListIds.length>1){for(var j=0;j<this._aLinkListIds.length;j++){l=this.byId(this._aLinkListIds[j]);o=l.$().parent();s=(100/i)+"%";o.width(s);}}else{l=this.byId(this._aLinkListIds[0]);if(l){o=l.$().parent();o.width(s);}}}},onLinkListItemPressLocalData:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var t=e.getSource().data("targetUri");var i=e.getSource().data("openInNewWindow");var B=this.getView().getModel("ovpCardProperties").getProperty("/baseUrl");if(t){t=this.buildUrl(B,t);if(i==="true"){window.open(t);}else{window.location.href=t;}}}},onLinkListActionPressLocalData:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var s=e.getSource().data("dataAction");this.getView().getModel().callFunction(s,{method:"POST",urlParameters:{FunctionImport:s},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});}},onFuImpSuccess:function(e){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Success"),{duration:3000});},onFuImpFailed:function(r){sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Error"),{duration:3000});},onLinkListItemPress:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0]);}},onLinkPopover:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var p;switch(this.getCardPropertiesModel().getProperty("/listFlavor")){case"standard":p=e.getSource().getParent().getAggregation("items")[0];break;case"carousel":p=e.getSource().getParent().getAggregation("items")[0];break;}var o=this.getCardPropertiesModel();if(o.getProperty("/listFlavor")==="carousel"){var f=this.byId(P);f.addEventDelegate(D,this);}p.bindElement(e.getSource().getBindingContext().getPath());p.openBy(e.getSource());if(!this._bListeningPopOver){p.attachAfterOpen(function(){this.settingHeightAndWidthOfLinkListCardsOnManageCardAndFilter();}.bind(this));}this._bListeningPopOver=true;}},onLinkListLineItemUrl:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var t,s="com.sap.vocabularies.UI.v1.LineItem",n=this.entityType[s][0].Url;if(n.hasOwnProperty("String")){t=n.String;}else{var N=this.getEntityNavigationEntries(e.getSource().getBindingContext(),s)[0];t=N.url;}if(t){window.location.href=t;}else{jQuery.sap.log.info("LinkList Standard Card: No Navigation on line item");}}},onLinkNavigationSingleTarget:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),undefined);this.doNavigation(e.getSource().getBindingContext(),n[0]);}},onLinkNavigation:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{if(sap.ushell.Container.getService("CrossApplicationNavigation")){var B=e.getSource().getBindingContext();if(B.getProperty("SemanticObject")){var n={target:{semanticObject:B.getProperty("SemanticObject"),action:B.getProperty("SemanticAction")}};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(n);}}}},buildUrl:function(B,m){if(m.lastIndexOf(B,0)===0||m.indexOf("://")>0){return m;}else if(m.lastIndexOf("/",0)===0){return B+m;}else{return B+"/"+m;}},onLinkListActionPress:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var s=e.getSource().data("dataAction");this.getView().getModel().callFunction(s,{method:"POST",urlParameters:{FunctionImport:s},success:(this.onFuImpSuccess.bind(this)),error:(this.onFuImpFailed.bind(this))});}},onLinkListSemanticObjectPressLocalData:function(e){if(sap.ovp.cards.OVPCardAsAPIUtils.checkIfAPIIsUsed(this)){sap.ovp.cards.CommonUtils.onContentClicked(e);}else{var r=parseInt(e.getSource().data("contentRowIndex"),10);this._oStaticContent=this.getCardPropertiesModel().getProperty("/staticContent");if(this._oStaticContent[r].semanticObject&&this._oStaticContent[r].action){var n={target:{semanticObject:this._oStaticContent[r].semanticObject,action:this._oStaticContent[r].action},params:this._oStaticContent[r].params};var i=this._oStaticContent[r];this.doCrossApplicationNavigation(i,n);}else{sap.m.MessageToast.show(sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("Toast_Action_Error"),{duration:3000});}}}});})();
