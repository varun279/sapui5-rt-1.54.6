/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(['jquery.sap.global','sap/ovp/cards/rta/SettingsDialogConstants'],function(q,S){"use strict";function g(i,j,k,D){return i+"_sap.ovp.cards."+j+"."+k+"."+D;}function c(V){return{"type":"XTIT","maxLength":40,"value":{"":V,"en":V}};}function a(i,I,j){var k=i+"["+I+"]";if(j){k+="/"+j;}return k;}function s(j,M){var k=M._getCardsModel();for(var i=0;i<k.length;i++){if(k[i].id===j){return true;}}return false;}function b(i,j,k){var E={"propertyPath":i,"operation":j};if(k){E["propertyValue"]=k;}return E;}function f(j){delete j.id;delete j.settings.baseUrl;delete j.settings.cloneCard;if(j.settings["staticContent"]){for(var i=0;i<j.settings["staticContent"].length;i++){delete j.settings["staticContent"][i].id;}}}function d(i,O,N){if(N==="customer.settings"&&O){P.aEntityPropertyChange.push(b("vendor.settings","UPSERT",O.settings));i["vendor.settings"]=O.settings;}}function e(N,i,O,j){if(O){if(N==="customer.settings"){O[j]={operation:"DELETE"};}}else{if(N==="customer.settings"){P.aEntityPropertyChange.push(b(i,"UPSERT",{operation:"DELETE"}));}else{P.aEntityPropertyChange.push(b(i,"DELETE"));}}}function h(i){P.aEntityPropertyChange.push(b("customer.settings","UPSERT",i["customer.settings"]));}function l(i,j,k,V,O){var I=g(P.sApplicationId,P.sCardId,i,k),D=j+"/"+k;if(!P.oText){P.oText={};}P.oText[I]=c(V);if(O){O[k]="{{"+I+"}}";}else{P.aEntityPropertyChange.push(b(D,"UPSERT","{{"+I+"}}"));}}function m(N,j,T,O){var k=this._oCardManifestSettings,D=this._oOriginalCardManifestSettings;for(var i=0;i<T.length;i++){if((!D[T[i]]&&k[T[i]])||(D[T[i]]&&k[T[i]]&&(D[T[i]]!=k[T[i]]))){if(O){l(N,N,T[i],k[T[i]],j[N]);}else{l(N,N,T[i],k[T[i]]);}j.settings[T[i]]=k[T[i]];}else if(!k[T[i]]&&D[T[i]]){if(O){e(N,N+"/"+T[i],j[N],T[i]);}else{e(N,N+"/"+T[i]);}delete j.settings[T[i]];}}}function n(i,j,V,O){var k=i+"/"+j;if(O){O[j]=V;}else{P.aEntityPropertyChange.push(b(k,"UPSERT",V));}}function o(N,j,k,O){var D=this._oCardManifestSettings,E=this._oOriginalCardManifestSettings;for(var i=0;i<k.length;i++){if((!E[k[i]]&&D[k[i]])||(E[k[i]]&&D[k[i]]&&(E[k[i]]!=D[k[i]]))){if(O){n(N,k[i],D[k[i]],j[N]);}else{n(N,k[i],D[k[i]]);}j.settings[k[i]]=D[k[i]];}else if(!D[k[i]]&&E[k[i]]){if(O){e(N,N+"/"+k[i],j[N],k[i]);}else{e(N,N+"/"+k[i]);}delete j.settings[k[i]];}}}function p(N,i){var j=S.cardSettings["settings"],T=S.cardSettings["text"];if(N==="customer.settings"){if(i["customer.settings"]){m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);}else{i["customer.settings"]={};m.bind(this)(N,i,T,true);o.bind(this)(N,i,j,true);h(i);}}else{m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);}}function r(N,k,D,T,E,O){var F=this._oCardManifestSettings[E];for(var i=0;i<F.length;i++){for(var j=0;j<T.length;j++){if(F[i][T[j]]){var G=a(N+"/"+E,i),I=N+"."+E+"."+i;if(O){l(I,G,T[j],F[i][T[j]],k[N][E][i]);}else{l(I,G,T[j],F[i][T[j]],D[i]);}}}}if(!O){n(N,E,D);}}function t(j,T){var O=S.cardSettingsArrayLevel[T]["onlyTabLevelProps"],F=false;for(var i=0;O&&i<O.length;i++){if(O[i]===j){F=true;break;}}return F;}function u(N,j,T,k,D,O){var E=this._oCardManifestSettings,i;for(i=0;i<T.length;i++){if(E[T[i]]&&!t(T[i],D)){if(O){l(N,N,T[i],E[T[i]],j[N]);}else{l(N,N,T[i],E[T[i]]);}j.settings[T[i]]=E[T[i]];}}for(i=0;i<k.length;i++){if(E[k[i]]&&!t(k[i],D)){if(O){n(N,k[i],E[k[i]],j[N]);}else{n(N,k[i],E[k[i]]);}j.settings[k[i]]=E[k[i]];}}if(O){e(N,N+"/"+D,j[N],D);}else{e(N,N+"/"+D);}delete j.settings[D];}function v(N,j,k,T,D,E,O){var i;for(i=0;i<T.length;i++){if(j[N][T[i]]){if(O){e(N,N+"/"+T[i],j[N],T[i]);}else{e(N,N+"/"+T[i]);}delete j.settings[T[i]];}}for(i=0;i<D.length;i++){if(j[N][D[i]]){if(O){e(N,N+"/"+D[i],j[N],D[i]);}else{e(N,N+"/"+D[i]);}delete j.settings[D[i]];}}r.bind(this)(N,j,k,T,E,O);}function w(j,T){return q.map(q.extend(true,{},j),function(k){var D=S.cardSettingsArrayLevel[T]["text"],i,E=S.cardSettingsArrayLevel[T]["settings"],F={};for(i=0;i<D.length;i++){if(k[D[i]]){F[D[i]]=k[D[i]];}}for(i=0;i<E.length;i++){if(k[E[i]]){F[E[i]]=k[E[i]];}}return F;});}function x(N,i,j,k,T,O){var D=S.cardSettingsArrayLevel[T]["text"],E=S.cardSettingsArrayLevel[T]["settings"],F=w(j,T);if(j&&k){i.settings[T]=w(j,T);if(N==="customer.settings"){i[N][T]=w(j,T);}r.bind(this)(N,i,F,D,T,O);}else if(!j&&k){u.bind(this)(N,i,D,E,T,O);}else if(j&&!k){i.settings[T]=w(j,T);if(N==="customer.settings"){i[N][T]=w(j,T);}v.bind(this)(N,i,F,D,E,T,O);}}function y(N,i,O){var j=this._oCardManifestSettings["staticContent"],k=this._oOriginalCardManifestSettings["staticContent"],T=this._oCardManifestSettings["tabs"],D=this._oOriginalCardManifestSettings["tabs"];if(j||k){x.bind(this)(N,i,j,k,"staticContent",O);}else if(T||D){x.bind(this)(N,i,T,D,"tabs",O);}}function z(N,i){var j=S.cardSettingsForComplex["settings"],T=S.cardSettingsForComplex["text"];if(N==="customer.settings"){if(i["customer.settings"]){m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);y.bind(this)(N,i,false);}else{i["customer.settings"]={};m.bind(this)(N,i,T,true);o.bind(this)(N,i,j,true);y.bind(this)(N,i,true);h(i);}}else{m.bind(this)(N,i,T,false);o.bind(this)(N,i,j,false);y.bind(this)(N,i,false);}}function A(N,i){var j=this._oCardManifestSettings["staticContent"],O=this._oOriginalCardManifestSettings["staticContent"],T=this._oCardManifestSettings["tabs"],k=this._oOriginalCardManifestSettings["tabs"];if(j||O||T||k){z.bind(this)(N,i);}else{p.bind(this)(N,i);}}function B(D,E,F){var T,i,j,k,G,H=F.settings["staticContent"],I=F.settings["tabs"];var J=S.cardSettingsWithText;for(i=0;i<J.length;i++){var K;if(typeof J[i]=="string"){if(F.settings[J[i]]){if(!T){T={};}K=g(D,E,"settings",J[i]);T[K]=c(F.settings[J[i]]);F.settings[J[i]]="{{"+K+"}}";}}else if(typeof J[i]=="object"){if(J[i].hasOwnProperty("staticContent")){if(H){for(j=0;j<H.length;j++){for(k=0;k<J[i]["staticContent"].length;k++){G=J[i]["staticContent"][k];if(H[j][G]){if(!T){T={};}K=g(D,E,"settings.staticContent."+j,G);T[K]=c(H[j][G]);F.settings["staticContent"][j][G]="{{"+K+"}}";}}}}}else if(J[i].hasOwnProperty("tabs")){if(I){for(j=0;j<I.length;j++){for(k=0;k<J[i]["tabs"].length;k++){G=J[i]["tabs"][k];if(I[j][G]){if(!T){T={};}K=g(D,E,"settings.tabs."+j,G);T[K]=c(I[j][G]);F.settings["tabs"][j][G]="{{"+K+"}}";}}}}}}}return T;}function C(i,T,F){var j={};j['appDescriptorChange']={'parameters':i};if(T){j['appDescriptorChange']['texts']=T;}j['flexibilityChange']=F;return j;}var P={sApplicationId:"",sCardId:"",aEntityPropertyChange:[],oText:undefined,getPayLoadForEditCard:function(i){var j=i.oAppDescriptor.id,k={"cardId":j},T,E,D=q.extend(true,{},i.oAppDescriptor),N;N=(j.lastIndexOf("customer.",0)===0)?"settings":"customer.settings";P.sApplicationId=i.sApplicationId;P.sCardId=j;P.aEntityPropertyChange=[];P.oText=undefined;d(D,i.oOriginalAppDescriptor,N);A.bind(this)(N,D);T=q.extend(true,{},P.oText);E=P.aEntityPropertyChange;if(E.length===1){k["entityPropertyChange"]=E[0];}else{k["entityPropertyChange"]=E;}return C(k,T,D);},getPayLoadForCloneCard:function(j){return new Promise(function(k,D){var E={card:{}},T,F={},G=j.getComponentInstance().getComponentData(),M=G.mainComponent,H=M._getApplicationId(),I=q.extend(true,{},M._getCardFromManifest(G.cardId));var J="customer."+I.id,i=1;while(s(J+"_"+i,M)){i++;}J=J+"_"+i;f(I);F=q.extend(true,{},I);F.id=J;F.settings.title=F.settings.title+" "+i;I.settings.title=I.settings.title+" "+i;T=B(H,J,I);E.card[J]=I;k(C(E,T,F));});}};return P;},true);
