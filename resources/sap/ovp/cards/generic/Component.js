sap.ui.define(["sap/ui/core/UIComponent","sap/ovp/cards/AnnotationHelper","sap/ovp/cards/LoadingUtils","sap/ovp/cards/CommonUtils"],function(U,A,L,C){"use strict";return U.extend("sap.ovp.cards.generic.Component",{metadata:{properties:{"contentFragment":{"type":"string"},"headerExtensionFragment":{"type":"string"},"contentPosition":{"type":"string","defaultValue":"Middle"},"headerFragment":{"type":"string","defaultValue":"sap.ovp.cards.generic.Header"},"footerFragment":{"type":"string"},"identificationAnnotationPath":{"type":"string","defaultValue":"com.sap.vocabularies.UI.v1.Identification"},"selectionAnnotationPath":{"type":"string"},"filters":{"type":"object"},"parameters":{"type":"object"},"addODataSelect":{"type":"boolean","defaultValue":false}},version:"1.54.4",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},setSelectionVariant:function(s,S){if(/^@/.test(s)){s=s.slice(1);}S.selectionAnnotationPath=s;},setPresentationVariant:function(p,s,e){if(/^@/.test(p)){p=p.slice(1);}s.presentationAnnotationPath=p;var v=e[p].Visualizations;var i;for(i=0;i<v.length;i++){var V=v[i].AnnotationPath;if(V){if(/^@/.test(V)){V=V.slice(1);}if(/.LineItem/.test(V)){s.annotationPath=V;break;}}}for(i=0;i<v.length;i++){var V=v[i].AnnotationPath;if(V){if(/^@/.test(V)){V=V.slice(1);}if(/.Chart/.test(V)){s.chartAnnotationPath=V;break;}}}},setDataPointAnnotationPath:function(d,s){if(/^@/.test(d)){d=d.slice(1);}s.dataPointAnnotationPath=d;},getCustomPreprocessor:function(){},getPreprocessors:function(p){var c=this.getComponentData(),s=c.settings,m=c.model,M,e,E,o;if(s.description&&!s.subTitle){s.subTitle=s.description;}if(m){M=m.getMetaModel();if(s.entitySet){var a=M.getODataEntitySet(s.entitySet);var b=M.getODataEntitySet(s.entitySet,true);e=M.getODataEntityType(a.entityType);o=M.createBindingContext(b);E=M.createBindingContext(e.$path);}}var d=this._getCardPropertyDefaults();var f=this._completeLayoutDefaults(d,s);var g;var h;if(c.appComponent&&c.appComponent.getModel("ui")&&c.appComponent.getModel("ui").oData){g=c.appComponent.getModel("ui").oData.showDateInRelativeFormat;h=c.appComponent.getModel("ui").oData.disableTableCardFlexibility;}else{if(c.showDateInRelativeFormat){g=c.showDateInRelativeFormat;}if(c.disableTableCardFlexibility){h=c.disableTableCardFlexibility;}}var j={metaModel:M,entityType:e,webkitSupport:sap.ui.Device.browser.webkit,layoutDetail:f&&f.cardLayout?f.cardLayout.containerLayout:'fixed',showDateInRelativeFormat:g,disableTableCardFlexibility:h};if(!!c&&!!c.cardId){var k=c.mainComponent;var t=null;if(!!k){t=k._getCardFromManifest(c.cardId)?k._getCardFromManifest(c.cardId).template:null;}else{t=c.template;}if(!!t){j.template=t;}}d.densityStyle=C._setCardpropertyDensityAttribute();if(f){j.cardLayout=f.cardLayout;}if(d.state!=="Loading"){if(s&&s.kpiAnnotationPath){var K=e[s.kpiAnnotationPath];var l=d.contentFragment;if(K&&l==="sap.ovp.cards.charts.analytical.analyticalChart"){var S=K.SelectionVariant&&K.SelectionVariant.Path;if(S){this.setSelectionVariant(S,s);}var P=K.Detail.DefaultPresentationVariant&&K.Detail.DefaultPresentationVariant.Path;if(P){this.setPresentationVariant(P,s,e);}var D=K.DataPoint&&K.DataPoint.Path;if(D){this.setDataPointAnnotationPath(D,s);}}}else if(s&&s.selectionPresentationAnnotationPath){var n=e[s.selectionPresentationAnnotationPath];if(n){var S=n.SelectionVariant&&n.SelectionVariant.Path;if(S){this.setSelectionVariant(S,s);}var P=n.PresentationVariant&&n.PresentationVariant.Path;if(P){this.setPresentationVariant(P,s,e);}}}}if(c.ovpCardsAsApi&&s.ignoreSelectionVariant){s.selectionAnnotationPath="";var I=[];for(var q=0;!!s.filters&&q<s.filters.length;q++){I.push({id:"headerFilterText--"+(q+1),index:q});}s.idForExternalFilters=I;}if(!!j.entityType&&!!s.selectionAnnotationPath&&!!j.entityType[s.selectionAnnotationPath]){var r=j.entityType[s.selectionAnnotationPath].SelectOptions;for(var u=0;!!r&&u<r.length;u++){r[u].id="headerFilterText--"+(u+1);}j.entityType[s.selectionAnnotationPath].SelectOptions=r;}if(j.template==="sap.ovp.cards.linklist"&&!!s.staticContent){for(var i=0;i<s.staticContent.length;i++){s.staticContent[i].id="linkListItem--"+(i+1);}}if(j.template==='sap.ovp.cards.charts.analytical'){s.dataStep=s.dataStep?s.dataStep:10;}if(d.state&&(d.state==="Loading"||d.state==="Error")&&L.bPageAndCardLoading){d.footerFragment="sap.ovp.cards.loading.LoadingContent";}d=jQuery.extend(true,j,d,s);var O=new sap.ui.model.json.JSONModel(d);var v=new sap.ui.model.json.JSONModel(sap.ui.Device);v.setDefaultBindingMode("OneWay");var w={dontIncludeUOM:true,firstDataPointIndex:0,secondDataPointIndex:1,thirdDataPointIndex:2,fourthDataPointIndex:3,fifthDataPointIndex:4,sixthDataPointIndex:5,firstDataFieldIndex:0,secondDataFieldIndex:1,thirdDataFieldIndex:2,fourthDataFieldIndex:3,fifthDataFieldIndex:4,sixthDataFieldIndex:5};var x=new sap.ui.model.json.JSONModel(w);var y={xml:{bindingContexts:{entityType:E,entitySet:o},models:{device:v,entityType:M,entitySet:M,ovpMeta:M,ovpCardProperties:O,ovplibResourceBundle:p,ovpConstants:x},ovpCardProperties:O,dataModel:m,_ovpCache:{}}};return jQuery.extend(true,{},this.getCustomPreprocessor(),y);},_completeLayoutDefaults:function(c,s){var o={},a=this.getComponentData(),b=null,d=null;if(a.appComponent){b=a.appComponent.getOvpConfig();}if(!b){return null;}if(b.containerLayout==="resizable"&&a.cardId&&c.contentFragment!=="sap.ovp.cards.quickview.Quickview"){d=a.appComponent.getDashboardLayoutUtil();var e=a.cardId;var f=d.aCards.filter(function(i){return i.id===e;});o.cardLayout=f[0].dashboardLayout;o.cardLayout.containerLayout=b.containerLayout;o.cardLayout.iRowHeightPx=d.ROW_HEIGHT_PX;o.cardLayout.iCardBorderPx=d.CARD_BORDER_PX;o.cardLayout.headerHeight=f[0].dashboardLayout.headerHeight;}return o;},_getCardPropertyDefaults:function(){var c={};var p=this.getMetadata().getAllProperties();var P;for(var a in p){P=p[a];if(P.defaultValue!==undefined){c[P.name]=P.defaultValue;}}return c;},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new sap.ui.model.resource.ResourceModel({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},_getCacheKeys:function(){},createContent:function(){var c=this.getComponentData&&this.getComponentData();var m=c.model;var p;var P;var M=c&&c.mainComponent;var o=M&&M.oModelViewMap;var s=c&&c.modelName;var f=function(){if(m&&s){m.bIncludeInCurrentBatch=false;if(o&&s&&o[s]&&o[s][c.cardId]){delete o[s][c.cardId];if(Object.keys(o[s]).length>0){m.bIncludeInCurrentBatch=true;}}}};if(c&&c.mainComponent){p=c.mainComponent._getOvplibResourceBundle();}else{p=this.getOvplibResourceBundle();}P=this.getPreprocessors(p);var v={preprocessors:P,type:sap.ui.core.mvc.ViewType.XML,viewName:"sap.ovp.cards.generic.Card"};var a=this._getCacheKeys();if(a&&a.length&&a.length>0){v.async=true;v.cache={keys:a};}var l=this._getCardPropertyDefaults().state;var i=c.cardId+(l?l:"Original");if(!l){i=i+(c.settings.selectedKey?"_Tab"+c.settings.selectedKey:"");}if(!v.async){f();}var V=sap.ui.view(c.containerId==="dialogCard"?undefined:i,v);if(v.async){var O=V.onControllerConnected;V.onControllerConnected=function(){f();O.apply(V,arguments);};}V.setModel(m);if(c.i18n){V.setModel(c.i18n,"@i18n");}V.setModel(P.xml.ovpCardProperties,"ovpCardProperties");V.setModel(p,"ovplibResourceBundle");return V;}});});
