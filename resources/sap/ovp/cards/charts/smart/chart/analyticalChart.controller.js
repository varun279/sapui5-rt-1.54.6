(function(){"use strict";sap.ui.controller("sap.ovp.cards.charts.smart.chart.analyticalChart",{onInit:function(){sap.ovp.cards.charts.VizAnnotationManager.formatChartAxes();this.bFlag=true;var s=this.getView().byId("analyticalChart2");if(s){if(s.getHeader()===""){s.setHeader("Dummy");}}var M=sap.ui.comp.odata.MetadataAnalyser;var e=M.prototype._enrichChartAnnotation;var l,i,o;M.prototype._enrichChartAnnotation=function(a,A){if(A){if(!A.Measures){A.Measures=[];if(A.MeasureAttributes){l=A.MeasureAttributes.length;for(i=0;i<l;i++){o=A.MeasureAttributes[i];A.Measures.push({"PropertyPath":o.Measure.PropertyPath});}}}if(!A.Dimensions){A.Dimensions=[];if(A.DimensionAttributes){l=A.DimensionAttributes.length;for(i=0;i<l;i++){o=A.DimensionAttributes[i];A.Dimensions.push({"PropertyPath":o.Dimension.PropertyPath});}}}}e.apply(this,arguments);};},onBeforeRendering:function(){var s=this.getView().byId("analyticalChart2");var v=s._getVizFrame();this.vizFrame=v;var a=s.getChart();a.setProperty("enableScalingFactor",true);sap.ovp.cards.charts.SmartAnnotationManager.getSelectedDataPoint(v,this);sap.ovp.cards.charts.SmartAnnotationManager.attachDataReceived(s,this);},onAfterRendering:function(){var c=this.getOwnerComponent().getComponentData();if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"&&c.appComponent){var d=c.appComponent.getDashboardLayoutUtil();var C=d.getCardDomId(c.cardId);var o=d.dashboardLayoutModel.getCardById(c.cardId);var e=document.getElementById(C);e.getElementsByClassName('sapOvpWrapper')[0].style.height=o.dashboardLayout.rowSpan*d.ROW_HEIGHT_PX+1-(o.dashboardLayout.headerHeight+2*d.CARD_BORDER_PX)+"px";var a=Math.round((o.dashboardLayout.headerHeight+2*d.CARD_BORDER_PX)/d.ROW_HEIGHT_PX);if(o.dashboardLayout.rowSpan<=a){e.classList.add("sapOvpMinHeightContainer");}}var s=this.getView().byId("analyticalChart2");var b=s.getChart();var v=s._getVizFrame();b.addEventDelegate({onAfterRendering:function(){var D="in";if(v&&v._states()&&v._states()["dynamicScale"]){var S=b.getScalingFactor();var f=S&&S.primaryValues&&S.primaryValues.scalingFactor;if(f!=undefined){D=D+" "+f;}var u=S&&S.primaryValues&&S.primaryValues.unit;if(u){D=sap.ui.getCore().getLibraryResourceBundle("sap.ovp").getText("IN_NO_SCALE",[u]);var h=s.getHeader();h+=D;s.setHeader(h);}}}});},beforeRebindSmartChart:function(e){var c=this.getView().byId("analyticalChart2"),C=sap.ovp.cards.charts.SmartAnnotationManager.getMaxItems(c),a=+this.getCardPropertiesModel().getProperty("/cardLayout/colSpan")-1;c.attachBeforeRebindChart(jQuery.proxy(this.beforeRebindSmartChart,this));var b=e.getParameter("bindingParams");if(this.getCardPropertiesModel().getProperty('/layoutDetail')==='resizable'){this.dataLength=C.itemsLength+a*C.dataStep;}else{this.dataLength=C.itemsLength;}b.length=this.dataLength;var f=b.filters;var o=this.getCardPropertiesModel();var d=o.getData();var s=d.entityType[d.selectionAnnotationPath];var F=s&&s.SelectOptions;var g=this.getModel();var E=this.getEntitySet();var m=sap.ovp.cards.charts.SmartAnnotationManager.getMetadata(this.getModel(),d.entitySet);if(F){jQuery.each(s.SelectOptions,function(){var i=this.PropertyName.PropertyPath;jQuery.each(this.Ranges,function(){if(this.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"){var j=sap.ovp.cards.charts.SmartAnnotationManager.getPrimitiveValue(this.Low);var k=this.High&&this.High.String;j=sap.ovp.cards.charts.SmartAnnotationManager.formatByType(m,i,j);var l={path:i,operator:this.Option.EnumMember.split("/")[1],value1:j};if(k){l.value2=sap.ovp.cards.charts.SmartAnnotationManager.formatByType(m,i,k);}f.push(new sap.ui.model.Filter(l));}});});}var h="";var p=s&&s.Parameters,P=o.getProperty('/parameters');p=p||!!P;if(p){h=sap.ovp.cards.AnnotationHelper.resolveParameterizedEntitySet(g,E,s,P);}else{h="/"+E.name;}c.setChartBindingPath(h);},resizeCard:function(n,$){var c=this.getCardPropertiesModel(),s=this.getView().byId("analyticalChart2"),C=this.getCardPropertiesModel().getProperty("/cardLayout");c.setProperty("/cardLayout/rowSpan",n.rowSpan);c.setProperty("/cardLayout/colSpan",n.colSpan);jQuery(this.getView().$()).find(".sapOvpWrapper").css({height:(n.rowSpan*C.iRowHeightPx)-(C.headerHeight+2*C.iCardBorderPx)+"px"});if(s){s.rebindChart();s._getVizFrame().setHeight(this._calculateVizFrameHeight()+"px");}},_calculateVizFrameHeight:function(){var v,c=this.getCardPropertiesModel().getProperty("/cardLayout");if(c&&c.rowSpan){var g=this.getView().getController();var d=this.getItemHeight(g,'toolbar');var b=this.getView().byId("bubbleText");var C=this.getView().byId("ovpCT")?20:0;var B=b&&b.getVisible()?70:20;v=c.rowSpan*c.iRowHeightPx+1-(c.headerHeight+2*c.iCardBorderPx+d+C+B+30);}return v;}});})();
