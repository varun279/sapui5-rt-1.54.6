sap.ui.define(["./AxisTimeStrategyBase","sap/gantt/misc/Format"],function(A,F){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");sap.gantt.axistime.StepwiseTimeLineOptions={"FiveMinutes":{text:r.getText("SWZS_FIVE_MINUTES"),innerInterval:{unit:sap.gantt.config.TimeUnit.minute,span:5,range:32},largeInterval:{unit:sap.gantt.config.TimeUnit.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.minute,span:5,pattern:"mm "}},"FifteenMinutes":{text:r.getText("SWZS_FIFTEEN_MINUTES"),innerInterval:{unit:sap.gantt.config.TimeUnit.minute,span:15,range:48},largeInterval:{unit:sap.gantt.config.TimeUnit.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.minute,span:15,pattern:"mm "}},"Hour":{text:r.getText("SWZS_HOUR"),innerInterval:{unit:sap.gantt.config.TimeUnit.hour,span:1,range:48},largeInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,pattern:"MMMM dd, yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.hour,span:1,pattern:"HH:mm "}},"SixHours":{text:r.getText("SWZS_SIX_HOURS"),innerInterval:{unit:sap.gantt.config.TimeUnit.hour,span:6,range:64},largeInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,pattern:"MMMM dd, yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.hour,span:6,pattern:"HH:mm "}},"DayDate":{text:r.getText("SWZS_DATE_1"),innerInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,range:64},largeInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,pattern:"MMM yyyy, 'Week' ww  "},smallInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,pattern:sap.ui.getCore().getConfiguration().getRTL()?"dd EEE ":"EEE dd "}},"Date":{text:r.getText("SWZS_DATE_2"),innerInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,range:32},largeInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,pattern:"MMM yyyy, 'Week' ww  "},smallInterval:{unit:sap.gantt.config.TimeUnit.day,span:1,pattern:"dd "}},"CWWeek":{text:r.getText("SWZS_WEEK_1"),innerInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,range:56},largeInterval:{unit:sap.gantt.config.TimeUnit.month,span:1,pattern:"MMM yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,pattern:sap.ui.getCore().getConfiguration().getRTL()?"'CW' ww  ":"'CW' ww  "}},"WeekOfYear":{text:r.getText("SWZS_WEEK_2"),innerInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,range:32},largeInterval:{unit:sap.gantt.config.TimeUnit.month,span:1,pattern:"MMM yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.week,span:1,pattern:"ww "}},"Month":{text:r.getText("SWZS_MONTH"),innerInterval:{unit:sap.gantt.config.TimeUnit.day,span:30,range:48},largeInterval:{unit:sap.gantt.config.TimeUnit.month,span:3,pattern:"yyyy QQQ "},smallInterval:{unit:sap.gantt.config.TimeUnit.month,span:1,pattern:"MMM "}},"Quarter":{text:r.getText("SWZS_QUARTER"),innerInterval:{unit:sap.gantt.config.TimeUnit.day,span:90,range:48},largeInterval:{unit:sap.gantt.config.TimeUnit.year,span:1,pattern:"yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.month,span:3,pattern:"QQQ "}},"Year":{text:r.getText("SWZS_YEAR"),innerInterval:{unit:sap.gantt.config.TimeUnit.year,span:1,range:48},largeInterval:{unit:sap.gantt.config.TimeUnit.year,span:5,pattern:"yyyy "},smallInterval:{unit:sap.gantt.config.TimeUnit.year,span:1,pattern:"yyyy "}}};var S=sap.gantt.axistime.StepwiseTimeLineOptions;var a=A.extend("sap.gantt.axistime.StepwiseZoomStrategy",{metadata:{library:"sap.gantt"}});a.prototype.init=function(){this._oTotalHorizonBeforeExtension=null;this._sZoomControlType=sap.gantt.config.ZoomControlType.Select;this._aTimeLineOptions=null;this._initialTotalHorizon=null;var t=S.DayDate;this.setProperty("timeLineOption",t,true);this.setProperty("timeLineOptions",S,true);this.setProperty("zoomLevel",this._getIndexOfTimeLineOption(t,S),true);this.setProperty("mouseWheelZoomType",sap.gantt.MouseWheelZoomType.None,true);this.setProperty("finestTimeLineOption",null,true);this.setProperty("coarsestTimeLineOption",null,true);this.setProperty("zoomLevels",0,true);this._aZoomRate=new Array(11);};a.prototype.applySettings=function(){A.prototype.applySettings.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();if(this._getIndexOfTimeLineOption(this.getTimeLineOption())===-1){this.setTimeLineOption(this._aTimeLineOptions[0]);}return this;};a.prototype.createAxisTime=function(l){A.prototype.createAxisTime.apply(this,arguments);this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()));this._Locale=l;return this;};a.prototype.setVisibleHorizon=function(v){this.setVisibleHorizonWithReason(v,"visibleHorizonUpdated");return this;};a.prototype.setVisibleHorizonWithReason=function(v,R,o){var l=this.getVisibleHorizon();A.prototype.setVisibleHorizon.apply(this,arguments);this.fireRedrawRequest(false,R,l,o);return this;};a.prototype.setTotalHorizon=function(t){A.prototype.setTotalHorizon.apply(this,arguments);var o=this.getAxisTime();if(o){o.setTimeRange([F.getTimeStampFormatter().parse(t.getStartTime()),F.getTimeStampFormatter().parse(t.getEndTime())]);var h=F.getTimeStampFormatter().parse(t.getStartTime());var H=F.getTimeStampFormatter().parse(t.getEndTime());var n=H.valueOf()-h.valueOf();var T=this.getTimeLineOption();var b=jQuery.sap.getObject(T.innerInterval.unit).offset(h,T.innerInterval.span).valueOf()-h.valueOf();o.setViewRange([0,Math.ceil((n*T.innerInterval.range/b)/this._aZoomRate[this.getZoomLevel()])]);}return this;};a.prototype.setZoomLevels=function(z){return this;};a.prototype.setZoomLevel=function(z){if(z>=0){this.setProperty("zoomLevel",z,true);this.setProperty("timeLineOption",this._getTimeLineOptionByIndex(z),true);if(this._aZoomRate[z]){var o=this.getAxisTime();if(o){o.setZoomRate(this._aZoomRate[z]);}var t=this.getTotalHorizon();if(this._oTotalHorizonBeforeExtension){this.setTotalHorizon(new sap.gantt.config.TimeHorizon({startTime:this._oTotalHorizonBeforeExtension.getStartTime(),endTime:this._oTotalHorizonBeforeExtension.getEndTime()}));}if(this.getGanttVisibleWidth()){var n=this._updateVisibleHorizon(this.getGanttVisibleWidth());this.setVisibleHorizon(n);}}}return this;};a.prototype.setCoarsestTimeLineOption=function(t){return this;};a.prototype.setFinestTimeLineOption=function(t){return this;};a.prototype.setTimeLineOptions=function(t){A.prototype.setTimeLineOptions.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();return this;};a.prototype._updateVisibleHorizon=function(n){if(!n){var w=this._getWidthOfTotalHorizon();this._extendTotalHorizon(w);}else{this._extendTotalHorizon(n);}var v=this.getVisibleHorizon();var m=this.calMiddleDate(F.getTimeStampFormatter().parse(v.getStartTime()),F.getTimeStampFormatter().parse(v.getEndTime()));var N=this.calVisibleHorizonByRate(this._aZoomRate[this.getZoomLevel()],m);A.prototype.setVisibleHorizon.call(this,N);return N;};a.prototype.syncContext=function(n){var o=this.getGanttVisibleWidth();if(n!==o){this._updateVisibleHorizon(n);this.updateGanttVisibleWidth(n);}var R={zoomLevelChanged:true,axisTimeChanged:true};return R;};a.prototype._updateZoomRateArray=function(){if(this._oZoom){var t=this.getTimeLineOptions();this._aZoomRate=[];if(t){var i;if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){i=this._getCountOfTimeLineOptions();for(var j in t){i--;this._aZoomRate[i]=this._oZoom.base.scale/this.calZoomScale(t[j].innerInterval.unit,t[j].innerInterval.span,t[j].innerInterval.range);}}else{i=0;for(var j in t){this._aZoomRate[i]=this._oZoom.base.scale/this.calZoomScale(t[j].innerInterval.unit,t[j].innerInterval.span,t[j].innerInterval.range);i++;}}}else{this._aZoomRate[0]=1;}}};a.prototype._updateTimeLineOptions=function(){var t=this.getTimeLineOptions();this._aTimeLineOptions=[];if(t){for(var i in t){this._aTimeLineOptions.push(t[i]);}if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){this._aTimeLineOptions=this._aTimeLineOptions.reverse();}}};a.prototype.updateStopInfo=function(s){this.setZoomLevel(s.index);return this;};a.prototype._getIndexOfTimeLineOption=function(t,T){var I,o=T;if(!o){o=this.getTimeLineOptions();}if(!this._aTimeLineOptions){this._updateTimeLineOptions();}for(var i=0,l=this._aTimeLineOptions.length;i<l;i++){if(this._aTimeLineOptions[i]==t){return i;}}return-1;};a.prototype._getTimeLineOptionByIndex=function(i){if(i<this._aTimeLineOptions.length){return this._aTimeLineOptions[i];}else{return null;}};a.prototype._getWidthOfTotalHorizon=function(){var t=this.getTotalHorizon();var s=F.getTimeStampFormatter().parse(t.getStartTime());var e=F.getTimeStampFormatter().parse(t.getEndTime());var o=this.getAxisTime();var b=o.timeToView(s);var c=o.timeToView(e);return Math.abs(c-b);};a.prototype._extendTotalHorizon=function(n){if(!this._initialTotalHorizon){this._initialTotalHorizon=this.getTotalHorizon();}var t=this.getTotalHorizon();var b=0;if(this._oZoom&&this._oZoom.base&&this._oZoom.base.scale!==undefined){var T=F.abapTimestampToDate(t.getStartTime());var o=F.abapTimestampToDate(t.getEndTime());var c=o.getTime()-T.getTime();var d=this._aZoomRate[this.getZoomLevel()];var e=this._oZoom.base.scale/d;var f=n*e;b=f-c;t=this._calTotalHorizon(b,f);this.setTotalHorizon(t);}};a.prototype._calTotalHorizon=function(n,b){var t=this.getTotalHorizon();if(n!==0){var c=F.abapTimestampToDate(this._initialTotalHorizon.getStartTime()).getTime();var d=F.abapTimestampToDate(this._initialTotalHorizon.getEndTime()).getTime();var e=(c+d)/2;if(n>0){var f=e-b/2;var g=e+b/2;}else{var f=F.abapTimestampToDate(t.getStartTime()).getTime()-n/2;var g=F.abapTimestampToDate(t.getEndTime()).getTime()+n/2;if(f>c){f=c;}if(g<d){g=d;}}var N=new Date();N.setTime(f);var o=new Date();o.setTime(g);return new sap.gantt.config.TimeHorizon({startTime:N,endTime:o});}return t;};a.prototype._updateZoomControlType=function(z){if(z){A.prototype._updateZoomControlType.apply(this,arguments);this._sZoomControlType=z;this._updateZoomRateArray();this._updateTimeLineOptions();this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()));}};a.prototype._getCountOfTimeLineOptions=function(){if(this._iCountOfTimeLineOptions){return this._iCountOfTimeLineOptions;}var t=this.getTimeLineOptions();var c=0;for(var i in t){if(t.hasOwnProperty(i)){c++;}}this._iCountOfTimeLineOptions=c;return c;};return a;},true);
