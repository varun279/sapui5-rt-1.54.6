sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox"],function(C,M,a){"use strict";var o=function(){this.getView().attachAfterRendering(function(){A();});};var O=function(){var m=this.getView().getModel("data");if(m.getProperty("/status")==="Loading"){M.show("Application is still loading");return;}var t=new Date().toLocaleTimeString([],{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"});m.setData({properties:null,retrieval:t,copyEnabled:false});m.updateBindings();this.getView().getViewData().plugin.onRefresh();};var f=function(){var n="\r\n";var p="- ";var d=this.getView().getModel("data").getData();if(!(d&&d.properties&&d.url)){a.error("Could not copy data to your clipboard! No data collected",{title:"Error"});return;}var P=d.properties;var c="*************+Extracted by SAP Fiori Elements Diagnostics Plugin [FEDiagnostic]+*************"+n;c+=p+"Extracted on "+new Date().toUTCString()+n;c+=p+"Host: "+d.origin+n;c+=p+"Application status: "+d.status+n;if(d.statusMessage){c+=p+"Notice: "+d.statusMessage+n;}c+=n;c+="APP DATA"+n;for(var i=0,l=P.length;i<l;i++){if(P[i].type==="string"){c+=p+P[i].name+": "+P[i].value+n;}else if(P[i].type==="link"){c+=p+P[i].name+": "+P[i].target+n;}else if(P[i].type==="group"){c+="Group: "+P[i].name+n;}}c+=n;c+="**************************"+n;c+=n;c+=n;c+="PROVIDE"+n;c+=p+"User/Password: <user>/<password>"+n;c+=p+"Steps to recreate the issue: <maybe also provide master data, pictures or video…>"+n;var t=this.getView().byId("CopyDataTextArea").getId();var T=document.getElementById(t);T.style.display="block";T.value=c;T.select();try{var S=document.execCommand("copy");if(S){M.show("Ticket relevant information copied to clip board");}else{a.error("Could not copy data to your clipboard! You can copy it manually from here: "+n+n+c,{title:"Error"});}}catch(e){a.error("Could not copy data to your clipboard! You can copy it manually from here: "+n+n+c,{title:"Error"});}finally{T.style.display="none";}};var b=function(){var n="<br/>",S="</span>"+n,c="<span>",p=c+"- ",d=this.getView().getModel("data").getData();if(!(d&&d.properties&&d.url)){a.error("Could not copy data to your clipboard! No data collected",{title:"Error"});return;}var P=d.properties,$=jQuery.sap.byId(this.getView().byId("CopyDataHTML").getId()),e=$[0];var g=c+"*************+Extracted by SAP Fiori Elements Diagnostics Plugin [FEDiagnostic]+*************"+S;g+=p+"Extracted on "+new Date().toUTCString()+S;g+=p+"Host: <a href=\""+d.url+"\">"+d.origin+"</a>"+S;g+=p+"Application status: "+d.status+S;if(d.statusMessage){g+=p+"Notice: "+d.statusMessage+S;}g+=n;g+=c+"APP DATA"+S;for(var i=0,l=P.length;i<l;i++){if(P[i].type==="string"){g+=p+P[i].name+": "+P[i].value+S;}else if(P[i].type==="link"){g+=p+P[i].name+": <a href=\""+P[i].target+"\">"+P[i].value+"</a>"+S;}else if(P[i].type==="group"){g+=c+"Group: "+P[i].name+S;}}g+=c+"**************************"+S;g+=n;g+=c+"PROVIDE"+S;g+=c+"User/Password: &lt;user&gt;/&lt;password&gt;"+S;g+=c+"Steps to recreate the issue: &lt;maybe also provide master data, pictures or video…&gt;"+S;function r(){try{document.getSelection().removeAllRanges();}catch(j){jQuery.noop();}}$.empty();jQuery(g).appendTo(e);try{var h=document.createRange();r();h.selectNode(e);document.getSelection().addRange(h);document.execCommand("copy");r();M.show("Ticket relevant information copied to clip board with HTML format");}catch(j){r();f();}finally{$.empty();}};var A=function(){var g=jQuery(".diagnosticPropertiesGroupHeaderContent");if(g.length===0){jQuery.sap.log.debug("No headers found which should be customized");return;}for(var i=0;i<g.length;i++){var c=g[i].closest("td").id;var $=jQuery("#"+c);$.addClass("diagnosticPropertiesGroupHeader");$.attr("colspan",2);$.next().remove();}};var u=function(t,S){var m=this.getView().getModel("data");m.setData({timeLeft:t,status:S});};var s=function(){if(jQuery.sap.fioriElementsPluginID){var v=jQuery.sap.byId(jQuery.sap.fioriElementsPluginID);if(v&&v.parent()&&!v.parent().hasClass("sapUiSupportHidden")){M.show("Data refreshed");}}};return C.extend("sap.suite.ui.generic.template.support.DiagnosticsTool.controller.DiagnosticsTool",{onInit:o,onRefreshData:O,onCopyDataPlain:f,onCopyDataHTML:b,updateStatus:u,showDataRefreshed:s});});
