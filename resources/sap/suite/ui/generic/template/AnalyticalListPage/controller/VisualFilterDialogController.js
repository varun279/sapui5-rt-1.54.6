sap.ui.define(["sap/m/Button","sap/m/ButtonType","sap/m/Label","sap/m/Dialog","sap/m/Bar","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Link","sap/m/List","sap/m/TextArea","sap/m/Text","sap/m/StandardListItem","sap/m/ListSeparators","sap/m/Popover","sap/ui/layout/form/SimpleForm","sap/ui/layout/GridData","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms",'sap/ui/model/Filter',"sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/m/OverflowToolbarButton"],function(B,a,L,D,b,S,T,c,d,V,H,C,e,f,g,h,j,k,P,l,G,m,F,n,o,p,q,r,O){"use strict";var s="_BASIC";var t="100%";var u=0.33;var v=0.5;var w=m.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController",{init:function(i){this.oState=i;this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.bIsTimeBasedLine;this.bSortOrder;},_createForm:function(){this.sJsonModel=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').getJSON();this.oConfig=JSON.parse(this.sJsonModel);this._filterModified=false;this.filterCompList=[];this.filterChartList=[];this._buildFiltersFromConfig();this.oVerticalBox=new V();this.oVerticalBox.setModel(this.oState.oController.getView().getModel("_templPriv"),"_templPriv");this.oVerticalBox.setModel(this.oState.oController.getView().getModel());this.oVerticalBox.setModel(this.oState.oController.getView().getModel("i18n"),"i18n");this.oVerticalBox.setModel(this.oState.oController.getOwnerComponent().getModel("_filter"),"_filter");this.oVerticalBox.setModel(this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");this._addFilterSwitch();this._addGroupsAndFilters();return this.oVerticalBox;},_toggle:function(){var i=this.oState.oSmartFilterbar.getFilterDialogContent();if(i&&(i.length===2)){if(i[0].getVisible()){i[0].setVisible(false);i[1].setVisible(true);i[1].getItems()[0].getContent()[1].addCustomData(new sap.ui.core.CustomData({key:'isToggle',value:true}));}else{i[0].setVisible(true);i[1].setVisible(false);i[0].getToolbar().getContent()[1].addCustomData(new sap.ui.core.CustomData({key:'isToggle',value:true}));}}},_addFilterSwitch:function(){var i=[new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-fields",width:"inherit",key:"compact",tooltip:"{i18n>FILTER_COMPACT}"}),new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-analytics",width:"inherit",key:"visual",tooltip:"{i18n>FILTER_VISUAL}"})];var x=new n({width:"inherit",selectedKey:"visual",items:i}).addEventDelegate({onAfterRendering:function(E){if(E.srcControl.getCustomData()[0]&&E.srcControl.getCustomData()[0].getValue()){E.srcControl.focus();E.srcControl.removeAllCustomData();}}});x.attachSelect(function(E){var z=E.getSource();z.setSelectedKey("visual");this._toggle();}.bind(this));var y=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[new sap.m.ToolbarSpacer(),x]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogToolbar");this.oVerticalBox.addItem(y);},_searchDialog:function(){this.oState.alr_visualFilterBar._setVariantModified();},_restoreDialog:function(){this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').setData(JSON.parse(this.sJsonModel));this.oConfig=JSON.parse(this.sJsonModel);this._reloadForm();this._filterModified=false;},_cancelDialog:function(){if(this._filterModified){var i=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');i.setData(JSON.parse(this.sJsonModel));this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}},_buildFiltersFromConfig:function(){var i;this.filterCompList=[];this.filterChartList=[];for(i=0;i<this.oConfig.filterCompList.length;i++){var x=this.oConfig.filterCompList[i].component.properties.sortOrder;if(x.constructor===Object&&x.value){this.oConfig.filterCompList[i].component.properties.sortOrder=x.value;}this.filterCompList.push({obj:{shownInFilterBar:this.oConfig.filterCompList[i].shownInFilterBar,shownInFilterDialog:this.oConfig.filterCompList[i].shownInFilterDialog,cellHeight:this.oConfig.filterCompList[i].cellHeight,component:{type:this.oConfig.filterCompList[i].component.type,cellHeight:this.oConfig.filterCompList[i].component.cellHeight},group:{label:this.oConfig.filterCompList[i].group.label,name:this.oConfig.filterCompList[i].group.name}},searchVisible:this.oConfig.filterCompList[i].searchVisible===undefined||this.oConfig.filterCompList[i].searchVisible});}},_rebuildConfig:function(){var i;var x={filterCompList:[]};for(i=0;i<this.filterCompList.length;i++){x.filterCompList.push({shownInFilterBar:this.filterCompList[i].obj.shownInFilterBar&&this.filterCompList[i].obj.shownInFilterDialog,shownInFilterDialog:this.filterCompList[i].obj.shownInFilterDialog,cellHeight:this.filterCompList[i].obj.cellHeight,group:{label:this.filterCompList[i].obj.group.label,name:this.filterCompList[i].obj.group.name},component:{type:this.filterCompList[i].obj.component.type,cellHeight:this.filterCompList[i].obj.component.cellHeight,properties:{scaleFactor:this.filterChartList[i].getScaleFactor(),numberOfFractionalDigits:this.filterChartList[i].getNumberOfFractionalDigits(),sortOrder:this.filterChartList[i].getSortOrder(),filterRestriction:this.oConfig.filterCompList[i].component.properties.filterRestriction,entitySet:this.filterChartList[i].getEntitySet(),isDropDown:this.oConfig.filterCompList[i].component.properties.isDropDown,width:this.oConfig.filterCompList[i].component.properties.width,height:this.oConfig.filterCompList[i].component.properties.height,dimensionField:this.filterChartList[i].getDimensionField(),dimensionFieldDisplay:this.filterChartList[i].getDimensionFieldDisplay(),dimensionFieldIsDateTime:this.filterChartList[i].getDimensionFieldIsDateTime(),dimensionFilter:this.filterChartList[i].getDimensionFilter(),unitField:this.filterChartList[i].getUnitField(),isCurrency:this.filterChartList[i].getIsCurrency(),isMandatory:this.oConfig.filterCompList[i].component.properties.isMandatory,measureField:this.filterChartList[i].getMeasureField(),outParameter:this.oConfig.filterCompList[i].component.properties.outParameter,inParameters:this.oConfig.filterCompList[i].component.properties.inParameters,parentProperty:this.oConfig.filterCompList[i].component.properties.parentProperty,chartQualifier:this.oConfig.filterCompList[i].component.properties.chartQualifier}}});}return x;},_reloadForm:function(){this.oVerticalBox.destroyItems();this._buildFiltersFromConfig();this._addFilterSwitch();this._addGroupsAndFilters();},_addGroupsAndFilters:function(){var i;var x;var y;var z=[];var A=0;for(i=0;i<this.filterCompList.length;i++){if(!Array.isArray(this.filterCompList[i])){if(this.filterCompList[i].searchVisible===false){continue;}if(!(z.indexOf(this.filterCompList[i].obj.group.name)>-1)){if(y){this.oVerticalBox.addItem(y);}x=this.filterCompList[i].obj.group.name;z.push(x);y=new V();y.setWidth("100%");y.setLayoutData(new G({span:"L12 M12 S12"}));y.addStyleClass("sapUiSmallMarginTop");A++;this._addGroupToolbar(y,this.filterCompList[i].obj.group.label,this.filterCompList[i].obj.group.name);}if(this.filterCompList[i].obj.shownInFilterDialog){this.filterCompList[i].toolbar=this._addChartCustomToolbar(this.oConfig.filterCompList[i],i);this.filterCompList[i].overlay=this._addChartOverlay(this.oConfig.filterCompList[i],i);this.filterChartList[i]=this._addChart(this.oConfig.filterCompList[i].component.type,this.oConfig.filterCompList[i].component.properties,i);var E=this,I=this.filterChartList[i].getParentProperty().replace(/[^\w]/gi,'')+"checkBox";var J=[new V({items:[E.filterCompList[i].toolbar,E.filterCompList[i].overlay,E.filterChartList[i]]}).setWidth("100%").addStyleClass("sapUiSmallMarginEnd")];if(sap.ui.Device.system.desktop){J[0].setWidth("80%");J.splice(1,0,new V({items:[new L({text:"{i18n>SHOW_ON_FILTER_BAR}",labelFor:I}).addStyleClass("sapUiTinyMarginTop"),new C({id:I,text:"",selected:E.oConfig.filterCompList[i].shownInFilterBar}).data("idx",i).attachSelect(null,E._onCheckBoxSelect,E)]}).setAlignItems("Center"));J[1].setWidth("20%");}var K=new H({items:J}).addStyleClass("sapUiSmallMarginTop").setWidth("100%");y.addItem(K);}}if(y){this.oVerticalBox.addItem(y);}}if(A==1&&x===s){F.executeFunction(y,"mAggregations.items.0.setVisible",[false]);}},_onCheckBoxSelect:function(E){var i=E.getSource().data("idx");this.selectCheckBox(i,E.getSource().getSelected());},_addGroupToolbar:function(i,x,y){var z=new d({text:x});var A=new T({content:[z,new c()]});if(y!=s){A.addContent(this._createMoreFiltersLink(y,z));}i.addItem(A);},selectCheckBox:function(i,x){this._filterModified=true;var y=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),z=jQuery.extend(true,{},y);z.setProperty('/filterCompList/'+i+'/shownInFilterBar',x);y.setData(z.getData());this.oConfig=JSON.parse(y.getJSON());this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_addChartOverlay:function(i,x){var y=new V({width:"100%",height:i.component.properties.height,items:[new sap.m.Label({text:{path:'_visualFilterConfigModel>/filterCompList/'+x+'/overlayMessage',formatter:function(z){return this.getModel("i18n").getResourceBundle().getText(z);}}})],visible:{path:'_visualFilterConfigModel>/filterCompList/'+x+'/showChartOverlay',formatter:function(z){return z;}}});y.addStyleClass("sapUiOverlay");y.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");return y;},_addChartCustomToolbar:function(i,x){var y=this;var z=i.component.properties.parentProperty,A=i.component.properties,E=F.getPropertyNameDisplay(this.oState.alr_visualFilterBar.getModel(),i.component.properties.entitySet,i.component.properties.dimensionField),M=z.replace(/[^\w]/gi,''),I=this.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(i.component.properties.entitySet),J=i.component.properties.sortOrder[0].Descending.Boolean,K=F.readProperty(i,"component.type")==="Line"&&F.readProperty(i,"component.properties.dimensionFieldIsDateTime"),N=this.oState.alr_visualFilterBar._resolveChartType(i.component.type),Q=this._getChartTypeIconLink(N),R=new d({text:y._getChartTitle(i,x),tooltip:y._getChartTitle(i,x),titleStyle:sap.ui.core.TitleLevel.H6});if(this.oConfig.filterCompList[x].component.properties.isMandatory){R.addStyleClass("sapMLabelRequired");}var U=this.oState.oSmartFilterbar.getControlByKey(i.component.properties.parentProperty);this.oState.oSmartFilterbar.ensureLoadedValueHelp(i.component.properties.parentProperty);var W=U.getShowValueHelp&&U.getShowValueHelp(),X=(A.isDropDown)?"sap-icon://slim-arrow-down":"",Y=W?"sap-icon://value-help":X,Z,$=this.oVerticalBox.getModel("i18n").getResourceBundle(),_=[new B({type:"Transparent",icon:"sap-icon://line-chart-time-axis",visible:false,press:function(b1){y._showLineChartTimeAxisPopup(b1);}}).data("idx",x),new B({type:"Transparent",icon:(W||A.isDropDown)?Y:"",visible:{path:"_filter>/"+z,formatter:function(b1){if(W||A.isDropDown){return true;}else{if(!b1){return false;}if(typeof b1==="object"){return(b1.value||(b1.items&&b1.items.length)||(b1.ranges&&b1.ranges.length))?true:false;}return true;}}},text:{path:"_filter>/"+z,formatter:function(b1){Z=0;if(b1){if(typeof b1==="object"){if(b1.value){Z++;}if(b1.items){Z+=b1.items.length;}if(b1.ranges){Z+=b1.ranges.length;}}else{Z++;}}return Z?"("+Z+")":"";}},press:function(b1){if(W){U.fireValueHelpRequest.call(U);}else if(A.isDropDown){var c1=y.oState.alr_visualFilterBar._isEntitytypeSearchable(this.getModel(),A.entitySet),d1=this.getModel("visualFilter")||this.getModel();r.createDropdown(b1.getSource(),y.filterChartList[b1.getSource().data("idx")],d1,E,A,c1);}else{sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup(b1.getSource(),y.filterChartList[b1.getSource().data("idx")],b1.getSource().getModel('i18n'));}},tooltip:{path:"_filter>/"+z,formatter:function(){return F.getTooltipForValueHelp(W,E,$,Z);}},layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})}).data("idx",x),new O({type:"Transparent",icon:(J?"sap-icon://sort-descending":"sap-icon://sort-ascending"),visible:!K,tooltip:"{i18n>VISUAL_FILTER_SORT_ORDER}",text:"{i18n>VISUAL_FILTER_SORT_ORDER}",press:function(b1){y._showChartSortPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",x),new O({type:"Transparent",icon:Q,tooltip:"{i18n>VISUAL_FILTER_CHART_TYPE}",text:"{i18n>VISUAL_FILTER_CHART_TYPE}",press:function(b1){y._showChartTypesPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",x),new O({id:"template::VisualFilterDialog::MeasureChangeButton::"+I+"::"+M,type:"Transparent",icon:"sap-icon://measure",tooltip:"{i18n>VISUAL_FILTER_MEASURE}",text:"{i18n>VISUAL_FILTER_MEASURE}",press:function(b1){y._showChartMeasuresPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",x)];if((sap.ui.Device.system.tablet||sap.ui.Device.system.phone)&&!sap.ui.Device.system.desktop){_.splice(2,0,new C({tooltip:"{i18n>SHOW_ON_FILTER_BAR}",text:"{i18n>SHOW_ON_FILTER_BAR}",selected:y.oConfig.filterCompList[x].shownInFilterBar,layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:sap.m.OverflowToolbarPriority.AlwaysOverflow})}).data("idx",x).attachSelect(null,y._onCheckBoxSelect,y));_[2].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDShowInFilterBarCozy");}var a1=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[R,new sap.m.ToolbarSpacer(),_]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogTitleToolbar");a1.getContent()[0].addStyleClass("sapUiTinyMarginTop");a1.getContent()[0].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogChartTitle");a1.setWidth("100%");return a1;},_addChart:function(i,x,y){var z;var A=this;var E={scaleFactor:x.scaleFactor,numberOfFractionalDigits:x.numberOfFractionalDigits,sortOrder:x.sortOrder,filterRestriction:x.filterRestriction,isDropDown:x.isDropDown,width:t,height:x.height,labelWidthPercent:u,entitySet:x.entitySet,dimensionField:x.dimensionField,dimensionFieldDisplay:x.dimensionFieldDisplay,dimensionFieldIsDateTime:x.dimensionFieldIsDateTime,unitField:x.unitField,isCurrency:x.isCurrency,isMandatory:x.isMandatory,measureField:x.measureField,dimensionFilter:x.dimensionFilter,outParameter:x.outParameter,inParameters:x.inParameters,parentProperty:x.parentProperty,textArrangement:x.textArrangement,chartQualifier:x.chartQualifier};var I="/filterCompList/"+y;if(i==="Donut"){E.labelWidthPercent=v;}i=this.oState.alr_visualFilterBar._resolveChartType(i);var z=this.oState.alr_visualFilterBar._createFilterItemOfType(i,E);z.data("idx",y);z.addCustomData(new sap.ui.core.CustomData({key:'sPath',value:I}));z.bindProperty('visible',{path:'_visualFilterConfigModel>/filterCompList/'+y+'/showChartOverlay',formatter:function(N){return!N;}});z.bindProperty('dimensionFilter',{path:'_filter>/'+z.getParentProperty()});var J=z.getInParameters(),K=[];if(J&&J.length>0){J.forEach(function(N){K.push({path:"_filter>/"+N.localDataProperty});});}if(A.oState.alr_visualFilterBar.getEntitySet()===z.getEntitySet()){var M=A.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();if(M&&M.length>0){M.forEach(function(N){if(!N.data("isCustomField")){K.push({path:'_filter>/'+N.getName()});}});}}if(K&&K.length>0){z.bindProperty('dimensionFilterExternal',{parts:K,formatter:function(){var J=this.getInParameters(),N=this.getParentProperty(),Q,R;if(!(A.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()&&A.oState.oSmartFilterbar.getAnalyticBindingPath()!=="")&&(A.oState.oSmartFilterbar.getAnalyticBindingPath()===""||((A.oState.oSmartFilterbar.getAnalyticBindingPath().indexOf("P_DisplayCurrency"))!=-1))){var U=A.oState.alr_visualFilterBar.getProperty("displayCurrency");if(U){var W=this.getMeasureField();var X=A.oState.alr_visualFilterBar.getModel();var Y=X.getMetaModel();var Z=Y.getODataEntityType(A.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var $=Y.getODataProperty(Z,W);if($){var _=$[p.ISOCurrency];if(_){var a1=_.Path;for(var b1=(J.length-1);b1>-1;b1--){var c1=J[b1].valueListProperty;var d1=J[b1].localDataProperty;if(c1===a1){var e1=A.oState.oSmartFilterbar.getFilterData();if(!e1[d1]){R=Y.getODataProperty(Z,a1);if(R&&R["sap:filterable"]!=="false"){Q=new sap.ui.model.Filter({aFilters:[new sap.ui.model.Filter({path:a1,operator:"EQ",value1:U,value2:undefined})],and:false});}}break;}}}}}}return A.oState.alr_visualFilterBar._getFiltersForFilterItem(J,N,Q,a1);}});}z._updateBinding();z._bAllowBindingUpdateOnPropertyChange=true;z.attachFilterChange(function(N){A._filterModified=true;A.oState.alr_visualFilterBar.fireFilterChange();});z.attachTitleChange(function(N){var y=N.getSource().data("idx");if(A.filterCompList[y].toolbar.getContent().length>0){if(E.isMandatory){A.filterCompList[y].toolbar.getContent()[0].addStyleClass("sapMLabelRequired");}A.filterCompList[y].toolbar.getContent()[0].setText(A._getChartTitle(A.filterCompList[y].obj,y));}});return z;},_createMoreFiltersLink:function(x,y){var z=this;var A=0;var i;var E=new e();for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].searchVisible&&this.filterCompList[i].obj.group.name===x&&!this.filterCompList[i].obj.shownInFilterDialog){A++;}}if(A>0){E.setText(this.oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[A]));}else{E.setText(this.oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS"));}E.attachPress(function(I){z._createAddRemoveFiltersDialog(x,E);});if(y){E.addAriaLabelledBy(y);}return E;},_showChartMeasuresPopup:function(E){var i=this;var x=E.getSource().data("idx");var y=this.filterChartList[x].getProperty("entitySet");var z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(E.getSource().getModel('i18n'),"VISUAL_FILTER_MEASURES");var A=new f({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true});A.data("idx",x);z.addContent(A);var I=this.oState.alr_visualFilterBar._getMeasureMap()[y];A.addStyleClass("sapUiSizeCompact");if(I){for(var J in I){var K=new j({title:I[J].label,tooltip:(I[J].fieldInfo&&I[J].fieldInfo.quickInfo)||I[J].label}).data("measureName",I[J].name);A.addItem(K);if(this.filterChartList[x].getMeasureField()===I[J].name){A.setSelectedItem(K);}}}A.attachSelectionChange(function(E){var x=E.getSource().data("idx"),M=E.getSource().getSelectedItem().data("measureName");i.filterChartList[x].setProperty("unitField",I[M].fieldInfo.unit);i.filterCompList[x].toolbar.getContent()[0].setText(i._getChartTitle(i.filterCompList[x].obj,x));i.oConfig.filterCompList[x].component.properties.measureField=M;if(!i.filterChartList[x]._chart.getPoints){var N=jQuery.extend(true,[],i.filterChartList[x].getSortOrder());N[0].Field.String=M;i.filterChartList[x].setSortOrder(N);i._updateVisualFilterConfigModel(x,'/component/properties/sortOrder',N);}var Q={bUpdateBinding:true,value:M};i.filterChartList[x].setMeasureField(Q);i._updateVisualFilterConfigModel(x,'/component/properties/measureField',Q);i._updateVisualFilterConfigModel(x,'/component/properties/measureField',M);i._updateVisualFilterConfigModel(x,'/component/properties/unitField',I[M].fieldInfo.unit);i._filterModified=true;if(z){z.close();}});z.attachAfterClose(function(){z.destroy();z=null;});z.openBy(E.getSource());},_showChartTypesPopup:function(E){var x=this;var y=E.getSource();var z=y.getModel('i18n');var A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(z,"VISUAL_FILTER_CHART_TYPES");var I=this.oState.alr_visualFilterBar._getSupportedFilterItemList();var J=[];var K=false;for(var i=0;i<I.length;i++){var M=I[i];var N=new j({title:"{i18n>"+M.textKey+"}",icon:M.iconLink,selected:y.getIcon()===M.iconLink}).data("type",M.type);J.push(N);}var Q=new f({mode:sap.m.ListMode.SingleSelectMaster,items:J});Q.data("button",y);Q.addStyleClass("sapUiSizeCompact");Q.setModel(z,"i18n");A.addContent(Q);Q.attachSelectionChange(function(E){var R=E.getSource().data("button").data("idx"),U=E.getSource().getSelectedItem().data("type"),W=x.filterChartList[R],X=W.getDimensionField(),Y=W.getMeasureField(),Z=W.getDimensionFieldIsDateTime(),$=F.readProperty(x.oConfig,"filterCompList."+R+".component.properties.sortOrder.0.Field.String"),_=x.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),a1=jQuery.extend(true,{},_.getProperty('/filterCompList/'+R)),b1=F.readProperty(a1,"component.properties.sortOrder.0.Field.String");x.oConfig.filterCompList[R].component.type=U;K=true;E.getSource().data("button").setIcon(x._getChartTypeIconLink(U));if($&&b1){if(U==="Line"){x.oConfig.filterCompList[R].component.properties.sortOrder[0].Field.String=X;a1.component.properties.sortOrder[0].Field.String=X;if(Z){x.bSortOrder=x.oConfig.filterCompList[R].component.properties.sortOrder[0].Descending.Boolean;x.oConfig.filterCompList[R].component.properties.sortOrder[0].Descending.Boolean=true;a1.component.properties.sortOrder[0].Descending.Boolean=true;x.bIsTimeBasedLine=true;}}else{x.oConfig.filterCompList[R].component.properties.sortOrder[0].Field.String=Y;a1.component.properties.sortOrder[0].Field.String=Y;if(x.bIsTimeBasedLine){x.oConfig.filterCompList[R].component.properties.sortOrder[0].Descending.Boolean=x.bSortOrder;a1.component.properties.sortOrder[0].Descending.Boolean=x.bSortOrder;x.bIsTimeBasedLine=false;}}}a1.component.type=U;_.setProperty('/filterCompList/'+R,a1);x.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);x.oState.alr_visualFilterBar.updateVisualFilterBindings(true);if(A){A.close();}});A.attachBeforeClose(function(){if(K){x._filterModified=true;x._reloadForm();}});A.attachAfterClose(function(){A.destroy();A=null;});A.openBy(E.getSource());},_showLineChartTimeAxisPopup:function(E){var i=E.getSource().data("idx");var x=E.getSource();var y=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(E.getSource().getModel('i18n'),"VISUAL_FILTER_LINE_CHART_TIME_LINE");var z=new f({mode:sap.m.ListMode.SingleSelectLeft,items:[new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_DAYS}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_MONTH}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_QUARTERS}"}).data("idx",i),new j({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_YEARS}"}).data("idx",i)]});z.data("button",x);z.addStyleClass("sapUiSizeCompact");y.addContent(z);z.attachSelectionChange(function(E){y.close();});y.attachAfterClose(function(){y.destroy();y=null;});y.openBy(E.getSource());},_showChartSortPopup:function(E){var i=this;var x=E.getSource().data("idx");var y=E.getSource();var z=E.getSource().getModel('i18n');var A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(z,"VISUAL_FILTER_SORTING");var I=new f({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new j({title:z.getResourceBundle().getText("VISUAL_FILTER_SORTING_ASCENDING")}).data("idx",x),new j({title:z.getResourceBundle().getText("VISUAL_FILTER_SORTING_DESCENDING")}).data("idx",x)]});I.data("button",y);I.addStyleClass("sapUiSizeCompact");if(this.filterChartList[x].getSortOrder()[0].Descending.Boolean){I.setSelectedItem(I.getItems()[1],true);}else{I.setSelectedItem(I.getItems()[0],true);}A.addContent(I);I.attachSelectionChange(function(E){var y=E.getSource().data("button");var x=y.data("idx");var J=jQuery.extend(true,[],i.filterChartList[x].getSortOrder());J[0].Descending.Boolean=E.getSource().getItems()[1].isSelected();if(J[0].Descending.Boolean){y.setIcon("sap-icon://sort-descending");}else{y.setIcon("sap-icon://sort-ascending");}var K={bUpdateBinding:true,value:J};i.filterChartList[x].setSortOrder(K);i._updateVisualFilterConfigModel(x,'/component/properties/sortOrder',K);i._updateVisualFilterConfigModel(x,'/component/properties/sortOrder',J);i._filterModified=true;if(A){A.close();}});A.attachAfterClose(function(){A.destroy();A=null;});A.openBy(E.getSource());},_createAddRemoveFiltersDialog:function(x,y){var i;var z=this;var A=new sap.m.Dialog();A.setTitle(this.oRb.getText("SELECT_FILTER_FIELDS"));A.addStyleClass("sapUiPopupWithPadding");A.addStyleClass("sapUiCompAddRemoveFilterDialog");A.addStyleClass("sapUiSizeCompact");A.setVerticalScrolling(true);var E=new b();var I=new S({placeholder:this.oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=I;I.attachLiveChange(function(N){z._onAddRemoveFiltersSearch(N);});E.addContentRight(I);A.setSubHeader(E);this.addRemoveList=new f({mode:sap.m.ListMode.MultiSelect});this.addRemoveList.setShowSeparators(k.None);A.addContent(this.addRemoveList);for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].obj.group.name===x&&this.filterCompList[i].searchVisible){var J=new j({title:this._getChartTitle(this.filterCompList[i].obj,i,true)}).data("idx",i);this.addRemoveList.addItem(J);if(this.filterCompList[i].obj.shownInFilterDialog){this.addRemoveList.setSelectedItem(J,true);}}}this.addRemoveList.attachSelectionChange(function(N){if(N){var Q=N.getParameters();if(Q){var J=Q.listItem;var R=J.data("idx");if(J){var U={bVisible:Q.selected,propertyName:z.oConfig.filterCompList[R].component.properties.parentProperty};z.oState.alr_visualFilterBar.fireFilterChange(U);}}}});var K=new B({text:this.oRb.getText("FORM_PERS_DIALOG_OK")});K.attachPress(function(){var i;var N=z.addRemoveList.getItems();var Q=z.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),R=jQuery.extend(true,{},Q);for(i=0;i<N.length;i++){var U=N[i].data("idx");var W=N[i].isSelected();R.setProperty('/filterCompList/'+U+'/shownInFilterBar',W);R.setProperty('/filterCompList/'+U+'/shownInFilterDialog',W);}Q.setData(R.getData());z.oConfig=JSON.parse(Q.getJSON());z.oState.alr_visualFilterBar.updateVisualFilterBindings(true);z.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);z._filterModified=true;z._reloadForm();A.close();});A.addAggregation("buttons",K);A.setInitialFocus(this._oSearchField);A.setContentHeight("23.25rem");var M=new B({text:this.oRb.getText("FORM_PERS_DIALOG_CANCEL"),press:function(){A.close();}});A.addAggregation("buttons",M);A.attachAfterClose(function(){A.destroy();A=null;});A.open();},_onAddRemoveFiltersSearch:function(E){var i;if(!E){return;}var x=E.getParameters();if(!x){return;}var y=(x.newValue?x.newValue:"").toLowerCase();var z=this.addRemoveList.getItems();for(i=0;i<z.length;i++){var A=(z[i].getTitle()).toLowerCase();z[i].setVisible(A.indexOf(y)>=0);}},_getChartTypeIconLink:function(i){var x=this.oState.alr_visualFilterBar._getSupportedFilterItemMap();var y=x[i];return!y?"":y.iconLink;},_getChartTitle:function(i,x,y){var z="";if(this.filterChartList[x]){if(y){i.component.properties=this.filterChartList[x].getP13NConfig();z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(i);}else{z=this.filterChartList[x].getTitle();}}else{i.component.properties=this.oConfig.filterCompList[x].component.properties;z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(i);}return z;},_adjustToolbarIcons:function(i){if(this.filterCompList[i].obj.component.type==="Line"){this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(true);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(false);}else{this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(false);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(true);}},_updateVisualFilterConfigModel:function(i,x,y,I){var z=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');z.setProperty('/filterCompList/'+i+x,y);if(I){var M=jQuery.extend(true,{},z.getProperty('/filterCompList/'+i));z.setProperty('/filterCompList/'+i,M);this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}this.oConfig=JSON.parse(z.getJSON());this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_triggerSearchInFilterDialog:function(E){var i;if(!E){return;}var x=E.getParameters();if(!x){return;}var y=(x.newValue?x.newValue:"").toLowerCase();for(i=0;i<this.oConfig.filterCompList.length;i++){var z=this.oConfig.filterCompList[i].component.properties;this.oConfig.filterCompList[i].searchVisible=(z.parentProperty.toLowerCase().indexOf(y)>=0)||(z.measureField.toLowerCase().indexOf(y)>=0);}this._reloadForm();}});sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog=function(i,x){if(this._oPopoverDialog){this._oPopoverDialog.destroy();}this._oPopoverDialog=new sap.m.Popover();this._oPopoverDialog.setTitle(i.getResourceBundle().getText(x));this._oPopoverDialog.setPlacement(sap.m.PlacementType.PreferredBottomOrFlip);this._oPopoverDialog.addStyleClass("sapUiPopupWithPadding");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList=function(x,y){var z=new f({mode:sap.m.ListMode.Delete}),A,E=x.getFilterRestriction();z.data("chart",x);if(E==='multiple'){A=jQuery.extend(true,{},x.getDimensionFilter());var I=(A&&A.items)?A.items:undefined,J=(A&&A.ranges)?A.ranges:undefined,K=(A&&A.value)?A.value:null;A=jQuery.extend(true,{},x.getDimensionFilter());if(I){for(var i=0;i<I.length;i++){var M=new j({title:I[i].text?I[i].text:I[i].key});if(M){M.addCustomData(new sap.ui.core.CustomData({key:'items',value:i}));}z.addItem(M);}}if(J){for(var i=0;i<J.length;i++){var M=new j({title:J[i].tokenText?J[i].tokenText:F.createTitleFromCode(J[i])});M.addCustomData(new sap.ui.core.CustomData({key:'ranges',value:i}));z.addItem(M);}}if(K){var M=new j({title:K});M.addCustomData(new sap.ui.core.CustomData({key:'value'}));z.addItem(M);}}else{z.addItem(new j({title:x.getDimensionFilter()}));}z.attachDelete(function(N){var Q=N.getParameter("listItem"),R=z.data('chart'),U;if(E==='single'){U=null;}else{U=jQuery.extend(true,{},R.getDimensionFilter());var W=Q.getCustomData()[0],X=W.getKey(),Y=U[X];if(X!=='value'){var Z=W.getValue();Y.splice(Z,1);}else{U.value=null;}}z.removeItem(Q);R.setDimensionFilter(U);R.fireFilterChange();y.removeContent(z);var $=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(R,y);if($.getItems().length>0){y.addContent($);y.focus();}else{y.close();}});return z;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup=function(i,x,y){var z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(y,"VISUAL_FILTER_ALL_SELECTED_FILTERS"),A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(x,z);z.addContent(A);z.addStyleClass("sapUiSizeCompact");z.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");var E=new sap.m.Bar();var I=new B({text:y.getResourceBundle().getText("CLEAR_FILTERS_ALL"),press:function(J){var K=A.data('chart'),M=K.getFilterRestriction(),N;if(M==='multiple'){N=jQuery.extend(true,{},K.getDimensionFilter());N.items=[];N.ranges=[];N.value=null;}else{N=null;}z.removeContent(A);K.setDimensionFilter(N);K.fireFilterChange();z.close();}});E.addContentRight(I);z.setFooter(E);z.attachAfterClose(function(){z.destroy();z=null;});z.openBy(i);};return w;});
