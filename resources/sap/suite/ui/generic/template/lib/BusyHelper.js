sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,M,t){"use strict";function g(T){var b={};var i=false;var a=false;var c=0;var d=T.oNavigationHost.getBusyIndicatorDelay();var u=Promise.resolve();var U=q.noop;var o={};function f(){return c!==0||!q.isEmptyObject(b);}var A;function h(I){var e=f();if(e||I){a=false;T.oNavigationHost.setBusy(e);q.sap.log.info("Physical busy state has been changed to "+e);if(e!==i){i=e;if(!i){T.oNavigationHost.setBusyIndicatorDelay(d);var p=T&&T.oNavigationControllerProxy&&T.oNavigationControllerProxy.getActiveComponents();if(p){for(var r=0;r<p.length;r++){var v=p[r];if(!v){continue;}var C=T.componentRegistry&&T.componentRegistry[v]&&T.componentRegistry[v].oController;C&&C.adaptTransientMessageExtension&&C.adaptTransientMessageExtension();}}M.handleTransientMessages(T.oApplicationProxy.getDialogFragment,o.actionLabel);o={};U();}}}else{var N=T.oNavigationObserver.getProcessFinished(true);N.then(A,A);}}A=h.bind(null,true);function E(I){if(I){T.oNavigationHost.setBusyIndicatorDelay(0);h();}else if(!a){a=true;setTimeout(h,0);}}function j(){c--;if(!c){E(false);}}function m(){if(i){return;}i=true;u=new Promise(function(r){U=r;});M.removeTransientMessages();}function s(r,I,e,S){if(I){q.extend(o,S);m();b[r]=true;}else{delete b[r];}E(e);}function l(p,r){var S,C,L;try{throw new Error("Get the stack");}catch(e){S=e.stack.split(p,2);if(S.length>=2){S=S[1].split("\n");S.shift();}C=S[0].trim();}L=q.sap.log.getLevel();if(L<q.sap.log.Level.INFO){q.sap.log.setLevel(q.sap.log.Level.INFO);}q.sap.log.info("busyHandling: "+p+" called "+C,function(){var v={type:"sap.suite.generic.template.busyHandling",promise:r,promisePending:true,callStack:S};function P(){v.promisePending=false;}v.promise.then(P,P);return v;});q.sap.log.setLevel(L);}function k(e,I,S){q.extend(o,S);c++;if(sap.ui.support){l("setBusy",e);}m();e.then(j,j);E(I);}function n(){return d;}return{setBusyReason:s,setBusy:k,isBusy:f,getUnbusy:function(){return u;},getBusyDelay:n};}return B.extend("sap.suite.ui.generic.template.lib.BusyHelper",{constructor:function(T){q.extend(this,(t.testableStatic(g,"BusyHelper"))(T));}});});
