/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/UIComponent","sap/m/NavContainer","sap/f/FlexibleColumnLayout","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/NavigationController","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/library"],function(q,U,N,F,a,b,J,R,A,c,B,d,P,T,C,V,t,e){"use strict";A=t.observableConstructor(A);var D=sap.m.DraftIndicatorState;var r=T.getRegisterAppComponent();var o;function g(){o=o||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return o.getText.apply(o,arguments);}function f(){return new P({processObservers:[]});}var m=sap.ui.getCore().getMessageManager().getMessageModel();var v=new a({path:"validation",operator:b.EQ,value1:true});function h(j,k){var l={oAppComponent:j,componentRegistry:Object.create(null),aRunningSideEffectExecutions:[],getText:g,mRouteToTemplateComponentPromise:Object.create(null),oTemplatePrivateGlobalModel:(new J()).setDefaultBindingMode("TwoWay"),aStateChangers:[],oPaginatorInfo:Object.create(null),oValidationMessageBinding:m.bindList("/",null,null,v)};l.oValidationMessageBinding.attachChange(q.noop);var n;var p;var s;function u(){var i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");l.oTemplatePrivateGlobalModel.setProperty("/generic",{crossAppNavSupport:!!i&&i.isIntentUrl(document.URL),draftIndicatorState:D.Clear,shellServiceUnavailable:false,forceFullscreenCreate:false});j.setModel(l.oTemplatePrivateGlobalModel,"_templPrivGlobal");l.oShellServicePromise.catch(function(){l.oTemplatePrivateGlobalModel.setProperty("/generic/shellServiceUnavailable",true);});}function w(){l.fnAddSideEffectPromise=function(S){var i=0;for(;l.aRunningSideEffectExecutions[i];){i++;}l.aRunningSideEffectExecutions[i]=S;var W=function(){l.aRunningSideEffectExecutions[i]=null;};S.then(W,W);};n.attachEvent("beforeSideEffectExecution",function(i){if(i.getParameter("valueChange")||i.getParameter("fieldControl")){var S=i.getParameter("promise");l.oBusyHelper.setBusy(S);l.fnAddSideEffectPromise(S);}});var O=j.getModel("_templPrivGlobal");var Q="/generic/draftIndicatorState";n.attachBeforeQueueItemProcess(function(i){if(i.draftSave){O.setProperty(Q,D.Saving);}});n.attachOnQueueCompleted(function(){if(O.getProperty(Q)===D.Saving){O.setProperty(Q,D.Saved);}});n.attachOnQueueFailed(function(){if(O.getProperty(Q)===D.Saving){O.setProperty(Q,D.Clear);}});O.setProperty("/generic/appComponentName",j.getMetadata().getComponentName());}function x(){var i={appComponent:j,oTemplateContract:l,application:new c(l),oViewDependencyHelper:new V(l)};l.oViewDependencyHelper=i.oViewDependencyHelper;var S=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");l.oShellServicePromise=(S&&S.createInstance())||Promise.reject();l.oShellServicePromise.catch(function(){q.sap.log.warning("No ShellService available");});(U.prototype.init||q.noop).apply(j,arguments);l.oBusyHelper.setBusy(l.oShellServicePromise);s=r(i);var O=j.getModel();n=new A(O);u();p=new d(l);w();C.enableAutomaticDraftSaving(l);if((!O.oMetadata||!O.oMetadata.isLoaded())||O.oMetadata.isFailed()){O.attachMetadataFailed(function(){p.navigateToMessagePage({title:g("ST_GENERIC_ERROR_TITLE"),text:g("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),icon:"sap-icon://message-error",description:g("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var Q in l.componentRegistry){l.componentRegistry[Q].fnViewRegisteredResolve(true);}});}if(j&&j.getMetadata()&&j.getMetadata().getManifest()){e.setAppComponent(j);}e.setApplicationStatus(e.mApplicationStatus.LOADING);e.publishEvent("elements","ViewRenderingStarted",{});l.oBusyHelper.setBusyReason("initAppComponent",false);}function y(){if(l.oNavigationHost){return"";}if(l.sRoutingType==="f"){var i=new F();l.oNavigationHost=i;l.aNavigationObservers=[new P({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:i.attachBeginColumnNavigate.bind(i),attachProcessStop:i.attachAfterBeginColumnNavigate.bind(i)}}),new P({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:i.attachMidColumnNavigate.bind(i),attachProcessStop:i.attachAfterMidColumnNavigate.bind(i)}}),new P({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:i.attachEndColumnNavigate.bind(i),attachProcessStop:i.attachAfterEndColumnNavigate.bind(i)}})];l.oNavigationObserver=new P({processObservers:l.aNavigationObservers});l.aHeaderLoadingObservers=[f(),f(),f()];}else{var O=new N({id:j.getId()+"-appContent"});l.oNavigationHost=O;l.oNavigationObserver=new P({processName:"Navigation",eventHandlers:{attachProcessStart:O.attachNavigate.bind(O),attachProcessStop:O.attachAfterNavigate.bind(O)}});}l.oHeaderLoadingObserver=new P({processObservers:l.aHeaderLoadingObservers||[]});l.oPagesDataLoadedObserver=new P({processObservers:[l.oHeaderLoadingObserver,l.oNavigationObserver]});l.oNavigationHost.addStyleClass(l.oApplicationProxy.getContentDensityClass());l.oBusyHelper=new B(l);l.oBusyHelper.setBusyReason("initAppComponent",true,true);return l.oNavigationHost;}function z(){if(l.oNavigationHost){l.oNavigationHost.destroy();}if(n){n.destroy();}if(p){p.destroy();}if(l.oValidationMessageBinding){l.oValidationMessageBinding.destroy();}(U.prototype.exit||q.noop).apply(j,arguments);s();t.endApp(k);}function E(i){var O=Object.keys(i).map(function(Q){var S=i[Q];if(S.pages){S.pages=E(S.pages);}return i[Q];});return O;}function G(O){if(!O){return;}for(var i=0;i<O.length;i++){var Q=O[i];if(Q.routingSpec&&Q.routingSpec.noOData){Q.entitySet=Q.routingSpec.routeName;Q.navigationProperty=Q.routingSpec.routeName;}G(Q.pages);if(Q.embeddedComponents){for(var S in Q.embeddedComponents){var W=Q.embeddedComponents[S];G(W.pages);}}G(Q.implementingComponent&&Q.implementingComponent.pages);}}var H;function I(){if(!H){var i=j.getMetadata();H=i.getManifestEntry("sap.ui.generic.app");if(H._version==="1.3.0"&&H.pages&&q.isPlainObject(H.pages)){H.pages=E(H.pages);}G(H.pages);}return H;}var K;function L(){if(!K){K=q.extend({},j.getMetadata().getManifest());K["sap.ui.generic.app"]=I();}return K;}function M(){var i=j.getManifestObject();var S=i.getEntry("sap.ui.generic.app").settings;l.sRoutingType=(S&&S.flexibleColumnLayout)?"f":"m";return"sap."+l.sRoutingType+".routing.Router";}return{init:x,createContent:y,exit:z,_getRouterClassName:M,getConfig:I,getInternalManifest:L,getTransactionController:function(){return n.getTransactionController();},getApplicationController:function(){return n;},getNavigationController:function(){return p;}};}return U.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{config:{title:"SAP UI Application Component",fullWidth:true},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:true}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",viewPath:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template"},constructor:function(){var i=t.startApp();q.extend(this,h(this,i));(U.prototype.constructor||q.noop).apply(this,arguments);}});});
