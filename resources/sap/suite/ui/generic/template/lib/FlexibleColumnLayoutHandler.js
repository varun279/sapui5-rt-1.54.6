sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/LayoutType"],function(q,B,F,L){"use strict";function o(O){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],O);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(v){return c[v]?v:d;}function a(v){return t(v)===v;}function g(v){return c[t(v)]+"ColumnPages";}function b(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function e(v){return m[t(v)];}function f(v){return c[t(v)];}function h(R){return R.name.length>5&&R.name.lastIndexOf("query")===R.name.length-"query".length;}function j(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function k(T){var i=j(T);var R=i?i[0]:false;return R;}function l(n,N){var M=N.oTemplateContract.oAppComponent.getConfig();var p=M.settings&&M.settings.flexibleColumnLayout;var s=F.getInstanceFor(n,p);var D=s.getDefaultLayouts();var R;var u;var U;var C;var S;var v=-1;var T=N.oTemplateContract,w=N.oRouter;var x=p&&p.maxColumnCountInFCL||3;var y=p&&p.initialColumnsCount&&p.initialColumnsCount===2||false;var z=p&&p.displayNextObjectAfterDelete&&p.displayNextObjectAfterDelete===true;function A(i){if(i>=x||sap.ui.Device.system.phone){return 1;}else{var z1=p&&p.initialColumnsCount||1;var A1=Math.max(i+1,z1);if(sap.ui.Device.system.tablet&&A1>2){A1=2;}return A1;}}function E(i,z1,A1){i.showBeginColumn=i.viewLevel<3;i.showMidColumn=i.viewLevel===0&&y||i.viewLevel===1||i.viewLevel===2;i.showEndColumn=i.viewLevel>1;var B1=A(i.viewLevel);if(y&&i.viewLevel===0){if(B1===1){i.target=[i.name];i.showMidColumn=false;}else{i.target=[i.name,i.pages[0].entitySet];}}else if(y&&i.viewLevel===1){if(B1===1){i.target=[i.name];i.showBeginColumn=false;}else{i.target=A1;}}else{i.target=i.showMidColumn?A1.concat([z1]):z1;}return g(i.viewLevel);}function G(i){if(i==="OneColumn"&&y){return false;}return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function H(i,z1,A1){var B1=T.mRouteToTemplateComponentPromise[A1];if(B1){return B1.then(function(C1){return N.activateOneComponent(z1,i,C1);});}return r;}function I(i){var z1=i.substring(i.length-5,i.length);if(z1==="query"){return i.substring(0,i.length-5);}return i;}function J(i){return Promise.all(i).then(N.afterActivation);}function K(i,z1){var A1=G(i);if(u&&h(u)){u.arguments.query=u.arguments["?query"];if(A1){delete u.arguments.query.FCLLayout;if(q.isEmptyObject(u.arguments.query)){delete u.arguments.query;u.name=I(u.name);}}else{u.arguments.query.FCLLayout=i;}}else if(!A1){u.name=u.name+"query";u.arguments.query={FCLLayout:i};}var B1=w.getURL(u.name,u.arguments);B1=B1.replace("/?","?");N.navigate(B1,z1);}function O(i,z1){return new Promise(function(A1){o(function(B1){A1(B1.determinePath(i,z1,T.routeViewLevel1.pattern));});});}function P(){var i=function(z1,A1){var B1={};if(!u){A1();return;}var C1=u.event.getParameter("config").viewLevel;if(C1<3){B1.begin={route:"root",path:"",isVisible:U.columnsVisibility.beginColumn};if(C1===0){z1(B1);return;}}var D1=I(u.name);if(C1>0){var E1=f(C1);B1[E1]={route:D1,path:u.path,isVisible:C1>2||(C1===1&&U.columnsVisibility.midColumn)||(C1===2&&U.columnsVisibility.endColumn)};}if(C1===2){O(u.routeConfig,u.event).then(function(F1){B1.mid={route:T.routeViewLevel1.name,path:F1,isVisible:U.columnsVisibility.midColumn};z1(B1);});}else{z1(B1);}};return new Promise(i);}function Q(i){var z1=P();z1.then(function(A1){var B1=[];var C1=[A1.begin,A1.mid,A1.end];var D1=N.performPseudoHashChange(C1);for(var E1 in i){if(i[E1]){var F1=A1[E1];if(F1){B1.push(H(D1,F1.path,F1.route));}}}J(B1);},q.noop);}function V(){return!(U.columnsVisibility.beginColumn?U.columnsVisibility.midColumn:U.columnsVisibility.midColumn&&U.columnsVisibility.endColumn);}function W(i){var z1=s.getCurrentUIState();var A1={};A1.end=U&&(U.columnsVisibility.endColumn!==z1.columnsVisibility.endColumn);A1.mid=U&&(U.columnsVisibility.midColumn!==z1.columnsVisibility.midColumn);A1.begin=U&&(U.columnsVisibility.beginColumn!==z1.columnsVisibility.beginColumn);U=z1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:U.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:U.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.endColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",V());var B1;if(U.columnsVisibility.endColumn){B1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}else if(U.columnsVisibility.midColumn){B1=1;}else{B1=0;}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",B1);var C1;if(U.columnsVisibility.midColumn){C1=1;}else{C1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",C1);if(u&&C!==U.layout){K(U.layout,true);}else if((A1.begin||A1.mid||A1.end)&&!i){Q(A1);}}function X(i,z1,A1,B1){return new Promise(function(C1,D1){W(true);var E1=P();E1.then(function(F1){var G1=[];for(var H1 in F1){var I1=F1[H1];if(I1.isVisible){G1.push(H(B1,I1.path,I1.route));}}J(G1).then(C1,D1);});});}function Y(i){i=q.extend({},i);u={name:i.getParameter("name"),arguments:i.getParameter("arguments"),event:i};var z1=i.getParameter("config").viewLevel;var A1=i.getParameter("arguments")["?query"];if(a(z1)){C=(A1&&A1.FCLLayout);if(!C){switch(z1){case 0:var B1=s.getNextUIState(0).columnsVisibility;if(B1.midColumn){C=D.defaultTwoColumnLayoutType;}else{C=D.defaultLayoutType;if(A(z1)>1){K(D.defaultLayoutType,true);}}break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=L.EndColumnFullScreen;}n.setLayout(C);}function Z(i,z1,A1,B1){v=-1;var C1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");R=C1===2?i:null;u.path=A1;u.routeConfig=z1;return X(i,z1,A1,B1);}function $(i){return G(i)?{}:{FCLLayout:[i]};}function _(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function a1(i,z1){if(!a(i)){return N.getParStringPromise(z1,false);}var A1=S||s.getNextUIState(i).layout;q.extend(z1,$(A1));S=null;if(_(A1)){return N.getParStringPromise(z1,false);}var B1=(i===2)?N.addUrlParameterInfoForRoute(T.routeViewLevel1.name,z1):r;return new Promise(function(C1){B1.then(function(){N.getParStringPromise(z1,true).then(C1);});});}function b1(){S=U.actionButtonsInfo.midColumn.closeColumn;N.navigateToRoot(true);}function c1(){S=U.actionButtonsInfo.endColumn.closeColumn;var i=R.getParameter("config");O(i,R).then(function(z1){N.navigateToContext(z1,null,true,0);});}function d1(i,z1){var A1=N.oHashChanger.getHash()||"";A1=A1.split("?")[0];var B1=N.getParStringPromise(i,z1);N.navigateToParStringPromise(A1,B1,false);}function e1(i){if(i===0&&u1()){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function f1(){var z1=U.actionButtonsInfo.midColumn.fullScreen;var A1;if(z1===null){z1=U.actionButtonsInfo.endColumn.fullScreen;var B1=N.getActiveComponents();for(var i=0;i<B1.length;i++){var C1=T.componentRegistry[B1[i]];if(C1.viewLevel===2){A1=C1.route;break;}}}else{A1=T.routeViewLevel1.name;}var D1=$(z1);N.addUrlParameterInfoForRoute(A1,D1).then(function(){d1(D1,false);});}function g1(){var i=U.actionButtonsInfo.midColumn.exitFullScreen;var z1;var A1;if(i===null){i=U.actionButtonsInfo.endColumn.exitFullScreen;}var B1=$(i);if(i===U.actionButtonsInfo.endColumn.exitFullScreen){var C1=N.getActiveComponents();var D1=C1[0];var E1=T.componentRegistry[D1];if(E1){z1=N.addUrlParameterInfoForRoute(E1.route,B1);A1=O(u.routeConfig,u.event);}}(z1||r).then(function(){(A1||r).then(function(F1){var G1=N.addUrlParameterInfoForRoute(T.routeViewLevel1.name,B1,F1);G1.then(function(){d1(B1,true);});});});}function h1(i){return a(i)&&{onCloseColumnPressed:i===1?b1:c1,onFullscreenColumnPressed:f1,onExitFullscreenColumnPressed:g1};}function i1(i){return T.oApplicationProxy.getDraftSiblingPromise(i);}function j1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")===2){var z1=R.getParameter("config");var A1=T.mRouteToTemplateComponentPromise[I(z1.name)];var B1=new Promise(function(C1,D1){A1.then(function(E1){var F1=E1.getBindingContext();var G1=i1(F1,true);G1.then(function(H1){o(function(I1){var J1=z1.navigationProperty;var K1=i.getPath()+"/"+I1.determineNavigationPath(H1,J1).path;S=U.layout;N.navigateToContext(K1,null,true,2);C1();});},D1);},D1);});T.oBusyHelper.setBusy(B1);}else{N.navigateToContext(i,null,true,2);}}function k1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")!==2){return Promise.resolve(i);}var z1=new Promise(function(A1){var B1=R.getParameter("config");var C1=T.mRouteToTemplateComponentPromise[I(B1.name)];C1.then(function(D1){var E1=D1.getBindingContext();var F1=i1(E1,true);F1.then(function(G1){if(!G1){A1(i);return;}o(function(H1){var I1=B1.navigationProperty;var J1=i.getPath()+"/"+H1.determineNavigationPath(G1,I1).path;A1(J1);});});});});T.oBusyHelper.setBusy(z1);return z1;}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function l1(i){var z1=N.getTargetLevel(i);switch(z1){case 1:return!U.columnsVisibility.midColumn;case 2:return!U.columnsVisibility.endColumn;default:return true;}}function m1(i){C=s.getNextUIState(i).layout;n.setLayout(C);}function n1(){return!V();}function o1(z1){v=t(z1.viewLevel);m1(z1.viewLevel);var A1=N.oRouter.getTargets();var B1=e(z1.viewLevel);A1.display(B1);var C1;if(z1.viewLevel===v){C1=[];for(var i=0;i<z1.viewLevel;i++){C1.push(true);}}return C1;}function p1(i){if(i<v||v<0){return U.columnsVisibility[f(i)+"Column"];}return false;}function q1(i,z1){if(!a(z1)){return i;}var A1=s.getNextUIState(z1).layout;if(G(A1)){return i;}return i+"?FCLLayout="+A1;}function r1(){return x;}function s1(i,z1){if(!y){return;}var A1=false;var B1=s.getNextUIState(0).columnsVisibility;if(B1.midColumn){var C1=u.event.getParameter("config").viewLevel;if(C1===0){A1=true;if(h(u)){u.arguments.query=u.arguments["?query"];if(u.arguments.query.FCLLayout==="OneColumn"){A1=false;}}}}if(A1){if(i){z1(i);}else{N.navigateToRoot(true);}}else{return;}}function t1(){return z;}function u1(){return y;}function v1(i,z1,A1){var B1;B1=k(i);T.oApplicationProxy.setListReportTable(i);if(u1&&u1()){s1(B1,function(){setTimeout(function(){A1.oCommonEventHandlers.onListNavigate(B1,z1);},0);});}}function w1(){S=L.OneColumn;}function x1(i){if(i>2){S="";}else{S=e1(i);}}function y1(i){return{oActionButtonHandlers:h1(i),navigateToDraft:j1,getMaxColumnCountInFCL:r1,handleListReceived:s1,handleDataReceived:v1,isListAndFirstEntryLoadedOnStartup:u1};}n.attachStateChange(W.bind(null,false));return{adaptRoutingInfo:E,createMessagePageTargets:b,displayMessagePage:o1,isLevelActive:p1,handleBeforeRouteMatched:Y,handleRouteMatched:Z,getAppStateParStringForNavigation:a1,getActionButtonHandlers:h1,getTargetAfterCancelPromise:k1,isNewHistoryEntryRequired:l1,adaptBreadCrumbUrl:q1,isAppTitlePrefered:n1,getFullscreenLayout:e1,getMaxColumnCountInFCL:r1,isNextObjectLoadedAfterDelete:t1,getFclProxyForView:y1,setStoredTargetLayoutToOneColumn:w1,isListAndFirstEntryLoadedOnStartup:u1,setStoredTargetLayoutToFullscreen:x1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,n){q.extend(this,l(i,n));}});});
