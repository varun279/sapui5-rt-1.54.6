sap.ui.define(["sap/suite/ui/commons/library","jquery.sap.global","sap/ui/core/Control","./SvgBase","./Node","./Line","./Group","./layout/LayeredLayout","./Tooltip","sap/ui/core/Popup","sap/ui/model/json/JSONModel","sap/m/SuggestionItem","./Utils","sap/m/ButtonType","sap/m/Label","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/SearchField","sap/m/ToolbarSpacer","sap/ui/core/CustomData","sap/ui/model/Filter","sap/m/OverflowToolbarLayoutData","./KeyboardNavigator","sap/ui/core/theming/Parameters"],function(l,q,C,S,N,L,G,c,T,P,J,d,U,B,e,O,f,g,h,j,F,k,K,m){var n=l.networkgraph.Orientation;var A="nodes",o="lines",p="groups";var Z=[0.05,0.1,0.25,0.33,0.50,0.67,0.75,0.80,0.90,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5],D=9,r=0.4,s=100000;var t={Group:"group",Node:"node",Line:"line",IsLastKey:"islast",TypeKey:"type"};var u=Object.freeze({Node:"Node",Line:"Line",Group:"Group"});var R=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var v=0,M=100;var w=d.extend("sap.suite.ui.commons.networkgraph.LimitedSuggestionItem",{render:function(a,i,b,y){if(v++<M){d.prototype.render.call(this,a,i,b,y);}}});var x=S.extend("sap.suite.ui.commons.networkgraph.Graph",{metadata:{library:"sap.suite.ui.commons",properties:{height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},orientation:{type:"sap.suite.ui.commons.networkgraph.Orientation",group:"Behavior",defaultValue:n.LeftRight},enableWheelZoom:{type:"boolean",group:"Behavior",defaultValue:true},backgroundImage:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null}},aggregations:{lines:{type:"sap.suite.ui.commons.networkgraph.Line",multiple:true,singularName:"line"},nodes:{type:"sap.suite.ui.commons.networkgraph.Node",multiple:true,singularName:"node"},groups:{type:"sap.suite.ui.commons.networkgraph.Group",multiple:true,singularName:"group"},legend:{type:"sap.ui.core.Control",multiple:false},layoutAlgorithm:{type:"sap.suite.ui.commons.networkgraph.layout.LayoutAlgorithm",multiple:false},statuses:{type:"sap.suite.ui.commons.networkgraph.Status",multiple:true,singularName:"status"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{graphReady:{},afterLayouting:{},beforeLayouting:{},zoomChanged:{},failure:{parameters:{type:"String",message:"String"}},selectionChange:{parameters:{items:{type:"sap.suite.ui.commons.networkgraph.ElementBase[]"}}},searchSuggest:{parameters:{term:{type:"sap.ui.core.String"}}},search:{parameters:{term:{type:"sap.ui.core.String"},key:{type:"sap.ui.core.String"}}}}}});x.FAILURE_TYPE={INCONSISTENT_MODEL:"Inconsistent model",LAYOUT_FAILURE:"Layout failure"};x.prototype.ZOOM_100_INDEX=D;x.prototype.init=function(){this._fZoomRatio=1;this._fZoomRatioIndex=D;this._mSelectedNodes={};this._mSelectedLines={};this._bIsLayedOut=false;this._bIsFullScreen=false;this._mNodes={};this._bNeedNodeProcessing=true;this._oFullScreenContainer=null;this._bRequiresDataProcessing=true;this._oPanning={};this._oLegendLabels={};this._iRunningLayouts=0;this._oLastLayout=null;this._bIsRtl=sap.ui.getCore().getConfiguration().getRTL();this._oFocus=null;this._tooltip=this._createTooltip();this._bIsInvalid=false;this._oStatuses={};this._createToolbar();};x.prototype.onBeforeRendering=function(){this._bIsRtl=sap.ui.getCore().getConfiguration().getRTL();this.setBusy(false);this.setBusyIndicatorDelay(0);this._loadData();};x.prototype.onAfterRendering=function(){var H="",a=this._bIsRtl?"direction="+"\"rtl\"":"",b="<rect class=\"sapSuiteFlickerFreeRect\" x=\"0\" y=\"0\"></rect>";this.$scroller=this.$("scroller");this.$legend=this.$("legend");if(this.getNodes().length===0||this._bIsInvalid){if(this._bIsInvalid){this.$scroller.html("<span class=\"sapSuiteNetworkGraphErrorText\">"+R.getText("NETWORK_GRAPH_WRONGDATA")+"</span>");}this.fireGraphReady();return;}this.setBusy(true);if(this._isDelayedLayouting()){this.getNodes().forEach(function(i){i._setupWidthAndHeight();H+=i._render({sizeDetermination:i._useAutomaticSize()});});this.$scroller.html("<svg "+a+" class=\"sapSuiteUiCommonsNetworkGraphSvg\">"+H+b+"</svg>");setTimeout(function(){this.getNodes().forEach(function(i){i._applyMaxWidth();i._createMultilineTitle();i._createDescription();i._setupWidthAndHeight();});this._preprocessData();}.bind(this),0);}};x.prototype._beforeRender=function(){this.fireEvent("afterLayouting");};x.prototype._fireFailure=function(a,b){var i=b;if(typeof b==="object"&&b.text){i=b.text;}this.fireFailure([a.toString(),i]);q.sap.log.error("Graph failure: "+a+": "+i);};x.prototype.preventInvalidation=function(b){this._bPreventInvalidation=b;};x.prototype.setSearchSuggestionItems=function(i){var a=[];if(i){i.forEach(function(I){a.push({text:I.getText(),icon:I.getIcon(),key:I.getKey(),description:I.getDescription()});});}this._oSuggestionItemsModel.setData({items:a});};x.prototype.destroyAllElements=function(){this.destroyAggregation(A,false);this.destroyAggregation(p,false);this.destroyAggregation(o,false);};x.prototype.deselect=function(b){var i=[],$=this.$(),a=function(E){Object.keys(E).forEach(function(y){i.push(E[y]);E[y].setSelected(false);},this);}.bind(this);$.find("."+this.HIGHLIGHT_CLASS).removeClass(this.HIGHLIGHT_CLASS);$.find("."+this.SELECT_CLASS).removeClass(this.SELECT_CLASS);$.find("."+this.VISIBLE_ACTIONS_BUTTONS_CLASS).removeClass(this.VISIBLE_ACTIONS_BUTTONS_CLASS);a(this._mSelectedNodes);a(this._mSelectedLines);if(!b&&i.length){this.fireSelectionChange({items:i});}return i;};x.prototype.getFocus=function(){return this._oFocus;};x.prototype.getToolbar=function(){return this._toolbar;};x.prototype.getNodeByKey=function(a){if(this._bRequiresDataProcessing){this._processData();}return this._mNodes[a];};x.prototype.setCustomLegendLabel=function(a){var b;if(a.isGroup===true){b=u.Group;}else if(a.isLine===true){b=u.Line;}else{b=a.isNode===false?u.Line:u.Node;}if(a.status){this._oLegendLabels[b+a.status]=a.label;this._createLegend();}};x.prototype.getCorrectMousePosition=function(a){var b=this.$svg.offset(),i=1,y=1;if(this._iWidth!==this.$svg.width()||this._iHeight!==this.$svg.height()){i=this._iWidth/this.$svg.width();y=this._iHeight/this.$svg.height();}return{x:parseInt((a.x-b.left)*i,10),y:parseInt((a.y-b.top)*y,10)};};x.prototype._createTooltip=function(){var a=new T(this.getId()+"-tooltip");this.addDependent(a);a.create(this);a.attachEvent("afterClose",function(){this.setFocus(this.getFocus());}.bind(this));return a;};x.prototype.defocus=function(){this.$().find("."+this.FOCUS_CLASS).removeClass(this.FOCUS_CLASS);};x.prototype.setFocus=function(a){var i;if(!a&&!this._oFocus||a&&this._oFocus&&a.item===this._oFocus.item&&a.button===this._oFocus.button){return;}this.defocus();if(this.getFocusDomRef()){this.getFocusDomRef().focus();}if(a&&a.item instanceof L){a.button=null;}if(a){if(a.button){if(a.item instanceof N){i=a.item._aActionButtons.indexOf(a.button);if(i>-1){a.item._setActionButtonFocus(a.button,true);}}else if(a.item instanceof G){if(a.button===G.BUTTONS.MENU){a.item._setMenuButtonFocus(true);}else if(a.button===G.BUTTONS.COLLAPSE){a.item._setCollapseButtonFocus(true);}}}else if(a.item){a.item._setFocus(true);}}this._oFocus=a;this._ensureOnScreen(a?a.item:null);this._updateAccessibility(a);};x.prototype._updateAccessibility=function(a){var i,b=function(){this._setAccessibilityTitle(R.getText("NETWORK_GRAPH_ACCESSIBILITY_CONTENT"));}.bind(this),y=function(z){return R.getText("NETWORK_GRAPH_ACCESSIBILITY_ACTION_BUTTON")+" "+z;};if(a){if(a.button){if(a.item instanceof N){i=a.item._aActionButtons.indexOf(a.button);if(i>-1){this._setAccessibilityTitle(a.item._getActionButtonTitle(a.button));}else{b();}}else if(a.item instanceof G){if(a.button===G.BUTTONS.MENU){this._setAccessibilityTitle(y(R.getText("NETWORK_GRAPH_GROUP_DETAIL")));}else if(a.button===G.BUTTONS.COLLAPSE){this._setAccessibilityTitle(y(R.getText("NETWORK_GRAPH_EXPAND_COLLAPSE")));}else{b();}}else{b();}}else if(a.item){this._setAccessibilityTitle(a.item._getAccessibilityLabel());}}else{b();}};x.prototype._processProperties=function(){if(this._bNeedNodeProcessing){this._mSelectedNodes={};this._mSelectedLines={};this.getNodes().forEach(function(a){if(a.getSelected()){this._mSelectedNodes[a.getKey()]=a;}if(a.getCollapsed()){a.setCollapsed(true);}},this);this.getLines().forEach(function(a){if(a.getSelected()){this._mSelectedLines[a._getLineId()]=a;}},this);this._bNeedNodeProcessing=false;}};x.prototype._loadData=function(){if(this.getNodes().length>0){if(!this._processData()){return;}if(!this._isDelayedLayouting()){q.sap.delayedCall(0,this,this._preprocessData);}}};x.prototype._preprocessData=function(){this._bIsLayedOut=false;this._bImageLoaded=false;this.fireBeforeLayouting();this._applyLayout().then(this._render.bind(this));};x.prototype._getAllElements=function(){return this.getNodes().concat(this.getGroups());};x.prototype._render=function(){this._beforeRender();this._iRunningLayouts--;if(this._iRunningLayouts>0){return;}this._oLastLayout=null;this._createSearchSuggestItems();this._innerRender();this._createLegend();this._processProperties();if(this._fZoomRatio!==1){this.$svg[0].setAttribute("viewBox","0 0 "+this.$svg.width()+" "+this.$svg.height());this.$svg.width(this.$svg.width()*this._fZoomRatio);this.$svg.height(this.$svg.height()*this._fZoomRatio);}this._setLineClasses();if(this._selectElementAfterScroll){this._scrollToElement(this._selectElementAfterScroll);this._selectElementAfterScroll=null;}this._bIsLayedOut=true;this._setupEvents();this._setupKeyboardNavigation();this.setFocus(this.getFocus());if(!this.getBackgroundImage()||this._bImageLoaded){this.setBusy(false);this.fireGraphReady();}};x.prototype._innerRender=function(a){var b=function(W){var X="";W.forEach(function(Y){X+=Y._render();Y.bOutput=true;});return X;};var i=function(){this.$svg.find(".sapSuiteFlickerFreeRect").remove();this._bImageLoaded=true;if(this._bIsLayedOut){this.setBusy(false);this.fireGraphReady();}}.bind(this);var y=20,z=50,E=function(){var W=0,X=0;var Y=function(_,a1){if(_>W){W=_;}if(a1>X){X=a1;}};this._iWidth=0;this._iHeight=0;this._getAllElements().forEach(function(_){Y(_._iWidth+_.getX(),_._iHeight+_.getY());},this);this.getLines().forEach(function(_){_.getCoordinates().forEach(function(a1){Y(a1.getX(),a1.getY());});},this);if(this.getBackgroundImage()){var $=new Image();$.onload=function(){this._iWidth=Math.max(this._iWidth,$.width);this._iHeight=Math.max(this._iHeight,$.height);this.$svg.width(this._iWidth);this.$svg.height(this._iHeight);this.$svg.css("background-image","url("+this.getBackgroundImage()+")");this.$svg.css("background-size","cover");i();}.bind(this);$.onerror=function(){q.sap.log.warning("Unable to load background image.");i();};$.src=this.getBackgroundImage();}this._iWidth=Math.round(W+z);this._iHeight=Math.round(X+y);if(this.getWidth()==="auto"){this.$().width(this._iWidth);}if(this.getHeight()==="auto"){this.$("wrapper").height(this._iHeight);}this.$svg.width(this._iWidth);this.$svg.height(this._iHeight);}.bind(this);var H=function(W){W.forEach(function(X){X.forEach(function(Y){Y._afterRendering();});});};var I=this.getNodes(),Q=this.getLines(),V=this.getGroups();q.sap.measure.start(this.getId(),"Rendering of a network graph");this.$scroller.html(this._renderSvg(b(I),b(Q),b(V)));this.$svg=this.$("networkGraphSvg");E();H([I,Q,V]);q.sap.measure.end(this.getId());};x.prototype._renderSvg=function(a,b,i){var H="",y="sapSuiteUiCommonsNetworkGraphSvg sapSuiteUiCommonsNetworkGraphNoSelect "+(this._fZoomRatio<r?" sapSuiteUiCommonsNetworkGraphZoomedOut ":"");H+="<svg id=\""+this.getId()+"-networkGraphSvg\"";if(this._bIsRtl){H+="direction="+"\"rtl\"";}H+=" class=\""+y+"\" preserveAspectRatio=\"none\" ";H+=">";H+="<g id=\""+this.getId()+"-eventwrapper\"><rect style=\"fill: none\" class=\"sapSuiteUiCommonsNetworkGraphEventWrapper\" width=\"100%\" height=\"100%\"/></g>";H+="<g id=\""+this.getId()+"-svgbody\">";H+="<g class=\"sapSuiteUiCommonsNetworkGroupEventWrapper\"></g>";H+="<g id=\""+this._getDomId("groups")+"\">";H+=i?i:"";H+="</g>";H+="<g id=\""+this._getDomId("lines")+"\" class=\"sapSuiteUiCommonsNetworkLines\">";H+=b?b:"";H+="</g>";H+="<g id=\""+this._getDomId("nodes")+"\" class=\"sapSuiteUiCommonsNetworkNodes\">";H+=a?a:"";H+="</g>";H+="</g>";if(this.getBackgroundImage()){H+="<rect class=\"sapSuiteFlickerFreeRect\" x=\"0\" y=\"0\" height=\"100%\" width=\"100%\"></rect>";}H+="</svg>";return H;};x.prototype._isProperKey=function(a){return a||(a==="0");};x.prototype._processData=function(){var a=function(){var I=0;this.mGroups={};return this.getGroups().some(function(y){var z=y.getKey();if(!this._isProperKey(z)){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Group without a proper key [index: "+I+"] found.");return true;}y._resetSize();y._clearChildren();if(this.mGroups[z]){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Group with a duplicit key "+z+" found.");return true;}this.mGroups[z]=y;I++;return false;},this);}.bind(this);var b=function(){var I=0;this._mNodes={};return this.getNodes().some(function(y){if(!this._isProperKey(y.getKey())){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Node without a proper ID [index: "+I+"] found.");return true;}var z=y.getGroup(),E;y._oGroup=null;if(z){E=this.mGroups[z];if(E){y._oGroup=E;E.aNodes.push(y);}else{this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Node belonging to a nonexistent group with key "+z+" found.");return true;}}y._setupWidthAndHeight();y._clearChildren();y._rendered=false;if(this._mNodes[y.getKey()]){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Node with a duplicit key "+y.getKey()+" found.");return true;}this._mNodes[y.getKey()]=y;I++;return false;},this);}.bind(this);var i=function(){return this.getLines().some(function(y,I){var z=this.getNodeByKey(y.getFrom()),E=this.getNodeByKey(y.getTo());if(!z){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Line going from a nonexistent node with key "+y.getFrom()+" found.");return true;}if(!E){this._fireFailure(x.FAILURE_TYPE.INCONSISTENT_MODEL,"Line going to a nonexistent node with key "+y.getTo()+" found.");return true;}y._rendered=false;y._initialized=false;if(z&&E){z.aChildren.push(E);z.aLines.push(y);E.aParents.push(z);E.aParentLines.push(y);y._oFrom=z;y._oTo=E;y._sKey="line_"+z.getKey()+"-"+E.getKey()+"["+I+"]";}if(z._oGroup){z._oGroup.aLines.push(y);z._oGroup.aChildren.push(E);}if(E._oGroup){E._oGroup.aParentLines.push(y);E._oGroup.aParents.push(z);}return false;},this);}.bind(this);this._bRequiresDataProcessing=false;if(a()||b()||i()){this._bIsInvalid=true;return false;}this._oStatuses={};this.getStatuses().forEach(function(y){var z=y.getKey();if(z){this._oStatuses[z]=y;}},this);this._bIsInvalid=false;return true;};x.prototype._validateLayout=function(){var W,b,a,i;W=this.getNodes().some(function(y){if(y._isIgnored()){return false;}i="Missing coordinates: Node("+y.getKey()+")";return!((y._oGroup&&y._oGroup.getCollapsed())||(isFinite(y.getX())&&isFinite(y.getY())));});if(W){this._fireFailure(x.FAILURE_TYPE.LAYOUT_FAILURE,i);return false;}if(this._isLayered()){b=this.getGroups().some(function(y){if(y._isIgnored()){return false;}i="Missing coordinates: Group("+y.getKey()+")";return!y._isEmpty()&&(!isFinite(y.getX())||!isFinite(y.getY()));});if(b){this._fireFailure(x.FAILURE_TYPE.LAYOUT_FAILURE,i);return false;}}a=this.getLines().some(function(y){if(y._isIgnored()){return false;}i="Missing coordinates: Line("+y.getKey()+")";return!y._validateLayout();});if(a){this._fireFailure(x.FAILURE_TYPE.LAYOUT_FAILURE,i);return false;}return true;};x.prototype._suggest=function(a){var b=function(i){i.addCustomData(new j({key:t.IsLastKey,value:"true",writeToDom:true}));};var y=function(i){var Q=U.find(i.getCustomData(),function(V){return V.getKey()===t.IsLastKey;});if(Q){i.removeCustomData(Q);}};var z=function(i){var Q=U.find(i.getCustomData(),function(V){return V.getKey()===t.TypeKey;});return Q&&Q.getValue();};var E=function(){var Q=this._searchField.getSuggestionItems(),V,W,X;for(var i=0;i<Q.length;i++){V=Q[i];y(V);if(i<Q.length-1){W=z(V);X=z(Q[i+1]);if(W&&X){if((W===t.Node&&X===t.Line)||(W===t.Line&&X===t.Group)){b(V);}}}}}.bind(this);var H=[],I=this.fireEvent("searchSuggest",{term:a},true);v=0;if(I){if(a){H=[new F([new F("text",function(i){return(i.toLowerCase()||"").indexOf(a.toLowerCase())>-1;}),new F("description",function(i){return(i.toLowerCase()||"").indexOf(a.toLowerCase())>-1;})],false)];}this._searchField.getBinding("suggestionItems").filter(H);E();}this._searchField.suggest();};x.prototype._search=function(a,b){var i="_selectNode",E,I;E=this.fireEvent("search",{term:a,key:b},true);if(!E){return;}if(a){I=U.find(this.getNodes(),function(I){return b?I.getKey()===b:I.getTitle()===a;});if(!I){I=U.find(this.getLines(),function(y){if(y._isLoop()){return false;}return b?y._getLineId()===b:y._createSuggestionHelpText()===a;});i="_selectLine";}if(!I){I=U.find(this.getGroups(),function(y){return y.aNodes.length>0&&(b?y.getKey()===b:y.getTitle()===a);});i="_selectGroup";}if(I){if(i){this[i]({element:I,scroll:true,alwaysSelect:true});}}}else{this.deselect(false);this.setFocus(null);}};x.prototype._createToolbar=function(){var a=this;this._toolbar=new O(this.getId()+"-toolbar",{content:[new h()]}).addStyleClass("sapSuiteUiCommonsNetworkGraphToolbar");this.addDependent(this._toolbar);this._searchField=new g({layoutData:new k({priority:sap.m.OverflowToolbarPriority.NeverOverflow,shrinkable:true}),enableSuggestions:true,suggest:function(E){a._suggest(E.getParameter("suggestValue"));},search:function(E){var b=E.getParameter("query"),i=E.getParameter("suggestionItem"),y;if(i){y=i.getProperty("key");}a._search(b,y);}}).addStyleClass("sapSuiteUiCommonsNetworkGraphSearchField");this._toolbar.addContent(this._searchField);this._toolbar.addContent(new f({type:B.Transparent,icon:"sap-icon://legend",press:function(E){if(a.$legend.is(":visible")){a.$legend.hide();}else{a.$legend.show();}}}).setTooltip(R.getText("NETWORK_GRAPH_LEGEND")));this._toolbar.addContent(new f({layoutData:new k({group:1}),type:B.Transparent,icon:"sap-icon://zoom-in",press:function(E){a._zoom({deltaY:1});}}));this._zoomLabel=new e({layoutData:new k({group:1,priority:sap.m.OverflowToolbarPriority.Disappear}),text:"100%"});this._toolbar.addContent(this._zoomLabel);this._toolbar.addContent(new f({layoutData:new k({group:1}),type:B.Transparent,icon:"sap-icon://zoom-out",press:function(E){a._zoom({deltaY:-1});}}));this._toolbar.addContent(new f({type:B.Transparent,icon:"sap-icon://sys-monitor",press:this._fitToScreen.bind(this)}).setTooltip(R.getText("NETWORK_GRAPH_ZOOMTOFIT")));this._toolbar.addContent(new f({type:B.Transparent,icon:"sap-icon://full-screen",press:this._toggleFullScreen.bind(this)}));this._oPopup=new P({modal:true,shadow:false,autoClose:false});};x.prototype._fitToScreen=function(){var H=this.$scroller.height()/this._iHeight,W=this.$scroller.width()/this._iWidth,a=Math.min(H,W),z=Z.length-1;for(var i=1;i<Z.length;i++){if(a<Z[i]){z=i-1;break;}}this._zoom({newIndex:z});};x.prototype._getZoomText=function(){return Math.floor((this._fZoomRatio*100))+"%";};x.prototype._toggleFullScreen=function(){var a=function(){this._oFullScreenContainer={};this._oFullScreenContainer.$content=this.$();if(this._oFullScreenContainer.$content){this._oFullScreenContainer.$tempNode=q("<div></div>");this._oFullScreenContainer.$content.before(this._oFullScreenContainer.$tempNode);this._oFullScreenContainer.$overlay=q("<div id='"+q.sap.uid()+"'></div>");this._oFullScreenContainer.$overlay.addClass("sapSuiteUiCommonsNetworkGraphContainerOverlay");this._oFullScreenContainer.$overlay.append(this._oFullScreenContainer.$content);this._oPopup.setContent(this._oFullScreenContainer.$overlay);}this._oPopup.open(200,P.Dock.BeginTop,P.Dock.BeginTop,q("body"));}.bind(this),b=function(){this._oFullScreenContainer.$tempNode.replaceWith(this._oFullScreenContainer.$content);this._oPopup.close();this._oFullScreenContainer.$overlay.remove();}.bind(this);if(this._bIsFullScreen){b();}else{a();}this._bIsFullScreen=!this._bIsFullScreen;};x.prototype._setupKeyboardNavigation=function(){var I=[],y=[[]],z,E;if(!this._isLayedOut()){return;}this.getNodes().forEach(function(a){if(a.isHidden()||a._isIgnored()||!a.getVisible()){return;}I.push({item:a,x:a.getX(),y:a.getY()});});this.getLines().forEach(function(a){if(a.isHidden()||a._isIgnored()||!a.getVisible()){return;}var b=a.getCoordinates()[0],X=b.getX(),Y=b.getY();a.getCoordinates().forEach(function(b){if(X>b.getX()){X=b.getX();}if(Y>b.getY()){Y=b.getY();}});I.push({item:a,x:X,y:Y});});this.getGroups().forEach(function(a){if(a.isHidden()||a._isEmpty()||!a.getVisible()){return;}I.push({item:a,x:a.getX(),y:a.getY()});});I.sort(function(a,b){if(a.y<b.y){return-1;}else if(a.y>b.y){return 1;}else if(a.x<b.x){return-1;}else if(a.x>b.x){return 1;}else{return 0;}});if(I.length>0){E=[I[0]];y=[E];z=I[0];I.forEach(function(a,i){if(i===0){return;}if(a.y===z.y){E.push(a);}else{E=[a];y.push(E);}z=a;});}y=this._normalizeGrid(y,I);if(!this._oKeyboardNavigator){this._oKeyboardNavigator=new K(this);this.addDelegate(this._oKeyboardNavigator);}this._oKeyboardNavigator.setItems(y);this._oKeyboardNavigator.setWrapperDom(this.getFocusDomRef());};x.prototype._normalizeGrid=function(a,I){if(I.length===0){return a;}var b=I[0],y=b.x,z=b.x,E=1,H,Q,V=[],i;I.forEach(function(W){if(W.x<y){y=W.x;}if(W.x>z){z=W.x;}});a.forEach(function(W){if(W.length>E){E=W.length;}});H=Math.abs(z-y)/E;Q=y;for(i=0;i<E;i++){Q+=H;V.push(Q);}return a.map(function(W){var X,Y;if(W.length===E){X=W;}else{X=[];Y=0;while(Y<(E-W.length)&&V[Y]<W[0].x){Y++;X.push(null);}W.forEach(function($){X.push($);Y++;});while(Y<E){X.push(null);Y++;}}return X.map(function($){return $?$.item:null;});});};x.prototype.getFocusDomRef=function(){return this.getDomRef("wrapper");};x.prototype._setupEvents=function(){var a=5;var i=0,b={},$=this.$("eventwrapper"),y=this.$("ctrlalert"),z=this.$scroller;var E=function(Q,V){return Math.sqrt(Math.pow(Q.clientX-V.clientX,2)+Math.pow(Q.clientY-V.clientY,2));};var H=function(Q){if(Q.touches&&Q.touches.length===2){b={t1:Q.touches[0],t2:Q.touches[1],diff:E(Q.touches[0],Q.touches[1])};}};var I=function(Q){if(Q.touches&&Q.touches.length===2){if(++i===a){var V=Q.touches[0],W=Q.touches[1],X=E(V,W);this._zoom({point:{x:(V.clientX+W.clientX)/2,y:(V.clientY+W.clientY)/2},deltaY:X-b.diff});i=0;b={t1:V,t2:W,diff:X};}}}.bind(this);z.mousemove(function(Q){this._mouseMove(Q.clientX,Q.clientY);}.bind(this));$.mousedown(function(Q){this._mouseDown(Q.clientX,Q.clientY);Q.preventDefault();}.bind(this));z.mouseleave(this._endDragging.bind(this));z.mouseup(this._mouseUp.bind(this));z.bind("wheel",function(Q){if(this._wheel({x:Q.originalEvent.clientX,y:Q.originalEvent.clientY,deltaY:Q.originalEvent.deltaY,div:y,ctrl:Q.ctrlKey})){Q.preventDefault();}}.bind(this));z.bind("touchstart",function(Q){H(Q);});z.bind("touchmove",function(Q){I(Q);});};x.prototype._wheel=function(a){if(this.getEnableWheelZoom()||a.ctrl){a.div.css("opacity","0");this._zoom({point:{x:a.x,y:a.y},deltaY:-a.deltaY});this._zoomLabel.setText(this._getZoomText());return true;}else{a.div.css("transition-duration","0.3s");a.div.css("opacity","0.6");q.sap.delayedCall(1500,this,function(){a.div.css("transition-duration","0.8s");a.div.css("opacity","0");});}return false;};x.prototype._endDragging=function(){this._oPanning.dragging=false;this.$scroller.removeClass("sapSuiteUiCommonsNetworkGraphPanning");};x.prototype._mouseMove=function(X,y){var a=this.$scroller[0];if(this._oPanning.dragging){if(!this.$scroller.hasClass("sapSuiteUiCommonsNetworkGraphPanning")){this.$scroller.addClass("sapSuiteUiCommonsNetworkGraphPanning");}a.scrollTop=a.scrollTop-(y-this._oPanning.lastY);a.scrollLeft=a.scrollLeft-(X-this._oPanning.lastX);this._oPanning.lastX=X;this._oPanning.lastY=y;}};x.prototype._mouseDown=function(X,y){this.deselect(false);this.setFocus(null);this._oPanning.lastX=X;this._oPanning.lastY=y;this._oPanning.dragging=true;this._tooltip.instantClose();};x.prototype._mouseUp=function(){this._endDragging();};x.prototype._preventZoomToChangeLineWidth=function(){return this._isLayered()&&(this._fZoomRatio>=0.5&&this._fZoomRatio<2);};x.prototype._setLineClasses=function(){var $=this.$(),a=this._preventZoomToChangeLineWidth()?"addClass":"removeClass",b=(this._fZoomRatio<0.5)?"removeClass":"addClass";$[a]("sapSuiteUiCommonsNetworkGraphDefaultLineWidth");$[b]("sapSuiteUiCommonsNetworkGraphCrispEdges");};x.prototype._zoom=function(a){var b=this.$svg[0].getAttribute("viewBox"),i=a.deltaY<0?-1:1,y,z,E,H;if(!a.point){a.point={x:this.$scroller.width()/2,y:this.$scroller.height()/2};}y=this.getCorrectMousePosition({x:a.point.x,y:a.point.y});E=a.newIndex||a.newIndex===0?a.newIndex:this._fZoomRatioIndex+i;if((E<0)||(E>Z.length-1)){return;}this._fZoomRatioIndex=E;this._fZoomRatio=Z[this._fZoomRatioIndex];if(!b){H="0 0 "+Math.round(this.$svg.width())+" "+Math.round(this.$svg.height());this.$svg[0].setAttribute("viewBox",H);}this.$svg.width(Math.round(this._iWidth*this._fZoomRatio));this.$svg.height(Math.round(this._iHeight*this._fZoomRatio));z=this.getCorrectMousePosition({x:a.point.x,y:a.point.y});this.$scroller[0].scrollLeft+=(y.x-z.x)*this._fZoomRatio;this.$scroller[0].scrollTop+=(y.y-z.y)*this._fZoomRatio;this._zoomLabel.setText(this._getZoomText());if(this._fZoomRatio<r){this.$svg.addClass("sapSuiteUiCommonsNetworkGraphZoomedOut");}else{this.$svg.removeClass("sapSuiteUiCommonsNetworkGraphZoomedOut");}this._setLineClasses();this.fireEvent("zoomChanged");};x.prototype._createSearchSuggestItems=function(){var a=50;var b={items:[]},i=this.getNodes().sort(function(E,H){return E.getTitle().localeCompare(H.getTitle());}),y=this.getLines().sort(function(E,H){var I=E.getTitle(),Q=H.getTitle();if(I===Q){return E.getFromNode().getTitle().localeCompare(H.getFromNode().getTitle());}return I.localeCompare(Q);}),z=this.getGroups().sort(function(E,H){return E.getTitle().localeCompare(H.getTitle());});this._oSuggestionItemsModel=new J();this._oSuggestionItemsModel.setSizeLimit(s);i.forEach(function(E){var H=U.trimText(E.getTitle(),a);b.items.push({text:H?H:E.getKey(),type:t.Node,icon:E.getIcon(),key:E.getKey(),description:"("+R.getText("NETWORK_GRAPH_NODE")+")"});});y.forEach(function(E){if(E._isLoop()){return;}if(E.getTitle()||E.getFromNode().getTitle()||E.getToNode().getTitle()){b.items.push({text:E._createSuggestionHelpText(),type:t.Line,key:E._getLineId(),description:"("+R.getText("NETWORK_GRAPH_LINE")+")"});}});z.forEach(function(E){var H=U.trimText(E.getTitle(),a);if(E.aNodes.length>0){b.items.push({text:H?H:E.getKey(),key:E.getKey(),type:t.Group,description:"("+R.getText("NETWORK_GRAPH_GROUP")+")"});}});this._oSuggestionItemsModel.setData(b);this._searchField.setModel(this._oSuggestionItemsModel);this._searchField.bindAggregation("suggestionItems",{path:"/items",template:new w({text:"{text}",icon:"{icon}",key:"{key}",description:"{description}",customData:new j({key:"type",value:"{type}"})})});};x.prototype._scrollToElement=function(i){var I=i._oGroup&&i._oGroup.getCollapsed(),a=i instanceof L?i.getSource():i;if(I){a=i._oGroup;}this.$scroller.get(0).scrollLeft=((a.getX()+(a._iWidth?a._iWidth:0)/2)*this._fZoomRatio)-(this.$scroller.width()/2);this.$scroller.get(0).scrollTop=((a.getY()+(a._iHeight?a._iHeight:0)/2)*this._fZoomRatio)-(this.$scroller.height()/2);};x.prototype._ensureOnScreen=function(i){var a,b,y,z,E,H,I,Q;if(!i||!this.$scroller){return;}a=this.$scroller[0];if(i instanceof N){I=i.getX()+i._iWidth/2;Q=i.getY()+i._iHeight/2;}else if(i instanceof L){b=i._getArrowPosition();I=(b.arrowFrom.x+b.arrowTo.x)/2;Q=(b.arrowFrom.y+b.arrowTo.y)/2;}else if(i instanceof G){I=i.getX();Q=i.getY();}I*=this._fZoomRatio;Q*=this._fZoomRatio;y=a.scrollLeft;E=a.scrollTop;z=y+this.$scroller.width();H=E+this.$scroller.height();if(I<y||I>z){a.scrollLeft=I-this.$scroller.width()/2;}if(Q<E||Q>H){a.scrollTop=Q-this.$scroller.height()/2;}};x.prototype._createLegend=function(){var $=this.$("legend"),H="",a=this,b={},i={},y={};var z=function(V,W){var X=V.getStatus();if(X){if(W[X]){W[X].push(V);}else{W[X]=[V];}}};var E=function(V){return Object.keys(V).length>0;};var I=function(V,W){var X=this._oStatuses[V],Y=X&&X._getLegendColor(),_=X&&X.getTitle(),a1=Y?"background-color:"+m.get(Y):"";_=_||V;H+=this._renderControl("div",{status:V,elementtype:W,"class":"sapSuiteUiCommonsNetworkGraphLegendLine"},false);H+=this._renderControl("div",{"class":"sapSuiteUiCommonsNetworkGraphLegendColorLine "+this._getStatusClass(V),"style":a1});H+=this._renderControl("label",{"class":"sapSuiteUiCommonsNetworkGraphLegendLineLabel"},false);H+=this._oLegendLabels[W+V]?this._oLegendLabels[W+V]:_;H+="</label>";H+="</div>";}.bind(this);var Q=function(V,W,X,Y,_){V.forEach(function(a1){z(a1,W);});if(E(W)){H+="<div class=\""+X+"\"><label class=\"sapSuiteUiCommonsNetworkGraphLegendTitle\">"+q.sap.encodeHTML(R.getText(Y))+"</label></div>";Object.keys(W).forEach(function(a1){I(a1,_);});}};if(this.getLegend()){return;}if(!$[0]){return;}Q(this.getNodes(),b,"sapSuiteUiCommonsNetworkGraphLegendTitleNode","NETWORK_GRAPH_NODES",u.Node);Q(this.getLines(),i,"sapSuiteUiCommonsNetworkGraphLegendTitleLine","NETWORK_GRAPH_LINES",u.Line);Q(this.getGroups(),y,"sapSuiteUiCommonsNetworkGraphLegendTitleLine","NETWORK_GRAPH_GROUPS",u.Group);$.html(H);this.$().find(".sapSuiteUiCommonsNetworkGraphLegendLine").click(function(V){var W=q(this).attr("status"),X=q(this).attr("elementtype"),Y;if(X===u.Node){Y=b;}if(X===u.Line){Y=i;}if(!V.ctrlKey){a.deselect(false);a.setFocus(null);}if(X!==u.Group&&Y[W]){Y[W].forEach(function(_){_.setSelected(true);});}});};x.prototype._selectElement=function(a){var i=a.element&&!a.element.getSelected(),I=[];var b=function(V){a.element.setSelected(V);if(a.setFocus!==false){this.setFocus({item:a.element});}}.bind(this);this.$().find("."+this.VISIBLE_ACTIONS_BUTTONS_CLASS).removeClass(this.VISIBLE_ACTIONS_BUTTONS_CLASS);if(!a.preventDeselect){I=this.deselect(true);if(a.setFocus){this.setFocus(null);}if(i||a.alwaysSelect){b(true);}}else{b(i);}if(!a.element._hasFocus()&&a.forceFocus){this.setFocus({item:a.element});}if(!I.some(function(y){return y===a.element;})){I.push(a.element);}this.fireSelectionChange({items:I});};x.prototype._selectLine=function(a){var b=a.element.getFromNode(),i=a.element.getToNode(),y=(b._isInCollapsedGroup()&&(b._oGroup===i._oGroup))?i._oGroup:null;if(a.scroll){this._scrollToElement(y||a.element);}if(!y){this._selectElement(a);}};x.prototype._selectNode=function(a){var b=a.element._isInCollapsedGroup()?a.element._oGroup:null;if(a.scroll){this._scrollToElement(b||a.element);}if(!b){this._selectElement(a);if(a.renderActionButtons!==false){a.element.showActionButtons(true);}}};x.prototype._selectGroup=function(a){if(a.scroll){this._scrollToElement(a.element);}this.setFocus({item:a.element});};x.prototype._applyLayout=function(){var a;this._iRunningLayouts++;a=this._getLayoutAlgorithm().layout().catch(function(E){this._fireFailure(x.FAILURE_TYPE.LAYOUT_FAILURE,E);return Promise.reject();}.bind(this)).then(function(){return new Promise(function(b,i){if(a.isTerminated()){b();return;}if(this._validateLayout()){b();}else{i();}}.bind(this));}.bind(this));if(this._oLastLayout&&this._iRunningLayouts>1){this._oLastLayout.terminate();}this._oLastLayout=a;return a;};x.prototype._setAccessibilityTitle=function(i){var a,W=this.$("accessibility");if(i===null){a=R.getText("NETWORK_GRAPH_ACCESSIBILITY_CONTENT");}else if(typeof i==="string"){a=i;}else{a=i._getAccessibilityLabel();}if(W){W.html(q.sap.encodeHTML(a));}};x.prototype._getLayoutAlgorithm=function(){return this.getLayoutAlgorithm()||this._getDefalutLayout();};x.prototype._getDefalutLayout=function(){if(!this._oDefalutLayout){this._oDefaultLayout=new c();this._oDefaultLayout.setParent(this,null,true);}return this._oDefaultLayout;};x.prototype._isLayered=function(){return this._getLayoutAlgorithm().isLayered();};x.prototype._isDelayedLayouting=function(){return this.getNodes().some(function(a){return a._useAutomaticSize()||a.getTitleLineSize()!==1||a._displayDescription();});};x.prototype._isLayedOut=function(){return this._bIsLayedOut;};x.prototype.destroyAggregation=function(a,b){this._bRequiresDataProcessing=true;C.prototype.destroyAggregation.call(this,a,b);};x.prototype.insertAggregation=function(a,b,i,y){this._bRequiresDataProcessing=true;C.prototype.insertAggregation.call(this,a,b,i,y);};x.prototype.removeAggregation=function(a,b,i){this._bRequiresDataProcessing=true;C.prototype.removeAggregation.call(this,a,b,i);};x.prototype.addAggregation=function(a,b,i){this._bRequiresDataProcessing=true;C.prototype.addAggregation.call(this,a,b,i);};x.prototype.removeAllAggregation=function(a,b){this._bRequiresDataProcessing=true;C.prototype.removeAllAggregation.call(this,a,b);};x.prototype.updateAggregation=function(a){this._bNeedNodeProcessing=true;C.prototype.updateAggregation.call(this,a);};x.prototype.invalidate=function(){if(this._bPreventInvalidation!==true){C.prototype.invalidate.call(this);}};return x;});
