/*!
 * Copyright (c) 2009-2017 SAP SE, All Rights Reserved
 */
"use strict";sap.ui.define(['jquery.sap.global','sap/ui/core/support/Plugin','sap/ui/core/support/Support','sap/ui/core/HTML','sap/ui/layout/VerticalLayout','sap/m/Text'],function(q,P,S,H,V,T){var A=P.extend("sap.ushell_abap.support.plugins.app-infra.AppInfraOnSapNetWeaverSupportPlugin",{constructor:function(s){this.sModulePath=q.sap.getModulePath("sap.ushell_abap.support.plugins.app-infra");this.oI18n=q.sap.resources({url:this.sModulePath+"/i18n/AppInfraOnSapNetWeaverSupportPlugin.properties"});P.apply(this,["sapUiAppInfraOnSapNetWeaverSupportPlugin",this.oI18n.getText("BACKEND_INFRASTRUCTURE"),s]);}});A.prototype.isToolPlugin=function(){return true;};A.prototype.isAppPlugin=function(){return false;};var g=q.sap.encodeHTML('@08@');var y=q.sap.encodeHTML('@09@');var r=q.sap.encodeHTML('@0A@');A.prototype.getReportLine=function(l,o){var p=(o&&o.putAtBeginningOfEachLine)?o.putAtBeginningOfEachLine:"";l=(l=="")?'&nbsp;':q.sap.encodeHTML(l);l="<div>"+p+l.replace(g,"<img src='"+this.sModulePath+"/ABAP_ICON_GREEN_LIGHT.png'/>").replace(y,"<img src='"+this.sModulePath+"/ABAP_ICON_YELLOW_LIGHT.png'/>").replace(r,"<img src='"+this.sModulePath+"/ABAP_ICON_RED_LIGHT.png'/>")+"</div>";return l;};A.prototype.writeReportLine=function(R,l){R.write(this.getReportLine(l));};A.prototype.getReportLines=function(l,o){var t=this;return l.reduce(function(h,L){return h+t.getReportLine(L,o);},"");};A.prototype.writeFormatted=function(f){try{var t=this;var i=[],p;this.oInfo=new V("backEndInformation",{content:[new T({text:f.topic}),new T({text:"\n"}),new T({text:this.oI18n.getText("SYSTEM_ID")+" : "+f.sapNetWeaverAsAbap.systemId+" ( "+f.sapNetWeaverAsAbap.systemText+" )"}),new T({text:this.oI18n.getText("CLIENT")+" : "+f.sapNetWeaverAsAbap.client+" ( "+f.sapNetWeaverAsAbap.clientDescription+" )"}),new T({text:this.oI18n.getText("SAP_NETWEAVER_RELEASE")+" : "+f.sapNetWeaverAsAbap.release}),new T({text:"\n"}),new T({text:this.oI18n.getText("SAP_UI_SOFTWARE_COMPONENT")+" : "+f.sapUi.softwareComponent+" ( "+f.sapUi.softwareComponentDescription+" )"}),new T({text:this.oI18n.getText("VERSION")+" : "+f.sapUi.version}),new T({text:this.oI18n.getText("SUPPORT_PACKAGE_LEVEL")+" : "+f.sapUi.supportPackageLevel}),new T({text:"\n"})].map(function(o){return o.addStyleClass('checkInfo');})});i.push(this.oInfo);f.checks.forEach(function(c){function a(c){switch(c.outcome.status){case'S':return t.sModulePath+'/ABAP_ICON_GREEN_LIGHT.png';case'W':return t.sModulePath+'/ABAP_ICON_YELLOW_LIGHT.png';case'E':return t.sModulePath+'/ABAP_ICON_RED_LIGHT.png';default:console.error('SAPUI5 Apps: Check of Infrastructure on SAP NetWeaver Application Server for ABAP - Received invalid status: "'+c.outcome.status+'" for Check "'+c.title+'"');return t.sModulePath+'/ABAP_ICON_LIGHT_OUT.png';}}p=new sap.m.Panel({expandable:true,expanded:false,width:"auto",headerToolbar:new sap.m.Toolbar({content:[new sap.m.Image({src:a(c)}),new sap.m.Title({level:"H3",text:c.outcome.message})]})});function s(b){switch(b){case'S':return'checkSuccessful';case'W':return'checkEndedWithWarnings';case'E':return'checkEndedWithErrors';default:return'';}}p.addStyleClass(s(c.outcome.status));var h=new H().setContent('<div class="checkSummary">'+t.getReportLines(c.outcome.summary)+'</div>'+'<div>&nbsp;</div>&nbsp;<div class="sapMText">'+t.oI18n.getText("DETAILS_BELOW")+'</div><div>&nbsp;</div>'+'<div class="checkDetails">'+t.getReportLines(c.outcome.details,{putAtBeginningOfEachLine:"&emsp;&emsp;&emsp;"})+'</div>');p.addContent(h);i.push(p);});return new V({content:i,width:"100%"});}catch(e){return new T({text:this.oI18n.getText("ERROR_RESPONSE_FROM_BACKEND_NOT_PROPERLY_FORMATTED")});}};A.prototype.init=function(s){if(this.runsAsToolPlugin()){var t=this;var R=sap.ui.getCore().createRenderManager();R.write('<div id="'+this.getId()+'-Area" class="sapUiSizeCompact" />').flush(this.$().get(0));this.addStylesheet("sap/ushell_abap/support/plugins/app-infra/AppInfraOnSapNetWeaverSupportPlugin");R.destroy();var o=this.check().done(function(f){t.writeFormatted(f).placeAt(t.getId()+"-Area");}).fail(function(j,a,e){new T("noBackEndResult",{text:t.oI18n.getText("ERROR_UNABLE_TO_RETRIEVE_INFORMATION_FROM_BACKEND")}).placeAt(t.getId()+"-Area");});return o;}else{}};A.prototype.exit=function(){P.prototype.exit.apply(this,arguments);};A.prototype.destroy=function(){if(this.oInfo){this.oInfo.destroy()};P.prototype.destroy.apply(this,arguments);};A.prototype.check=function(){return q.getJSON("/sap/bc/ui2/check_app_infra",{});};return A;},true);
