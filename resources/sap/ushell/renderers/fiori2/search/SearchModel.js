(function(g){"use strict";sap.ui.define(['sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/SearchResultListFormatter','sap/ushell/renderers/fiori2/search/SearchFacetsFormatter','sap/ushell/renderers/fiori2/search/SearchTabStripsFormatter','sap/ushell/renderers/fiori2/search/FacetItem','sap/ushell/renderers/fiori2/search/suggestions/SuggestionHandler','sap/ushell/renderers/fiori2/search/SearchConfiguration','sap/ushell/renderers/fiori2/search/personalization/PersonalizationStorage','sap/ushell/renderers/fiori2/search/SearchNavigationObject','sap/ushell/renderers/fiori2/search/eventlogging/EventLogger','sap/ushell/renderers/fiori2/search/SearchUrlParser'],function(S,a,b,c,F,d,f,P,h,E,k){sap.ushell.renderers.fiori2.search.getModelSingleton=function(){if(!sap.ushell.renderers.fiori2.search.oModel){sap.ushell.renderers.fiori2.search.oModel=new sap.ushell.renderers.fiori2.search.SearchModel();}return sap.ushell.renderers.fiori2.search.oModel;};var m;var n=sap.ui.model.json.JSONModel.extend("sap.ushell.renderers.fiori2.search.SearchModel",{constructor:function(p){var t=this;p=p||{};sap.ui.model.json.JSONModel.prototype.constructor.apply(t,[]);t.config=f.getInstance();t.setSizeLimit(1000);t.suggestionHandler=new d({model:this});t.searchApplications=S.refuseOutdatedRequests(t.searchApplications,'search');t.pageSize=10;t.appTopDefault=20;t.boTopDefault=t.pageSize;t.setProperty('/isQueryInvalidated',true);t.setProperty('/isBusy',false);t.setProperty('/tableColumns',[]);t.setProperty('/tableSortableColumns',[]);t.setProperty('/tableResults',[]);t.setProperty('/results',[]);t.setProperty('/appResults',[]);t.setProperty('/boResults',[]);t.setProperty('/origBoResults',[]);t.setProperty('/count',0);t.setProperty('/boCount',0);t.setProperty('/appCount',0);t.setProperty('/facets',[]);t.setProperty('/dataSources',[t.allDataSource,t.appDataSource]);t.setProperty('/currentPersoServiceProvider',null);t.setProperty('/businessObjSearchEnabled',true);t.setProperty('/initializingObjSearch',false);t.setProperty('/suggestions',[]);t.setProperty('/resultToDisplay',S.loadResultViewType());t.setProperty('/displaySwitchVisibility',false);t.setProperty('/documentTitle','Search');t.setProperty('/top',t.boTopDefault);t.setProperty('/orderBy',{});t.setProperty('/facetVisibility',false);t.setProperty('/focusIndex',0);t.setProperty('/fuzzy',false);t.setProperty('/errors',[]);t.setProperty('/isErrorPopovered',false);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");this.setProperty("/firstSearchWasExecuted",false);t.setProperty('/multiSelectionAvailable',false);t.setProperty('/multiSelectionEnabled',false);t.setProperty('/multiSelection/actions',[]);if(p.searchModel&&p.searchModel._initBusinessObjSearchProm){t._initBusinessObjSearchProm=p.searchModel._initBusinessObjSearchProm;t.oFacetFormatter=new sap.ushell.renderers.fiori2.search.SearchFacetsFormatter(t);}t.initBusinessObjSearch();t.searchUrlParser=new k({model:this});},createSina:function(){var s=new jQuery.Deferred();sap.ui.require(['sap/ushell/renderers/fiori2/search/sinaNext/sina/sinaFactory'],function(e){if(!this.config.searchBusinessObjects){e.createAsync('dummy').then(function(i){s.resolve(i);},function(i){s.reject(i);});return;}var t=[];if(window.location.href.indexOf("demo/FioriLaunchpad.html")!==-1){t=['sample'];}else{t=['abap_odata','inav2','dummy'];}e.createByTrialAsync(t).then(function(i){s.resolve(i);},function(i){s.reject(i);});}.bind(this));return s;},initBusinessObjSearch:function(){var t=this;if(t._initBusinessObjSearchProm){return t._initBusinessObjSearchProm;}t.setProperty("/initializingObjSearch",true);t.setProperty("/isBusy",true);var e={label:sap.ushell.resources.i18n.getText("genericLoading"),labelPlural:sap.ushell.resources.i18n.getText("genericLoading"),enabled:false,id:'$$Loading$$'};t.setProperty("/dataSource",e);t.setProperty("/dataSources",[e]);t._initBusinessObjSearchProm=this.createSina().then(function(s){t.sinaNext=s;t.createAllAndAppDataSource();t.setProperty('/defaultDataSource',t.allDataSource);if(s.provider.id==='dummy'){t.setProperty('/defaultDataSource',t.appDataSource);t.setProperty('/businessObjSearchEnabled',false);t.config.searchBusinessObjects=false;t.setProperty('/facetVisibility',false);}if(s.provider.id==='inav2'&&t.config.isLaunchpad()){sap.ushell.Container.addRemoteSystem(new sap.ushell.System({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH"}));}t.setProperty('/uiFilter',t.sinaNext.createFilter());t.loadDataSources();t.resetDataSource(false);t.resetFilterConditions(false);t.query=t.sinaNext.createSearchQuery();if(t.config.multiSelect){t.query.setMultiSelectFacets(true);}t.oFacetFormatter=new sap.ushell.renderers.fiori2.search.SearchFacetsFormatter(t);t.tabStripFormatter=new c.Formatter(t.allDataSource);t.dataSourceTree=t.tabStripFormatter.tree;t.eventLogger=E.newInstance({sinaNext:t.sinaNext});t.eventLogger.logEvent({type:t.eventLogger.SESSION_START});t.setProperty("/initializingObjSearch",false);t.setProperty("/isBusy",false);},function(i){var j=sap.ushell.resources.i18n.getText('searchError');var l=sap.ushell.resources.i18n.getText('searchInitialError');if(i.message){l=l+" "+i.message;}sap.m.MessageBox.error(l,{icon:sap.m.MessageBox.Icon.NONE,title:j,actions:sap.m.MessageBox.Action.OK,onClose:null,styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit});});return t._initBusinessObjSearchProm;},initPersonalization:function(){var t=this;if(this.initPersonalizationPromise){return this.initPersonalizationPromise;}this.initPersonalizationPromise=P.getInstance().then(function(p){var i=false;try{i=p.getItem('search-facet-panel-button-state');}catch(e){}t.setFacetVisibility(i,false);},function(){return jQuery.Deferred().resolve(true);});return this.initPersonalizationPromise;},isBusinessObjSearchConfigured:function(){try{var i=window['sap-ushell-config'].renderers.fiori2.componentData.config;return i.searchBusinessObjects!=='hidden';}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty('/businessObjSearchEnabled');},setProperty:function(e,v,C,A){var t=this;var r=sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(e){case'/boResults':case'/appResults':t.calculateResultList();break;case'/appCount':case'/boCount':r=t.setProperty('/count',t.getProperty('/appCount')+t.getProperty('/boCount'));break;default:break;}return r;},setFuzzy:function(e){this.query.setFuzzy(e);this.setProperty("/fuzzy",e);},getPersonalizationStorageInstance:function(){return P.getInstanceSync();},getSearchBoxTerm:function(){return this.getProperty('/uiFilter/searchTerm');},setSearchBoxTerm:function(s,e){var t=this;var i=s.replace(/^\s+/,"");this.setProperty('/uiFilter/searchTerm',i);this.calculateSearchButtonStatus();if(i.length===0){return;}if(e||e===undefined){t._firePerspectiveQuery();}},getLastSearchTerm:function(){return this.query.getSearchTerm();},setFacetVisibility:function(v,i){if(sap.ui.Device.system.phone){v=false;}this.setProperty('/facetVisibility',v);try{this.getPersonalizationStorageInstance().setItem('search-facet-panel-button-state',v);}catch(e){}if((i||i===undefined)){this._firePerspectiveQuery({preserveFormerResults:true});}},getFacetVisibility:function(){return this.getProperty('/facetVisibility');},getTop:function(){return this.getProperty('/top');},setTop:function(t,e){this.setProperty('/top',t);if(e||e===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetTop:function(){this.setProperty('/focusIndex',0);if(this.isAppCategory()){this.setTop(this.appTopDefault,false);}else{this.setTop(this.boTopDefault,false);}},getOrderBy:function(){return this.getProperty('/orderBy');},setOrderBy:function(o,e){this.setProperty('/orderBy',o);if(e||e===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},resetOrderBy:function(e){this.setProperty('/orderBy',{});if(e||e===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}},isEqualOrderBy:function(e,q){if(!e.orderBy){return q.length===0;}if(q.length!==1){return false;}var i=q[0];if(i.id!==e.orderBy){return false;}if(e.sortOrder==='ASC'){return i.order===this.sinaNext.SortOrder.Ascending;}else{return i.order===this.sinaNext.SortOrder.Descending;}},getDocumentTitle:function(){var s=this.getSearchBoxTerm();var e=this.getDataSource().label;var t;if(this.getDataSource()===this.allDataSource){t=sap.ushell.resources.i18n.getText('searchTileTitleProposalAll',[s]);}else{t=sap.ushell.resources.i18n.getText('searchTileTitleProposal',[s,e]);}return t;},resetQuery:function(){S.hasher.reset();this.resetTop();this.setSearchBoxTerm('');this.resetDataSource(false);this.resetFilterConditions(false);this.query.resetConditions();this.query.setSearchTerm('random-jgfhfdskjghrtekjhg');this.setProperty('/facets',[]);this.setProperty('/results',[]);this.setProperty('/appResults',[]);this.setProperty('/boResults',[]);this.setProperty('/origBoResults',[]);this.setProperty('/count',0);this.setProperty('/boCount',0);this.setProperty('/appCount',0);},createAllAndAppDataSource:function(){this.allDataSource=this.sinaNext.getAllDataSource();this.allDataSource.label=sap.ushell.resources.i18n.getText("label_all");this.allDataSource.labelPlural=sap.ushell.resources.i18n.getText("label_all");this.appDataSource=this.sinaNext._createDataSource({id:'$$APPS$$',label:sap.ushell.resources.i18n.getText("label_apps"),labelPlural:sap.ushell.resources.i18n.getText("label_apps"),type:this.sinaNext.DataSourceType.Category});},loadDataSources:function(){var e=this.sinaNext.getBusinessObjectDataSources();e=e.slice();if(!this.config.odataProvider&&this.config.isLaunchpad()){e.splice(0,0,this.appDataSource);e.splice(0,0,this.allDataSource);}else{if(e.length==1){this.setDataSource(e[0],false);}else{e.splice(0,0,this.allDataSource);}}this.setProperty("/dataSources",e);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());},resetDataSource:function(e){this.setDataSource(this.getDefaultDataSource(),e);},isAllCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e===this.allDataSource;},isOtherCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e.type===this.sinaNext.DataSourceType.Category&&!this.isAllCategory();},isAppCategory:function(){var e=this.getProperty("/uiFilter/dataSource");return e===this.appDataSource;},getDataSource:function(){return this.getProperty("/uiFilter/dataSource");},getDefaultDataSource:function(){return this.getProperty("/defaultDataSource");},setDataSource:function(i,j,r){if(this.sinaNext.provider.id!==i.sina.provider.id){this.sinaNext=i.sina;var s=this.getProperty("/uiFilter/searchTerm");this.setProperty("/uiFilter",this.sinaNext.createFilter({dataSource:i,searchTerm:s}));this.query=this.sinaNext.createSearchQuery({dataSource:i,searchTerm:s,top:this.getTop()});this.oFacetFormatter=new sap.ushell.renderers.fiori2.search.SearchFacetsFormatter(this);}if(r||r===undefined){this.resetTop();}this.updateDataSourceList(i);this.getProperty("/uiFilter").setDataSource(i);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.calculateSearchButtonStatus();var l=this.getProperty('/uiFilter/dataSource/multiId');this.setProperty('/uiFilter/dataSource/multiId','');this.setProperty('/uiFilter/dataSource/multiId',l);if(j||j===undefined){this._firePerspectiveQuery();}try{this.eventLogger.logEvent({type:this.eventLogger.DATASOURCE_CHANGE,dataSourceId:i.id});}catch(e){}},getServerDataSources:function(){var t=this;if(t.getDataSourcesDeffered){return t.getDataSourcesDeffered;}t.getDataSourcesDeffered=t.sina.getDataSources().then(function(e){return jQuery.grep(e,function(i){return i.getType()!=='Category';});});return t.getDataSourcesDeffered;},notifyFilterChanged:function(){jQuery.each(this.aBindings,function(i,e){if(e.sPath==='/uiFilter/rootCondition'){e.checkUpdate(true);}});},addFilterCondition:function(e,i){if(e.attribute||e.conditions){this.getProperty("/uiFilter").autoInsertCondition(e);}else{this.setDataSource(e,false);}if(i||i===undefined){this._firePerspectiveQuery({preserveFormerResults:false});}this.notifyFilterChanged();},removeFilterCondition:function(e,i){if(e.attribute||e.conditions){this.getProperty("/uiFilter").autoRemoveCondition(e);}else{this.setDataSource(e,false);}if(i||i===undefined){this._firePerspectiveQuery({preserveFormerResults:true});}this.notifyFilterChanged();},resetFilterConditions:function(e){this.getProperty("/uiFilter").resetConditions();if(e||e===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},doSuggestion:function(){this.suggestionHandler.doSuggestion(this.getProperty('/uiFilter').clone());},abortSuggestions:function(){this.suggestionHandler.abortSuggestions();},_firePerspectiveQuery:function(e,p){var t=this;this.initBusinessObjSearch().then(function(){var i=function(){return t._doFirePerspectiveQuery(e,p);};t.initPersonalization().then(i);});},_doFirePerspectiveQuery:function(e,p){var t=this;var i,j;if(jQuery.isPlainObject(e)){i=e.deserialization;j=e.preserveFormerResults;}else{i=e?e:undefined;j=p?p:undefined;}var u=this.getProperty('/uiFilter');if(u.equals(this.query.filter)&&this.getTop()===this.query.top&&this.isEqualOrderBy(this.getOrderBy(),this.query.sortOrder)&&this.getCalculateFacetsFlag()===this.query.calculateFacets&&!this.getProperty('/isQueryInvalidated')){return(new jQuery.Deferred()).resolve();}if(S.getUrlParameter('nlq')==='true'){this.query.setNlq(true);}if((this.query.filter.dataSource&&u.dataSource!==this.query.filter.dataSource)||(this.query.filter.searchTerm&&u.searchTerm!==this.query.filter.searchTerm)){this.resetOrderBy(false);}if(!i&&!j){if(!u.equals(this.query.filter)){this.resetTop();}}if(u.searchTerm!==this.query.filter.searchTerm||!u.rootCondition.equals(this.query.filter.rootCondition)){this.tabStripFormatter.invalidate(this.getDataSource());}if(this.getProperty('/isQueryInvalidated')===true){this.query.resetResultSet();this.setProperty('/isQueryInvalidated',false);}this.query.setFilter(this.getProperty('/uiFilter').clone());this.query.setTop(this.getTop());this.query.setSortOrder(this.assembleSortOrder());this.query.setCalculateFacets(this.getCalculateFacetsFlag());this.cleanErrors();this.setProperty("/queryFilter",this.query.filter);sap.ui.getCore().getEventBus().publish("allSearchStarted");this.setProperty('/isBusy',true);this.abortSuggestions();this.calculateVisibility();if(!i){this.updateSearchURLSilently();}this.eventLogger.logEvent({type:this.eventLogger.SEARCH_REQUEST,searchTerm:this.getProperty('/uiFilter/searchTerm'),dataSourceKey:this.getProperty('/uiFilter/dataSource').id});return jQuery.when.apply(null,[this.normalSearch(j),this.appSearch()]).then(function(){t.setProperty('/tabStrips',t.tabStripFormatter.format(t.getDataSource(),t.perspective,t));return t.oFacetFormatter.getFacets(t.getDataSource(),t.perspective,t).then(function(l){if(l&&l.length>0){l[0].change=jQuery.sap.now();t.setProperty('/facets',l);}});}).always(function(){document.title=t.getDocumentTitle();sap.ui.getCore().getEventBus().publish("allSearchFinished");t.setProperty('/isBusy',false);t.setProperty("/firstSearchWasExecuted",true);});},assembleSortOrder:function(){var o=this.getOrderBy();if(!o.orderBy){return[];}var e=this.sinaNext.SortOrder.Ascending;if(o.sortOrder==='DESC'){e=this.sinaNext.SortOrder.Descending;}return[{id:o.orderBy,order:e}];},getCalculateFacetsFlag:function(){if(this.getDataSource().type===this.sinaNext.DataSourceType.Category||this.getFacetVisibility()){return true;}else{return false;}},appSearch:function(){var t=this;this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(!this.isAllCategory()&&!this.isAppCategory()){return jQuery.when(true);}var e=this.query.filter.dataSource===this.allDataSource?this.appTopDefault:this.query.top;return this.searchApplications(this.query.filter.searchTerm,e,0).then(function(r){t.setProperty("/appCount",r.totalResults);t.setProperty("/appResults",r.getElements());},function(i){t.pushError({type:"error",title:i.name,description:i,keep:i.keep});return jQuery.when(true);});},searchApplications:function(s,t,e){return sap.ushell.Container.getService("Search").queryApplications({searchTerm:s,searchInKeywords:true,top:t,skip:e});},normalSearch:function(p){var t=this;if(!p){t.resetAndDisableMultiSelection();}if(!t.isBusinessObjSearchEnabled()||t.isAppCategory()){this.setProperty("/boResults",[]);this.setProperty("/origBoResults",[]);this.setProperty("/boCount",0);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");return jQuery.when(true);}var q=new jQuery.Deferred();var s=function(i){t.perspective=i;if(i.nlqSuccess){t.setProperty("/nlqSuccess",true);t.setProperty("/nlqDescription",i.title);}t._afterSearchPrepareResultList(t.perspective,p).then(function(){q.resolve();});};var e=function(i){t.normalSearchErrorHandling(i);t.perspective=null;q.resolve();};t.setFuzzy(false);t.setDataSource(t.getDataSource(),false,false);t.query.setCalculateFacets(t.getCalculateFacetsFlag());t.query.getResultSetAsync().then(function(i){if(i.totalCount<1&&t.sinaNext.capabilities.fuzzy&&t.query.filter.searchTerm!=='*'){t.setProperty("/boResults",[]);t.setProperty('/origBoResults',[]);t.setProperty("/boCount",0);t.setFuzzy(true);return t.query.getResultSetAsync().then(s,e);}else{return s(i);}},e);return q;},_prepareTableResults:function(r){var t=this;var e=r;var i,j,o;for(i=0;i<e.length;i++){var p=e[i].itemattributes;if(p.length>0){o=1;for(j=0;j<e[i].itemattributes.length;j++){e[i].itemattributes[j].indexInTable=o;o++;}if(!p[0].isTitle){e[i].itemattributes.unshift({name:e[i].dataSourceName,value:e[i].title,key:"DATASOURCE_AS_COLUMN_KEY",isTitle:true,isSortable:false,uri:e[i].uri,titleNavigation:e[i].titleNavigation,onlyUsedInTable:true,indexInTable:0});}if(e[i].navigationObjects!==undefined&&e[i].navigationObjects.length>0&&!p[p.length-1].hasIntents){e[i].itemattributes.splice(o,0,{name:sap.ushell.resources.i18n.getText("intents"),navigationObjects:e[i].navigationObjects,key:"RELATED_OBJECTS",isNavigationObjects:true,isSortable:false,onlyUsedInTable:true,indexInTable:o});}}}t.setProperty("/tableResults",e);var q=[];var s=[];var u=e[0];var v="";if(u){var w=u.itemattributes;for(i=0;i<w.length;i++){if(w[i].indexInTable!==undefined&&w[i].key!==undefined){v=w[i].key;q.push({"name":w[i].name,"key":"columnKey"+i,"originalKey":v,"index":w[i].indexInTable,"persoOrder":i});}}t.setProperty("/tableColumns",q);var x=this.sinaNext.dataSourceMap[this.getDataSource().id].attributesMetadata;for(var l=0;l<x.length;l++){var y=x[l];if(y.isSortable){s.push({"name":y.label,"key":"normalColumn"+l,"originalKey":y.id,"selected":t.getProperty("/orderBy").orderBy===y.id});}}s.unshift({"name":sap.ushell.resources.i18n.getText("defaultRank"),"key":"ushellSearchDefaultSortItem","originalKey":"ushellSearchDefaultSortItem","selected":jQuery.isEmptyObject(t.getProperty("/orderBy"))});t.setProperty("/tableSortableColumns",s);}},_afterSearchPrepareResultList:function(s,p){var t=this;t.setProperty("/boCount",s.totalCount);var i;var e=[];if(false&&p){var _=t.getProperty("/boResults");for(i=0;i<_.length;i++){if(_[i].expanded||_[i].selected){e.push(_[i]);}}}t.setProperty("/boResults",[]);t.setProperty("/origBoResults",s.items);t.setProperty("/boCount",0);var l=new a();var o=l.format(s,t.query.filter.searchTerm);var q;var r=[];var u=[];for(i=0;i<o.length;i++){q=o[i];q.positionInList=i;if(!q.navigationTargets){q.navigationTargets=[];}if(q.suvlink&&q.suvlink.value){var v=new h({text:q.suvlink.label,href:q.suvlink.value,target:"_blank"});q.navigationTargets.push(v);}r.push(q.dataSource);u.push({isDocumentConnector:q.isDocumentConnector});}var w=t.config.loadCustomModulesForDataSourcesAsync(r,u);if(false&&e&&e.length>0){var R=t.sina.ResultElementKeyStatus;var x=[];for(i=0;i<o.length;i++){q=o[i];if(q.keystatus===R.OK){for(var j=0;j<e.length;j++){var y=e[j];if(y.keystatus===R.OK&&y.key===q.key){q.selected=y.selected;q.expanded=y.expanded;e.splice(j,1);break;}}}else{x.push(q);}}if(x.length>0){var z=[];var A="";for(i=0;i<x.length;i++){var B=x[i].dataSource.key;if(jQuery.inArray(B,z)<0){z.push(B);A+=B+"\n";}}t.pushError({type:"warning",title:sap.ushell.resources.i18n.getText("preserveFormerResultErrorTitle"),description:sap.ushell.resources.i18n.getText("preserveFormerResultErrorDetails",A)});}}var C=$.Deferred();Promise.all([Promise.resolve(s),w]).then(function(D){var s=D[0];if(!t.isAllCategory()&&!t.isOtherCategory()&&!t.isAppCategory()){t._prepareTableResults(o);}t.setProperty("/boCount",s.totalCount);t.setProperty("/boResults",o);t.enableOrDisableMultiSelection();C.resolve();});return C.promise();},resetAndDisableMultiSelection:function(){this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);},enableOrDisableMultiSelection:function(){var e=this.getDataSource();var i=this.config.getDataSourceConfig(e);var s=new i.searchResultListSelectionHandlerControl();if(s){this.setProperty("/multiSelectionAvailable",s.isMultiSelectionAvailable());}else{this.setProperty("/multiSelectionAvailable",false);}},_endWith:function(s,e){return s.indexOf(e,s.length-e.length)!==-1;},calculatePlaceholder:function(){var t=this;if(t.isAllCategory()){return sap.ushell.resources.i18n.getText("search");}else{return sap.ushell.resources.i18n.getText("searchInPlaceholder",t.getDataSource().labelPlural);}},updateDataSourceList:function(e){var j=this.getProperty('/dataSources');while(j.length>0&&j[0]!==this.allDataSource){j.shift();}if(e===this.allDataSource||e===this.appDataSource){return;}if(e&&e.id){if(e.id.indexOf('~')>=0){return;}}for(var i=0;i<j.length;++i){var l=j[i];if(l===e){return;}}j.unshift(e);this.setProperty('/dataSources',j);},invalidateQuery:function(){this.setProperty('/isQueryInvalidated',true);},autoStartApp:function(){var t=this;if(t.getProperty("/appCount")&&t.getProperty("/appCount")===1&&t.getProperty("/count")&&t.getProperty("/count")===1){var A=t.getProperty("/appResults");if(A&&A.length>0&&A[0]&&A[0].url&&t.getProperty('/uiFilter/searchTerm')&&A[0].tooltip&&t.getProperty('/uiFilter/searchTerm').toLowerCase().trim()===A[0].tooltip.toLowerCase().trim()){if(A[0].url[0]==='#'){window.location.href=A[0].url;}else{window.open(A[0].url,'_blank');}}}},getResultToDisplay:function(){return this.getProperty('/resultToDisplay');},setResultToDisplay:function(t){this.setProperty('/resultToDisplay',t);S.saveResultViewType(t);},calculateVisibility:function(){var t=this;if(t.isAppCategory()){t.setResultToDisplay("appSearchResult");t.setProperty('/displaySwitchVisibility',false);}else if(t.isAllCategory()||t.isOtherCategory()){t.setResultToDisplay("searchResultList");t.setProperty('/displaySwitchVisibility',false);}else{var r=t.getResultToDisplay();if(!(r==="searchResultList"||r==="searchResultTable"||r==="searchResultMap")){t.setResultToDisplay("searchResultList");}t.setProperty('/displaySwitchVisibility',true);}},calculateSearchButtonStatus:function(){if(this.getDataSource()===this.getProperty('/defaultDataSource')&&this.getSearchBoxTerm().length===0){this.setProperty('/searchButtonStatus','close');}else{this.setProperty('/searchButtonStatus','search');}},calculateResultList:function(){var t=this;var r=[];var e=t.getProperty('/boResults');if(e&&e.length){r.push.apply(r,e);}var i=t.getProperty('/appResults');if(i&&i.length>0){var j={type:'appcontainer',tiles:i};if(r.length>0){if(r.length>3){r.splice(3,0,j);}else{r.push(j);}}else{r=[j];}}sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,['/results',r]);},getDebugInfo:function(){var t=[this.sinaNext.getDebugInfo()];t.push('See also Enterprise Search Setup Documentation:');t.push('http://help.sap.com/saphelp_uiaddon10/helpdata/en/57/7d77c891954c21a19c242694e83177/frameset.htm');return t.join('\n');},getErrors:function(){return this.getProperty('/errors');},cleanErrors:function(){this.setProperty('/errors',jQuery.grep(this.getProperty('/errors'),function(e){return e.keep;}));},pushError:function(e){var t=this;e.title=e.title==="[object Object]"?sap.ushell.resources.i18n.getText('searchError'):e.title;var i=this.getProperty('/errors');i.push(e);t.setProperty('/errors',i);},normalSearchErrorHandling:function(e){if(!e){return;}var s=function(t){return t.replace(/<(?:.|\n)*?>|[{}]/gm,'');};if(e instanceof this.sinaNext.core.Exception){this.pushError({type:"error",title:e.message,description:s(e.description)+'\n'+this.getDebugInfo(),keep:e.keep});return;}this.pushError({type:"error",title:e.toString(),description:e.toString()+'\n'+this.getDebugInfo(),keep:e.keep});},updateSearchURLSilently:function(){var H=this.renderSearchURL();S.hasher.setHash(H);},renderSearchURL:function(){return this.searchUrlParser.render();},parseURL:function(){this.searchUrlParser.parse();}});n.injectSearchShellHelper=function(_){m=m||_;};return n;});})(window);
