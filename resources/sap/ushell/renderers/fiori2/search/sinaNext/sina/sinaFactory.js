window.sinaRequire=window.sinaRequire||(window.sap&&window.sap.ui&&window.sap.ui.require)||window.require;window.sinaDefine=window.sinaDefine||(window.sap&&window.sap.ui&&window.sap.ui.define)||window.define;var modules=['../core/core','../core/util','./Sina'];var isSapRequire=window.sap&&window.sap.ui&&window.sap.ui.require&&window.sap.ui.require===window.sinaRequire;if(!isSapRequire){modules.push('module');}sinaDefine(modules,function(c,u,S,m){return{createAsync:function(a){a=this.normalizeConfiguration(a);return new c.Promise(function(r,b){sinaRequire([a.provider],function(p){var d=new p();var s=new S(d);return s._initAsync.apply(s,[a]).then(function(){r(s);},function(e){b(e);});},function(e){console.log('require error',e);});});},normalizeConfiguration:function(a){if(c.isString(a)){a={provider:a};}if(a.provider.indexOf('/')<0){if(isSapRequire){a.provider=this.calculateProviderUrlSap(a.provider);}else{a.provider=this.calculateProviderUrl(a.provider);}}return a;},calculateProviderUrlSap:function(p){var a='sap/ushell/renderers/fiori2/search/sinaNext/providers/';var s='/Provider';return a+p+s;},calculateProviderUrl:function(p){var a=m.uri.split('/').slice(0,-1).join('/')+'/../providers/';var s='/Provider';return a+p+s;},createByTrialAsync:function(a,b){b=b||function(){return true;};a=c.map(a,this.normalizeConfiguration.bind(this));var s=u.getUrlParameter('sinaProvider');var d=u.getUrlParameter('sinaConfiguration');if(s&&!d){d='{ "provider": "'+s+'"}';}if(d){d=this.normalizeConfiguration(JSON.parse(d));for(var i=0;i<a.length;++i){var e=a[i];if(e.provider!==d.provider){a.splice(i,1);i--;continue;}this.mergeConfiguration(e,d);}if(a.length===0){a.push(d);}}var f=function(g){if(g>=a.length){return c.Promise.reject(new c.Exception('sina creation by trial failed'));}var e=a[g];return this.createAsync(e).then(function(h){if(b(h)){return h;}return f(g+1);}.bind(this),function(){return f(g+1);}.bind(this));}.bind(this);return f(0);},mergeConfiguration:function(a,b){for(var p in b){a[p]=b[p];}}};});
