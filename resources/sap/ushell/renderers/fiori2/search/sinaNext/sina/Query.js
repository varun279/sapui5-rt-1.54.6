sinaDefine(['../core/core','../core/util','./SinaObject'],function(c,u,S){return S.derive({_meta:{properties:{fuzzy:{required:false,default:false,setter:true},filter:{required:false,default:function(){return this.sina.createFilter();}},top:{required:false,default:10,setter:true},skip:{required:false,default:0,setter:true},sortOrder:{required:false,default:function(){return[];},setter:true},valueHelp:{required:false,default:false,setter:true}}},_afterInitProperties:function(p){if(p.dataSource){this.filter.setDataSource(p.dataSource);}if(p.searchTerm){this.filter.setSearchTerm(p.searchTerm);}if(p.rootCondition){this.filter.setRootCondition(p.rootCondition);}this.getResultSetAsync=u.refuseOutdatedResponsesDecorator(this.getResultSetAsync);},_initClone:function(o){this.fuzzy=o.fuzzy;this.top=o.top;this.skip=o.skip;this.filter=o.filter.clone();this.sortOrder=c.clone(o.sortOrder);this.valueHelp=o.valueHelp;},_equals:function(o){return this.fuzzy===o.fuzzy&&this.top===o.top&&this.skip===o.skip&&this.filter.equals(o.filter)&&c.equals(this.sortOrder,o.sortOrder)&&this.valueHelp===o.valueHelp;},abort:function(){this.getResultSetAsync.abort();},getResultSetAsync:function(){if(this.equals(this._lastQuery,this.sina.EqualsMode.CheckFireQuery)){return this._resultSetPromise;}if(this._lastQuery&&!this.filter.equals(this._lastQuery.filter)){this.setSkip(0);}this._lastQuery=this._createReadOnlyClone();this._resultSetPromise=this._execute(this._lastQuery);return this._resultSetPromise;},_setResultSet:function(r){this._lastQuery=this._createReadOnlyClone();this._resultSetPromise=Promise.resolve(r);r.query=this._lastQuery;},_createReadOnlyClone:function(){var q=this.clone();q.getResultSetAsync=function(){throw new c.Exception('this query is readonly');};return q;},resetResultSet:function(){this._lastQuery=null;this._resultSetPromise=null;},getSearchTerm:function(){return this.filter.searchTerm;},getDataSource:function(){return this.filter.dataSource;},getRootCondition:function(){return this.filter.rootCondition;},setSearchTerm:function(s){this.filter.setSearchTerm(s);},setDataSource:function(d){this.filter.setDataSource(d);},setRootCondition:function(r){this.filter.setRootCondition(r);},resetConditions:function(){this.filter.resetConditions();},autoInsertCondition:function(a){this.filter.autoInsertCondition(a);},autoRemoveCondition:function(a){this.filter.autoRemoveCondition(a);},setFilter:function(f){if(!this.filter.equals(f)){this.setSkip(0);}this.filter=f;}});});
