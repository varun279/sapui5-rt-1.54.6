sinaDefine(['../../core/core','../../sina/ComplexCondition','../../sina/ComparisonOperator','./typeConverter'],function(c,C,a,t){"use strict";var b=c.defineClass({_init:function(d){this.dataSource=d;},convertSinaToOdataOperator:function(s){switch(s){case a.Eq:return'eq';case a.Lt:return'lt';case a.Gt:return'gt';case a.Le:return'le';case a.Ge:return'ge';case'And':return"and";case'Or':return"or";default:throw new c.Exception('unknow comparison operator '+s);}},serializeComplexCondition:function(d){var r={"Id":1,"OperatorType":this.convertSinaToOdataOperator(d.operator),"SubFilters":[]};var s=d.conditions;for(var i=0;i<s.length;++i){var e=s[i];r.SubFilters.push(this.serialize(e));}var f=r.SubFilters.join(' '+r.OperatorType+' ');if(r.SubFilters.length>1){f='('+f+')';}return f;},serializeSimpleCondition:function(d){var m;var e;var f;m=this.dataSource.getAttributeMetadata(d.attribute);e=m.type;f={"ConditionAttribute":d.attribute,"ConditionOperator":this.convertSinaToOdataOperator(d.operator),"ConditionValue":t.sina2Odata(e,d.value)};return f.ConditionAttribute+" "+f.ConditionOperator+" '"+f.ConditionValue+"'";},serializeBetweenCondition:function(d){var m;var e;m=this.dataSource.getAttributeMetadata(d.conditions[0].attribute);e=m.type;var r=d.conditions[0].attribute+" "+this.convertSinaToOdataOperator(d.conditions[0].operator)+" "+t.sina2Odata(e,d.conditions[0].value);r+=" and ";r+=d.conditions[1].attribute+" "+this.convertSinaToOdataOperator(d.conditions[1].operator)+" "+t.sina2Odata(e,d.conditions[1].value);r="("+r+")";return r;},serialize:function(d){if(d instanceof C){if(d.operator==="And"&&d.conditions.length>1&&d.conditions[0]&&(d.conditions[0].operator==="Ge"||d.conditions[0].operator==="Gt"||d.conditions[0].operator==="Le"||d.conditions[0].operator==="Lt")){return this.serializeBetweenCondition(d);}else{return this.serializeComplexCondition(d);}}else{return this.serializeSimpleCondition(d);}}});return{serialize:function(d,e){var s=new b(d);return s.serialize(e);}};});
