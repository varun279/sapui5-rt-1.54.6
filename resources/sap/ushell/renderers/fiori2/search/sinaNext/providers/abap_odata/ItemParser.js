sinaDefine(['../../core/core','../../core/util','./typeConverter','../../sina/fiori/FioriIntentsResolver','../../sina/NavigationTarget'],function(c,u,t,I,N){return c.defineClass({_init:function(p){this.provider=p;this.sina=p.sina;this.intentsResolver=this.sina._createFioriIntentsResolver();},parse:function(s,d){if(d.ResultList.SearchResults===null){return Promise.resolve([]);}var a=d.ResultList.SearchResults.results;var b=[];for(var i=0;i<a.length;++i){var e=a[i];var f=this.parseItem(e);b.push(f);}return Promise.all(b);},parseItem:function(a){var b=[];var d=[];var e={};var w=[];var s=[];var j;var f;var g=this.sina.getDataSource(a.DataSourceId);for(j=0;j<a.Attributes.results.length;++j){var h=a.Attributes.results[j];var m=g.getAttributeMetadata(h.Id);if(m.isUnitOfMeasure||m.isCurrency){var k=this.sina._createSearchResultSetItemAttribute({id:h.Id,label:m.label,value:t.odata2Sina(m.type,h.Value),valueFormatted:h.ValueFormatted||h.Value,valueHighlighted:h.Snippet||h.ValueFormatted||h.Value,isHighlighted:h.Snippet.indexOf("<b>")>-1&&h.Snippet.indexOf("</b>")>-1,metadata:m});e[h.Id]=k;}}for(j=0;j<a.Attributes.results.length;++j){var h=a.Attributes.results[j];var m=g.getAttributeMetadata(h.Id);if(m.isUnitOfMeasure||m.isCurrency){continue;}var k=this.sina._createSearchResultSetItemAttribute({id:h.Id,label:m.label,value:t.odata2Sina(m.type,h.Value),valueFormatted:h.ValueFormatted||h.Value,valueHighlighted:h.Snippet||h.ValueFormatted||h.Value,isHighlighted:h.Snippet.indexOf("<b>")>-1&&h.Snippet.indexOf("</b>")>-1,metadata:m});if(m.unitOfMeasureAttribute){var l=e[m.unitOfMeasureAttribute];if(l){k.unitOfMeasure=l;}}k=u.addPotentialNavTargetsToAttribute(this.sina,k);if(m.usage.Title){b.push(k);}if(m.usage.Detail){d.push(k);}if(!m.usage.Title&&!m.usage.Detail&&k.isHighlighted){w.push(k);}f=g.attributeMetadataMap[k.id].semanticObjectType;if(f.length>0){s.push({name:f,value:k.value,type:k.metadata.type});}}b.sort(function(x,y){return x.metadata.usage.Title.displayOrder-y.metadata.usage.Title.displayOrder;});d.sort(function(x,y){return x.metadata.usage.Detail.displayOrder-y.metadata.usage.Detail.displayOrder;});if(a.HitAttributes!==null){for(var i=0;i<a.HitAttributes.results.length;++i){var h=a.HitAttributes.results[i];var m=g.getAttributeMetadata(h.Id);var k=this.sina._createSearchResultSetItemAttribute({id:h.Id,label:m.label,value:t.odata2Sina(m.type,u.filterString(h.Snippet,['<b>','</b>'])),valueFormatted:h.Snippet,valueHighlighted:h.Snippet,isHighlighted:h.Snippet.indexOf("<b>")>-1&&h.Snippet.indexOf("</b>")>-1,metadata:m});w.push(k);}}d=d.concat(w);var n=[];var o=[];for(var i=0;i<b.length;++i){var p=b[i];n.push(p.valueFormatted);o.push(p.valueHighlighted);}n=n.join(' ');o=o.join(' ');f=g.sematicObjectType;var q=g.system;var r=g.client;var v;return this.intentsResolver.resolveIntents({semanticObjectType:f,semanticObjectTypeAttributes:s,systemId:q,client:r,fallbackDefaultNavigationTarget:v}).then(function(x){var y=x&&x.defaultNavigationTarget;var z=x&&x.navigationTargets;return this.sina._createSearchResultSetItem({dataSource:g,title:n,titleHighlighted:o,titleAttributes:b,detailAttributes:d,defaultNavigationTarget:y,navigationTargets:z});}.bind(this));}});});
