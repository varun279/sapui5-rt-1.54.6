sinaDefine(['../../core/core','./typeConverter'],function(c,t){return c.defineClass({_init:function(p){this.provider=p;this.sina=p.sina;},parse:function(q,d){var s=[];var a;var p;var b=[];var e=[];var f;var g;var h;for(var i=0;i<d.length;i++){a=null;f=d[i];h=this.parseCalculationMode(f.Type);switch(f.Type){case'H':a=this.parseSearchTermSuggestion(q,f);break;case'A':a=this.parseSearchTermAndDataSourceSuggestion(q,f);a.type='A';a.cell=f;break;case'M':a=this.parseDataSourceSuggestion(q,f);break;}if(a){if(a.type==='A'){if(b[a.searchTerm]===undefined){g=this._getParentCell(a.cell);p=this.parseSearchTermSuggestion(q,g);b[a.searchTerm]=p;}delete a.type;delete a.cell;b[a.searchTerm].childSuggestions.push(a);}else{s.push(a);}}}Object.keys(b).forEach(function(k){s.push(b[k]);});return s;},parseDataSourceSuggestion:function(q,a){var b=this.sina.SuggestionCalculationMode.Data;var d=this.sina.getDataSource(a.FromDataSource);if(!d){return null;}var f=q.filter.clone();f.setDataSource(d);return this.sina._createDataSourceSuggestion({calculationMode:b,dataSource:d,label:a.SearchTermsHighlighted});},parseSearchTermSuggestion:function(q,a){var b=this.parseCalculationMode(a.Type);var f=q.filter.clone();f.setSearchTerm(a.SearchTerms);return this.sina._createSearchTermSuggestion({searchTerm:a.SearchTerms,calculationMode:b,filter:f,label:a.SearchTermsHighlighted});},parseSearchTermAndDataSourceSuggestion:function(q,a){var b=this.parseCalculationMode(a.Type);var f=q.filter.clone();f.setSearchTerm(a.SearchTerms);var d=this.sina.getDataSource(a.FromDataSource);if(!d){return null;}f.setDataSource(d);return this.sina._createSearchTermAndDataSourceSuggestion({searchTerm:a.SearchTerms,dataSource:d,calculationMode:b,filter:f,label:a.SearchTermsHighlighted});},parseCalculationMode:function(s){switch(s){case'H':return this.sina.SuggestionCalculationMode.History;case'A':case'M':return this.sina.SuggestionCalculationMode.Data;}},_getParentCell:function(a){var p={};p=a;p.FromDataSource="<All>";p.FromDataSourceAttribute="";p.Type="A";return p;}});});
