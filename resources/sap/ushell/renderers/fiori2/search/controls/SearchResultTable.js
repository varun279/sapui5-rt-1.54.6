sap.ui.define(['sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/SearchResultListFormatter','sap/ui/core/util/Export','sap/ui/core/util/ExportTypeCSV','sap/ushell/renderers/fiori2/search/SearchNavigationObject'],function(S,c,E,d,e){"use strict";return sap.m.Table.extend('sap.ushell.renderers.fiori2.search.controls.SearchResultTable',{renderer:'sap.m.TableRenderer',onAfterRendering:function(){S.attachEventHandlersForTooltip(this.getDomRef());},onDataExport:sap.m.Table.prototype.exportData||function(){var t=this;sap.ui.getCore().byId('dataExportButton').setEnabled(false);t.oExport=new E({exportType:new d(),models:this.getModel(),rows:{path:"/exportRows"}});if(sap.ui.getCore().getConfiguration().getLanguage().toUpperCase()==="DE"){t.oExport.getExportType().setSeparatorChar(";")}else{t.oExport.getExportType().setSeparatorChar(",")}var a=t.getModel().query.clone();a.setCalculateFacets(false);a.setTop(1000);var s=function(f){var g=new c();var n=g.format(f,a.filter.searchTerm,{suppressHighlightedValues:true});var h=t.parseColumns();h.forEach(function(j){var k=new sap.ui.core.util.ExportColumn({name:j.name,template:{content:"{"+j.originalKey+"}"}});t.oExport.addColumn(k);});var i=t.parseRows(n,h);t.getModel().setProperty("/exportRows",i);t.doExport();};var b=function(f){t.getModel().normalSearchErrorHandling(f);sap.ui.getCore().byId('dataExportButton').setEnabled(true);};if(t.getModel().getProperty("/boCount")>1000){sap.m.MessageBox.information(sap.ushell.resources.i18n.getText("exportDataInfo"),{actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],onClose:function(A){if(A==sap.m.MessageBox.Action.OK){a.getResultSetAsync().then(s,b);}if(A==sap.m.MessageBox.Action.CANCEL){sap.ui.getCore().byId('dataExportButton').setEnabled(true);}}});}else{a.getResultSetAsync().then(s,b);}},parseColumns:function(){var t=this;var m=t.getModel().getProperty("/tableColumns");var f=[];if(t.getModel().getProperty("/resultToDisplay")==="searchResultTable"){var u=t.getColumns();m.forEach(function(a){u.forEach(function(b){if(a.key===b.sId&&b.getVisible()){f.push(a);}});});f.sort(function(a,b){if(a.persoOrder<b.persoOrder)return-1;if(a.persoOrder>b.persoOrder)return 1;return 0;});}else{var i=0;m.forEach(function(a){if(i<=12){f.push(a);i++;}});}return f;},parseRows:function(s,a){var b=[];s.forEach(function(r){var f=r.itemattributes;var g={};g["DATASOURCE_AS_COLUMN_KEY"]=r.title;a.forEach(function(h){f.forEach(function(i){if(i.key===h.originalKey){g[h.originalKey]=i.value;}})});b.push(g);});return b;},doExport:function(){var t=this;t.oExport.saveFile().catch(function(o){t.getModel().pushError({type:"error",title:sap.ushell.resources.i18n.getText("exportDataError"),description:JSON.stringify(o)});}).then(function(){t.oExport.destroy();t.getModel().setProperty("/exportRows",[]);sap.ui.getCore().byId('dataExportButton').setEnabled(true);});}});});
