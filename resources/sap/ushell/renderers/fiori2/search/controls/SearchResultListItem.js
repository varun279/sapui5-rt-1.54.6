sap.ui.define(['sap/ushell/renderers/fiori2/search/controls/SearchText','sap/ushell/renderers/fiori2/search/controls/SearchLink','sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/controls/SearchRelatedObjectsToolbar','sap/ushell/renderers/fiori2/search/SearchModel'],function(S,a,b,c,f){"use strict";var n='\u2013';return sap.ui.core.Control.extend("sap.ushell.renderers.fiori2.search.controls.SearchResultListItem",{metadata:{properties:{itemId:"string",title:"string",titleNavigation:"object",geoJson:"object",type:"string",imageUrl:"string",attributes:{type:"object",multiple:true},navigationObjects:{type:"object",multiple:true},selected:"boolean",expanded:"boolean",parentListItem:"object",additionalParameters:"object",positionInList:"int",layoutCache:"object"},aggregations:{_titleLink:{type:"sap.ushell.renderers.fiori2.search.controls.SearchLink",multiple:false,visibility:"hidden"},_typeText:{type:"sap.ushell.renderers.fiori2.search.controls.SearchText",multiple:false,visibility:"hidden"},_selectionCheckBox:{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"},_expandButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_attributeLabels:{type:"sap.m.Label",multiple:true,visibility:"hidden"},_attributeValues:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_attributeValuesWithoutWhyfoundHiddenTexts:{type:"sap.ui.core.InvisibleText",multiple:true,visibility:"hidden"},_relatedObjectActionsToolbar:{type:"sap.ushell.renderers.fiori2.search.controls.SearchRelatedObjectsToolbar",multiple:false,visibility:"hidden"},_titleLabeledByText:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}}},init:function(){var t=this;if(sap.ui.core.Control.prototype.init){sap.ui.core.Control.prototype.init.apply(this,arguments);}t.setAggregation("_titleLink",new a({}).addStyleClass("sapUshellSearchResultListItem-Title").addStyleClass("sapUshellSearchResultListItem-MightOverflow").attachPress(function(e){var p=t._getPhoneSize();var w=$(window).width();if(w<=p){e.preventDefault();e.cancelBubble();t._performTitleNavigation();}else{t._performTitleNavigation({trackingOnly:true});}}));t.setAggregation("_typeText",new S().addStyleClass("sapUshellSearchResultListItem-Category").addStyleClass("sapUshellSearchResultListItem-MightOverflow"));t.setAggregation("_selectionCheckBox",new sap.m.CheckBox({select:function(e){t.setProperty("selected",e.getParameters().selected,true);}}));t.setAggregation("_expandButton",new sap.m.Button({type:sap.m.ButtonType.Transparent,press:function(e){t.toggleDetails();}}));t.setAggregation("_relatedObjectActionsToolbar",new c().addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar"));t.setAggregation("_titleLabeledByText",new sap.ui.core.InvisibleText());},renderer:function(r,C){C._renderer(r);},_renderer:function(r){this._registerItemPressHandler();this._resetPrecalculatedValues();this._renderContainer(r);this._renderAccessibilityInformation(r);},_renderContainer:function(r){var t=this;r.write('<div');r.writeControlData(t);r.addClass("sapUshellSearchResultListItem-Container");if(t.getImageUrl()){r.addClass("sapUshellSearchResultListItem-WithImage");}r.writeClasses();r.write('>');t._renderContentContainer(r);t._renderExpandButtonContainer(r);r.write('</div>');},_renderContentContainer:function(r){r.write('<div class="sapUshellSearchResultListItem-Content">');this._renderTitleContainer(r);this._renderAttributesContainer(r);r.write('</div>');},_renderExpandButtonContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-ExpandButtonContainer">');r.write('<div class="sapUshellSearchResultListItem-ExpandButton">');var i,d;var e=t.getProperty("expanded");if(e){i=sap.ui.core.IconPool.getIconURI("slim-arrow-up");d=sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip");}else{i=sap.ui.core.IconPool.getIconURI("slim-arrow-down");d=sap.ushell.resources.i18n.getText("showDetailBtn_tooltip");}var g=t.getAggregation("_expandButton");g.setIcon(i);g.setTooltip(d);g.onAfterRendering=function(){sap.m.Button.prototype.onAfterRendering.apply(this,arguments);t.setAriaExpandedState();};r.renderControl(g);r.write('</div>');r.write('</div>');},_renderTitleContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-TitleAndImageContainer">');r.write('<div class="sapUshellSearchResultListItem-TitleContainer">');t._renderCheckbox(r);var d="";var e;var g=t.getTitleNavigation();if(g){d=g.getHref();e=g.getTarget();}var h=t.getAggregation("_titleLink");h.setHref(d);h.setText(t.getTitle());if(e){h.setTarget(e);}if(d.length===0){h.setEnabled(false);}r.renderControl(h);var i=t.getAggregation("_typeText");i.setText(t.getType());r.renderControl(i);r.write('</div>');t._renderImageForPhone(r);r.write('</div>');},_renderCheckbox:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-CheckboxExpandContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxContainer">');r.write('<div class="sapUshellSearchResultListItem-CheckboxAlignmentContainer">');var d=t.getAggregation("_selectionCheckBox");var s=t.getProperty("selected");d.setSelected(s);r.renderControl(d);r.write('</div>');r.write('</div>');r.write('</div>');},_renderImageForPhone:function(r){var t=this;if(t.getImageUrl()){r.write('<div class="sapUshellSearchResultListItem-TitleImage">');r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');r.write('</div>');}},_renderAttributesContainer:function(r){var t=this;r.write('<div class="sapUshellSearchResultListItem-AttributesExpandContainer');var e=t.getProperty("expanded");if(e){r.write(" sapUshellSearchResultListItem-AttributesExpanded");}r.write('">');r.write('<div class="sapUshellSearchResultListItem-AttributesAndActions">');r.write('<ul class="sapUshellSearchResultListItem-Attributes">');t._renderImageAttribute(r);var i=t.getAttributes();t._renderAllAttributes(r,i);r.write('<li class="sapUshellSearchResultListItem-ExpandSpacerAttribute" aria-hidden="true"></li>');r.write('</ul>');t._renderRelatedObjectsToolbar(r);r.write('</div>');r.write('</div>');},_renderAllAttributes:function(r,d){var t=this;var e;var l;var v;var g;var h,j,m,o;var p;var q=this.getLayoutCache()||{};this.setLayoutCache(q,true);if(!q.attributes){q.attributes={};}var i=0,k,s=0;var u=4;var w=3;var x=[0,0,0];var y=[0,0,0,0];var z=u*x.length;var A=w*y.length;var B=2;var C=2;if(t.getImageUrl()){z--;A--;x[0]++;y[0]++;}t.destroyAggregation("_attributeLabels");t.destroyAggregation("_attributeValues");t.destroyAggregation("_attributeValuesWithoutWhyfoundHiddenTexts");var D=function(m){return function(){m.prototype.onAfterRendering.apply(this,arguments);var K=$(this.getDomRef());K.attr("aria-describedby",K.attr("data-tooltippedby"));}};for(;!(B<=0&&C<=0)&&i<d.length;i++){e=d[i];if(e.isTitle){continue;}if(z<=0&&A<=0&&!e.whyfound){continue;}l=e.name;v=e.value;if(l===undefined||v===undefined){continue;}if(!v||v===""){v=n;}o=e.longtext!=undefined&&e.longtext.length>0;g=e.valueWithoutWhyfound;var _=-1,E=-1,F={desktop:1,tablet:1};var G=q.attributes[e.key]||{};q.attributes[e.key]=G;r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-MainAttribute');if(o){var H=G.longTextColumnNumber||t._howManyColumnsToUseForLongTextAttribute(v);G.longTextColumnNumber=H;F=H;r.write(' sapUshellSearchResultListItem-LongtextAttribute');}if(z<=0){if(e.whyfound&&B>0){r.write(' sapUshellSearchResultListItem-WhyFoundAttribute-Desktop');B--;}else{r.write(' sapUshellSearchResultListItem-DisplayNoneAttribute-Desktop');}}if(A<=0){if(e.whyfound&&C>0){r.write(' sapUshellSearchResultListItem-WhyFoundAttribute-Tablet');C--;}else{r.write(' sapUshellSearchResultListItem-DisplayNoneAttribute-Tablet');}}if(o&&this.getImageUrl()&&x[0]==1){E=0;x[0]=u;z-=u+1;}else{for(k=0;k<x.length;k++){if(x[k]+F.desktop<=u){x[k]+=F.desktop;z-=F.desktop;E=k;break;}}}if(E<0){E=x.length;}if(o&&this.getImageUrl()&&y[0]==1){_=0;y[0]=w;A-=w+1;}else{for(k=0;k<y.length;k++){if(y[k]+F.tablet<=w){y[k]+=F.tablet;A-=F.tablet;_=k;break;}}}if(_<0){_=y.length;}r.write(' sapUshellSearchResultListItem-OrderTablet-'+_);r.write(' sapUshellSearchResultListItem-OrderDesktop-'+E);r.write('"');if(o){r.write(' data-sap-searchresultitem-attributeweight-desktop="'+F.desktop+'"');r.write(' data-sap-searchresultitem-attributeweight-tablet="'+F.tablet+'"');}r.write('>');h=new sap.m.Label({displayOnly:true});h.setText(l);h.addStyleClass("sapUshellSearchResultListItem-AttributeKey");h.addStyleClass("sapUshellSearchResultListItem-MightOverflow");r.renderControl(h);r.write('<span class="sapUshellSearchResultListItem-AttributeValueContainer">');if(e.defaultNavigationTarget){j=new a();m=a;j.setHref(e.defaultNavigationTarget.getHref());j.setTarget(e.defaultNavigationTarget.getTarget());j.addStyleClass("sapUshellSearchResultListItem-AttributeLink");}else{j=new S();m=S;}j.setText(v);j.addStyleClass("sapUshellSearchResultListItem-AttributeValue");j.addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(e.whyfound){j.data("ishighlighted","true",true);}if(o){j.data("islongtext","true",true);}if(g){p=new sap.ui.core.InvisibleText({});p.setText(g);j.data("tooltippedBy",p.getId(),true);j.onAfterRendering=D(m);t.addAggregation("_attributeValuesWithoutWhyfoundHiddenTexts",p,true);r.renderControl(p);}r.renderControl(j);r.write('</span>');r.write('</li>');t.addAggregation("_attributeLabels",h,true);t.addAggregation("_attributeValues",j,true);s++;}if(this.getImageUrl()){var I=u-x[0];var J=w-y[0];if(I>0||J>0){r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-MainAttribute');r.write(' sapUshellSearchResultListItem-OrderTablet-0 sapUshellSearchResultListItem-OrderDesktop-0');r.write('"');r.write(' data-sap-searchresultitem-attributeweight-desktop="'+I+'"');r.write(' data-sap-searchresultitem-attributeweight-tablet="'+J+'"');r.write('></li>');}}},_howManyColumnsToUseForLongTextAttribute:function(d){if(d.length<40){return{tablet:1,desktop:1};}if(d.length<85){return{tablet:2,desktop:2};}if(d.length<135){return{tablet:3,desktop:3};}return{tablet:3,desktop:4};},_renderImageAttribute:function(r){var t=this;if(!t.getImageUrl()){return;}r.write('<li class="sapUshellSearchResultListItem-GenericAttribute sapUshellSearchResultListItem-ImageAttribute');if(!t.getImageUrl()){r.write(' sapUshellSearchResultListItem-ImageAttributeHidden');}r.write('">');r.write('<div class="sapUshellSearchResultListItem-ImageContainer">');if(t.getImageUrl()){r.write('<img class="sapUshellSearchResultListItem-Image" src="');r.write(t.getImageUrl());r.write('">');}r.write('<div class="sapUshellSearchResultListItem-ImageContainerAlignmentHelper"></div>');r.write('</div>');r.write('</li>');},_renderRelatedObjectsToolbar:function(r){var t=this;var d=t.getNavigationObjects();if(!d||d.length===0){return;}t._showExpandButton=true;var e=t.getAggregation("_relatedObjectActionsToolbar");e.setProperty("navigationObjects",d);e.setProperty("positionInList",this.getPositionInList());r.renderControl(e);},_renderAccessibilityInformation:function(r){var t=this;var p=t.getProperty("parentListItem");if(p){var l=t.getTitle()+", "+t.getType();var d=t.getAggregation("_titleLabeledByText");d.setText(l);r.renderControl(d);p.onAfterRendering=function(){sap.m.CustomListItem.prototype.onAfterRendering.apply(this,arguments);var e=$(this.getDomRef());e.attr("aria-labelledby",d.getId());};p.addEventDelegate({onsapspace:function(e){if(e.target===e.currentTarget){t.toggleDetails();}},onsapenter:function(e){if(e.target===e.currentTarget){var g=t.getTitleNavigation();if(g){g.performNavigation();}}}});}},_getExpandAreaObjectInfo:function(){var t=this;var r=$(t.getDomRef());var d=r.find(".sapUshellSearchResultListItem-AttributesExpandContainer");var e=r.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");var g=false;if(e.css("display")==="none"){e.css("display","block");g=true;}var h=d.height();var i=r.find(".sapUshellSearchResultListItem-AttributesAndActions").height();if(g){e.css("display","");}var j=[];var p=0,k=false;r.find(".sapUshellSearchResultListItem-GenericAttribute").each(function(){if(!k){var x=this.getBoundingClientRect().x;if(x>p){p=x;return;}else{k=true;}}j.push(this);});var l=200;var m=l/10;var o={resultListItem:r,attributesExpandContainer:d,currentHeight:h,expandedHeight:i,elementsToFadeInOrOut:j,expandAnimationDuration:l,fadeInOrOutAnimationDuration:m,relatedObjectsToolbar:e};return o;},isShowingDetails:function(){var e=this._getExpandAreaObjectInfo();if(e.currentHeight<e.expandedHeight){return false;}return true;},showDetails:function(d){var t=this;if(t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();e.relatedObjectsToolbar.css("opacity",0);e.relatedObjectsToolbar.css("display","block");var r=t.getAggregation("_relatedObjectActionsToolbar");if(r){r._layoutToolbarElements();}var g,s=false;var h=e.attributesExpandContainer.animate({"height":e.expandedHeight},{"duration":e.expandAnimationDuration,"progress":function(i,p,j){if(!s&&p>0.5){g=e.relatedObjectsToolbar.animate({"opacity":1},j).promise();s=true;jQuery.when(h,g).done(function(){t.setProperty("expanded",true,true);$(this).addClass("sapUshellSearchResultListItem-AttributesExpanded");$(this).css("height","");$(e.elementsToFadeInOrOut).css("opacity","");var k=sap.ui.core.IconPool.getIconURI("slim-arrow-up");var l=t.getAggregation("_expandButton");l.setTooltip(sap.ushell.resources.i18n.getText("hideDetailBtn_tooltip"));l.setIcon(k);l.rerender();e.relatedObjectsToolbar.css("display","");e.relatedObjectsToolbar.css("opacity","");}.bind(this));}}}).promise();$(e.elementsToFadeInOrOut).animate({"opacity":1},e.fadeInOrOutAnimationDuration);},hideDetails:function(d){var t=this;var r=$(t.getDomRef());if(!t.isShowingDetails()){return;}var e=this._getExpandAreaObjectInfo();e.relatedObjectsToolbar.css("opacity",1);e.relatedObjectsToolbar.animate({"opacity":0},e.expandAnimationDuration/2);var g=r.find(".sapUshellSearchResultListItem-MainAttribute").outerHeight(true)+r.find(".sapUshellSearchResultListItem-ExpandSpacerAttribute").outerHeight(true);var s=false;var h=e.attributesExpandContainer.animate({"height":g},{"duration":e.expandAnimationDuration,"progress":function(i,p,j){if(!s&&j<=e.fadeInOrOutAnimationDuration){s=true;var k=$(e.elementsToFadeInOrOut).animate({"opacity":0},e.fadeInOrOutAnimationDuration).promise();jQuery.when(h,k).done(function(){t.setProperty("expanded",false,true);e.attributesExpandContainer.removeClass("sapUshellSearchResultListItem-AttributesExpanded");$(e.elementsToFadeInOrOut).css("opacity","");e.relatedObjectsToolbar.css("opacity","");var l=sap.ui.core.IconPool.getIconURI("slim-arrow-down");var m=t.getAggregation("_expandButton");m.setTooltip(sap.ushell.resources.i18n.getText("showDetailBtn_tooltip"));m.setIcon(l);m.rerender();});}}}).promise();},toggleDetails:function(d){if(this.isShowingDetails()){this.hideDetails(d);}else{this.showDetails(d);}},isSelectionModeEnabled:function(){var t=this;var i=false;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");if(s){i=s.css("opacity")>0;}return i;},enableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;var h=false;s.animate({width:"2rem"},{"duration":g,"progress":function(i,p,r){if(!h&&p>0.5){e.css("display","");e.animate({opacity:"1.0"},g/2);h=true;}}});},disableSelectionMode:function(d){var t=this;var s=$(t.getDomRef()).find(".sapUshellSearchResultListItem-multiSelect-innerContainer");var e=s.find(".sapUshellSearchResultListItem-multiSelect-selectionBoxContainer");var g=200;e.animate({opacity:"0.0"},g/2,function(){e.css("display","none");});s.animate({width:"0"},g);},toggleSelectionMode:function(d){if(this.isSelectionModeEnabled()){this.disableSelectionMode(d);}else{this.enableSelectionMode(d);}},onAfterRendering:function(){var t=this;var d=$(t.getDomRef());t._showOrHideExpandButton();t._setListItemStatusBasedOnWindowSize();if(t.getModel().config.odataProvider||!t.getModel().config.isLaunchpad()){t.getAggregation("_titleLink").setEnabled(true);$(t.getAggregation("_titleLink").getDomRef()).bind('click',function(){var e="";var g=t.getTitleNavigation();if(g){e=g.getTargetUrl();}if(!e||e.length===0){var q=new sap.m.QuickViewGroup();var B=t.getBindingContext().sPath+"/itemattributes";q.bindAggregation("elements",B,function(i,C){var T=sap.m.QuickViewGroupElementType.text;var h=C.oModel.getProperty(C.sPath);var u;if(h.key.toLowerCase().indexOf("email")!==-1){T=sap.m.QuickViewGroupElementType.email;}else if(h.key.toLowerCase().indexOf("url")!==-1){T=sap.m.QuickViewGroupElementType.link;u="http://"+h.value;}else if(h.key.toLowerCase().indexOf("telefon")!==-1){T=sap.m.QuickViewGroupElementType.phone;}var j=new sap.m.QuickViewGroupElement({visible:!h.isTitle&&!h.hidden,label:"{name}",value:"{value}",type:T,url:u});return j;});var Q=new sap.m.QuickViewPage({header:t.getTitle(),icon:t.getImageUrl(),groups:[q]});var o=new sap.m.QuickView({placement:sap.m.PlacementType.Auto,width:$(window).width()/3+"px",pages:[Q]});o.setModel(t.getModel());o.openBy(t.getAggregation("_titleLink"));o.addStyleClass("sapUshellSearchQuickView");sap.ushell.renderers.fiori2.search.SearchHelper.boldTagUnescaper(o.getDomRef());}});}t.forwardEllipsis(d.find(".sapUshellSearchResultListItem-Title, .sapUshellSearchResultListItem-AttributeKey, .sapUshellSearchResultListItem-AttributeValue"));b.attachEventHandlersForTooltip(t.getDomRef());},resizeEventHappened:function(){var t=this;var d=$(t.getDomRef());t._showOrHideExpandButton();t._setListItemStatusBasedOnWindowSize();t.getAggregation("_titleLink").rerender();t.forwardEllipsis(d.find(".sapUshellSearchResultListItem-Title, .sapUshellSearchResultListItem-AttributeKey, .sapUshellSearchResultListItem-AttributeValue"));},_getPhoneSize:function(){return 767;},_resetPrecalculatedValues:function(){this._visibleAttributes=undefined;this._detailsArea=undefined;this._showExpandButton=false;},_setListItemStatusBasedOnWindowSize:function(){var w=window.innerWidth;var p=this.getParentListItem();if(this.getTitleNavigation()&&w<=this._getPhoneSize()){p.setType(sap.m.ListType.Active);}else{p.setType(sap.m.ListType.Inactive);}},_showOrHideExpandButton:function(){var t=this;var d=$(t.getDomRef());var g=d.find(".sapUshellSearchResultListItem-ExpandButtonContainer");var i=g.css("visibility")!="hidden";var s=false;var h=d.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar");s=h.length>0;if(!s){var p=0;d.find(".sapUshellSearchResultListItem-MainAttribute,.sapUshellSearchResultListItem-WhyFoundAttribute").each(function(){var x=this.getBoundingClientRect().x;if(x>p){p=x;}else{s=true;return false;}});}if(i&&!s){g.css("visibility","hidden");g.attr("aria-hidden","true");t.setAriaExpandedState();}else if(!i&&s){g.css("visibility","");g.removeAttr("aria-hidden");t.setAriaExpandedState();var m=sap.ushell.renderers.fiori2.search.getModelSingleton();var j={type:m.eventLogger.ITEM_SHOW_DETAILS,itemPosition:this.getPositionInList()};if(t.getItemId()){j.itemId=this.getItemId();}try{m.eventLogger.logEvent(j);}catch(e){}}},setAriaExpandedState:function(){var t=this;var e=t.getAggregation("_expandButton");var d=$(e.getDomRef());var g=$(t.getDomRef());var h=t.getParentListItem()?$(t.getParentListItem().getDomRef()):g.closest("li");var i=g.find(".sapUshellSearchResultListItem-ExpandButtonContainer");if(i.css("visibility")=="hidden"){d.removeAttr("aria-expanded");h.removeAttr("aria-expanded");}else{var j=t.getProperty("expanded");if(j){d.attr("aria-expanded","true");h.attr("aria-expanded","true");}else{d.attr("aria-expanded","false");h.attr("aria-expanded","false");}}},_registerItemPressHandler:function(){var t=this;var p=t.getParentListItem();if(p){p.attachPress(function(e){t._performTitleNavigation();});t._registerItemPressHandler=function(){}}},_performTitleNavigation:function(p){var t=p&&p.trackingOnly||false;var d=this.getTitleNavigation();if(d){d.performNavigation({trackingOnly:t});}},forwardEllipsis:function(o){o.each(function(i,d){b.forwardEllipsis4Whyfound(d);});}});});
