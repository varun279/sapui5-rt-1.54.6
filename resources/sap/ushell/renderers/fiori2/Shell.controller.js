// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/ui5service/ShellUIService','sap/ui/core/IconPool','sap/ushell/CanvasShapesManager','./AccessKeysHandler','./History','./Lifecycle','sap/ushell/components/applicationIntegration/AppLifeCycle','sap/ushell/services/AppConfiguration','sap/ushell/services/AppType','sap/ushell/services/Message','sap/ushell/services/ShellNavigation','sap/ushell/ui/launchpad/Fiori2LoadingDialog','sap/ushell/utils','sap/ushell/components/container/ApplicationContainer'],function(S,I,C,A,H,L,a,b,c,M,d,F,u,f){"use strict";var g=true,h=true,p=false,B=false,s,m,n={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},o={},j,k=['minimal','app','standalone','embedded','headerless','merged','home','blank'];sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{onInit:function(){h=true;B=false;g=true;var e=window.matchMedia("(min-width: 600px)"),i;var o=(this.getView().getViewData()?this.getView().getViewData().config:{})||{};this.oStatefulApplicationContainer=this._parseStatefulContainerConfiguration(o.statefulApplicationContainer);this.bMeAreaSelected=false;this.oEndUserFeedbackConfiguration={showAnonymous:true,anonymousByDefault:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};this.bMeAreaLoaded=false;this.bNotificationsSelected=false;o["enableBackGroundShapes"]=o.enableBackGroundShapes===undefined?true:o.enableBackGroundShapes;j=this._historyBackNavigation;this.initShellModel(o);i=function(q){m.setProperty('/isPhoneWidth',!q.matches);};if(e.addListener){e.addListener(i);i(e);}this.getView().setModel(m);this.getView().setModel(sap.ushell.resources.i18nModel,"i18n");sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);this._setConfigurationToModel();if(o.moveEditHomePageActionToShellHeader){sap.ui.getCore().getEventBus().subscribe("showCatalog",this._hideEditButton,this);}sap.ui.getCore().getEventBus().subscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().subscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().subscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().subscribe("launchpad","shellFloatingContainerDockedIsResize",this._onResizeWithDocking,this);sap.ui.getCore().getEventBus().subscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ushell.Container.getService("AppLifeCycle");s.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);this.history=new H();this.oViewPortContainer=sap.ui.getCore().byId("viewPortContainer");this.oNotificationsCountButton=sap.ui.getCore().byId("NotificationsCountButton");this.oFiori2LoadingDialog=sap.ui.getCore().byId("Fiori2LoadingDialog");this.oShellNavigation=sap.ushell.Container.getService("ShellNavigation");this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this._handleEmptyHash,this));this.oShellNavigation.init(jQuery.proxy(this.doHashChange,this));this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this.handleDataLoss,this));sap.ushell.Container.getService("Message").init(jQuery.proxy(this.doShowMessage,this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());this.bContactSupportEnabled=sap.ushell.Container.getService("SupportTicket").isEnabled();A.init(m);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}return sap.ushell.resources.browserI18n.getText("dataLossExternalMessage");}};if(m.getProperty("/contentDensity")){this._applyContentDensityClass();}sap.ui.Device.media.attachHandler(this.onScreenSizeChange.bind(this),null,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this.onScreenSizeChange(sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD));this.initShellUIService();if(this.getView().oShellNavigationMenu){this.getView().oShellNavigationMenu.setModel(m);}sap.ui.getCore().attachThemeChanged(this.redrawBackGroundShapes);if(o.sessionTimeoutIntervalInMinutes){var l=20000,t=this;setTimeout(function(){t._createSessionHandler(o);},l);}},_parseStatefulContainerConfiguration:function(e){var i={};if(!e){return i;}var l={"GUI":true};Object.keys(e).filter(function(q){return true===e[q]&&l[q];}).map(function(U){var q=U;if(q==="GUI"){q="TR";}return q;}).forEach(function(q){i[q]=null;});return i;},initShellModel:function(o){s=a;s.init(o);m=s.getModel();},redrawBackGroundShapes:function(){if(o.enableBackGroundShapes){C.drawShapes();}},setBackGroundShapes:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode')!=='minimal';if(!B&&o.enableBackGroundShapes){B=true;C.drawShapes();C.enableAnimationDrawing(e);}},initShellUIService:function(){this.oShellUIService=new S({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oShellUIService._attachHierarchyChanged(this.onHierarchyChange.bind(this));this.oShellUIService._attachTitleChanged(this.onTitleChange.bind(this));this.oShellUIService._attachRelatedAppsChanged(this.onRelatedAppsChange.bind(this));this.oShellUIService._attachBackNavigationChanged(this.onBackNavigationChange.bind(this));if(o.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(U){this.oUserStatus=new U({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oUserStatus.attachEnabledStatusChanged(function(e){this.getModel().setProperty("/userStatusEnabled",e.mParameters.data);}.bind(this));this.oUserStatus.attachStatusChanged(function(e){this.getModel().setProperty("/userStatus",e.mParameters.data);if(e.mParameters.data==null){this.getModel().setProperty("/userStatusUserEnabled",false);}else{this.getModel().setProperty("/userStatusUserEnabled",true);}}.bind(this));}.bind(this));}},onHierarchyChange:function(e){this.isHierarchyChanged=true;var i=e.getParameters().data,l,E=[],q;if(!i){i=[];}l=this.getHierarchyDefaultValue();i.forEach(function(r,t){E[t]=jQuery.extend({},r);});E=E.concat(l);q=m.getProperty("/currentState");if(q&&q.stateName==="home"){s.updateStateProperty("application/hierarchy",E,false,["home"]);}s.updateStateProperty("application/hierarchy",E,true);},onTitleChange:function(e){this.isTitleChanged=true;var t=e.getParameters().data,i;if(!t){t=this.getTitleDefaultValue();}i=m.getProperty("/currentState");if(i&&i.stateName==="home"){s.updateStateProperty("application/title",t,false,["home"]);}s.updateStateProperty("application/title",t,true);window.document.title=t;},onBackNavigationChange:function(e){this.isBackNavigationChanged=true;var i=e.getParameters().data,m=this.getModel(),l=m.getProperty('/currentState/');if(i){j=i;if(l.stateName==='minimal'||l.stateName==='standalone'||l.stateName==='embedded'){sap.ushell.Container.getRenderer('fiori2').showHeaderItem('backBtn',true);}}else{j=this._historyBackNavigation;}},onRelatedAppsChange:function(e){this.isRelatedAppsChanged=true;var r=e.getParameters().data,i;if(!r){r=[];}i=m.getProperty("/currentState");if(i&&i.stateName==="home"){s.updateStateProperty("application/relatedApps",r,false,["home"]);}s.updateStateProperty("application/relatedApps",r,true);},getHierarchyDefaultValue:function(){var e=[],i=m.getProperty("/currentState");if(i&&(i.stateName==="app"||i.stateName==="embedded")){e=[{icon:"sap-icon://home",title:sap.ushell.resources.i18n.getText("actionHomePage"),intent:o.rootIntent?"#"+o.rootIntent:"#"}];}return e;},getTitleDefaultValue:function(){var t="",e=b.getMetadata();if(e&&e.title){t=e.title;}return t;},getAppIcon:function(){var i="sap-icon://folder",e=b.getMetadata();if(e&&e.icon){i=e.icon;}return i;},_isCompactContentDensityByDevice:function(){var i;if(!sap.ui.Device.support.touch||sap.ui.Device.system.combi){i=true;}else{i=false;}return i;},_applyContentDensityByPriority:function(i){if(i===undefined){if(sap.ui.Device.system.combi){var e=sap.ushell.Container.getService("UserInfo"),U=e.getUser(),l="autoDetect";if(U){l=U.getContentDensity();}switch(l){case"cozy":i=false;break;case"compact":i=true;break;default:var q=b.getMetadata();if(q.compactContentDensity&&!q.cozyContentDensity){i=true;}else{i=false;}}}else{var q=b.getMetadata();if(q.compactContentDensity&&!q.cozyContentDensity){i=true;}else{if(!q.compactContentDensity&&q.cozyContentDensity){i=false;}else{i=this._isCompactContentDensityByDevice();}}}}this._applyContentDensityClass(i);},_applyContentDensityClass:function(i){if(i===undefined){var e=sap.ushell.Container.getService("UserInfo"),U=e.getUser?e.getUser():undefined;if(U&&U.getContentDensity()==='cozy'){i=false;}else{i=this._isCompactContentDensityByDevice();}}if(i){jQuery('body').removeClass('sapUiSizeCozy');jQuery('body').addClass('sapUiSizeCompact');}else{jQuery('body').removeClass('sapUiSizeCompact');jQuery('body').addClass('sapUiSizeCozy');}},toggleContentDensity:function(e,E,D){var i=D.contentDensity==="compact";this._applyContentDensityByPriority(i);},loadMeAreaView:function(){},_handleEmptyHash:function(e){e=(typeof e==="string")?e:"";e=e.split("?")[0];if(e.length===0){var v=this.getView()?this.getView().getViewData():{};o=v.config||{};if(o.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(o.rootIntent){setTimeout(function(){hasher.setHash(o.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var v=this.getView().getViewData(),e,i;if(v){o=v.config||{};}if(o){if(o.states){i=m.getProperty('/states');for(e in o.states){if(o.states.hasOwnProperty(e)){i[e]=o.states[e];}}m.setProperty('/states',i);}if(o.appState==="headerless"||o.appState==="merged"||o.appState==="blank"){m.setProperty("/personalization",false);o.enablePersonalization=false;}else if(o.enablePersonalization!==undefined){m.setProperty("/personalization",o.enablePersonalization);}if(o.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=o.changeEndUserFeedbackTitle;}if(o.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=o.changeEndUserFeedbackPlaceholder;}if(o.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=o.showEndUserFeedbackAnonymousCheckbox;}if(o.makeEndUserFeedbackAnonymousByDefault!==undefined){this.oEndUserFeedbackConfiguration.anonymousByDefault=o.makeEndUserFeedbackAnonymousByDefault;}if(o.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=o.showEndUserFeedbackLegalAgreement;}if(o.enableSetTheme!==undefined){m.setProperty("/setTheme",o.enableSetTheme);}m.setProperty("/contentDensity",o.enableContentDensity===undefined?true:o.enableContentDensity);if(o.title){m.setProperty("/title",o.title);}if(o.migrationConfig!==undefined){m.setProperty("/migrationConfig",o.migrationConfig);}if(o.enableUserDefaultParameters!==undefined){m.setProperty("/userDefaultParameters",o.enableUserDefaultParameters);}if(o.disableHomeAppCache!==undefined){m.setProperty("/disableHomeAppCache",o.disableHomeAppCache);}m.setProperty("/enableHelp",!!o.enableHelp);m.setProperty("/searchAvailable",(o.enableSearch!==false));m.bindProperty('/animationMode').attachChange(this.handleAnimationModeChange.bind(this));m.setProperty("/animationMode",o.animationMode);this._getPersonalizer({container:"flp.launchpad.animation.mode",item:"animationMode"}).getPersData().then(function(U){m.setProperty("/animationMode",U?U:o.animationMode);o.animationMode=U?U:o.animationMode;}.bind(this));var l=this._getTrackingUserActivies();l.done(function(q){if(q!==undefined){m.setProperty("/enableTrackingActivity",q);}else{m.setProperty("/enableTrackingActivity",true);}});s.updateStateProperty("headerHiding",false,false,["home","app"]);}},_getTrackingUserActivies:function(){'use strict';var e=this._getPersonalizer({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).getPersData();e.fail(function(i){jQuery.sap.log.error("Failed to load anchor bar state from the personalization",i,"sap.ushell.components.flp.settings.FlpSettings");});return e;},_hideEditButton:function(){var e=sap.ui.getCore().byId("ActionModeBtn");if(e){e.setVisible(false);}},_getPreviousPageDirty:function(){return p;},_setPreviousPageDirty:function(e){p=e;},getModelConfiguration:function(){var v=this.getView().getViewData(),e,i;if(v){e=v.config||{};i=jQuery.extend({},e);}delete i.applications;return i;},_getLogonFrameProvider:function(){var v=this.getView();return{create:function(){return v.createIFrameDialog();},show:function(){v.showIFrameDialog();},destroy:function(){v.destroyIFrameDialog();}};},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.setBackGroundShapes,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.delayedCloseLoadingScreen,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this._loadCoreExtNonUI5,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","appClosed",this.logApplicationUsage,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell","coreResourcesFullyLoaded",this._postCoreExtActivities,this);sap.ui.getCore().getEventBus().unsubscribe("launchpad","launchpadCustomRouterRouteMatched",this._centerViewPort,this);sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().unsubscribe("showCatalog",this._hideEditButton,this);sap.ui.Device.media.detachHandler(this.onScreenSizeChange.bind(this),null,sap.ui.Device.media.RANGESETS.SAP_STANDARD);this.oShellNavigation.hashChanger.destroy();this.getView().aDanglingControls.forEach(function(e){if(e.destroyContent){e.destroyContent();}e.destroy();});sap.ushell.UserActivityLog.deactivate();s.destroy();s=undefined;},handleAnimationModeChange:function(){var v=this.getView(),m=v.getModel(),e=m.getProperty('/animationMode'),E=e!=='minimal';C.enableAnimationDrawing(E);sap.ui.getCore().getEventBus().publish("launchpad","animationModeChange",e);},getAnimationType:function(){return"show";},onCurtainClose:function(e){jQuery.sap.log.warning("Closing Curtain",e);},handleDataLoss:function(e,i){if(!h){h=true;this.closeLoadingScreen();return this.oShellNavigation.NavigationFilterStatus.Custom;}if(sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(sap.ushell.resources.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);p=true;return this.oShellNavigation.NavigationFilterStatus.Continue;}h=false;window.history.back();return this.oShellNavigation.NavigationFilterStatus.Custom;}return this.oShellNavigation.NavigationFilterStatus.Continue;},doShowMessage:function(t,i,P){sap.ui.require(["sap/m/MessageToast","sap/m/MessageBox"],function(l,q){if(t===M.Type.ERROR){if(sap.ushell.Container&&sap.ushell.Container.getService("SupportTicket").isEnabled()&&i!==sap.ushell.resources.i18n.getText("supportTicketCreationFailed")){sap.ui.require(["sap/ushell/ui/launchpad/EmbeddedSupportErrorMessage"],function(E){try{var r=new E("EmbeddedSupportErrorMessage",{title:P.title||sap.ushell.resources.i18n.getText("error"),content:new sap.m.Text({text:i})});r.open();}catch(e){q.show(i,q.Icon.ERROR,P.title||sap.ushell.resources.i18n.getText("error"));}});}else{q.show(i,q.Icon.ERROR,P.title||sap.ushell.resources.i18n.getText("error"));}}else if(t===M.Type.CONFIRM){if(P.actions){q.show(i,q.Icon.QUESTION,P.title,P.actions,P.callback);}else{q.confirm(i,P.callback,P.title);}}else{l.show(i,{duration:P.duration||3000});}});},_isColdStart:function(){if(this.history.getHistoryLength()<=1){return true;}this._isColdStart=function(){return false;};return false;},_setEnableHashChange:function(v){h=v;},_logRecentActivity:function(r){if(this._getConfig().enableRecentActivity&&sap.ushell.components.applicationIntegration.AppLifeCycle.getModel().getProperty("/enableTrackingActivity")){setTimeout(function(){if(sap.ushell.Container){b.addActivity(r);}},700);}},_logOpenAppAction:function(e){if(o&&o.enableTilesOpacity&&o.enableRecentActivity&&sap.ushell.components.applicationIntegration.AppLifeCycle.getModel().getProperty("/enableTrackingActivity")){setTimeout(function(){if(sap.ushell.Container){var U=sap.ushell.Container.getService("UserRecents");U.addAppUsage(e);}},700);}},_applicationIsStatefulType:function(e){return this.oStatefulApplicationContainer.hasOwnProperty(e);},_getStatefulContainer:function(e){return this.oStatefulApplicationContainer[e];},_setStatefulContainer:function(e,i){return this.oStatefulApplicationContainer[e]=i;},_statefulContainerForTypeExists:function(e){return!!this._getStatefulContainer(e);},doHashChange:function(e,i,O,l,P){jQuery.sap.measure.start("FLP:ShellController.doHashChange","doHashChange","FLP");u.addTime("ShellControllerHashChange");return this._doHashChange(this,e,i,O,l,P).then(function(){jQuery.sap.measure.end("FLP:ShellController.doHashChange");},function(E){jQuery.sap.measure.end("FLP:ShellController.doHashChange");});},_doHashChange:function(e,i,l,O,q,P){var r,t;e.lastApplicationFullHash=q?O+q:O;if(!h){h=true;e.closeLoadingScreen();return jQuery.when();}if(P){e.hashChangeFailure(e.history.getHistoryLength(),P.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return jQuery.when();}if(sap.m.InstanceManager&&g){sap.m.InstanceManager.closeAllDialogs();sap.m.InstanceManager.closeAllPopovers();}g=true;e.openLoadingScreen();if(u.getParameterValueBoolean("sap-ushell-no-ls")){e.closeLoadingScreen();}r=e.history.getHistoryLength();t=e.fixShellHash(i);e.history.hashChange(t,O);e.currentAppBeforeNav=b.getCurrentApplication();jQuery.sap.flpmeasure.end(0,"Creating Shell");jQuery.sap.flpmeasure.start(0,"targetResolution",1);return e._resolveHashFragment(t).then(function(R,v){jQuery.sap.flpmeasure.end(0,"targetResolution");jQuery.sap.flpmeasure.start(0,"CreateComponent",3);var w=v?v.semanticObject+"-"+v.action:"",o=e._getConfig(),T,x=R&&R.ui5ComponentName,y=!!x,z=!!(R&&R.componentHandle);R=e._calculateNavigationMode(v,R);if(R&&(R.navigationMode===n.newWindow||u.isNativeWebGuiNavigation(R))){if(o&&o.enableRecentActivity){var D=b.getMetadata(R);var E={};E.title=D.title;E.appType=R.applicationType;E.url=t;E.appId=t;e._logRecentActivity(E);}e._openAppInNewWindowAndRestore(R);return;}if(e.getModel().getProperty("/migrationConfig")){o.migrationConfig=false;e.getModel().setProperty("/migrationConfig",false);if(R&&t==='#'){o.rootIntent="";}else if(t==='#'){setTimeout(function(){hasher.setHash(o.rootIntent);},0);return;}}if(z||!y){e._initiateApplication(R,t,v,r);return;}if(o&&o.applications&&o.applications[w]){R.applicationConfiguration=o.applications[w];}T=e._getViewPortControlByIntent(w);if(e._isShellHomeIntent(w)&&T){e._initiateApplication(R,t,v,r);return;}if(e._applicationIsStatefulType(R.applicationType)&&T){}if(T){e.oViewPortContainer.removeCenterViewPort(T.getId(),true);T.destroy();}b.setApplicationInInitMode();sap.ui.getCore().getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:x});jQuery.sap.measure.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getService("Ui5ComponentLoader").createComponent(R,v,e._createWaitForRendererCreatedPromise()).done(function(G){jQuery.sap.measure.end("FLP:ShellController.UI5createComponent");jQuery.sap.flpmeasure.end(0,"CreateComponent");e._initiateApplication(R,t,v,r);}).fail(function(G){b.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(r,"Failed to load UI5 component for navigation intent "+t,G,"sap.ushell.renderers.fiori2.Shell.controller",false);});},function(v){var E;E="Failed to resolve navigation target: \""+t+"\""+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration"+" or by missing role assignment.";e.hashChangeFailure(r,E,v,"sap.ushell.renderers.fiori2.Shell.controller",false);});},_initiateApplication:function(r,e,P,O){jQuery.sap.measure.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var i=b.getMetadata(r);if(i.title){window.document.title=i.title;}else{jQuery.sap.log.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined");}if(this.bContactSupportEnabled){sap.ushell.UserActivityLog.activate();}this._logOpenAppAction(e);try{this.navigate(P,e,i,r);}catch(E){if(E.stack){jQuery.sap.log.error("Application initialization (Intent: \n"+e+"\n failed due to an Exception:\n"+E.stack);}this.hashChangeFailure(O,E.name,E.message,i?i.title:"",false);}finally{if(r&&r.coreResourcesFullyLoaded&&!this._pluginLoadingTriggered){this._loadRendererExtensionPlugins();}}jQuery.sap.measure.end("FLP:ShellController._initiateApplication");},_resolveHashFragment:function(e){jQuery.sap.measure.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var r,P,i=sap.ushell.Container.getService("URLParsing").parseShellHash(e),D=new jQuery.Deferred(),o=this._getConfig();P=i&&i.params||{};if(i&&i.contextRaw&&i.contextRaw==="navResCtx"&&P&&P.additionalInformation&&(P.additionalInformation[0]||P.additionalInformation[0]==="")&&P.applicationType&&P.applicationType[0]&&P.url&&P.url[0]&&P.navigationMode&&(P.navigationMode[0]||P.additionalInformation[0]==="")){P=i.params||{};r={additionalInformation:P.additionalInformation[0],applicationType:P.applicationType[0],url:P.url[0],navigationMode:P.navigationMode[0]};if(P.title){r.text=P.title[0];}D.resolve(r,i);}else{if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(l){D.resolve(l.resolvedHashFragment,i);delete window["sap-ushell-async-libs-promise-directstart"];},function(l){D.reject(l);delete window["sap-ushell-async-libs-promise-directstart"];});return D.promise();}sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(e).done(function(r){if(i&&(i.semanticObject+"-"+i.action)===o.rootIntent){r.navigationMode="embedded";}jQuery.sap.measure.end("FLP:ShellController._resolveHashFragment");D.resolve(r,i);}).fail(function(l){D.reject(l);});}return D.promise();},_calculateNavigationMode:function(P,r){if(!r){return undefined;}var N=r.navigationMode;if(N===n.newWindowThenEmbedded){if(this._isColdStart()||(P.contextRaw&&P.contextRaw==="navResCtx")||this.history.backwards){r.navigationMode=n.embedded;}else{r.navigationMode=n.newWindow;if(!u.isNativeWebGuiNavigation(r)){r.url=this._getCurrentLocationHash();}}return r;}if(N===n.newWindow&&this._isColdStart()){r.navigationMode=n.replace;return r;}return r;},_usesNavigationRedirect:function(e){if(!e){return new jQuery.Deferred().reject().promise();}var t=this,i=e.getInstance({});if(i&&typeof i.navigationRedirect==="function"){var D=new jQuery.Deferred();var N=i.navigationRedirect();if(N&&typeof N.then==="function"){N.then(function(l){jQuery.sap.log.warning("Performing navigation redirect to hash "+l);i.destroy();t.history.pop();sap.ushell.Container.getService("ShellNavigation").toExternal({target:{shellHash:l}},undefined,false);D.resolve(true);},function(){D.reject();});return D.promise();}}return new jQuery.Deferred().reject().promise();},navigate:function(P,e,i,r){jQuery.sap.measure.start("FLP:ShellController.navigate","navigate","FLP");var N=(jQuery.isPlainObject(r)?r.navigationMode:null),t=this;if(N===null){if(this._isColdStart()){hasher.setHash("");return;}h=false;this.history.pop();this._windowHistoryBack(1);return;}r=this._calculateNavigationMode(P,r);N=(jQuery.isPlainObject(r)?r.navigationMode:null);if(N===n.embedded){var D=this._usesNavigationRedirect(r.componentHandle);D.then(null,function(){t._handleEmbeddedNavMode(e,P,i,r);if(P&&P.contextRaw==="navResCtx"){jQuery.sap.log.error(" This path will no longer be supported in 1.40");h=false;if(P&&P.params&&P.params.original_intent&&P.params.original_intent[0]){hasher.replaceHash(P.params.original_intent[0]);t.history._history[0]=P.params.original_intent[0];}}});jQuery.sap.measure.end("FLP:ShellController.navigate");return;}if(N===n.replace){h=false;this._changeWindowLocation(r.url);return;}if(N===n.newWindow){this._openAppInNewWindowAndRestore(r);return;}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);},_openAppInNewWindowAndRestore:function(r){h=false;if(u.isNativeWebGuiNavigation(r)){try{var U=u.appendUserIdToUrl("sap-user",r.url);var E=u.getPrivateEpcm();E.doNavigate(U);}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,r.text,false);}}else{this._openAppNewWindow(r.url);}this.history.pop();var v=r.componentHandle&&r.componentHandle.getInstance&&r.componentHandle.getInstance({});if(v){v.destroy();}this._windowHistoryBack(1);b.setCurrentApplication(this.currentAppBeforeNav);return;},_handleEmbeddedNavMode:function(e,P,i,r){jQuery.sap.measure.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var l,q,t,v,w,R;this.resetShellUIServiceHandlers();this.setAppIcons(i);l='-'+P.semanticObject+'-'+P.action;t=(r.applicationType==="NWBC"||r.applicationType==="TR");v=e==="#"||(o.rootIntent&&o.rootIntent===P.semanticObject+"-"+P.action);if(v&&!o.disableHomeAppCache){this._saveHomePageComponent();}w=P?P.semanticObject+"-"+P.action:"";if(t&&!r.explicitNavMode){if(r.applicationType==="NWBC"&&o.appState&&o.appState==="headerless"){this.switchViewState("headerless");}else{this.switchViewState("minimal");}}else if(v){this.switchViewState("home");this.oShellUIService.setBackNavigation();}else{this.switchViewState("app");}q=this._getViewPortControlByIntent(w);R=this._statefulContainerForTypeExists(r.applicationType);if(!q){q=this.getWrappedApplicationWithMoreStrictnessInIntention(w,i,r,l,r.fullWidth||i.fullWidth||t);}else if(w===o.rootIntent){this.closeLoadingScreen();}else if(!R){this.oViewPortContainer.removeCenterViewPort(q.getId(),true);q.destroy();q=this.getWrappedApplicationWithMoreStrictnessInIntention(w,i,r,l,r.fullWidth||i.fullWidth||t);}this.oViewPortContainer.navTo('centerViewPort',q.getId(),'show');this._centerViewPort();if(R){q.setNewApplicationContext(r.applicationType,r.url).then(function(){q.toggleStyleClass("hidden",false);jQuery.sap.log.info("New application context opened successfully in an existing transaction UI session.");},function(E){jQuery.sap.log.error(E&&E.message||E);});}this.closeLoadingScreen();if(this.currentAppBeforeNav){var x=this._getStatefulContainer(this.currentAppBeforeNav.applicationType);if(x){x.onApplicationOpened(r.applicationType)}}jQuery.sap.measure.end("FLP:ShellController._handleEmbeddedNavMode");},_centerViewPort:function(){this.oViewPortContainer.switchState("Center");},_getViewPortControlByIntent:function(i){return this.oViewPortContainer&&(this.oViewPortContainer.getViewPortControl('centerViewPort',"application"+'-'+i)||this.oViewPortContainer.getViewPortControl('centerViewPort',"applicationShellPage"+'-'+i));},_isShellHomeIntent:function(i){return i==="#"||i===o.rootIntent;},_getExistingAppAndDestroyIfNotRoot:function(i){var v;v=this._getViewPortControlByIntent(i);if(!v){return;}if(i===o.rootIntent){return v;}this.oViewPortContainer.removeCenterViewPort(v.getId(),true);v.destroy();return null;},getWrappedApplicationWithMoreStrictnessInIntention:function(i,e,r,l,q){var t,v=this;setTimeout(function(){setTimeout(function(){var w;if(m.getProperty("/currentState/stateName")==="app"){w="shellAppTitle";}A.sendFocusBackToShell(w);setTimeout(function(){v.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",r);jQuery.sap.log.info('app is being opened');},0);if(o.applications){r.applicationConfiguration=o.applications[i];}t=this._getAppContainer(l,r);r.sShellHash=i;this.publishNavigationStateEvents(t,r);t.addStyleClass('sapUshellApplicationPage');if(!q){t.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia('(min-width: 106.4rem)').matches){t.addStyleClass("sapUShellDockingContainer");t.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){t.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}t.toggleStyleClass('sapUshellDefaultBackground',!e.hideLightBackground);this._applyContentDensityByPriority();t.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};t.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};this.oViewPortContainer.addCenterViewPort(t);setTimeout(function(){v.closeLoadingScreen();},0);jQuery.sap.measure.end("FLP:ShellController.getWrappedApplication");return t;},getWrappedApplication:function(i,e,r,l,q){jQuery.sap.flpmeasure.end(0,"CreateComponent");jQuery.sap.measure.start("FLP:ShellController.getWrappedApplication","getWrappedApplication","FLP");var E,t,v=this;E=this._getExistingAppAndDestroyIfNotRoot(i,l);if(E){this.closeLoadingScreen();return E;}setTimeout(function(){setTimeout(function(){var w;if(m.getProperty("/currentState/stateName")==="app"){w="shellAppTitle";}A.sendFocusBackToShell(w);setTimeout(function(){v.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",r);jQuery.sap.log.info('app is being opened');},0);if(o.applications){r.applicationConfiguration=o.applications[i];}t=this._getAppContainer(l,r);r.sShellHash=i;this.publishNavigationStateEvents(t,r);t.addStyleClass('sapUshellApplicationPage');if(!q){t.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia('(min-width: 106.4rem)').matches){t.addStyleClass("sapUShellDockingContainer");t.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){t.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}t.toggleStyleClass('sapUshellDefaultBackground',!e.hideLightBackground);this._applyContentDensityByPriority();t.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};t.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};this.oViewPortContainer.addCenterViewPort(t);setTimeout(function(){v.closeLoadingScreen();},0);jQuery.sap.measure.end("FLP:ShellController.getWrappedApplication");return t;},resetShellUIServiceHandlers:function(){this.isHierarchyChanged=false;this.isTitleChanged=false;this.isRelatedAppsChanged=false;this.isBackNavigationChanged=false;},_publicEventDataFromResolutionResult:function(e){var P={};if(!e){return e;}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(i){P[i]=e[i];});Object.freeze(P);return P;},onAppAfterRendering:function(e){setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appOpened",e);jQuery.sap.log.info('app was opened');},0);var i=this._publicEventDataFromResolutionResult(e);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",i);if(this.oShellUIService){if(!this.isHierarchyChanged){this.oShellUIService.setHierarchy();}if(!this.isTitleChanged){this.oShellUIService.setTitle();}if(!this.isRelatedAppsChanged){this.oShellUIService.setRelatedApps();}if(!this.isBackNavigationChanged){this.oShellUIService.setBackNavigation();}}s.updateStateProperty("application/icon",this.getAppIcon(),true);s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_getAppContainer:function(e,r){var i;if(!this.oShellUIService){this.initShellUIService();}r.shellUIService=this.oShellUIService.getInterface();r.targetNavigationMode=this._isColdStart()?"explace":"inplace";if(this._applicationIsStatefulType(r.applicationType)){i=this._getStatefulContainer(r.applicationType);if(!i){i=new f("application"+e,r);this._setStatefulContainer(r.applicationType,i);i.setIsStateful(true);}}return i||new f("application"+e,r);},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var t=this,e="sap.ushell.components.container.ApplicationContainer",l=function(E,i,D){t.oHomeApp=D.component;sap.ui.getCore().getEventBus().unsubscribe(e,'componentCreated',l);};sap.ui.getCore().getEventBus().subscribe(e,'componentCreated',l);},hashChangeFailure:function(i,e,D,l,E){this.reportError(e,D,l);this.closeLoadingScreen();this.delayedMessageError(sap.ushell.resources.i18n.getText("fail_to_start_app_try_later"));g=false;if(i===0){hasher.setHash("");}else{if(jQuery.sap.getUriParameters().get("bFallbackToShellHome")){hasher.setHash("");}else{h=E;sap.ushell.Container.setDirtyFlag(p);this._windowHistoryBack(1);}}},reportError:function(e,D,i){jQuery.sap.log.error(e,D,i);},delayedMessageError:function(e){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(e);}},0);},fixShellHash:function(e){if(!e){e='#';}else if(e.charAt(0)!=='#'){e='#'+e;}return e;},publishNavigationStateEvents:function(e,i){var l,q=e.getId?e.getId():"",t=this;var r=b.getMetadata(),v=r.icon,T=r.title;e.addEventDelegate({onAfterRendering:this.onAppAfterRendering.bind(this,i)});l=e.exit;e.exit=function(){if(l){l.apply(this,arguments);}t._applyContentDensityByPriority();setTimeout(function(){var E=jQuery.extend(true,{},i);delete E.componentHandle;E["appId"]=q;E["usageIcon"]=v;E["usageTitle"]=T;sap.ui.getCore().getEventBus().publish("launchpad","appClosed",E);jQuery.sap.log.info('app was closed');},0);var P=t._publicEventDataFromResolutionResult(i);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",P);};},_openAppNewWindow:function(U){var e=window.open(U);if(!e){var i=sap.ushell.resources.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(i);}},_windowHistoryBack:function(i){window.history.back(i);},_changeWindowLocation:function(U){window.location.href=U;},setAppIcons:function(e){sap.ui.require(["sap/ui/core/theming/Parameters"],function(P){jQuery.sap.measure.start("FLP:ShellController.setAppIcons","setAppIcons","FLP");var i=jQuery.sap.getModulePath("sap.ushell"),l=(e&&e.homeScreenIconPhone)||(i+'/themes/base/img/launchicons/57_iPhone_Desktop_Launch.png'),q=(e&&e["homeScreenIconPhone@2"])||(i+'/themes/base/img/launchicons/114_iPhone-Retina_Web_Clip.png'),r=(e&&e.homeScreenIconTablet)||(i+'/themes/base/img/launchicons/72_iPad_Desktop_Launch.png'),t=(e&&e["homeScreenIconTablet@2"])||(i+'/themes/base/img/launchicons/144_iPad_Retina_Web_Clip.png'),v=(e&&e.favIcon)||(this._getDefaultFavIcon(P)),w=this.getFavIconHref();if(sap.ui.Device.os.ios){jQuery.sap.setIcons({'phone':l,'phone@2':q,'tablet':r,'tablet@2':t,'favicon':v,'precomposed':false});}else if(w!==v){jQuery.sap.setIcons({'phone':'','phone@2':'','tablet':'','tablet@2':'','favicon':v,'precomposed':true});}jQuery.sap.measure.end("FLP:ShellController.setAppIcons");}.bind(this));},_getDefaultFavIcon:function(P){var e=P.get('sapUiShellFavicon');if(e){var i=/url[\s]*\('?"?([^\'")]*)'?"?\)/.exec(e);if(i){e=i[1];}else if(e==="''"||e==="none"){e=null;}}if(!e){var l=jQuery.sap.getModulePath("sap.ushell");return l+'/themes/base/img/launchpad_favicon.ico';}return e;},handleEndItemsOverflow:function(P){var e=this.getModel().getProperty("/currentState/headEndItems");if(e.length===1||(e.length===2&&e.indexOf("NotificationsCountButton")!=-1)){return;}function r(){s.removeHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);var i=sap.ui.getCore().byId('headEndItemsOverflow');if(i){i.destroy();}}if(P.name==='Phone'||P.name==='Tablet'){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}else{r();s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else if(P.name==="Desktop"){if(P.showOverFlowBtn){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else{r();}}},isHeadEndItemOverflow:function(){var e=this.getModel().getProperty("/currentState/headEndItems");if(e.indexOf("endItemsOverflowBtn")===-1){return false;}else{var i=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;var l=3;if(i==="Phone"){l=1;}if(sap.ui.getCore().byId("endItemsOverflowBtn").getVisible()){return e.length>l+1;}else{return e.length>l;}}},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e);},isHeadEndItemNotInOverflow:function(e){if(this.isHeadEndItemOverflow()){if(e==="NOTIFICATIONSCOUNTBUTTON"||e==="ENDITEMSOVERFLOWBTN"){return true;}else{var i=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;if(i==="Tablet"){if(e==="SF"||e==="FLOATINGCONTAINERBUTTON"){return true;}else{return false;}}else if(i==="Desktop"){if(e==="SF"||e==="FLOATINGCONTAINERBUTTON"||e==="COPILOTBTN"){return true;}else{return false;}}else if(i==="Phone"){return false;}else{return true;}}}else if(e==="ENDITEMSOVERFLOWBTN"){return false;}else{return true;}},pressEndItemsOverflow:function(e){if(!sap.ui.Device.system.desktop){var i=m.getProperty("/currentState").headerHiding;if(i){m.setProperty("/currentState/headerHiding",false);}}var P=sap.ui.getCore().byId('headEndItemsOverflow');function l(){if(P.isOpen()){P.close();}}var q;if(P){q=P.getContent()[0];}else{var r=new sap.ui.model.Filter('','EQ','a');r.fnTest=this.isHeadEndItemInOverflow.bind(this);q=new sap.ui.layout.VerticalLayout({content:{path:"/currentState/headEndItems",filters:[r],factory:function(t,v){var w=sap.ui.getCore().byId(v.getObject());w.detachPress(l);w.attachPress(l);return w;}}});P=new sap.m.Popover("headEndItemsOverflow",{placement:sap.m.PlacementType.Bottom,showHeader:false,showArrow:false,content:q}).addStyleClass("sapUshellPopupContainer");P.addStyleClass("sapMPopoverheadEndItemsOverflow");q.updateAggregation=this.getView().updateShellAggregation;P.setModel(m);this.getView().aDanglingControls.push(P);P.attachAfterClose(P,function(){if(!sap.ui.Device.system.desktop){if(i){m.setProperty("/currentState/headerHiding",i);}}});}if(P.isOpen()){P.close();}else{q.updateAggregation("content");P.openBy(e.getSource());}},getFavIconHref:function(){return jQuery('link').filter('[rel="shortcut icon"]').attr('href')||'';},externalSearchTriggered:function(e,E,D){m.setProperty("/searchTerm",D.searchTerm);D.query=D.searchTerm;},onAfterNavigate:function(e){this.closeLoadingScreen();var i="application"+"-"+o.rootIntent,l=e.getParameter("fromId"),q=e.getParameter("from");if(l&&((l!==i)||o.disableHomeAppCache)&&!this._applicationIsStatefulType(q.getApplicationType())){this.oViewPortContainer.removeCenterViewPort(l,true);q.destroy();}u.addTime("ShellController.onAfterNavigate");if(e.mParameters&&e.mParameters.toId===i){var r=sap.ui.getCore().byId("configBtn");if(r){r.focus();}if(this.oHomeApp&&this.oHomeApp.setInitialConfiguration){this.oHomeApp.setInitialConfiguration();}}},logApplicationUsage:function(e,N,i){if(o&&o.enableRecentActivity){var l=i.appId,q=l,r={};r.title=i.usageTitle;r.appType=c.APP;r.url='#'+this.lastApplicationFullHash;if(l.indexOf('-')>0){q=l.substr(l.indexOf('-')+1);}r.appId='#'+q;if(q==="Action-search"){r.appType=c.SEARCH;}this._logRecentActivity(r);}},openLoadingScreen:function(){jQuery.sap.measure.start("FLP:ShellController.openLoadingScreen","openLoadingScreen","FLP");if(this.oFiori2LoadingDialog){var e=m.getProperty('/animationMode');var e=e||'full';this.oFiori2LoadingDialog.openLoadingScreen(e);}jQuery.sap.measure.end("FLP:ShellController.openLoadingScreen");},closeLoadingScreen:function(){if(this.oFiori2LoadingDialog){this.oFiori2LoadingDialog.closeLoadingScreen();}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=sap.ushell.resources.i18n.getText("loadingComplete");setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML="";},0);}},delayedCloseLoadingScreen:function(){setTimeout(function(){this.closeLoadingScreen();}.bind(this),600);},togglePane:function(e){var i=e.getSource(),l=i.getSelected();sap.ui.getCore().getEventBus().publish("launchpad","togglePane",{currentContent:i.getModel().getProperty("/currentState/paneContent")});if(e.getParameter("id")==="categoriesBtn"){i.getModel().setProperty("/currentState/showCurtainPane",!l);}else{i.getModel().setProperty("/currentState/showPane",!l);}},_switchViewPortStateByControl:function(O,e){var i=false,v=this.oViewPortContainer;if(O&&O.setEnabled&&typeof O.setEnabled==="function"){i=true;}if(i){O.addStyleClass("sapUshellShellHeadItemOverrideDisableStyle");O.setEnabled(false);}function l(){O.setEnabled(true);O.removeStyleClass("sapUshellShellHeadItemOverrideDisableStyle");v.detachAfterSwitchStateAnimationFinished(l);}if(i){v.attachAfterSwitchStateAnimationFinished(l);}v.switchState(e);},onScreenSizeChange:function(P){this.validateShowLogo(P);this.handleNavMenuTitleVisibility(P);this._handleHomeAndBackButtonsVisibility(P);this.handleEndItemsOverflow(P);},_handleHomeAndBackButtonsVisibility:function(P){var m=a.getModel(),i=jQuery("#mainShell").width()<1024&&jQuery(".sapUshellContainerDocked").length>0,e=m.getProperty('/currentViewPortState')==='Center',l=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name,q=sap.ui.getCore().byId("homeBtn"),r=sap.ui.getCore().byId("backBtn"),t=l==="Desktop",v=l!=="Phone"||e;if(i){if(q){t=false;}}if(q){q.setVisible(t);}if(r){r.setVisible(v);}},validateShowLogo:function(P){var e;var i=this.getModel().getProperty('/currentState/stateName');var l=i==='merged'||i==='headerless';if(P){e=P.name;}else{e=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD).name;}var q=true;if(e==="Phone"&&!this.bMeAreaSelected||l){q=false;}s.updateStateProperty("showLogo",q,false,["home","app","blank","blank-home","minimal"],true);},handleNavMenuTitleVisibility:function(P){this.bNavMenuTitleVisible=false;if(P.name!=="Desktop"){this.bNavMenuTitleVisible=true;}s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},navigateFromShellApplicationNavigationMenu:function(i){this.oViewPortContainer.switchState("Center");hasher.setHash(i);var e=sap.ui.getCore().byId("shellAppTitle");if(e){e.close();}},_loadCoreExtNonUI5:function(e,E,i){if(i&&(i.applicationType=="NWBC"||i.applicationType=="TR")){setTimeout(this._loadCoreExt.bind(this),2000);}},_postCoreExtActivities:function(){sap.ushell.Container.getService("UsageAnalytics").init(sap.ushell.resources.i18n.getText("usageAnalytics"),sap.ushell.resources.i18n.getText("i_agree"),sap.ushell.resources.i18n.getText("i_disagree"),sap.ushell.resources.i18n.getText("remind_me_later"));try{sap.ushell.Container.getService("EndUserFeedback").isEnabled().done(function(){m.setProperty('/showEndUserFeedback',true);}).fail(function(){m.setProperty('/showEndUserFeedback',false);});}catch(e){jQuery.sap.log.error("EndUserFeedback adapter is not found",e.message||e);m.setProperty('/showEndUserFeedback',false);}this.getView().createPostCoreExtControls();},_loadRendererExtensionPlugins:function(){var v=this.getView()?this.getView().getViewData():{},o=v.config||{},D=jQuery.sap.getUriParameters().get("sap-ushell-xx-pluginmode")==="delayed",t=this;if(!this._pluginLoadingTriggered){this._pluginLoadingTriggered=true;if(!sap.ushell.Container.getService("PluginManager").getRegisteredPlugins().RendererExtensions.init){sap.ushell.Container.getService("PluginManager").registerPlugins({init:{component:"sap.ushell.components.shell.defaults",url:jQuery.sap.getResourcePath("sap/ushell/components/shell/defaults")}});}jQuery.sap.log.info("Triggering load of 'RendererExtension' plug-ins after loading core-ext module (after home page content rendered)",null,"sap.ushell.renderers.fiori2.Shell");if(!o.inHeaderLessOpt){if(D){setTimeout(function(){sap.ushell.Container.getService("PluginManager").loadPlugins("RendererExtensions").always(function(){t._publishCoreExtLoadedEvent();});},5000);}else{sap.ushell.Container.getService("PluginManager").loadPlugins("RendererExtensions").always(function(){t._publishCoreExtLoadedEvent();});}}else{this._publishCoreExtLoadedEvent();}}},_loadCoreExt:function(){jQuery.sap.measure.end("FLP:Container.InitLoading");var e=window['sap-ui-debug']?['sap/fiori/core-ext-light-dbg.js']:['sap/fiori/core-ext-light-0.js','sap/fiori/core-ext-light-1.js','sap/fiori/core-ext-light-2.js','sap/fiori/core-ext-light-3.js'],t=this,P=[];e.forEach(function(i){P.push(jQuery.sap._loadJSResourceAsync(i));});Promise.all(P).then(function(){t._loadRendererExtensionPlugins();}).catch(function(){t._loadRendererExtensionPlugins();jQuery.sap.log.warning('failed to load sap.fiori.core-ext-light');});},_publishCoreExtLoadedEvent:function(){setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","coreExtLoaded");},0);setTimeout(function(){sap.ui.getCore().getEventBus().publish("shell","FLP-FMP");},5000);},getCurrentViewportState:function(){var v=m.getProperty('/currentViewPortState');return v;},makeEndUserFeedbackAnonymousByDefault:function(e){this.oEndUserFeedbackConfiguration.anonymousByDefault=e;},showEndUserFeedbackLegalAgreement:function(e){this.oEndUserFeedbackConfiguration.showLegalAgreement=e;},_activateFloatingUIActions:function(w){if(w<417){this.oFloatingUIActions.disable();}else{this.oFloatingUIActions.enable();}},setFloatingContainerDragSelector:function(e){jQuery(e).addClass("sapUshellShellFloatingContainerSelector");sap.ui.require(["sap/ushell/UIActions"],function(U){if(!this.oFloatingUIActions){this.oFloatingUIActions=new sap.ushell.UIActions({containerSelector:".sapUiBody",wrapperSelector:'.sapUshellShellFloatingContainerWrapper',draggableSelector:'.sapUshellShellFloatingContainerWrapper',rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1000,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:jQuery.sap.debug()});}else{this.oFloatingUIActions.elementsToCapture=jQuery(e);}this._activateFloatingUIActions(jQuery(window).width());var t;jQuery(window).bind("resize",function(){clearTimeout(t);t=setTimeout(this._activateFloatingUIActions(jQuery(window).width()),300);}.bind(this));}.bind(this));},_doDock:function(e){jQuery.sap.measure.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var D=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD);if(D.name=="Desktop"){var w=jQuery(window).width();if(e){e.docked={};var i=e.docked;if(e.moveX>=w-64){i.dockPos="right";i.setIsDockingAreaOpen=true;this._openDockingArea(e);}else if(e.moveX<64){i.dockPos="left";i.setIsDockingAreaOpen=true;this._openDockingArea(e);}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e);}if(jQuery("#canvas").hasClass('sapUshellContainerDocked')){this._handleCloseCanvas(e);}}}}jQuery.sap.measure.end("FLP:Shell.controller._doDock");},_finishDoDock:function(D){this._openDockingArea(false);var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");e.put("lastState","docked:"+D.dockPos);this._handleOpenCanvas(D);var w=jQuery('#sapUshellFloatingContainerWrapper');w.css("height","100%");jQuery("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsDocked",D.dockPos);if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}},_onResizeWithDocking:function(){this.onScreenSizeChange(sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD));setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appFinderWithDocking");},300);},_onDragStartUI:function(e){jQuery.sap.measure.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","floating");jQuery("#sapUshellFloatingContainerWrapper").removeClass('sapUshellContainerDocked');$(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");jQuery("#sapUshellFloatingContainerWrapper").addClass('sapUshellContainerDockedMinimizeCoPilot');jQuery(jQuery(".sapUshellContainerDockedMinimizeCoPilot")).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(false));this._handleCloseCanvas(e);}jQuery.sap.measure.end("FLP:Shell.controller._onDragStartUI");},_handleAnimations:function(i,D){var e=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');if(i){e.addClass("sapUshellContainerDockedLaunchpadTranisation");if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",true);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",true);}w.addClass(" sapUshellContainerDockedExtendCoPilot");setTimeout(function(){if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeRight",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",true);}else if(e.hasClass('sapUshellContainer-Narrow-Left')||D=="left"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("closeLeft",false);jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",true);}},300);this._onResizeWithDocking();}else{jQuery("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot");if(e.hasClass('sapUshellContainer-Narrow-Right')||D=="right"){jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openRight",false);}else{jQuery(".sapUshellContainerDockedLaunchpadTranisation").toggleClass("openLeft",false);}setTimeout(function(){e.removeClass("sapUshellContainerDockedLaunchpadTranisation  closeLeft  openLeft closeRight openRight")},550);}var l=sap.ui.getCore().byId('shell-header');l._handleResizeChange();},_openDockingArea:function(e){var D=e?e.docked:false;var i=D?D.setIsDockingAreaOpen:false;if(i&&jQuery("#DockinaAreaDiv").length==0){var l=sap.ui.getCore().getConfiguration().getRTL();if((D.dockPos==="right"&&e.clone&&!l)||(D.dockPos==="left"&&e.clone&&l)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement);}else if((D.dockPos==="left"&&e.clone&&!l)||(D.dockPos==="right"&&e.clone&&l)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement);}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=D.dockPos;}else if(!i){this._closeDockingArea();}},_closeDockingArea:function(e){setTimeout(function(){jQuery('.sapUshellShellDisplayDockingAreaRight').remove();jQuery('.sapUshellShellDisplayDockingAreaLeft').remove();},150);var i=sap.ui.getCore().byId('shell-header');if(i){i._handleResizeChange();}},_isDock:function(){return(jQuery('.sapUshellContainerDocked').size()!=0);},_isDockingAreaOpen:function(){return(jQuery('.sapUshellShellDisplayDockingAreaRight').size()!=0||jQuery('.sapUshellShellDisplayDockingAreaLeft').size()!=0);},_handleOpenCanvas:function(D){var e=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');var i=sap.ui.getCore().getConfiguration().getRTL();if((D.dockPos==="right"&&!i)||(D.dockPos==="left"&&i)){e.addClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked ');}if((D.dockPos==="left"&&!i)||(D.dockPos==="right"&&i)){e.addClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked ');}var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_handleCloseCanvas:function(e){var i=jQuery('#canvas');if(e){e.docked.setIsDockingAreaOpen=false;}if(i.hasClass('sapUshellContainer-Narrow-Right')){i.removeClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight');this._openDockingArea(e);this._setFloatingContainerHeight();}if(i.hasClass('sapUshellContainer-Narrow-Left')){i.removeClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft');this._openDockingArea(e);this._setFloatingContainerHeight();}if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}this._onResizeWithDocking();var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_setFloatingContainerHeight:function(e){var w=jQuery(window).width();var W=jQuery('#sapUshellFloatingContainerWrapper');if(this._isDock()){if(e&&(e.clientX>=w-64||e.clientX<64)){W.addClass(' sapUshellContainerDocked');W.addClass("sapUshellContainerDockedMinimizeCoPilot");jQuery(W).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(true));}}else if(!this._isDock()){jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");}},_handleFloatingContainerDrop:function(e,i,D){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var l=i.firstChild?sap.ui.getCore().byId(i.firstChild.id):undefined,q=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"),w=jQuery(window).width(),W=jQuery(window).height(),P=D.deltaX/w,r=D.deltaY/W,O=i.style.visibility,t=i.style.display,v=parseFloat(i.style.left.replace("%","")),x=parseFloat(i.style.top.replace("%",""));i.style.visibility='hidden';i.style.display='block';if(typeof(v)==='number'){P=v+100*D.deltaX/w;}if(typeof(x)==='number'){r=x+100*D.deltaY/W;}if(this._isDockingAreaOpen()){r=0;}i.setAttribute("style","left:"+P+"%;top:"+r+"%;position:absolute;");i.visibility=O;i.display=t;q.put("floatingContainerStyle",i.getAttribute("style"));if(l){l.handleDrop();if(!!D.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(D.clone.oDockedProp);}}jQuery.sap.measure.end("FLP:Shell.controller.handleFloatingContainerDrop");},_handleFloatingContainerUIStart:function(i,l){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var q=l;q.style.display="none";if(window.getSelection){var r=window.getSelection();try{r.removeAllRanges();}catch(e){}}jQuery.sap.measure.end("FLP:Shell.controller._handleFloatingContainerUIStart");},getFloatingContainerState:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var l="floating";if(e!=null){l=e.get("lastState");if(l==null){l="floating";}}return l;},setFloatingContainerVisibility:function(v){var l=this.getFloatingContainerState();if(l){if(l=="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}else if(l.indexOf("docked")!=-1){if(v==true){var D=sap.ui.Device.media.getCurrentRange(sap.ui.Device.media.RANGESETS.SAP_STANDARD);if(D.name=="Desktop"){var w=jQuery('#sapUshellFloatingContainerWrapper');w.addClass("sapUshellContainerDocked");jQuery("#canvas").addClass("sapUshellContainerDocked");w.css("height","100%");sap.ui.getCore().byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}if(sap.ui.getCore().getConfiguration().getRTL()){if(l.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}}else{if(l.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);}else{storage.put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}}else{if(sap.ui.getCore().getConfiguration().getRTL()){if(l.indexOf("right")!=-1){this._handleAnimations(false,"left");}else{this._handleAnimations(false,"right");}}else{if(l.indexOf("right")!=-1){this._handleAnimations(false,"right");}else{this._handleAnimations(false,"left");}}var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}}jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();var V=sap.ui.getCore().byId("viewPortContainer");if(V){V._handleSizeChange();}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible();},setFloatingContainerContent:function(P,i,e,l){s.setFloatingContainerContent(P,i,e,l);},getRightFloatingContainerVisibility:function(){var r=this.getView().getOUnifiedShell().getRightFloatingContainer(),R=r&&r.getVisible();return R;},setHeaderTitle:function(t,i){if(typeof t!=="string"){throw new Error("sTitle type is invalid");}this.getView().getOUnifiedShell().getHeader().setTitleControl(t,i);},addEndUserFeedbackCustomUI:function(e,i){if(e){this.oEndUserFeedbackConfiguration.customUIContent=e;}if(i===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=i;}},setFooter:function(e){if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid");}if(this.getView().oShellPage.getFooter()!==null){jQuery.sap.log.warning("You can only set one footer. Replacing existing footer: "+this.getView().oShellPage.getFooter().getId()+", with the new footer: "+e.getId()+".");}this.getView().oShellPage.setFooter(e);},removeFooter:function(){if(this.getView().oShellPage.getFooter()===null){jQuery.sap.log.warning("There is no footer to remove.");return;}this.getView().oShellPage.setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}var i=sap.ui.getCore().byId('shell-header');i._handleResizeChange();}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},switchViewState:function(e,i){var l=e;if(e==='home'&&(o.appState==='embedded'||o.appState=='headerless'||o.appState=='merged'||o.appState=='blank')){l=o.appState+'-home';}else if(e==='app'&&k.indexOf(o.appState)>=0){l=o.appState;}var q=s.switchState(l,i);if(e==="searchResults"){m.setProperty("/lastSearchScreen",'');if(!hasher.getHash().indexOf("Action-search")===0){var r=sap.ui.getCore().getModel("searchModel");hasher.setHash("Action-search&/searchTerm="+r.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(r.getProperty("/uiFilter/dataSource").getJson()));}}this._handleHomeAndBackButtonsVisibility();sap.ui.getCore().getEventBus().publish("launchpad","shellViewStateChanged",q);},_createSessionHandler:function(o){var t=this;sap.ui.require(["sap/ushell/SessionHandler"],function(e){t.oSessionHandler=new e();t.oSessionHandler.init({oModel:t.getModel(),keepSessionAlivePopupText:o.keepSessionAlivePopupText,pageReloadPopupText:o.pageReloadPopupText,preloadLibrariesForRootIntent:o.preloadLibrariesForRootIntent,sessionTimeoutReminderInMinutes:o.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:o.sessionTimeoutIntervalInMinutes,enableAutomaticSignout:o.enableAutomaticSignout});});},_getSessionHandler:function(){return this.oSessionHandler;},_navBack:function(){this.bMeAreaSelected=false;j();},_historyBackNavigation:function(){window.history.back();},_updateUserPrefModel:function(e){var i=this._getModelEntryFromEntryObject(e),l=m.getProperty("/userPreferences/entries");l.push(i);l=this._reorderUserPrefEntries(l);m.setProperty("/userPreferences/entries",l);},_updateProfilingModel:function(e){var i=this._getModelEntryFromEntryObject(e),l=m.getProperty("/userPreferences/profiling")||[];l.push(i);m.setProperty("/userPreferences/profiling",l);},_getModelEntryFromEntryObject:function(e){return{"entryHelpID":e.entryHelpID,"title":e.title,"editable":e.content?true:false,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null,"icon":e.icon};},_reorderUserPrefEntries:function(e){var l,t;for(var i=0;i<e.length;i++){if(e[i].entryHelpID==="flpSettingsEntry"){l=i;}else if(e[i].entryHelpID==="themes"){t=i;}if(l!=undefined&&t!=undefined){var q=e.splice(l,1);e.splice(t+1,0,q[0]);break;}}return e;},onAfterViewPortSwitchState:function(e){var t=e.getParameter("to");var i=sap.ui.getCore().byId("shellAppTitle");m.setProperty("/currentViewPortState",t);if(this.applicationKeyHandler){A.registerAppKeysHandler(this.applicationKeyHandler);this.applicationKeyHandler=undefined;}sap.ui.getCore().getEventBus().publish("launchpad","afterSwitchState",e);if(t==="Center"){i.setVisible(true);this.bMeAreaSelected=false;}else{i.setVisible(false);if(t==="Right"){this.bMeAreaSelected=false;}else if(t=="RightCenter"){this.applicationKeyHandler=A.getAppKeysHandler();A.bFocusOnShell=false;if(sap.ui.getCore().byId("notificationsView")){A.registerAppKeysHandler(sap.ui.getCore().byId("notificationsView").getController().keydownHandler.bind(sap.ui.getCore().byId("notificationsView")));}}}this.validateShowLogo();this._handleHomeAndBackButtonsVisibility();},getModel:function(){return m;},_getConfig:function(){return o?o:{};},_createWaitForRendererCreatedPromise:function(){var P,r;r=sap.ushell.Container.getRenderer();if(r){jQuery.sap.log.debug("Shell controller._createWaitForRendererCreatedPromise: shell renderer already created, return empty array.");return[];}else{P=new Promise(function(e,i){var O;O=function(){jQuery.sap.log.info("Shell controller: resolving component waitFor promise after shell renderer created event fired.");e();sap.ushell.Container.detachRendererCreatedEvent(O);};r=sap.ushell.Container.getRenderer();if(r){jQuery.sap.log.debug("Shell controller: resolving component waitFor promise immediately (shell renderer already created");e();}else{sap.ushell.Container.attachRendererCreatedEvent(O);}});return[P];}},_getPersonalizer:function(P){var e=sap.ushell.Container.getService("Personalization");var i=sap.ui.core.Component.getOwnerComponentFor(this.getView());var l={keyCategory:e.constants.keyCategory.FIXED_KEY,writeFrequency:e.constants.writeFrequency.LOW,clientStorageAllowed:true};return e.getPersonalizer(P,l,i);},_getCurrentLocationHash:function(){return window.location.hash;}});},false);
