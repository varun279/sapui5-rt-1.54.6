/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
(function(){"use strict";jQuery.sap.declare("sap.fe.templates.ObjectPage.AnnotationHelper");sap.fe.templates.ObjectPage.AnnotationHelper={isHasDeepHierarchy:function(f){if(f.Facets){for(var i=0;i<f.Facets.length;i++){if(f.Facets[i].RecordType==="com.sap.vocabularies.UI.v1.CollectionFacet"){return true;}}}return false;},checkMoreBlockContent:function(f){return sap.fe.templates.ObjectPage.AnnotationHelper.checkFacetContent(f,false);},checkBlockContent:function(f){return sap.fe.templates.ObjectPage.AnnotationHelper.checkFacetContent(f,true);},checkFacetContent:function(f,b){var p;var i=f.getInterface(0);var F=f.getModel().getProperty("",f);var a=f.getPath().split("/Facets");var c=i.getModel().getContext(a[0]);if(i.getModel().getProperty('',c).RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){return c.getPath();}else{if(!F){return;}for(var d=0;d<F.length;d++){if(!b){if(typeof F[d]["@com.sap.vocabularies.UI.v1.PartOfPreview"]!=='undefined'&&F[d]["@com.sap.vocabularies.UI.v1.PartOfPreview"]===false){p=i.getPath()+"/"+d;break;}}else{if(F[d].$Type!=="com.sap.vocabularies.UI.v1.ReferenceFacet"||(typeof F[d]["@com.sap.vocabularies.UI.v1.PartOfPreview"]==='undefined'||F[d]["@com.sap.vocabularies.UI.v1.PartOfPreview"]===true)){p=i.getPath()+"/"+d;break;}}}}return p;},replaceSpecialCharsInId:function(i){if(i.indexOf(" ")>=0){jQuery.sap.log.error("Annotation Helper: Spaces are not allowed in ID parts. Please check the annotations, probably something is wrong there.");}return i.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");},getStableIdPartFromFacet:function(f){var h="";if(typeof this.getContext==="function"&&this.getContext()&&this.getContext().getPath()&&this.getContext().getPath().indexOf("com.sap.vocabularies.UI.v1.HeaderFacets")>=0){h="headerEditable::";}if(f.$Type&&f.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){if(f.ID&&f.ID.String){return h+f.ID.String;}else{jQuery.sap.log.error("Annotation Helper: Unable to create a stable ID. You have to set an ID at all collection facets.");return Math.floor((Math.random()*99999)+1).toString();}}else if(f.$Type&&f.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){if(f.ID&&f.ID.String){return h+f.ID.String;}else{return h+sap.fe.templates.ObjectPage.AnnotationHelper.replaceSpecialCharsInId(f.Target.$AnnotationPath);}}else{jQuery.sap.log.error("Annotation Helper: Unable to create a stable ID. Please check the facet annotations.");return Math.floor((Math.random()*99999)+1).toString();}},getStableIdPartFromDataPoint:function(d){var p="";if(d.Value&&d.Value.$Path){return sap.fe.templates.ObjectPage.AnnotationHelper.replaceSpecialCharsInId(d.Value.$Path);}else if(d.Value&&d.Value.Apply&&d.Value.Apply.Name==="odata.concat"){for(var i=0;i<d.Value.Apply.Parameters.length;i++){if(d.Value.Apply.Parameters[i].Type==="Path"){if(p){p=p+"::";}p=p+sap.fe.templates.ObjectPage.AnnotationHelper.replaceSpecialCharsInId(d.Value.Apply.Parameters[i].Value);}}return p;}else{jQuery.sap.log.error("Annotation Helper: Unable to create stable ID derived from annotations.");}},doesCollectionFacetOnlyContainForms:function(f){var r=true;if(f.Facets){for(var i=0;i<f.Facets.length;i++){if(f.Facets[i].Target&&f.Facets[i].Target.AnnotationPath){if((f.Facets[i].Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.FieldGroup")<0)&&(f.Facets[i].Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.Identification")<0)&&(f.Facets[i].Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.DataPoint")<0)){r=false;}}}}else{r=false;}return r;},determineTableType:function(f,s){var S;if(s&&s.sections){S=s.sections[sap.fe.templates.ObjectPage.AnnotationHelper.getStableIdPartFromFacet(f)];}return(S&&(((S.tableType||S.treeTable))||(s&&s.tableType)));},buildExpressionForProgressIndicatorPercentValue:function(d,u){var p="0";if(d.Value&&d.Value.$Path){var v="${"+d.Value.$Path+"}";var t;if(d.TargetValue){t=d.TargetValue.$Path?"${"+d.TargetValue.$Path+"}":d.TargetValue.$Decimal;}if(u){u="'"+u+"'";}var e="({0} > 100 ? 100 : {0} < 0 ? 0 : {0} * 1)";var E="(({1} > 0) ? (({0} > {1}) ? 100 : (({0} < 0) ? 0 : ({0} / {1} * 100))) : 0)";var s="'{'= ({2} === ''%'') ? "+e+" : "+E+" '}'";p=jQuery.sap.formatMessage(s,[v,t,u]);}return p;},trimCurlyBraces:function(v){return v?v.replace("{","").replace("}",""):undefined;},buildExpressionForProgressIndicatorDisplayValue:function(d,u){var p,t;var b=function(P){var s=sap.fe.templates.ObjectPage.AnnotationHelper.trimCurlyBraces(P);var a="{path: '"+s+"'}";return a;};p=b(d.Value.$Path);t=d.TargetValue&&(d.TargetValue.$Path||d.TargetValue.$Decimal);p+=(", "+b(t)+", "+b(u));var D="{ parts: ["+p+"], formatter: 'sap.fe.templates.ObjectPage.AnnotationHelper.formatDisplayValue' }";return D;},formatDisplayValue:function(v,t,u){var d="";if(v){var c=this;var r=c.getModel("i18n").getResourceBundle();var C=c.getCustomData();t=t||C[0].getValue();u=u||C[1].getValue();if(u){if(u==='%'){d=r.getText("PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_PERCENT",[v]);}else{if(t){d=r.getText("PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT",[v,t,u]);}else{d=r.getText("PROGRESS_INDICATOR_DISPLAY_VALUE_UOM_IS_NOT_PERCENT_NO_TARGET_VALUE",[v,u]);}}}else{if(t){d=r.getText("PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM",[v,t]);}else{d=v;}}}else{jQuery.sap.log.warning("Value property is mandatory, the default (empty string) will be returned");}return d;},buildExpressionForCriticality:function(d){var f=sap.ui.core.ValueState.None;var e;var c=d.Criticality;if(c){e="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+sap.ui.core.ValueState.Error+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+sap.ui.core.ValueState.Warning+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+sap.ui.core.ValueState.Success+"'' : "+"''"+sap.ui.core.ValueState.None+"'' '}'";if(c.$Path){var C='${'+c.$Path+"}";f=jQuery.sap.formatMessage(e,C);}else if(c.$EnumMember){var s="'"+c.$EnumMember+"'";f=jQuery.sap.formatMessage(e,s);}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}}else{jQuery.sap.log.warning("Case not supported, returning the default sap.ui.core.ValueState.None");}return f;},buildRatingIndicatorSubtitleExpression:function(s){if(s){return"{parts: [{path: '"+s.$Path+"'}], formatter: 'sap.fe.templates.ObjectPage.AnnotationHelper.formatRatingIndicatorSubTitle'}";}},formatRatingIndicatorSubTitle:function(s){if(s){var r=this.getModel("i18n").getResourceBundle();if(this.getCustomData().length>0){return r.getText("RATING_INDICATOR_SUBTITLE",[s,this.data("Subtitle")]);}else{var S=s>1?r.getText("RATING_INDICATOR_SUBTITLE_LABEL_PLURAL"):r.getText("RATING_INDICATOR_SUBTITLE_LABEL");return r.getText("RATING_INDICATOR_SUBTITLE",[s,S]);}}},buildRatingIndicatorFooterExpression:function(d){var p,t;var b=function(P){var s=sap.fe.templates.ObjectPage.AnnotationHelper.trimCurlyBraces(P);var a="{path: '"+s+"'}";return a;};p=b(d.Value.$Path);t=d.TargetValue&&(d.TargetValue.$Path||d.TargetValue.$Decimal);p+=(", "+b(t));var f="{ parts: ["+p+"], formatter: 'sap.fe.templates.ObjectPage.AnnotationHelper.formatRatingIndicatorFooterText' }";return f;},formatRatingIndicatorFooterText:function(v,t){if(v){var r=this.getModel("i18n").getResourceBundle();if(t){return r.getText("RATING_INDICATOR_FOOTER",[v,t]);}else if(this.getCustomData().length>0){return r.getText("RATING_INDICATOR_FOOTER",[v,this.data("Footer")]);}else{var R=sap.m.RatingIndicator.getMetadata().getPropertyDefaults().maxValue;return r.getText("RATING_INDICATOR_FOOTER",[v,R]);}}}};})();
