/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2018 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/data/MeasureSemantics','sap/chart/coloring/CriticalityType','sap/chart/ChartLog','sap/chart/ColoringType','sap/chart/coloring/criticality/Criticality','sap/chart/utils/ChartUtils'],function(C,c,M,d,f,g,h,j){"use strict";var k=['sapUiChartPaletteQualitativeHue1','sapUiChartPaletteQualitativeHue2','sapUiChartPaletteQualitativeHue3','sapUiChartPaletteQualitativeHue4','sapUiChartPaletteQualitativeHue5','sapUiChartPaletteQualitativeHue6','sapUiChartPaletteQualitativeHue7','sapUiChartPaletteQualitativeHue8','sapUiChartPaletteQualitativeHue9','sapUiChartPaletteQualitativeHue10','sapUiChartPaletteQualitativeHue11','sapUiChartPaletteQualitativeHue12','sapUiChartPaletteQualitativeHue13','sapUiChartPaletteQualitativeHue14','sapUiChartPaletteQualitativeHue15','sapUiChartPaletteQualitativeHue16','sapUiChartPaletteQualitativeHue17','sapUiChartPaletteQualitativeHue18','sapUiChartPaletteQualitativeHue19','sapUiChartPaletteQualitativeHue20','sapUiChartPaletteQualitativeHue21','sapUiChartPaletteQualitativeHue22'],D=[['sapUiChartPaletteSequentialHue1','sapUiChartPaletteSequentialHue1Light2','sapUiChartPaletteSequentialHue1Dark1'],['sapUiChartPaletteSequentialHue2','sapUiChartPaletteSequentialHue2Light2','sapUiChartPaletteSequentialHue2Dark1']],S='sapUiChartPaletteSequentialNeutralDark2',l='sapUiChartPaletteSemanticNeutral',L={actual:'solid',projected:'dash',reference:'dot'},P={projected:'diagonalLightStripe',reference:'noFill'};var m=[d.Positive,d.Neutral,d.Critical,d.Negative];function r(a){var R={};if(a.getSemanticallyRelatedMeasures){var b=a.getSemanticallyRelatedMeasures();if(b){if(b.projectedValueMeasure){R.projected=b.projectedValueMeasure;}if(b.referenceValueMeasure){R.reference=b.referenceValueMeasure;}return R;}}return R;}function n(a,I){var b=a.reduce(function(b,e){b[e.getName()]={msr:e,sem:(e.getSemantics&&e.getSemantics())||"actual",rel:r(e)};return b;},{});jQuery.each(b,function(x,y){if(y.sem==="actual"){jQuery.each(y.rel,function(F,T){if(b[T]&&b[T].sem!==F){delete y.rel[F];var G=new f("error","Semantic Pattern",T+" shouldn't be used as "+F+" in semantic relation. ");G.display();}});}});if(I){for(var i=0;i<I.length;i++){var e=I[i];var R=r(e);if(R.projected&&R.reference&&b[R.projected]&&b[R.reference]){b[R.projected]={msr:e,sem:'projected',rel:{reference:R.reference}};}}}return b;}function o(e,i,x){var T=[],y=0,F;var G;if(!x){G=e.slice().sort(function(a,b){var H=i[a.getName()].sem,I=i[b.getName()].sem;if(H<I){return-1;}else if(H>I){return 1;}else{return e.indexOf(a)-e.indexOf(b);}});}else{G=jQuery.extend(true,{},e);}jQuery.each(G,function(a,b){var N=b.getName();if(!i[N]){return;}var H=i[N];var I={};var J;I[x?'actual':H.sem]=N;if(b.getLabel){J=b.getLabel();if(J){I.labels={};I.labels[H.sem]=J;}}I.index=y++;if(!x&&(H.sem==="actual"||H.sem==="projected")){if(H.rel.projected){if(i[H.rel.projected]){I.projected=H.rel.projected;if(i[H.rel.projected].msr.getLabel){J=i[H.rel.projected].msr.getLabel();if(J){I.labels=jQuery.extend(true,I.labels,{projected:J});}}delete i[H.rel.projected];}else{F=new f('error','Semantic Pattern',H.msr.getName()+' has an invalid projected semantic relation.');F.display();}}if(H.rel.reference){if(i[H.rel.reference]){I.reference=H.rel.reference;if(i[H.rel.reference].msr.getLabel){J=i[H.rel.reference].msr.getLabel();if(J){I.labels=jQuery.extend(true,I.labels,{reference:J});}}delete i[H.rel.reference];}else{F=new f('error','Semantic Pattern',H.msr.getName()+' has an invalid reference semantic relation.');F.display();}}delete i[N];}I.order=[M.Actual,M.Projected,M.Reference];T.push(I);});return T;}var p=function(a,b){if(!a.dataPointStyle){a=jQuery.extend(true,a,{"dataPointStyle":{"rules":[],others:null}});}a.dataPointStyle.rules.push(b);};var q=function(a,i,b){var e,x;if(a.indexOf('dual')===-1){x=k;e=k.length;}else{var y=(b==='valueAxis')?0:1;x=D[y];e=x.length;}return{actual:x[i%e],projected:x[i%e],reference:x[i%e]};};var s=function(T,a,b){if(T.projectedValueStartTime&&T.timeAxis&&a!==M.Reference){b=b||function(){return true;};var i=function(e){return e.hasOwnProperty(T.semanticMsrName);};if(a===M.Actual){return function(e){return b(e)&&i(e)&&(new Date(e[T.timeAxis]).getTime()<T.projectedValueStartTime);};}else if(a===M.Projected){return function(e){return b(e)&&i(e)&&(new Date(e[T.timeAxis]).getTime()>=T.projectedValueStartTime);};}}else{b=b||function(e){return e.hasOwnProperty(T[a]);};return b;}};var t=function(T,a,b,e){var i,x;if(a){if(T.iUnMentionedIndex==undefined){x=l;}else{i=C.assignUnmentionedColor(c.CRITICALITY.Neutral,e.unMentionedTuplesNumber);x=i[T.iUnMentionedIndex];}}else{if(b===M.Reference&&e.hasSingleReference){x=S;}else{i=q(e.chartType,T.index,T.valueAxisID);x=i[b];}}return x;};var u=function(a,T,b){var i=false;if(a.chartType.indexOf('combination')>-1){if(a.chartType.indexOf('timeseries')>-1){if(T.index!==0||T.valueAxisID!=='valueAxis'){i=true;}else{if(T.hasOwnProperty('actual')){if((!T.projectedValueStartTime&&b!=='actual')||b==='reference'){i=true;}}}}else{if(b!=='actual'){i=true;}}}return i;};var v=function(T,a,b,e,i){var x,y,F={},G;var H=T[b];var I;(a||[]).forEach(function(R){if(R.parsed.msr&&R.parsed.msr.getName()===H){y=R.parsed;I=R.type;}});var J=(T.labels&&T.labels[b])?T.labels[b]:H;if(T.semanticMsrName&&(b===M.Actual||b===M.Projected)){F[T.semanticMsrName]=J;}if(y){var K=m,N,O=0;if(a.Levels){K=a.Levels;N=c.GRADATION.SingleColorScheme[a.SingleColorScheme];O=K.length;}K.forEach(function(R,U){var V=y.callbacks[R];if(V){var Q=s(T,b,V[0]);var W=C.assignColor(N||c.CRITICALITY[R],O||V.length);if(a.Saturation==='DarkToLight'){W=W.reverse();}x=W[O===0?0:U];G={"color":x,"pattern":P[b]};if(j.CONFIG.lineChartType.indexOf(i.chartType)>-1){G.lineType=L[b];if(I==='Static'||I==='DelineatedMeasures'){G.lineColor=x;}}if(u(i,T,b)){if(b==='projected'){G.pattern='';}G.lineType=L[b];if(I==='Static'){G.lineColor=x;}}p(e,{"callback":Q,"properties":G,"displayName":y.legend[R],"dataName":F});}});}else{if(!a||a.bShowUnmentionedMsr){var Q=s(T,b);x=t(T,a,b,i);G={'color':x,"pattern":P[b]};if(j.CONFIG.lineChartType.indexOf(i.chartType)>-1){G.lineType=L[b];G.lineColor=x;}if(u(i,T,b)){if(b==='projected'){G.pattern='';}G.lineType=L[b];G.lineColor=x;}p(e,{"callback":Q,"properties":G,"displayName":J,"dataName":F});}}};var w=function(a){return a.reference&&(!(a.actual||a.projected));};var z=function(T,a,b,e){var i=(T.filter(function(x){return x.reference;}).length===1);var U=T.filter(function(x){return x.hasOwnProperty('iUnMentionedIndex');}).length;T.forEach(function(x){x.order.forEach(function(y){var N=true;if(e.indexOf('bullet')>-1){N=(y!==M.Reference||w(x));}if(x.hasOwnProperty(y)&&N){var F={chartType:e,hasSingleReference:i,unMentionedTuplesNumber:U};v(x,a,y,b,F);}});});};var A=function(a,b,i,x,y,F){i=i||{};var G=(i.type===g.Criticality&&i.subType==="MeasureValues"&&!(i.qualifiedSettings&&i.qualifiedSettings.bMBC));var H=i.type===g.Gradation&&i.subType==="DelineatedMeasures";var I={};if(!y){I.plotArea={dataPointStyle:null};}if(!F){I.legend={title:{text:null,visible:a.indexOf('waterfall')>-1?true:false}};}else{I.legend={};}var J,K=true;if((x&&B(b))||G||H){var N=G||H?i.qualifiedSettings:null;z(b,N,I.plotArea,a);jQuery.extend(true,I.legend,h.getLegendProps(N));}else if(i.ruleGenerator){try{var O=i.ruleGenerator();jQuery.extend(true,I,O.properties);J=O.colorScale;}catch(e){if(e instanceof f){e.display();}else{throw e;}}}if(J){K=false;}return{properties:I,scales:J?[J]:[],replaceColorScales:K};};function B(T){if(T){return T.some(function(a){return a.hasOwnProperty(M.Projected)||a.hasOwnProperty(M.Reference);});}return false;}function E(a,b){var e;var F;if(a){F=a.slice(0);F.sort(function(x,y){return x.index>y.index?1:-1;});}if(b.indexOf('combination')>-1&&a){var I=true;for(var i=0;i<F.length;i++){if(F[i].hasOwnProperty('projected')||F[i].hasOwnProperty('reference')){I=false;break;}}var G=[];var H=[];if(!I){F.forEach(function(T){T.order.forEach(function(x){if(T.hasOwnProperty(x)){if(T.valueAxisID==='valueAxis'){G.push((x==='actual')?"bar":"line");}else{H.push((x==='actual')?"bar":"line");}}});});}else{return;}e={'plotArea':{'dataShape':{'primaryAxis':G,'secondaryAxis':H}}};}return e;}return{getTuples:function(a,i,b){return o(a,n(a,i),b);},getSemanticVizSettings:A,hasSemanticRelation:B,getSemanticSettingsForCombination:E};});
