/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','./BaseController','sap/m/library','sap/ui/comp/library','./Util','sap/m/P13nSelectionPanel','sap/m/P13nItem','sap/m/P13nSelectionItem'],function(q,B,M,C,U,P,c,d){"use strict";var S=B.extend("sap.ui.comp.personalization.SelectionController",{constructor:function(i,s){B.apply(this,arguments);this.setType(sap.m.P13nPanelType.selection);this.setItemType(sap.m.P13nPanelType.selection+"Items");},metadata:{events:{afterSelectionModelDataChange:{}}}});S.prototype.getColumn2Json=function(o,s,i){return{columnKey:s,text:o.getLabel(),visible:o.getSelected()};};S.prototype.getColumn2JsonTransient=function(o,s,t,T){return{columnKey:s,text:t,href:o.getHref(),target:o.getTarget(),press:o.getPress()};};S.prototype.syncJson2Table=function(j){this.fireBeforePotentialTableChange();this.fireAfterPotentialTableChange();};S.prototype.getPanel=function(p){var t=this;return new P({titleLarge:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_SELECTION_TITLE"),items:{path:'$sapmP13nPanel>/transientData/selection/selectionItems',template:new c({columnKey:'{$sapmP13nPanel>columnKey}',href:'{$sapmP13nPanel>href}',target:'{$sapmP13nPanel>target}',text:'{$sapmP13nPanel>text}',press:'{$sapmP13nPanel>press}'})},selectionItems:{path:"$sapmP13nPanel>/controlDataReduce/selection/selectionItems",template:new d({columnKey:"{$sapmP13nPanel>columnKey}",selected:"{$sapmP13nPanel>visible}"})},beforeNavigationTo:this.setModelFunction(),changeSelectionItems:function(e){if(!e.getParameter("items")){return;}var j=t.createControlDataStructure();e.getParameter("items").forEach(function(m){j.selection.selectionItems.push({columnKey:m.columnKey,visible:m.selected});});t.setControlDataReduce2Model(j);}});};S.prototype.getChangeType=function(D,o){return this.getChangeData(D,o)?sap.ui.comp.personalization.ChangeType.ModelChanged:sap.ui.comp.personalization.ChangeType.Unchanged;};S.prototype.getChangeData=function(D,o){if(!o||!o.selection||!o.selection.selectionItems){return null;}var a={selection:U.copy(D.selection)};if(this._isSemanticEqual(D,o)){return null;}var t=[];a.selection.selectionItems.forEach(function(i){var I=U.getArrayElementByKey("columnKey",i.columnKey,o.selection.selectionItems);if(U.semanticEqual(i,I)){t.push(i);return;}for(var p in i){if(p==="columnKey"||!I){continue;}if(i[p]===I[p]){delete i[p];}}if(Object.keys(i).length<2){t.push(i);}});t.forEach(function(i){var I=U.getIndexByKey("columnKey",i.columnKey,a.selection.selectionItems);a.selection.selectionItems.splice(I,1);});return a;};S.prototype.getUnionData=function(D,o){var a=U.copy(D);if(!o||!o.selection||!o.selection.selectionItems){return a.selection?{selection:U.copy(a.selection)}:null;}if(!a||!a.selection||!a.selection.selectionItems){return{selection:U.copy(o.selection)};}var u=this.createControlDataStructure();a.selection.selectionItems.forEach(function(s){var b=U.getArrayElementByKey("columnKey",s.columnKey,o.selection.selectionItems);if(b){if(b.visible!==undefined){s.visible=b.visible;}}u.selection.selectionItems.push(s);});return u;};S.prototype._isSemanticEqual=function(D,o){var s=function(a,b){if(a.visible===true&&(b.visible===false||b.visible===undefined)){return-1;}else if((a.visible===false||a.visible===undefined)&&b.visible===true){return 1;}else if(a.visible===true&&b.visible===true){return 0;}else if((a.visible===false||a.visible===undefined)&&(b.visible===false||b.visible===undefined)){if(a.columnKey<b.columnKey){return-1;}else if(a.columnKey>b.columnKey){return 1;}else{return 0;}}};var e=U.copy(D.selection.selectionItems).sort(s);var f=U.copy(o.selection.selectionItems).sort(s);return!e.some(function(a,i){if(!U.semanticEqual(a,f[i])){return true;}});};return S;},true);
