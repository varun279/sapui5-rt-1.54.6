/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/ui/Device','sap/ui/model/json/JSONModel','sap/m/VBox','sap/m/SearchField','sap/m/RadioButton','sap/ui/core/TextAlign','sap/m/ScreenSize','sap/m/PopinDisplay','sap/m/Column','sap/m/Text','sap/m/Bar','sap/m/Table','sap/m/Page','sap/m/PlacementType','sap/m/ButtonType','sap/m/OverflowToolbar','sap/m/OverflowToolbarLayoutData','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/m/Button','sap/m/CheckBox','sap/m/Dialog','sap/m/Input','sap/m/Title','sap/m/Label','sap/m/ResponsivePopover','sap/m/SelectList','sap/m/ObjectIdentifier','sap/ui/comp/library','./EditableVariantItem','./VariantItem','sap/ui/core/InvisibleText','sap/ui/core/Control','sap/ui/core/Icon','sap/ui/core/Item','sap/ui/core/ValueState','sap/ui/core/VerticalAlign','sap/ui/layout/HorizontalLayout','sap/ui/layout/Grid'],function(q,D,J,V,S,R,T,a,P,C,b,B,c,d,f,g,O,h,j,k,l,m,n,I,o,L,p,r,s,t,E,u,v,w,x,y,z,A,H,G){"use strict";var F=w.extend("sap.ui.comp.variants.VariantManagement",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/variants/VariantManagement.designtime",properties:{initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},standardItemText:{type:"string",group:"Misc",defaultValue:null},industrySolutionMode:{type:"boolean",group:"Misc",defaultValue:false},useFavorites:{type:"boolean",group:"Misc",defaultValue:false},inErrorState:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Item",multiple:true,singularName:"item",deprecated:true},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,singularName:"variantItem"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},exe:{type:"boolean"},def:{type:"boolean"},global:{type:"boolean"},lifecyclePackage:{type:"string"},lifecycleTransportId:{type:"string"}}},manage:{parameters:{renamed:{type:"string[]"},deleted:{type:"string[]"},exe:{type:"object[]"},def:{type:"boolean"}}},select:{parameters:{key:{type:"string"}}}}},renderer:function(e,i){e.write("<div ");e.writeControlData(i);e.addClass("sapUiCompVarMngmt");e.writeClasses();var K=i.oResourceBundle.getText("VARIANT_MANAGEMENT_TRIGGER_TT");e.write(" title='"+K+"'");e.write(">");e.renderControl(i.oVariantLayout);e.write("</div>");}});F.STANDARD_NAME=sap.ui.comp.STANDARD_VARIANT_NAME;F.MAX_NAME_LEN=100;F.FAV_COLUMN=0;F.NAME_COLUMN=1;F.SHARE_COLUMN=2;F.DEF_COLUMN=3;F.EXEC_COLUMN=4;F.AUTHOR_COLUMN=5;F.prototype.init=function(){var e=this;this.STANDARDVARIANTKEY="*standard*";this.setStandardVariantKey(this.STANDARDVARIANTKEY);this.aRemovedVariants=[];this.aRenamedVariants=[];this.aRemovedVariantTransports=[];this.aExeVariants=[];this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.lastSelectedVariantKey=this._sStandardVariantKey;this.bVariantItemMode=false;this.oSelectedItem=null;this.sNewDefaultKey="";this.bManagementTableInitialized=false;this.sTransport=null;this.sPackage=null;this.aEvents=[];this.bEventRunning=false;this.oVariantSelectionPage=null;this.bManualVariantKey=false;this.bFireSelect=false;this.bExecuteOnSelectForStandardViaXML=false;this.bExecuteOnSelectForStandardByUser=null;this.bSupportExecuteOnSelectOnSandardVariant=false;this._bInnerControlsCreated=false;this._isVendorLayer=false;this.oModel=new J({enabled:false,selectedVariant:""});this.setModel(this.oModel,"save_enablement");this.oVariantInvisbletext=new v({text:{parts:[{path:'save_enablement>/selectedVariant'},{path:'save_enablement>/enabled'}],formatter:function(i,K){if(K){i=e.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT_MOD",[i]);}else{i=e.oResourceBundle.getText("VARIANT_MANAGEMENT_SEL_VARIANT",[i]);}return i;}}});this.oVariantText=new o(this.getId()+"-text",{text:"{save_enablement>/selectedVariant}"});this._setStandardText();this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtTitle");this.oVariantText.addStyleClass("sapMTitleStyleH4");if(D.system.phone){this.oVariantText.addStyleClass("sapUICompVarMngmtTextPhoneMaxWidth");}else{this.oVariantText.addStyleClass("sapUICompVarMngmtTextMaxWidth");}this.oVariantModifiedText=new o(this.getId()+"-modified",{visible:"{save_enablement>/enabled}"});this.oVariantModifiedText.setText("*");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtModified");this.oVariantModifiedText.addStyleClass("sapMTitleStyleH4");this.oVariantPopoverTrigger=new l(this.getId()+"-trigger",{icon:"sap-icon://slim-arrow-down",type:g.Transparent});this.oVariantPopoverTrigger.addAriaLabelledBy(this.oVariantInvisbletext);this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtTriggerBtn");this.oVariantPopoverTrigger.addStyleClass("sapMTitleStyleH4");this.oVariantLayout=new H({content:[this.oVariantText,this.oVariantModifiedText,this.oVariantPopoverTrigger,this.oVariantInvisbletext]});this.oVariantLayout.addStyleClass("sapUICompVarMngmtLayout");this.addDependent(this.oVariantLayout);};F.prototype._columnVisibilityManagementTable=function(e,i){if(!this.bManagementTableInitialized){return;}if(this.oManagementTable){var K=this.oManagementTable.getColumns();if(K&&K.length>=e){K[e].setVisible(i);}}};F.prototype.setUseFavorites=function(e){this.setProperty("useFavorites",e);this._columnVisibilityManagementTable(F.FAV_COLUMN,e);};F.prototype.setShowShare=function(e){this.setProperty("showShare",e);this._columnVisibilityManagementTable(F.SHARE_COLUMN,e);};F.prototype.setShowSetAsDefault=function(e){this.setProperty("showSetAsDefault",e);this._columnVisibilityManagementTable(F.DEF_COLUMN,e);};F.prototype.setShowExecuteOnSelection=function(e){this.setProperty("showExecuteOnSelection",e);this._columnVisibilityManagementTable(F.EXEC_COLUMN,e);};F.prototype.setStandardItemText=function(N){this.setProperty("standardItemText",N);var i=this._getSelectedItem();if(!i||(i.getKey()===this.getStandardVariantKey())){this.oModel.setProperty("/selectedVariant",N);}};F.prototype._triggerSave=function(){var e=this._createEvent("variantSaveAs",this._handleVariantSaveAs);this._addEvent(e);};F.prototype._checkNameValidity=function(i,e,M){var K=false;if(M&&this._getVariantNamesAndKeys){var N=this._getVariantNamesAndKeys();var Q=M.getItems();Q.forEach(function(U){var W=U.getCells()[F.NAME_COLUMN];var X=U.getKey();if(W.getValue&&N.hasOwnProperty(W.getValue())&&(N[W.getValue()]!==X)){W.setValueState(z.Error);W.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_DUPLICATE"));K=true;}}.bind(this));}return K;};F.prototype._checkVariantNameConstraints=function(i,e,M){var K=false;if(!i){return;}var N=i.getValue().trim();if(!this._checkIsDuplicate(i,N,this.oManagementTable)){if(N===""){i.setValueState(z.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));}else if(N.indexOf('{')>-1){i.setValueState(z.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NOT_ALLOWED_CHAR",["{"]));}else if(N.length>F.MAX_NAME_LEN){i.setValueState(z.Error);i.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_MAX_LEN",[F.MAX_NAME_LEN]));}else{i.setValueState(z.None);i.setValueStateText(null);}}if(e){if(i.getValueState()!==z.Error){this._checkIsDuplicate(i,N,M);}if(M&&this._getVariantNamesAndKeys){K=this._checkNameValidity(i,N,M);}if(K||(i.getValueState()===z.Error)||this._anyInErrorState(M)){e.setEnabled(false);}else{e.setEnabled(true);}}};F.prototype._anyInErrorState=function(M,e){var K,N,i;if(M){K=M.getItems();if(K){for(i=0;i<K.length;i++){N=K[i].getCells()[F.NAME_COLUMN];if(e&&(e===N)){continue;}if(N&&N.getValueState&&(N.getValueState()===z.Error)){if(this._checkIsDuplicate(N,N.getValue(),M)){return true;}}}}}return false;};F.prototype._checkIsDuplicate=function(i,e,M){var K=this._isDuplicate(i,e,M);if(K){i.setValueState(z.Error);i.setValueStateText(this.oResourceBundle.getText(e?"VARIANT_MANAGEMENT_ERROR_DUPLICATE":"VARIANT_MANAGEMENT_ERROR_EMPTY"));}else{i.setValueState(z.None);i.setValueStateText(null);}return K;};F.prototype._isDuplicate=function(i,e,M){if(M){return this._isDuplicateManaged(i,e,M);}else{return this._isDuplicateSaveAs(e);}};F.prototype._isDuplicateManaged=function(e,K,M){var N,Q,i;if(M){N=M.getItems();if(N&&(N.length>0)){for(i=0;i<N.length;i++){Q=N[i].getCells()[F.NAME_COLUMN];if(Q===e){continue;}if(Q){if(Q.getValue&&(K===Q.getValue().trim())){return true;}else if(Q.getText&&(K===Q.getText().trim())){return true;}else if(Q.getTitle&&(K===Q.getTitle().trim())){return true;}}}}else{if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false;}}}return false;};F.prototype._isDuplicateSaveAs=function(e){var i=e.trim();if(!i){return true;}var K=this._determineStandardVariantName();if(K===i){if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey){return false;}return true;}var M=this._getItems();for(var N=0;N<M.length;N++){K=M[N].getText().trim();if(K===i){return true;}}return false;};F.prototype._createSaveDialog=function(){var e=this;var i=this.oInputName?this.oInputName.getValue():"";this.oSaveSave.setEnabled(!this._isDuplicate(this.oInputName,i));if(!this.oSaveDialog){this.oSaveDialog=new n(this.getId()+"-savedialog",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEDIALOG"),beginButton:this.oSaveSave,endButton:new l(this.getId()+"-variantcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){e._bSaveCanceled=true;e.oSaveDialog.close();}}),content:[this.oLabelName,this.oInputName,this.oLabelKey,this.oInputKey,this.oSaveDialogOptionsGrid],stretch:D.system.phone});this.oSaveDialog.setParent(this);this.oSaveDialog.addStyleClass("sapUiPopupWithPadding");this.oSaveDialog.addStyleClass("sapUiCompVarMngmtSaveDialog");}};F.prototype._createManagementDialog=function(){var e=this;if(!this.oManagementDialog){this.oManagementDialog=new n(this.getId()+"-managementdialog",{beginButton:this.oManagementSave,endButton:new l(this.getId()+"-managementcancel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){e.aRemovedVariants=[];e.oManagementDialog.close();}}),content:[this.oManagementTable],stretch:D.system.phone,afterClose:function(){if(e.bFireSelect==true){e.bFireSelect=false;setTimeout(function(){e._fireSelectAsync();},0);}}});this.oManagementDialog.setParent(this);this.oManagementDialog.setTitle(this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGEDIALOG"));var i=new B();this.oManageDialogSearchField=new S();this.oManageDialogSearchField.attachLiveChange(function(K){this._triggerSearchInManageDialog(K);}.bind(this));i.addContentRight(this.oManageDialogSearchField);this.oManagementDialog.setSubHeader(i);}};F.prototype._handleArrowUpDown=function(i,K){var M=null;var N=this;i.attachBrowserEvent("keydown",function(e){if(e.which===38){if(N.oVariantSelectionPage.getShowSubHeader()){M=document.activeElement.id;}}});i.attachBrowserEvent("keyup",function(e){if(e.which===38){if(M&&(M===document.activeElement.id)){var Q=i.getItems();if(Q&&Q.length>0){var U=sap.ui.getCore().byId(M);if(U===Q[0]){K.focus();}}}M=null;}});K.attachBrowserEvent("keyup",function(e){if(e.which===40){var Q=i.getItems();if(Q&&Q.length>0){Q[0].focus();}}});};F.prototype._triggerSearch=function(e){if(!e){return;}var i=e.getParameters();if(!i){return;}this._restoreCompleteList();var K=i.newValue?i.newValue:"";this._triggerSearchByValue(K.toLowerCase());};F.prototype._triggerSearchByValue=function(e){var i,K,M;this.oSelectedVariantItemKey=null;M=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(M&&(M.getText().toLowerCase().indexOf(e)<0)){if(this.getSelectionKey()===K){this.oSelectedVariantItemKey=K;}this.oVariantList.removeItem(M);M.destroy();}var N=this._getItems();for(var Q=0;Q<N.length;Q++){i=N[Q].getText();if(i.toLowerCase().indexOf(e)<0){K=N[Q].getKey();M=this.oVariantList.getItemByKey(K);if(M){if(this.getSelectionKey()===K){this.oSelectedVariantItemKey=K;}this.oVariantList.removeItem(M);M.destroy();}}}};F.prototype._triggerSearchInManageDialog=function(e){var i,N,K="",M,Q;if(!e){return;}var U=e.getParameters();if(!U){return;}i=U.newValue?U.newValue.toLowerCase():"";if(this.oManagementTable){var W=this.oManagementTable.getItems();W.forEach(function(X){N=true;K="";Q=X.getCells();if(Q&&Q[F.NAME_COLUMN]){M=Q[F.NAME_COLUMN];if(M.getTitle){K=M.getTitle();}else if(M.getValue){K=M.getValue();}if(K.toLowerCase().indexOf(i)>=0){N=false;}}if(N&&Q&&Q[F.AUTHOR_COLUMN]){M=Q[F.AUTHOR_COLUMN];if(M.getText){K=M.getText();if(K.toLowerCase().indexOf(i)>=0){N=false;}}}X.setVisible(!N);});}};F.prototype._considerItem=function(i,e){if(this.getUseFavorites()&&!i){if(this._isIndustrySolutionModeAndVendorLayer()){return true;}if(e.getFavorite&&e.getFavorite()){return true;}return false;}return true;};F.prototype._restoreCompleteList=function(i){var e,K,M,N;this.oVariantList.destroyItems();N=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(!N){N=this._createStandardVariantListItem();if(N){if(this._considerItem(i,N)){this.oVariantList.insertItem(N,0);}else{N.destroy();}}}if(N){if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===N.getKey()){this.oVariantList.setSelectedItem(N);this.oSelectedVariantItemKey=null;}}else{if(this.getSelectionKey()==N.getKey()||this.getSelectionKey()===null){this.oVariantList.setSelectedItem(N);}}}M=this._getItems();M.sort(this._compareItems);for(e=0;e<M.length;e++){K=M[e];if(!this._considerItem(i,K)){continue;}if(K.getKey()===this.getStandardVariantKey()){continue;}N=this.oVariantList.getItemByKey(K.getKey());if(!N){N=this._createVariantListItem(K,e);this.oVariantList.addItem(N);}if(this.oSelectedVariantItemKey){if(this.oSelectedVariantItemKey===N.getKey()){this.oVariantList.setSelectedItem(N);this.oSelectedVariantItemKey=null;}}else{if(this.getSelectionKey()==N.getKey()){this.oVariantList.setSelectedItem(N);}}}};F.prototype._determineStandardVariantName=function(){var e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");if(this.bVariantItemMode===false){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT");}if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){e=this.getStandardItemText();}}return e;};F.prototype._createStandardVariantListItem=function(){var i,e=null;var K=this._determineStandardVariantName();if((this.bVariantItemMode===true)||(this.bVariantItemMode===false&&(this.getSelectionKey()===this.getStandardVariantKey()||this.getSelectionKey()===null))){e=new u(this.oVariantPopoverTrigger.getId()+"-item-standard",{key:this.getStandardVariantKey(),readOnly:true,executeOnSelection:this.getExecuteOnSelectForStandardVariant()});e.setText(K);if(this._isIndustrySolutionModeAndVendorLayer()&&this.bVariantItemMode){e.setGlobal(true);e.setReadOnly(false);}if(this.getStandardVariantKey()!==this.STANDARDVARIANTKEY){i=this.getItemByKey(this.getStandardVariantKey());if(i){this._setVariantListItemProperties(i,e);if(i.getFavorite&&!i.getFavorite()&&(this.getCurrentVariantId()===this.getStandardVariantKey())){e.setFavorite(true);}}}else{e.setAuthor("SAP");e.setReadOnly(true);e.setFavorite(this.getStandardFavorite());}}return e;};F.prototype._createVariantListItem=function(i,e){var K=new u(this.oVariantPopoverTrigger.getId()+"-item-"+e,{key:i.getKey(),text:i.getText()});this._setVariantListItemProperties(i,K);return K;};F.prototype._setVariantListItemProperties=function(i,e){if(i.getReadOnly){e.setReadOnly(i.getReadOnly());}if(i.getExecuteOnSelection){e.setExecuteOnSelection(i.getExecuteOnSelection());}if(i.getGlobal){e.setGlobal(i.getGlobal());}if(i.getLifecyclePackage){e.setLifecyclePackage(i.getLifecyclePackage());}if(i.getLifecycleTransportId){e.setLifecycleTransportId(i.getLifecycleTransportId());}if(i.getNamespace){e.setNamespace(i.getNamespace());}if(i.getAccessOptions){e.setAccessOptions(i.getAccessOptions());}if(i.getLabelReadOnly){e.setLabelReadOnly(i.getLabelReadOnly());}if(i.getAuthor){e.setAuthor(i.getAuthor());}if(i.getFavorite){e.setFavorite(i.getFavorite());}};F.prototype.exit=function(){if(this.oSearchField){this.oSearchField.destroy();this.oSearchField=undefined;}if(this.oManageDialogSearchField){this.oManageDialogSearchField.destroy();this.oManageDialogSearchField=undefined;}if(this.oVariantManage){this.oVariantManage.destroy();this.oVariantManage=undefined;}if(this.oVariantSave){this.oVariantSave.destroy();this.oVariantSave=undefined;}if(this.oVariantList){this.oVariantList.destroy();this.oVariantList=undefined;}if(this.oInputName){this.oInputName.destroy();this.oInputName=undefined;}if(this.oLabelName){this.oLabelName.destroy();this.oLabelName=undefined;}if(this.oDefault){this.oDefault.destroy();this.oDefault=undefined;}if(this.oSaveSave){this.oSaveSave.destroy();this.oSaveSave=undefined;}if(this.oSaveDialog){this.oSaveDialog.destroy();this.oSaveDialog=undefined;}if(this.oManagementTable){this.oManagementTable.destroy();this.oManagementTable=undefined;}if(this.oManagementSave){this.oManagementSave.destroy();this.oManagementSave=undefined;}if(this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined;}if(this.oVariantText){this.oVariantText.destroy();this.oVariantText=undefined;}if(this.oVariantPopoverTrigger){this.oVariantPopoverTrigger.destroy();this.oVariantPopoverTrigger=undefined;}if(this.oVariantLayout){this.oVariantLayout.destroy();this.oVariantLayout=undefined;}if(this.oVariantPopOver){this.oVariantPopOver.destroy();this.oVariantPopOver=undefined;}if(this.oVariantSaveAs){this.oVariantSaveAs.destroy();this.oVariantSaveAs=undefined;}if(this.oShare){this.oShare.destroy();this.oShare=undefined;}if(this.oExecuteOnSelect){this.oExecuteOnSelect.destroy();this.oExecuteOnSelect=undefined;}if(this.oCreateTile){this.oCreateTile.destroy();this.oCreateTile=undefined;}if(this.oSaveDialogOptionsGrid){this.oSaveDialogOptionsGrid.destroy();this.oSaveDialogOptionsGrid=undefined;}if(this.oVariantSelectionPage){this.oVariantSelectionPage.destroy();this.oVariantSelectionPage=undefined;}if(this.oErrorVariantPopOver){this.oErrorVariantPopOver.destroy();this.oErrorVariantPopOver=undefined;}if(this.oInputKey){this.oInputKey.destroy();this.oInputKey=undefined;}if(this.oLabelKey){this.oLabelKey.destroy();this.oLabelKey=undefined;}if(this.oModel){this.oModel.destroy();this.oModel=undefined;}};F.prototype.addItem=function(i){i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.addAggregation("items",i,false);var _=this.getInitialSelectionKey();this._setSelection(i,_);this._setStandardText();return this;};F.prototype.insertItem=function(i,e){var _=e;i=this.validateAggregation("items",i,true);this.bVariantItemMode=false;this.insertAggregation("items",i,_);var K=this.getInitialSelectionKey();this._setSelection(i,K);this._setStandardText();return this;};F.prototype.removeItem=function(i){i=this.removeAggregation("items",i);return i;};F.prototype.removeAllItems=function(){var e=this.removeAllAggregation("items");this._setSelectedItem(null);return e;};F.prototype.destroyItems=function(){this.destroyAggregation("items");this._setSelectedItem(null);return this;};F.prototype._getItems=function(){if(this.bVariantItemMode){return this.getVariantItems();}else{return this.getItems();}};F.prototype._removeItem=function(i){if(this.bVariantItemMode){return this.removeVariantItem(i);}else{return this.removeItem(i);}};F.prototype.getItemByKey=function(K){var i=this._getItems();for(var e=0;e<i.length;e++){if(K==i[e].getKey()){return i[e];}}return null;};F.prototype.addVariantItem=function(e){e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.addAggregation("variantItems",e,false);var _=this.getInitialSelectionKey();this._setSelection(e,_);this._setStandardText();return this;};F.prototype.insertVariantItem=function(e,i){var _=i;e=this.validateAggregation("variantItems",e,true);this.bVariantItemMode=true;this.insertAggregation("variantItems",e,_);var K=this.getInitialSelectionKey();this._setSelection(e,K);this._setStandardText();return this;};F.prototype._setSelectedItem=function(i){this.oSelectedItem=i;if(i!=null&&i.getKey()!=this.getStandardVariantKey()){this._setVariantText(i.getText());}else{this._setStandardText();}};F.prototype._getSelectedItem=function(){return this.oSelectedItem;};F.prototype.setInitialSelectionKey=function(K){this.setProperty("initialSelectionKey",K,true);this._setSelectionByKey(K);return this;};F.prototype.setEnabled=function(e){this.setProperty("enabled",e,false);if(!e){this.oVariantText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtClickable");this.oVariantText.addStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtDisabled");}else{this.oVariantText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantModifiedText.removeStyleClass("sapUICompVarMngmtDisabled");this.oVariantText.addStyleClass("sapUICompVarMngmtClickable");this.oVariantModifiedText.addStyleClass("sapUICompVarMngmtClickable");}return this;};F.prototype.getFocusDomRef=function(){if(this.oVariantPopoverTrigger&&this.getEnabled()){return this.oVariantPopoverTrigger.getFocusDomRef();}};F.prototype._setSelection=function(i,K){if(i.getKey()===K){this._setSelectedItem(i);this.fireSelect({key:K});}};F.prototype.addStyleClass=function(e){if(w.prototype.addStyleClass){w.prototype.addStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.addStyleClass(e);}if(this.oSaveDialog){this.oSaveDialog.addStyleClass(e);}if(this.oManagementDialog){this.oManagementDialog.addStyleClass(e);}};F.prototype.removeStyleClass=function(e){if(w.prototype.addStyleClass){w.prototype.removeStyleClass.apply(this,arguments);}if(this.oVariantPopOver){this.oVariantPopOver.removeStyleClass(e);}if(this.oSaveDialog){this.oSaveDialog.removeStyleClass(e);}if(this.oManagementDialog){this.oManagementDialog.removeStyleClass(e);}};F.prototype.clearVariantSelection=function(){this.setInitialSelectionKey(this.getStandardVariantKey());this._setSelectedItem(null);};F.prototype._setDialogCompactStyle=function(e,i){if(this._checkDialogCompactStyle(e)){i.addStyleClass("sapUiSizeCompact");}else{i.removeStyleClass("sapUiSizeCompact");}};F.prototype._checkDialogCompactStyle=function(e){if(e.$().closest(".sapUiSizeCompact").length>0){return true;}else{return false;}};F.prototype.getSelectionKey=function(){var K=null;var i=this._getSelectedItem();if(i!==null){K=i.getKey();}else if(this.bVariantItemMode){K=this.getStandardVariantKey();}else{K=null;}return K;};F.prototype._setSelectionByKey=function(K){var i=this._getItems();var e=false;if(i.length>0){for(var M=0;M<i.length;M++){if(i[M].getKey()===K){this._setSelectedItem(i[M]);e=true;break;}}}if(!e){this._setSelectedItem(null);}};F.prototype.replaceKey=function(e,N){var i=this._getItems();if(i.length>0){for(var K=0;K<i.length;K++){if(i[K].getKey()===e){i[K].setKey(N);if(this.getDefaultVariantKey()==e){this.setDefaultVariantKey(N);}if(this._getSelectedItem()===i[K]){this._setSelectedItem(null);}break;}}}};F.prototype._assignUser=function(K,U){var i=this._getItems();if(i.length>0){for(var e=0;e<i.length;e++){if(i[e].getKey()===K){if(i[e].setAuthor&&i[e].getAuthor&&!i[e].getAuthor()){i[e].setAuthor(U);}break;}}}};F.prototype.currentVariantSetModified=function(e){if(this.oModel){this.oModel.setProperty("/enabled",e);}};F.prototype.currentVariantGetModified=function(){return this.oModel.getProperty("/enabled");};F.prototype._delayedControlCreation=function(){var e=this;if(this._bInnerControlsCreated){return;}this._bInnerControlsCreated=true;this.oVariantManage=new l(this.getId()+"-manage",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:true,press:function(){e._openVariantManagementDialog();},layoutData:new h({priority:sap.m.OverflowToolbarPriority.High})});this.oVariantSave=new l(this.getId()+"-mainsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVE"),press:function(){var i=e._createEvent("variantSavePressed",e._variantSavePressed);e._addEvent(i);},enabled:false,layoutData:new h({priority:sap.m.OverflowToolbarPriority.Low})});this.oVariantSave.setModel(this.oModel);this.oVariantSaveAs=new l(this.getId()+"-saveas",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(){e._openSaveAsDialog();},layoutData:new h({priority:sap.m.OverflowToolbarPriority.Low})});this.oVariantList=new r(this.getId()+"-list",{itemPress:function(i){var K=null;if(i&&i.getParameters()){var M=i.getParameters().item;if(M){K=M.getKey();}}if(K){e.lastSelectedVariantKey=K;e._setSelectionByKey(K);e.oVariantPopOver.close();e.oModel.setProperty("/enabled",false);e.bFireSelect=true;}}});this.oVariantList.setNoDataText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_NODATA"));this.oSearchField=new S();this.oSearchField.attachLiveChange(function(i){e._triggerSearch(i);});this._handleArrowUpDown(this.oVariantList,this.oSearchField);this.oVariantSelectionPage=new d(this.getId()+"selpage",{subHeader:new j({content:[this.oSearchField]}),content:[this.oVariantList],footer:new O({content:[new k(this.getId()+"-spacer"),this.oVariantSave,this.oVariantSaveAs,this.oVariantManage]}),showSubHeader:false,showNavButton:false,showHeader:false});this.oVariantPopOver=new p(this.getId()+"-popover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),contentWidth:"400px",placement:f.Bottom,content:[this.oVariantSelectionPage],afterOpen:function(){e.bPopoverOpen=true;e._markSharedVariants();},afterClose:function(){if(e.bPopoverOpen){setTimeout(function(){if(e.bFireSelect==true){e.bFireSelect=false;e._fireSelectAsync();}e.bPopoverOpen=false;},200);}},contentHeight:"300px"});this.oVariantPopOver.setParent(this);this.oVariantPopOver.addStyleClass("sapUICompVarMngmtPopover");this.oInputName=new I(this.getId()+"-name",{liveChange:function(i){e._checkVariantNameConstraints(this,e.oSaveSave);}});this.oLabelName=new L(this.getId()+"-namelabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME"),required:true});this.oLabelName.setLabelFor(this.oInputName);this.oDefault=new m(this.getId()+"-default",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SETASDEFAULT"),enabled:true,visible:true,width:"100%"});this.oExecuteOnSelect=new m(this.getId()+"-execute",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),enabled:true,visible:false,width:"100%"});this.oCreateTile=new m(this.getId()+"-tile",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_CREATETILE"),enabled:true,visible:false,width:"100%"});this.oShare=new m(this.getId()+"-share",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARE"),enabled:true,visible:false,select:function(i){var K=e._createEvent("inputfieldChange",e._handleShareSelected);K.args.push(i);e._addEvent(K);},width:"100%"});this.oInputKey=new I(this.getId()+"-key",{liveChange:function(i){e._checkVariantNameConstraints(this);}});this.oLabelKey=new L(this.getId()+"-keylabel",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_KEY"),required:true});this.oLabelKey.setLabelFor(this.oInputKey);this.oSaveSave=new l(this.getId()+"-variantsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_OK"),press:function(){e._bSaveCanceled=false;e._triggerSave();},enabled:true});this.oSaveDialogOptionsGrid=new G({defaultSpan:"L12 M12 S12"});this.oManagementTable=new c(this.getId()+"-managementTable");this.oManagementSave=new l(this.getId()+"-managementsave",{text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_OK"),enabled:true,press:function(){var i=e._createEvent("managementSave",e._handleManageSavePressed);e._addEvent(i);}});};F.prototype._openInErrorState=function(){var i=this,K;if(!this.oErrorVariantPopOver){K=new V({fitContainer:true,alignItems:sap.m.FlexAlignItems.Center,items:[new x({size:"4rem",color:"lightgray",src:"sap-icon://message-error"}),new o({titleStyle:sap.ui.core.TitleLevel.H2,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT1")}),new sap.m.Text({textAlign:sap.ui.core.TextAlign.Center,text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_TEXT2")})]});K.addStyleClass("sapUICompVarMngmtErrorPopover");this.oErrorVariantPopOver=new p(this.getId()+"-errorpopover",{title:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"),contentWidth:"400px",placement:f.Bottom,content:[new d(this.getId()+"-errorselpage",{showSubHeader:false,showNavButton:false,showHeader:false,content:[K]})],afterOpen:function(){i.bPopoverOpen=true;},afterClose:function(){if(i.bPopoverOpen){setTimeout(function(){i.bPopoverOpen=false;},200);}},contentHeight:"300px"});this.oErrorVariantPopOver.attachBrowserEvent("keyup",function(e){if(e.which===32){this.oErrorVariantPopOver.close();}}.bind(this));}if(this.bPopoverOpen){return;}this.oErrorVariantPopOver.openBy(this.oVariantLayout);};F.prototype._openVariantSelection=function(){var i=null,e;if(this.getInErrorState()){this._openInErrorState();return;}this._delayedControlCreation();if(this.bPopoverOpen){return;}this.oVariantSave.setEnabled(false);if(this.bVariantItemMode===false&&this.getSelectionKey()!==null){this.oVariantSave.setEnabled(true);}i=this._getItems();if(i.length<9){this.oVariantSelectionPage.setShowSubHeader(false);}else{this.oVariantSelectionPage.setShowSubHeader(true);this.oSearchField.setValue("");}this._restoreCompleteList();if(this.currentVariantGetModified()){e=this.oVariantList.getItemByKey(this.getSelectionKey());if(e){if(!e.getReadOnly()||(this._isIndustrySolutionModeAndVendorLayer()&&(this.getStandardVariantKey()===e.getKey()))){this.oVariantSave.setEnabled(true);}}}this.oVariantSaveAs.setEnabled(true);if(this._isIndustrySolutionModeAndVendorLayer()&&this.bManualVariantKey&&(this.getStandardVariantKey()===this.STANDARDVARIANTKEY)){this.oVariantSave.setEnabled(false);this.oVariantSaveAs.setEnabled(true);}this._setDialogCompactStyle(this,this.oVariantPopOver);e=this.oVariantList.getSelectedItem();if(e){this.oVariantPopOver.setInitialFocus(e.getId());}this.oVariantPopOver.openBy(this.oVariantLayout);};F.prototype.handleOpenCloseVariantPopover=function(){if(!this.bPopoverOpen){this._openVariantSelection();}else if(this.oVariantPopOver&&this.oVariantPopOver.isOpen()){this.oVariantPopOver.close();}else if(this.getInErrorState()&&this.oErrorVariantPopOver&&this.oErrorVariantPopOver.isOpen()){this.oErrorVariantPopOver.close();}};F.prototype.onclick=function(e){if(this.getEnabled()){if(this.oVariantPopoverTrigger&&!this.bPopoverOpen){this.oVariantPopoverTrigger.focus();}this.handleOpenCloseVariantPopover();}};F.prototype.onkeydown=function(e){if(e.which===q.sap.KeyCodes.F4||e.which===q.sap.KeyCodes.SPACE||e.altKey===true&&e.which===q.sap.KeyCodes.ARROW_UP||e.altKey===true&&e.which===q.sap.KeyCodes.ARROW_DOWN){if(this.getEnabled()){this._openVariantSelection();}}};F.prototype._initalizeManagementTableColumns=function(){if(this.bManagementTableInitialized){return;}var e=new C({width:"3rem",visible:this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()});this.oManagementTable.addColumn(e);this.oManagementTable.addColumn(new C({header:new b({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_NAME")}),width:"14rem"}));this.oManagementTable.addColumn(new C({header:new b({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTTYPE")}),width:"8rem",demandPopin:true,popinDisplay:P.Inline,minScreenWidth:a.Tablet,visible:this.getShowShare()}));this.oManagementTable.addColumn(new C({header:new b({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT")}),width:"4rem",demandPopin:true,popinDisplay:P.Inline,minScreenWidth:a.Tablet,visible:this.getShowSetAsDefault()}));this.oManagementTable.addColumn(new C({header:new b({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT")}),width:"5.5rem",hAlign:T.Center,demandPopin:true,popinDisplay:P.Inline,minScreenWidth:"800px",visible:this.getShowExecuteOnSelection()}));this.oManagementTable.addColumn(new C({header:new b({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_AUTHOR")}),width:"8rem",demandPopin:true,popinDisplay:P.Inline,minScreenWidth:"900px"}));this.oManagementTable.addColumn(new C({width:"2rem",hAlign:T.Center}));this.bManagementTableInitialized=true;};F.prototype._initalizeSaveAsDialog=function(){this.oSaveDialogOptionsGrid.removeAllContent();this.oDefault.setVisible(this.getShowSetAsDefault());this.oShare.setVisible(this.getShowShare());this.oExecuteOnSelect.setVisible(this.getShowExecuteOnSelection());this.oCreateTile.setVisible(this.getShowCreateTile());if(this.getShowSetAsDefault()){this.oSaveDialogOptionsGrid.addContent(this.oDefault);}if(this.getShowShare()){this.oSaveDialogOptionsGrid.addContent(this.oShare);}if(this.getShowExecuteOnSelection()){this.oSaveDialogOptionsGrid.addContent(this.oExecuteOnSelect);}if(this.getShowCreateTile()){this.oSaveDialogOptionsGrid.addContent(this.oCreateTile);}};F.prototype.onAfterRendering=function(){this.oVariantText.$().off("mouseover").on("mouseover",function(){this.oVariantPopoverTrigger.addStyleClass("sapUICompVarMngmtTriggerBtnHover");}.bind(this));this.oVariantText.$().off("mouseout").on("mouseout",function(){this.oVariantPopoverTrigger.removeStyleClass("sapUICompVarMngmtTriggerBtnHover");}.bind(this));};F.prototype.onBeforeRendering=function(){var e=function(K){var W,X=0;for(var i=0;i<K.length;i++){W=K[i].$().width();if(W>X){X=W;}}return X;};if(this.oSaveDialogOptionsGrid&&this.oSaveDialog&&this.oSaveDialog.getVisible()){var K=this.oSaveDialogOptionsGrid.getContent();if(K&&K.length>0){var M=this.oSaveDialogOptionsGrid.$().width();var N=e(K);var Q=32;var U=12;if(!this._checkDialogCompactStyle(this.oSaveDialog)){Q=48;U=18;}if((Q+N+U)>M/2){this.oSaveDialogOptionsGrid.setDefaultSpan("L12 M12 S12");}}}};F.prototype._markSharedVariants=function(){var e,K,M=this._getItems();for(var i=0;i<M.length;i++){K=M[i];if(K.getGlobal&&K.getGlobal()){e=this.oVariantList.getItemByKey(K.getKey());if(e){var N=e.$();if(N){N.addClass("sapUiCompVarMngmtSharedVariant");}}}}};F.prototype._variantSavePressed=function(){var i=this._getSelectedItem();if(!i){if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY){i=new u({key:this.STANDARDVARIANTKEY,global:this._isIndustrySolutionModeAndVendorLayer()});i.setText(this._determineStandardVariantName());}else{i=this.getItemByKey(this.getStandardVariantKey());}}var e=false;if(this.getDefaultVariantKey()===i.getKey()){e=true;}if(i.getLifecyclePackage&&i.getGlobal()==true){var K=this;var M=function(Q,U){K.oVariantPopOver.close();K.sPackage=Q;K.sTransport=U;K.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e,global:(K._isIndustrySolutionModeAndVendorLayer()&&(K.getStandardVariantKey()===K.getStandardVariantKey())),lifecyclePackage:K.sPackage,lifecycleTransportId:K.sTransport});i.setLifecycleTransportId(K.sTransport);K.oModel.setProperty("/enabled",false);K._eventDone();};var N=function(Q){K.sTransport=null;K.sPackage=null;K._cancelAllEvents();};this._assignTransport(i,M,N,this.oVariantText);}else{this.oVariantPopOver.close();this.fireSave({name:i.getText(),overwrite:true,key:i.getKey(),def:e});this.oModel.setProperty("/enabled",false);this._eventDone();}};F.prototype._assignTransport=function(e,i,K,M){var N={type:"variant",name:"",namespace:""};N["package"]="";if(e!==null){N["package"]=e.getLifecyclePackage();N["name"]=e.getKey();N["namespace"]=e.getNamespace();}var _=function(X){var Y;var U;U=X.getParameters().selectedTransport;Y=X.getParameters().selectedPackage;i(Y,U);};var Q=function(X){K(X);};if(this.getLifecycleSupport()){var U=null;if(e){U=e.getLifecycleTransportId();}if(U!=null&&U.trim().length>0){i(N["package"],U);}else{var W=this._getTransportSelection();W.selectTransport(N,_,Q,this._checkDialogCompactStyle(M),M);}}else{i(N["package"],"");}};F.prototype._getTransportSelection=function(){if(this.getTransportSelection){return this.getTransportSelection();}else{return this._getFlTransportSelection();}};F.prototype._getFlTransportSelection=function(){if(!sap.ui.fl){sap.ui.getCore().loadLibrary('sap.ui.fl');}q.sap.require("sap.ui.fl.transport.TransportSelection");return new sap.ui.fl.transport.TransportSelection();};F.prototype.getDefaultVariantKey=function(){var e=this.getProperty("defaultVariantKey");if(e===""){if(this.bVariantItemMode){e=this.getStandardVariantKey();}}return e;};F.prototype._compareItems=function(e,i){var K=e.getText();var M=i.getText();var N=K.toUpperCase();var Q=M.toUpperCase();if(N==Q){if(K==M){return 0;}if(K<M){return-1;}if(K>M){return 1;}}if(N<Q){return-1;}if(N>Q){return 1;}};F.prototype._accessOptionsText=function(e){var M=null;switch(e){case"R":M=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");break;case"RD":M=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");break;default:M=null;}return M;};F.prototype._openSaveAsDialog=function(){this._initalizeSaveAsDialog();if(this._getSelectedItem()){this.oInputName.setValue(this._getSelectedItem().getText());}else{this.oInputName.setValue("");}this.oInputName.setEnabled(true);this.oInputName.setValueState(z.None);this.oInputName.setValueStateText(null);this.oDefault.setSelected(false);this.oShare.setSelected(false);this.oCreateTile.setSelected(false);this.oExecuteOnSelect.setSelected(false);if(this._isIndustrySolutionModeAndVendorLayer()){this.oInputName.setValue(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"));}this._createSaveDialog();this._setDialogCompactStyle(this,this.oSaveDialog);this.oVariantPopOver.close();this.sTransport=null;this.sPackage=null;if(this.bManualVariantKey){this.oInputKey.setVisible(true);this.oInputKey.setEnabled(true);this.oInputKey.setValueState(z.None);this.oInputKey.setValueStateText(null);this.oLabelKey.setVisible(true);}else{this.oInputKey.setVisible(false);this.oLabelKey.setVisible(false);}this.oSaveDialog.open();};F.prototype._checkManageItemNameChange=function(M){var e="";var i=null;var K=this;i=M.getCells()[F.NAME_COLUMN];e=i.getValue();e=e.trim();var N=M;var Q=N.getKey();this._checkVariantNameConstraints(i,this.oManagementSave,this.oManagementTable);if(i.getValueState()===z.Error){this._eventDone();return;}if(this.oVariantList.getItemByKey(Q).getText().trim()===e){this._eventDone();return;}if(N.getGlobal()){var U=function(X,Y){N.setLifecyclePackage(X);N.setLifecycleTransportId(Y);K._eventDone();};var W=function(X){var Y=K.oVariantList.getItemByKey(Q);i.setValue(Y.getText());K._cancelAllEvents();};this._createManagementDialog();this._assignTransport(N,U,W,this.oManagementDialog);}else{this._eventDone();}};F.prototype._handleManageSavePressed=function(){var N=this.oManagementTable.getItems();var i,e;var K=false;var M="";var Q=null;var U=0;var W=[];for(var X=0;X<N.length;X++){i=this.oVariantList.getItemByKey(N[X].getKey());e=N[X].getCells()[F.NAME_COLUMN];if(e&&e.getValue){M=e.getValue();}else if(e&&e.getTitle){M=e.getTitle();}M=M.trim();if(i.getText()!==M){this.aRenamedVariants.push({key:i.getKey(),name:M});Q=this.getItemByKey(N[X].getKey());Q.setText(M);if(Q.setLifecyclePackage){Q.setLifecyclePackage(N[X].getLifecyclePackage());Q.setLifecycleTransportId(N[X].getLifecycleTransportId());}if(this.lastSelectedVariantKey===i.getKey()){this._setVariantText(M);}}if(this.getUseFavorites()&&!this._isIndustrySolutionModeAndVendorLayer()){var Y=N[X].getKey();if(this._mFavoriteChanges&&this._mFavoriteChanges[Y]!==undefined){var Z=this._mFavoriteChanges[Y];if(Y===this.STANDARDVARIANTKEY){if(this.getStandardFavorite()!==Z){W.push({key:Y,visible:Z});this.setStandardFavorite(Z);}}else{Q=this.getItemByKey(N[X].getKey());if(Q&&i.getFavorite&&(i.getFavorite()!==Z)){W.push({key:Y,visible:Z});Q.setFavorite(Z);}}}}if(this.getShowExecuteOnSelection()&&i.getExecuteOnSelection&&i.getExecuteOnSelection()!=N[X].getCells()[F.EXEC_COLUMN].getSelected()){var $=N[X].getCells()[F.EXEC_COLUMN].getSelected();var _=this.getItemByKey(N[X].getKey());if(!_&&(this.getSupportExecuteOnSelectOnSandardVariant()&(N[X].getKey()===this.getStandardVariantKey()))){_=new u();}if(_&&_.setExecuteOnSelection){_.setExecuteOnSelection($);if(this.getSupportExecuteOnSelectOnSandardVariant()&(N[X].getKey()===this.getStandardVariantKey())){this._executeOnSelectForStandardVariantByUser($);}this.aExeVariants.push({key:i.getKey(),exe:$});if(_.setLifecyclePackage){_.setLifecyclePackage(N[X].getLifecyclePackage());_.setLifecycleTransportId(N[X].getLifecycleTransportId());}}}}if(this.oManagementDialog){this.oManagementDialog.close();}if(this.bVariantItemMode===false){if(this.getDefaultVariantKey()!=this.sNewDefaultKey){var a1=null;if(this.sNewDefaultKey==this.getStandardVariantKey()){a1=this.getItemByKey(this.getDefaultVariantKey());this.fireSave({name:a1.getText(),overwrite:true,key:a1.getKey(),def:false});}else{a1=this.getItemByKey(this.sNewDefaultKey);this.fireSave({name:a1.getText(),overwrite:true,key:a1.getKey(),def:true});}}}if(this.sNewDefaultKey!=this.getDefaultVariantKey()){this.setDefaultVariantKey(this.sNewDefaultKey);}for(U=0;U<this.aRemovedVariants.length;U++){i=this.getItemByKey(this.aRemovedVariants[U]);for(var iE=0;iE<this.aRemovedVariantTransports.length;iE++){if(this.aRemovedVariants[U]===this.aRemovedVariantTransports[iE].key){var c1=this.aRemovedVariantTransports[iE];if(i.setLifecyclePackage){i.setLifecycleTransportId(c1.transport);}break;}}}this.fireManage({renamed:this.aRenamedVariants,deleted:this.aRemovedVariants,exe:this.aExeVariants,def:this.getDefaultVariantKey(),fav:W});for(U=0;U<this.aRemovedVariants.length;U++){i=this.getItemByKey(this.aRemovedVariants[U]);if(i){this._removeItem(i);i.destroy();}if(this.lastSelectedVariantKey===this.aRemovedVariants[U]){K=true;this._setSelectedItem(null);this.oModel.setProperty("/enabled",false);}}if(K){this.bFireSelect=true;}this._eventDone();};F.prototype._createEvent=function(N,e){var i={name:N,fFunc:e,args:[]};return i;};F.prototype._handleNextEvent=function(){if(this.aEvents.length>0){if(!this.bEventRunning){this.bEventRunning=true;var e=this.aEvents.pop();e.fFunc.apply(this,e.args);}}};F.prototype._addEvent=function(e){this.aEvents.push(e);this._handleNextEvent();};F.prototype._cancelAllEvents=function(){this.aEvents=[];this.bEventRunning=false;};F.prototype._eventDone=function(){this.bEventRunning=false;this._handleNextEvent();};F.prototype._handleManageExecuteOnSelectionChanged=function(e){var i=this;var M=e.getParent();if(M.getGlobal()){var K=function(Q,U){M.setLifecyclePackage(Q);M.setLifecycleTransportId(U);i._eventDone();};var N=function(Q){e.setSelected(!e.getSelected());i._cancelAllEvents();};this._createManagementDialog();this._assignTransport(M,K,N,this.oManagementDialog);}else{this._eventDone();}};F.prototype._handleManageDeletePressed=function(e){var i=this,K;var M=function(){var K=null,X=i.oManagementTable.getItems();X.some(function(Y){if(Y.getKey()===i.getStandardVariantKey()){K=Y;return true;}});return K;};if(!this._anyInErrorState(this.oManagementTable,e.getParent().getCells()[F.NAME_COLUMN])){this.oManagementSave.setEnabled(true);}K=M();var N=e.getParent();if(N.getGlobal()){var Q=function(X,Y){var Z=N.getKey();i.aRemovedVariants.push(Z);i.oManagementTable.removeItem(N);if(i.getShowSetAsDefault()){if((N.getKey()===i.sNewDefaultKey)){if(K){K.getCells()[F.DEF_COLUMN].setSelected(true);K.getCells()[F.DEF_COLUMN].fireSelect({selected:true});}else{i.setStandardVariantKey(i.STANDARDVARIANTKEY);}i.sNewDefaultKey=i.getStandardVariantKey();}}N.destroy();var $={key:Z,transport:Y};i.aRemovedVariantTransports.push($);i._eventDone();};var U=function(X){i._cancelAllEvents();};this._createManagementDialog();this._assignTransport(N,Q,U,this.oManagementDialog);}else{this.aRemovedVariants.push(N.getKey());this.oManagementTable.removeItem(N);if(this.getShowSetAsDefault()){if(N.getKey()===this.sNewDefaultKey){if(K){K.getCells()[F.DEF_COLUMN].setSelected(true);K.getCells()[F.DEF_COLUMN].fireSelect({selected:true});}this.sNewDefaultKey=this.getStandardVariantKey();}}N.destroy();this._eventDone();}var W=sap.ui.getCore().byId(this.getId()+"-managementcancel");if(W){W.focus();}};F.prototype._handleShareSelected=function(e){var i=this;if(e.getParameters().selected){var K=function(N,Q){i.sTransport=Q;i.sPackage=N;i._eventDone();};var M=function(N){i.oShare.setSelected(false);i.sTransport=null;i.sPackage=null;i._cancelAllEvents();};this._createSaveDialog();this._assignTransport(null,K,M,this.oSaveDialog);}else{this.sTransport=null;this.sPackage=null;this._eventDone();}};F.prototype._handleVariantSaveAs=function(){var K="SV"+new Date().getTime();var N=this.oInputName.getValue();var M=this.oInputKey.getValue();var e="";var i="";var Q=false;var U=false;var W=null;N=N.trim();if(N==""){this.oInputName.setValueState(z.Error);this.oInputName.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}M=M.trim();if(this.bManualVariantKey&&M==""){this.oInputKey.setValueState(z.Error);this.oInputKey.setValueStateText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));this._cancelAllEvents();return;}if(this.bManualVariantKey){K=M;}if(this.oSaveDialog){this.oSaveDialog.close();}if(this.oExecuteOnSelect!==null){Q=this.oExecuteOnSelect.getSelected();}if(this.oCreateTile!==null){U=this.oCreateTile.getSelected();}if(this.bVariantItemMode){W=new u({key:K,readOnly:false,executeOnSelection:Q,global:this.oShare.getSelected(),lifecycleTransportId:this.sTransport,lifecyclePackage:this.sPackage});W.setText(N);this.addVariantItem(W);this._setSelectedItem(W);}else{W=new y({key:K});W.setText(N);this.addItem(W);this._setSelectedItem(W);}if(this.oDefault.getSelected()){this.setDefaultVariantKey(K);}if(this.oShare.getSelected()){i=this.sPackage;e=this.sTransport;}this.fireSave({name:N,overwrite:false,def:this.oDefault.getSelected(),key:K,exe:this.oExecuteOnSelect.getSelected(),tile:U,global:this.oShare.getSelected(),lifecyclePackage:i,lifecycleTransportId:e});this.oModel.setProperty("/enabled",false);this._eventDone();};F.prototype.setBackwardCompatibility=function(e){this._setBackwardCompatibility(e);};F.prototype._setBackwardCompatibility=function(e){if(this.getItems().length===0&&this.getVariantItems().length===0){this.bVariantItemMode=!e;}this._setStandardText();};F.prototype._setStandardText=function(){var K=this.getSelectionKey();if(K===null||K===this.getStandardVariantKey()){if(this.bVariantItemMode==false){this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"));}else{this._setVariantText(this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD"));}if(this.getStandardItemText()!==null&&this.getStandardItemText()!=""){this._setVariantText(this.getStandardItemText());}}};F.prototype._setVariantText=function(e){var M,i=this.extractBindingInfo(e),K=e;if((typeof i==="object")&&i.model&&i.path){M=this.getModel(i.model);if(M){K=M.getProperty(i.path);}}this.oModel.setProperty("/selectedVariant",K);};F.prototype._getVariantText=function(e){return this.oModel.getProperty("/selectedVariant");};F.prototype._updateVariantInvisibletext=function(e,i){if(i){e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_MODIFIED",[e]);}return e;};F.prototype._setFavoriteIcon=function(i,e){i.setSrc(e?"sap-icon://favorite":"sap-icon://unfavorite");i.setTooltip(this.oResourceBundle.getText(e?"VARIANT_MANAGEMENT_FAV_DEL_TOOLTIP":"VARIANT_MANAGEMENT_FAV_ADD_TOOLTIP"));};F.prototype._isFavoriteSelected=function(i){return i.getSrc()==="sap-icon://unfavorite";};F.prototype._openVariantManagementDialog=function(){var i;var e=null;var K=0;var M;var N;var Q;var U;var W;var X;var Y;var Z;var $,_,a1,b1,c1,d1;var e1=this;this._mFavoriteChanges={};this.oManagementSave.setEnabled(true);this.oManagementTable.destroyItems();$=function(f1){e1._checkVariantNameConstraints(this,e1.oManagementSave,e1.oManagementTable);};_=function(f1){var h1=e1._createEvent("inputfieldChange",e1._checkManageItemNameChange);h1.args.push(this.getParent());e1._addEvent(h1);};c1=function(f1){var h1=e1._isFavoriteSelected(f1.oSource),i=this.getParent();if(i&&(e1.sNewDefaultKey!==i.getKey())){e1._mFavoriteChanges[i.getKey()]=h1;e1._setFavoriteIcon(f1.oSource,h1);}};a1=function(f1){var h1=(f1.getParameters().selected===true),i=this.getParent();if(i){if(h1){e1.sNewDefaultKey=i.getKey();e1._mFavoriteChanges[i.getKey()]=h1;}else{if(i.getFavorite&&e1._mFavoriteChanges.hasOwnProperty(i.getKey())&&e1._mFavoriteChanges[i.getKey()]!==i.getFavorite()){delete e1._mFavoriteChanges[i.getKey()];}}var i1=i.getCells()[F.FAV_COLUMN];if(i1&&i.getFavorite){if(h1){e1._setFavoriteIcon(i1,true);}else{if(e1._mFavoriteChanges[i.getKey()]!==undefined){e1._setFavoriteIcon(i1,e1._mFavoriteChanges[i.getKey()]);}else{e1._setFavoriteIcon(i1,i.getFavorite()===true);}}}}};b1=function(f1){var h1=e1._createEvent("executeOnSelectionChange",e1._handleManageExecuteOnSelectionChanged);h1.args.push(this);e1._addEvent(h1);};d1=function(f1){var h1=e1._createEvent("manageDeletePressed",e1._handleManageDeletePressed);h1.args.push(this);e1._addEvent(h1);};if(this.oManageDialogSearchField){this.oManageDialogSearchField.setValue("");}this._initalizeManagementTableColumns();this.sNewDefaultKey=this.getDefaultVariantKey();this._restoreCompleteList(true);if(this.oVariantList.getItems()[0].getKey()!==this.getStandardVariantKey()&&this.bVariantItemMode==false){i=new u(this.oVariantManage.getId()+"-item-standard",{key:this.getStandardVariantKey(),text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DEFAULT"),readOnly:true,executeOnSelection:false});this.oVariantList.insertItem(i,0);}if(this.getUseFavorites()){i=this.oVariantList.getItemByKey(this.getStandardVariantKey());if(i){this.oVariantList.removeItem(i);}}e=this.oVariantList.getItems();if(this.getUseFavorites()){e.sort(this._compareItems);if(i){this.oVariantList.insertItem(i);e.splice(0,0,i);}}for(var iH=0;iH<e.length;iH++){if(e[iH].getReadOnly()||e[iH].getLabelReadOnly()){var g1=e[iH].getAccessOptions();Z=this._accessOptionsText(g1);}else{Z=null;}if(e[iH].getReadOnly()){Z=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LAYER");}else if(e[iH].getLabelReadOnly()===true){Z=this.oResourceBundle.getText("VARIANT_MANAGEMENT_WRONG_LANGUAGE");}if(e[iH].getKey()===this.getStandardVariantKey()){Z=null;}M=new E(this.oVariantManage.getId()+"-edit-"+K,{key:e[iH].getKey(),global:e[iH].getGlobal(),lifecyclePackage:e[iH].getLifecyclePackage(),lifecycleTransportId:e[iH].getLifecycleTransportId(),namespace:e[iH].getNamespace(),labelReadOnly:e[iH].getLabelReadOnly(),author:e[iH].getAuthor(),favorite:e[iH].getFavorite(),vAlign:A.Middle});N=new x(this.oVariantManage.getId()+"-fav-"+K,{press:c1});N.addStyleClass("sapUICompVarMngmtFavColor");if(e[iH].getFavorite){this._setFavoriteIcon(N,e[iH].getFavorite());}M.addCell(N);if(e[iH].getKey()===this.getStandardVariantKey()||e[iH].getReadOnly()===true||e[iH].getLabelReadOnly()===true){N=new s(this.oVariantManage.getId()+"-text-"+K,{});N.setTitle(e[iH].getText());if(Z){N.setTooltip(Z);}}else{N=new I(this.oVariantManage.getId()+"-input-"+K,{liveChange:$,change:_});N.setValue(e[iH].getText());}M.addCell(N);if(e[iH].getGlobal()){Y=this.oResourceBundle.getText("VARIANT_MANAGEMENT_SHARED");}else{Y=this.oResourceBundle.getText("VARIANT_MANAGEMENT_PRIVATE");}Q=new b(this.oVariantManage.getId()+"-type-"+K,{text:Y,wrapping:false});Q.addStyleClass("sapUICompVarMngmtType");M.addCell(Q);U=new R(this.oVariantManage.getId()+"-def-"+K,{groupName:this.oVariantManage.getId(),select:a1});if(this.sNewDefaultKey===e[iH].getKey()||e[iH].getKey()===this.getStandardVariantKey()&&this.sNewDefaultKey===""){U.setSelected(true);if(e[iH].getFavorite){this._setFavoriteIcon(M.getCells()[0],true);}}M.addCell(U);W=new m(this.oVariantManage.getId()+"-exe-"+K,{selected:false,enabled:false,select:b1});if(e[iH].getExecuteOnSelection){if((e[iH].getKey()===this.getStandardVariantKey()&&this.getSupportExecuteOnSelectOnSandardVariant())){W.setEnabled(true);}else{W.setEnabled(!e[iH].getReadOnly());}W.setSelected(e[iH].getExecuteOnSelection());if(Z){W.setTooltip(Z);}}M.addCell(W);Q=new b(this.oVariantManage.getId()+"-author-"+K,{text:e[iH].getAuthor(),textAlign:"Begin"});M.addCell(Q);X=new l(this.oVariantManage.getId()+"-del-"+K,{icon:"sap-icon://sys-cancel",enabled:true,type:g.Transparent,press:d1,tooltip:this.oResourceBundle.getText("VARIANT_MANAGEMENT_DELETE")});this._assignColumnInfoForDeleteButton(X);if(e[iH].getReadOnly&&e[iH].getReadOnly()){X.setEnabled(false);X.setVisible(false);}M.addCell(X);this.oManagementTable.addItem(M);K++;}this.aRemovedVariants=[];this.aRemovedVariantTransports=[];this.aRenamedVariants=[];this.aExeVariants=[];this._createManagementDialog();this._setDialogCompactStyle(this,this.oManagementDialog);i=this.oVariantList.getSelectedItem();if(i){this.lastSelectedVariantKey=i.getKey();}this.oVariantPopOver.close();this.oManagementDialog.open();};F.prototype._assignColumnInfoForDeleteButton=function(e){if(!this._oInvisibleDeleteColumnName){this._oInvisibleDeleteColumnName=new v({text:this.oResourceBundle.getText("VARIANT_MANAGEMENT_ACTION_COLUMN")});this._createManagementDialog();this.oManagementDialog.addContent(this._oInvisibleDeleteColumnName);}if(this._oInvisibleDeleteColumnName){e.addAriaLabelledBy(this._oInvisibleDeleteColumnName);}};F.prototype._enableManualVariantKey=function(e){this.bManualVariantKey=e;};F.prototype._fireSelectAsync=function(K){var e;if(K===undefined||K===null){var i=this._getSelectedItem();if(i===null){e=this.getStandardVariantKey();}else{e=i.getKey();}}this.fireSelect({key:e});};F.prototype.setSupportExecuteOnSelectOnSandardVariant=function(e){this.bSupportExecuteOnSelectOnSandardVariant=e;};F.prototype.getSupportExecuteOnSelectOnSandardVariant=function(){return this.bSupportExecuteOnSelectOnSandardVariant;};F.prototype._executeOnSelectForStandardVariantByXML=function(e){this.bExecuteOnSelectForStandardViaXML=e;};F.prototype._executeOnSelectForStandardVariantByUser=function(e){this.bExecuteOnSelectForStandardByUser=e;};F.prototype.getExecuteOnSelectForStandardVariant=function(){if(this.getSupportExecuteOnSelectOnSandardVariant()){if(this.bExecuteOnSelectForStandardByUser!==null){return this.bExecuteOnSelectForStandardByUser;}}return this.bExecuteOnSelectForStandardViaXML;};F.prototype.getStandardVariantKey=function(){return this._sStandardVariantKey;};F.prototype.setStandardVariantKey=function(e){this._sStandardVariantKey=e;};F.prototype._setVendorLayer=function(e){this._isVendorLayer=e;};F.prototype.setStandardFavorite=function(e){this._isFavorite=e;};F.prototype.getStandardFavorite=function(){return this._isFavorite;};F.prototype._isIndustrySolutionModeAndVendorLayer=function(){if(this.getIndustrySolutionMode()&&this._isVendorLayer){return true;}return false;};return F;},true);
