/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/m/Link','sap/ui/core/Control','sap/m/VBox','sap/m/HBox','sap/m/Button','sap/m/Title','sap/m/Image','sap/m/Text','sap/ui/layout/form/SimpleForm','sap/m/VBoxRenderer','./Factory','./LinkData','sap/ui/model/json/JSONModel','./Util','sap/ui/core/TitleLevel','sap/ui/layout/HorizontalLayout','sap/ui/layout/VerticalLayout','sap/ui/layout/form/SimpleFormLayout','sap/ui/comp/personalization/Util','./FlexHandler','sap/ui/base/ManagedObjectObserver'],function(L,C,V,H,B,T,I,a,S,b,F,c,J,U,d,e,f,g,P,h,M){"use strict";var N=V.extend("sap.ui.comp.navpopover.NavigationContainer",{metadata:{library:"sap.ui.comp",properties:{mainNavigationId:{type:"string",group:"Misc",defaultValue:null},availableActionsPersonalizationText:{type:"string",defaultValue:undefined},enableAvailableActionsPersonalization:{type:"boolean",defaultValue:true}},aggregations:{availableActions:{type:"sap.ui.comp.navpopover.LinkData",multiple:true,singularName:"availableAction"},mainNavigation:{type:"sap.ui.comp.navpopover.LinkData",multiple:false},flexHandler:{type:"sap.ui.comp.navpopover.FlexHandler",visibility:"hidden",multiple:false}},associations:{extraContent:{type:"sap.ui.core.Control",multiple:false},component:{type:"sap.ui.core.Element",multiple:false}},events:{navigate:{},availableActionsPersonalizationPress:{}}},renderer:b.render});N.prototype.init=function(){V.prototype.init.call(this);var m=new J({mainNavigationLink:{title:undefined,subtitle:undefined,href:undefined,target:undefined},availableActions:[],availableActionsPersonalizationText:undefined,enableAvailableActionsPersonalization:undefined,extraContent:undefined});m.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);m.setSizeLimit(1000);this.setModel(m,"$sapuicompNavigationContainer");this.setAggregation("flexHandler",new h());this._oObserver=null;};N.prototype.applySettings=function(){V.prototype.applySettings.apply(this,arguments);this._createContent();};N.prototype.exit=function(o){if(this._getInternalModel()){this._getInternalModel().destroy();}if(this._oObserver){this._oObserver.disconnect();this._oObserver=null;}};N.prototype.openSelectionDialog=function(i,s,j,k,l){var t=this;return this._getFlexHandler().openSelectionDialog(this,i,s,j,k,l).then(function(){t._updateAvailableActionsPersonalizationText();});};N.prototype.getDirectLink=function(){var m=this._getInternalModel();if(m.getProperty('/extraContent')){return null;}if(m.getProperty('/mainNavigationLink/href')&&!m.getProperty('/availableActions').length){return this._oHeaderArea.getItems()[0];}if(m.getProperty('/availableActions').length===1&&!m.getProperty('/mainNavigationLink/href')){return this._oActionArea.getItems()[0].getItems()[0];}return null;};N.prototype.hasContent=function(){var m=this._getInternalModel();return!!m.getProperty("/mainNavigationLink/href")||!!m.getProperty("/availableActions").length||!!m.getProperty('/extraContent');};N.prototype.setExtraContent=function(o){this.setAssociation("extraContent",o);if(!o){return this;}var m=this._getInternalModel();if(m.getProperty("/extraContent")){this.removeItem(1);}if(typeof o==="string"){o=sap.ui.getCore().byId(o);}this.insertItem(o,1);m.setProperty("/extraContent",o);return this;};N.prototype.setMainNavigationId=function(m){this.setProperty("mainNavigationId",m,true);var o=this._getInternalModel();if(typeof m==="string"){o.setProperty("/mainNavigationLink/title",m);}return this;};N.prototype.setMainNavigation=function(l){this.setAggregation("mainNavigation",l,true);if(!l){return this;}var m=this._getInternalModel();if(l.getHref()){m.setProperty("/mainNavigationLink/href",this._convertToExternal(l.getHref()));m.setProperty("/mainNavigationLink/target",l.getTarget());}if(!m.getProperty("/mainNavigationLink/title")&&m.getProperty("/mainNavigationLink/title")!==''){m.setProperty("/mainNavigationLink/title",l.getText());}m.setProperty("/mainNavigationLink/subtitle",l.getDescription());return this;};N.prototype.setAvailableActionsPersonalizationText=function(A){this.setProperty("availableActionsPersonalizationText",A,true);var m=this._getInternalModel();m.setProperty("/availableActionsPersonalizationText",A);return this;};N.prototype.setEnableAvailableActionsPersonalization=function(E){this.setProperty("enableAvailableActionsPersonalization",E,true);var m=this._getInternalModel();m.setProperty("/enableAvailableActionsPersonalization",E);this._updateAvailableActionsPersonalizationText();return this;};N.prototype.addAvailableAction=function(l){this.addAggregation("availableActions",l);if(!l){return this;}l.setHref(this._convertToExternal(l.getHref()));l.setPress(this._onLinkPress.bind(this));var m=this._getInternalModel();m.setProperty("/availableActions/"+this.indexOfAvailableAction(l)+"/",l.getJson());return this;};N.prototype.insertAvailableAction=function(l,i){this.insertAggregation("availableActions",l,i);if(!l){return this;}l.setHref(this._convertToExternal(l.getHref()));l.setPress(this._onLinkPress.bind(this));var m=this._getInternalModel();m.setProperty("/availableActions/"+i+"/",l.getJson());return this;};N.prototype.removeAvailableAction=function(l){var i=this.indexOfAvailableAction(l);if(i>-1){var m=this._getInternalModel();var A=m.getProperty("/availableActions");A.splice(i,1);m.setProperty("/availableActions",A);}l=this.removeAggregation("availableActions",l);return l;};N.prototype.removeAllAvailableActions=function(){var A=this.removeAllAggregation("availableActions");var m=this._getInternalModel();m.setProperty("/availableActions",[]);return A;};N.prototype.onAfterRenderingActionForm=function(){var m=this._getInternalModel();var $=m.getProperty("/extraContent")?m.getProperty("/extraContent").$()[0]:undefined;if($&&$.scrollHeight>$.clientHeight){this.setFitContainer(false).setJustifyContent(sap.m.FlexJustifyContent.Start);}};N.prototype._createContent=function(){var t=this;this.addStyleClass("navigationPopover");this._oObserver=new M(function(j){if((j.type==="property"||j.type==="binding")&&j.name==="visible"){var m=this._getInternalModel().getProperty("/availableActions");var k=m.filter(function(l){return l.visible===true;});i.setVisible(k.length>0||!!this._getInternalModel().getProperty("/enableAvailableActionsPersonalization"));this._oActionArea.setVisible(k.length>0);if(this.hasContent()&&!this._getInternalModel().getProperty("/extraContent")){D.setVisible(false);}}}.bind(this));var o=new L({href:{path:'/mainNavigationLink/href'},text:{path:'/mainNavigationLink/title'},target:{path:'/mainNavigationLink/target'},visible:{path:'/mainNavigationLink/title',formatter:function(j){return!!j;}},enabled:{path:'/mainNavigationLink/href',formatter:function(v){return!!v;}},press:this._onLinkPress.bind(this)});o.addStyleClass("navigationPopoverTitle");this._oObserver.observe(o,{bindings:["visible"],properties:["visible"]});var s=new a({text:{path:'/mainNavigationLink/subtitle'},visible:{path:'/mainNavigationLink/subtitle',formatter:function(v){return!!v;}}});this._oHeaderArea=new V({items:[o,s],visible:{path:'/mainNavigationLink/title',formatter:function(j){return!!j;}}});this._oHeaderArea.addStyleClass("navigationPopoverTitleH1");this._oHeaderArea.addStyleClass("navigationPopoverHeader");var D=new S({maxContainerCols:1,content:[new sap.ui.core.Title({text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_MSG_NO_CONTENT")})]});D.addStyleClass("navigationPopoverDefaultExtraContent");var i=new V({visible:false});i.addStyleClass("navigationPopoverSeparator");this._oActionArea=new V({items:{path:'/availableActions',templateShareable:false,factory:function(j,k){var l=new L({visible:"{visible}",text:"{text}",href:"{href}",target:"{target}",press:k.getProperty("press")});this._oObserver.observe(l,{bindings:["visible"],properties:["visible"]});return new V({visible:"{visible}",layoutData:new sap.m.FlexItemData({styleClass:k.getProperty("description")?"navigationPopoverAvailableLinkGroup":"navigationPopoverAvailableLinkWithoutGroup"}),items:[l,new a({visible:"{visible}",text:"{description}"})]});}.bind(this)}});this._oActionArea.addEventDelegate({onAfterRendering:this.onAfterRenderingActionForm.bind(this)});this._oActionArea.addStyleClass("navigationPopoverAvailableLinks");this._oPersonalizationButton=new H({visible:{parts:[{path:'/enableAvailableActionsPersonalization'}],formatter:function(E){return!!E;}},justifyContent:"End",items:new B({type:sap.m.ButtonType.Transparent,text:{path:'/availableActionsPersonalizationText'},press:function(){t.fireAvailableActionsPersonalizationPress();}})});this._oPersonalizationButton.addStyleClass("navigationPopoverPersonalizationButton");this.setFitContainer(true);this.setJustifyContent(sap.m.FlexJustifyContent.Start);this.addItem(this._oHeaderArea).addItem(this._getInternalModel().getProperty("/extraContent")||D).addItem(i).addItem(this._oActionArea).addItem(this._oPersonalizationButton);this._oHeaderArea.setModel(this._getInternalModel());i.setModel(this._getInternalModel());this._oActionArea.setModel(this._getInternalModel());this._oPersonalizationButton.setModel(this._getInternalModel());};N.prototype._onLinkPress=function(E){this.fireNavigate({text:E.getSource().getText(),href:E.getSource().getHref()});};N.prototype._convertToExternal=function(s){var x=F.getService("CrossApplicationNavigation");if(!x){return s;}return x.hrefForExternal({target:{shellHash:s}},this._getComponent());};N.prototype._getComponent=function(){var o=this.getComponent();if(typeof o==="string"){o=sap.ui.getCore().getComponent(o);}return o;};N.prototype._getFlexHandler=function(){return this.getAggregation("flexHandler");};N.prototype._updateAvailableAction=function(l,s){this._getFlexHandler().updateAvailableActionOfSnapshot(l,s);this._syncAvailableActions();};N.prototype._discardAvailableActions=function(l){this._getFlexHandler().discardAvailableActionsOfSnapshot(l);this._syncAvailableActions();};N.prototype._syncAvailableActions=function(){var s=this._getFlexHandler().determineSnapshotOfAvailableActions();var m=this._getInternalModel();m.getProperty("/availableActions").forEach(function(o,i){if(s[o.key]!==undefined){m.setProperty("/availableActions/"+i+"/visible",s[o.key].visible);}});};N.prototype._updateAvailableActionsPersonalizationText=function(){var A=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_DEFINE_LINKS");if(this.getEnableAvailableActionsPersonalization()){this.setAvailableActionsPersonalizationText(A);}};N.prototype._getInternalModel=function(){return this.getModel("$sapuicompNavigationContainer");};return N;},true);
