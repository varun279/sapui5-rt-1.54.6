/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/comp/library','./Factory','./LinkData'],function(C,F,L){"use strict";var U={getStorableAvailableActions:function(m){return m.filter(function(M){return M.key!==undefined;});},sortArrayAlphabetical:function(n){var l;try{l=sap.ui.getCore().getConfiguration().getLocale().toString();if(typeof window.Intl!=='undefined'){var c=window.Intl.Collator(l,{numeric:true});n.sort(function(a,b){return c.compare(a,b);});}else{n.sort(function(a,b){return a.localeCompare(b,l,{numeric:true});});}}catch(e){}},retrieveNavigationTargets:function(s,a,A,c,S,m){var n={mainNavigation:undefined,ownNavigation:undefined,availableActions:[]};return new Promise(function(r){var x=F.getService("CrossApplicationNavigation");var u=F.getService("URLParsing");if(!x||!u){jQuery.sap.log.error("Service 'CrossApplicationNavigation' or 'URLParsing' could not be obtained");return r(n);}var b=[s].concat(a);var p=b.map(function(d){return[{semanticObject:d,params:S?S[d]:undefined,appStateKey:A,ui5Component:c,sortResultsBy:"text"}];});x.getLinks(p).then(function(l){if(!l||!l.length){return r(n);}var d=x.hrefForExternal();if(d&&d.indexOf("?")!==-1){d=d.split("?")[0];}if(d){d+="?";}l[0][0].forEach(function(o){var f=u.parseShellHash(o.intent);var k=(f.semanticObject&&f.action)?f.semanticObject+"-"+f.action:undefined;var g=(o.tags&&o.tags.indexOf("superiorAction")>-1);if(o.intent.indexOf(d)===0){n.ownNavigation=new L({key:k,href:o.intent,text:o.text,visible:true,isSuperiorAction:g});return;}if(f.action&&(f.action==='displayFactSheet')){n.mainNavigation=new L({key:k,href:o.intent,text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_FACTSHEET"),visible:true,isSuperiorAction:g});return;}n.availableActions.push(new L({key:k,href:o.intent,text:o.text,visible:true,isSuperiorAction:g}));});if(!n.mainNavigation&&typeof m==="string"){n.mainNavigation=new L({text:m,visible:true});}var e=[];for(var i=1;i<b.length;i++){e=e.concat(l[i][0]);}e.forEach(function(o){var f=u.parseShellHash(o.intent);n.availableActions.push(new L({key:(f.semanticObject&&f.action)?f.semanticObject+"-"+f.action:undefined,href:o.intent,text:o.text,visible:true,isSuperiorAction:(o.tags&&o.tags.indexOf("superiorAction")>-1)}));});return r(n);},function(){jQuery.sap.log.error("'retrieveNavigationTargets' failed");return r(n);});});},retrieveSemanticObjectMapping:function(p,o,b){if(!p){return Promise.resolve(null);}if(!o||!o.getMetaModel()){return Promise.resolve(null);}var t=this;var m=o.getMetaModel();return new Promise(function(r){m.loaded().then(function(){var M;try{M=m.getMetaContext(b);}catch(e){jQuery.sap.log.error("sap.ui.comp.navpopover.Util.retrieveSemanticObjectMapping: binding path '"+b+"' is not valid. Error has been caught: "+e);return r(null);}if(!M){return r(null);}var E=M.getProperty(M.getPath());if(!E.property){return r(null);}var P=E.property.filter(function(a){return a.name===p;});if(P.length!==1){return r(null);}if(!P[0]["com.sap.vocabularies.Common.v1.SemanticObjectMapping"]){return r(null);}var s=t._getSemanticObjectMappingsOfProperty(P[0],t._getSemanticObjectsOfProperty(P[0]));var S={};for(var q in s){S[s[q].name]=s[q].mapping;}return r(S);});});},_getSemanticObjectsOfProperty:function(p){var s={};for(var a in p){var A=a.split("#")[0];var q=a.split("#")[1]||"";if(jQuery.sap.startsWith(A,"com.sap.vocabularies.Common.v1.SemanticObject")&&jQuery.sap.endsWith(A,"com.sap.vocabularies.Common.v1.SemanticObject")){s[q]={name:p[a]["String"],mapping:undefined};}}return s;},_getSemanticObjectMappingsOfProperty:function(p,s){var g=function(S){var m={};if(jQuery.isArray(S)){S.forEach(function(P){m[P.LocalProperty.PropertyPath]=P.SemanticObjectProperty.String;});}return m;};for(var a in p){var A=a.split("#")[0];var q=a.split("#")[1]||"";if(jQuery.sap.startsWith(A,"com.sap.vocabularies.Common.v1.SemanticObjectMapping")&&jQuery.sap.endsWith(A,"com.sap.vocabularies.Common.v1.SemanticObjectMapping")){if(s[q]){s[q].mapping=g(p[a]);}}}return s;}};return U;},true);
