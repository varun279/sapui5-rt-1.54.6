/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['jquery.sap.global','sap/m/DateTimePicker','sap/m/Select','sap/ui/core/Item','sap/m/ComboBox','sap/m/DatePicker','sap/m/DateRangeSelection','sap/m/TimePicker','sap/m/Input','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/SearchField','sap/m/Token','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/providers/ValueHelpProvider','sap/ui/comp/providers/ValueListProvider','sap/ui/model/Filter','sap/ui/model/json/JSONModel','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil','sap/ui/base/EventProvider','sap/ui/comp/util/IdentifierUtil','sap/ui/comp/providers/TokenParser','sap/ui/core/format/DateFormat'],function(q,D,S,I,C,a,b,T,c,M,d,f,g,h,V,l,F,J,O,m,E,o,p,r){"use strict";var s=function(P){this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;if(P){this._oParentODataModel=P.model;this._sServiceURL=P.serviceUrl;this._sBasicSearchFieldName=P.basicSearchFieldName;this._isBasicSearchEnabled=P.enableBasicSearch;this._bUseContainsAsDefault=P.useContainsAsDefaultFilter==="true";this.sEntityType=P.entityType;this.sEntitySet=P.entitySet;this._isRunningInValueHelpDialog=P.isRunningInValueHelpDialog;this._oAdditionalConfiguration=P.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=P.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=P.defaultTokenDisplayBehaviour;if(typeof P.dateFormatSettings==="string"){try{this._oDateFormatSettings=P.dateFormatSettings?JSON.parse(P.dateFormatSettings):undefined;}catch(e){}}else{this._oDateFormatSettings=P.dateFormatSettings;}if(!this._oDateFormatSettings){this._oDateFormatSettings={};}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true;}this._oSmartFilter=P.smartFilter;this._bConsiderAnalyticalParameters=P.considerAnalyticalParameters;this._bUseDateRangeType=P.useDateRangeType;this._bConsiderSelectionVariants=P.considerSelectionVariants;this._aConsiderNavigations=P.considerNavigations;}this.sFilterModelName=s.FILTER_MODEL_NAME;this._sBasicFilterAreaID=s.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarStringDateFieldNames=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFilterBarDateTimeFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new h(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._oParameterization=null;this._oNonAnaParameterization=null;this._intialiseMetadata();this._bInitialized=true;};s.FILTER_MODEL_NAME="fi1t3rM0d31";s.BASIC_FILTER_AREA_ID="_BASIC";s.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";s.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";s.FIELD_NAME_REGEX=/\./g;s.prototype._intialiseMetadata=function(){var G,e,k,n,t,i,j,u,v,w,x,y;this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType);}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);t=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);if(t){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);k=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(k&&k.selectionFields){this._aSelectionFields=k.selectionFields;}if(this._aFieldGroupAnnotation){G=this._aFieldGroupAnnotation.length;for(i=0;i<G;i++){n=this._aFieldGroupAnnotation[i];w=this._createGroupMetadata(n);w.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(w);}}G=t.length;for(i=0;i<G;i++){n=t[i];e=n.fields.length;w=this._createGroupMetadata(n);this._aFilterBarViewMetadata.push(w);for(j=0;j<e;j++){u=n.fields[j];if(u.type.indexOf("Edm.")===0){v=this._createFieldMetadata(u);w.fields.push(v);this._aFilterBarFieldNames.push(v.fieldName);}}}}y=this._getAdditionalConfigurationForCustomGroups(t);G=y.length;for(j=0;j<G;j++){w=this._createGroupMetadataForCustomGroup(y[j]);if(w){this._aFilterBarViewMetadata.push(w);}}x=this._getAdditionalConfigurationForCustomFilterFields();e=x.length;for(j=0;j<e;j++){v=this._createFieldMetadataForCustomFilterFields(x[j]);if(v){this._aFilterBarViewMetadata[0].fields.push(v);}}if(this._hasBasicSearch()){v=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(v);}if(!this._isRunningInValueHelpDialog){this._createParameters();}if(this._bConsiderSelectionVariants){this._createSelectionVariants();}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());};s.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotationList(this.sEntityType);};s.prototype._createParameters=function(){if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){if(this._bConsiderAnalyticalParameters){this._oParameterization=this._getAnalyticParameterization();this._createAnalyticParameters(this._oParameterization);}}else{this._createNonAnalyticParameters();}};s.prototype._getAnalyticParameterization=function(){var i,Q;q.sap.require("sap.ui.model.analytics.odata4analytics");try{i=new sap.ui.model.analytics.odata4analytics.Model(new sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(this._oParentODataModel));}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message;}Q=i&&i.findQueryResultByName(this.sEntitySet);return(Q&&Q.getParameterization());};s.prototype._createNonAnalyticParameters=function(){if(this.sEntitySet){this._oNonAnaParameterization=this._oMetadataAnalyser.getParametersByEntitySetName(this.sEntitySet);if(this._oNonAnaParameterization){this._createParametersByEntitySetName(this._oNonAnaParameterization.entitySetName,this._oNonAnaParameterization.parameters);}}};s.prototype.attachPendingChange=function(e){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEvent("PendingChange",e);};s.prototype.detachPendingChange=function(e){if(this._oEventProvider){this._oEventProvider.detachEvent("PendingChange",e);}};s.prototype.setPending=function(v){var e=this._bPending!==v;this._bPending=v;if(e&&this._oEventProvider){var P={};P.pending=v;this._oEventProvider.fireEvent("PendingChange",P);}};s.prototype.isPending=function(){if(!this._bInitialized){return true;}for(var n in this._mConditionTypeFields){if(this._mConditionTypeFields[n].conditionType.isPending()){return true;}}return false;};s.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultDropDownDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly;}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultTokenDisplayBehaviour=sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId;}}};s.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled;};s.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,j,i,R;if(!this._oAdditionalConfiguration){return[];}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e;}R=[];j=e.length;for(i=0;i<j;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){R.push(e[i]);}}return R;};s.prototype._getAdditionalConfigurationForCustomGroups=function(e){var G,k,n,i,R,j,t,u;if(!this._oAdditionalConfiguration){return[];}G=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return G;}R=[];n=e.length;k=G.length;for(i=0;i<k;i++){t=false;for(j=0;j<n;j++){u=e[j].groupName||e[j].groupEntityName;if(u===G[i].key){t=true;break;}}if(!t){R.push(G[i]);}}return R;};s.prototype._createInitialModelForField=function(j,e,u){var i=false,k,n,H=false,t=false,L=null,v=null,w,x=null,y=[],R=[];if(!e||e.isCustomFilterField){return;}if(e.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple){t=true;}if((e.filterType==="date")||(e.filterType==="time")){i=true;}if(u){k=e.defaultFilterValues;H=k&&k.length;if(!H){if(e.defaultPropertyValue&&e.isParameter){n=e.defaultPropertyValue;if(e.filterType==="numeric"){n=this._getType(e).parseValue(n,"string");}k=[{low:n}];H=true;}else if(e.defaultFilterValue){k=[{low:e.defaultFilterValue,high:e.defaultFilterValue,operator:"EQ",sign:"I"}];H=true;}}}if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single){if(H){n=k[0];L=i?this._createDateTimeValue(e,n.low):n.low;}j[e.fieldName]=L;}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval&&e.type!=="Edm.Time"){if(H){n=k[0];L=i?this._createDateTimeValue(e,n.low):n.low;v=i?this._createDateTimeValue(e,n.high):n.high;}j[e.fieldName]={low:L,high:v};}else{if(H){w=k.length;while(w--){n=k[w];if(t){x={"exclude":n.sign==="E","operation":n.operator==="CP"?"Contains":n.operator,"keyField":e.fieldName,"value1":i?this._createDateTimeValue(e,n.low):n.low,"value2":i?"":n.high};if((e.filterType==="time")&&n.high){x.value2=new Date(n.high);}}else{x={key:i?this._createDateTimeValue(e,n.low):n.low,text:i?"":n.low};}y.push(x);}}this._aFilterBarMultiValueFieldMetadata.push(e);j[e.fieldName]={value:null};if(t){R=y.slice(0);y=[];j[e.fieldName].ranges=R;}j[e.fieldName].items=y;this._updateMultiValueControl(e.control,y,R);}};s.prototype._createDateTimeValue=function(e,v){if((e.type==="Edm.Time")&&(v.indexOf("PT")===0)){return this._getTime(v);}else{return new Date(v);}};s.prototype._createInitialModel=function(u){var e,G,k,n,j,i;e={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){G=this._aFilterBarViewMetadata.length;for(i=0;i<G;i++){n=this._aFilterBarViewMetadata[i];k=n.fields.length;for(j=0;j<k;j++){this._createInitialModelForField(e,n.fields[j],u);}}}if(this._aAnalyticalParameters){k=this._aAnalyticalParameters.length;for(j=0;j<k;j++){this._createInitialModelForField(e,this._aAnalyticalParameters[j],u);}}this.oModel.setData(e);if(!u){this._clearConditionTypeFields();}this._updateConditionTypeFields();this._bCreatingInitialModel=false;};s.prototype._updateMultiValueControl=function(e,j,R,k){var i=0,t=null,n=null,u=null,v=null,K=null,w,x,y,z;if(e&&j){i=j.length;if(e instanceof d){t=[];while(i--){v=j[i].text||j[i].key;t.push(new g({key:j[i].key,text:v,tooltip:v}));}if(R){i=R.length;while(i--){u=R[i];if(u.tokenText){v=u.tokenText;}else{w=u.value1;x=u.value2;if(k){var A=["date","datetime","time"];if(!k.isCalendarDate&&A.indexOf(k.filterType)>-1){if(w&&typeof w==="string"){w=new Date(w);}if(x&&typeof x==="string"){x=new Date(x);}switch(k.filterType){case"date":z=sap.ui.core.format.DateFormat.getDateInstance(q.extend({},this._oDateFormatSettings,{UTC:false}));break;case"datetime":z=sap.ui.core.format.DateFormat.getDateTimeInstance(q.extend({},this._oDateFormatSettings,{UTC:false}));break;case"time":z=sap.ui.core.format.DateFormat.getTimeInstance(q.extend({},this._oDateFormatSettings,{UTC:false}));break;}if(z){if(w){w=z.format(w);}if(x){x=z.format(x);}}}else if(k.filterType==="numeric"){y=this._getType(k);if(y){if(w){w=y.formatValue(w,"string");}if(x){x=y.formatValue(x,"string");}}}else{var B=k.isCalendarDate||((w instanceof Date)||(x instanceof Date));if(B){y=this._getType(k);if(w){w=y.formatValue(w,"string");}if(x){x=y.formatValue(x,"string");}}}}v=m.getFormattedRangeText(u.operation,w,x,u.exclude);}n=new g({text:v,tooltip:v});n.data("range",u);t.push(n);}}e.setTokens(t);}if(e instanceof M){K=[];while(i--){K.push(j[i].key);}e.setSelectedKeys(K);}}};s.prototype._applyIndexes=function(){var e,i;if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=this._sortByIndex(this._aFilterBarViewMetadata);e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(this._aFilterBarViewMetadata[i].fields){this._aFilterBarViewMetadata[i].fields=this._sortByIndex(this._aFilterBarViewMetadata[i].fields);}}};s.prototype._sortByIndex=function(A){var e,i,j,R,k,n;if(!A||!A.length){return A;}R=[];e=[];j=A.length;for(i=0;i<j;i++){n=A[i];k=n.index;if(k>=0){e.push(n);}else{R.push(n);}}j=e.length;if(j){e=e.sort(function(t,u){return t.index-u.index;});if(!R.length){R=e;}else{for(i=0;i<j;i++){n=e[i];if(n.index>=R.length){R.push(n);}else{R.splice(n.index,0,n);}}}}return R;};s.prototype._applyGroupId=function(){var e,i,n,j,t,N,k;e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}n=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<n;j++){t=this._aFilterBarViewMetadata[i].fields[j];if(t&&t.groupId&&t.groupId!==this._aFilterBarViewMetadata[i].groupName){N=undefined;for(k=0;k<e;k++){if(this._aFilterBarViewMetadata[k].groupName===t.groupId){N=this._aFilterBarViewMetadata[k];break;}}if(N){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;n--;N.fields=N.fields||[];N.fields.push(t);}}}}};s.prototype._createFilterControlId=function(e){var i=this._oSmartFilter.getId();var G=o.replace(e.groupId||"");var n=o.replace(e.fieldName);return i+"-filterItemControl"+G+"-"+n;};s.prototype._createGroupMetadata=function(e){var G,i,j;j=e.groupName||e.groupEntityName;i=this._oAdditionalConfiguration.getGroupConfigurationByKey(j);G={};G.groupName=j;G.groupLabel=this._getGroupLabel(e,i);G.fields=[];G.index=this._getGroupIndex(i);return G;};s.prototype._createGroupMetadataForCustomGroup=function(G){var e;e={};e.groupName=G.key;e.groupLabel=G.label;e.fields=[];e.index=this._getGroupIndex(G);return e;};s.prototype._getTime=function(v){var e=r.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return e.parse(v);};s.prototype._checkMetadataDefaultValue=function(e){var i=e.defaultFilterValue||e.defaultPropertyValue;if(i){try{if((e.type==="Edm.Time")&&(i.indexOf("PT")===0)){this._getTime(i);}else{this._getType(e);}}catch(j){e.defaultPropertyValue=null;e.defaultFilterValue=null;q.sap.log.error("default value for "+e.fieldName+" could not be parsed.");}}};s.prototype._getType=function(e){var t,i={},j={};if(e.precision||e.scale){j.precision=e.precision;j.scale=e.scale;}if(e.maxLength){j.maxLength=e.maxLength;}if(e.displayFormat){j.displayFormat=e.displayFormat;}if(e.isDigitSequence){j.isDigitSequence=e.isDigitSequence;}if(e.fControlConstructor===b||e.fControlConstructor===a||e.type==="Edm.DateTimeOffset"||e.isCalendarDate){i=q.extend({},this._oDateFormatSettings,{UTC:false});}t=O.getType(e.type,i,j,e.isCalendarDate);return t;};s.prototype._createControl=function(e){var i,t,j=false,k,n;if(e.customControl){return e.customControl;}t=this._getType(e);i=new e.fControlConstructor(this._createFilterControlId(e));if(e.fControlConstructor===b){if(e.isCalendarDate){i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/low",type:t});i.bindProperty("secondDateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/high",type:t});}else{i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName+"/low");i.bindProperty("secondDateValue",this.sFilterModelName+">/"+e.fieldName+"/high");}}else if((e.fControlConstructor===C)||(e.fControlConstructor===S)){if(i.setForceSelection){i.setForceSelection(true);}if(e.fControlConstructor===S){i.addItem(new I({key:"",text:""}));i.addItem(new I({key:false,text:t.formatValue(false,"string")}));i.addItem(new I({key:true,text:t.formatValue(true,"string")}));}else{this._associateValueList(i,"items",e);i.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}i.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));}i.bindProperty('selectedKey',this.sFilterModelName+">/"+e.fieldName);}else if(e.fControlConstructor===M){this._associateValueList(i,"items",e);i.attachSelectionChange(function(v){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}var w=v.getSource(),x=null,K=[],L;x=w.getSelectedItems();if(x){L=x.length;while(L--){K.push({key:x[L].getKey(),text:x[L].getText()});}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",K);}w.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/value");}else if(e.fControlConstructor===d){if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.date||e.type==="Edm.Time"||e.type==="Edm.DateTimeOffset"){i.setValueHelpOnly(true);if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){this._associateValueHelpDialog(i,e,false,false);}else{this._associateValueHelpDialog(i,e,true,true);}}else{if(e.hasValueHelpDialog){this._associateValueHelpDialog(i,e,e.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,true);}else{i.setShowValueHelp(false);}i.bindProperty("value",{path:this.sFilterModelName+">/"+e.fieldName+"/value",type:t});}this._handleMultiInput(i,e,t);}else if(e.fControlConstructor===c){if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){j=true;i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}i.setPlaceholder(this.sIntervalPlaceholder);}else{i.bindProperty('value',{path:this.sFilterModelName+">/"+e.fieldName,type:t});}if(e.hasValueHelpDialog){i.setShowValueHelp(true);this._associateValueHelpDialog(i,e,false,false);}}else if(e.isCalendarDate){i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName,type:t});}else if(e.fControlConstructor===a||e.fControlConstructor===T||e.fControlConstructor===D){i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);}if(i instanceof a){if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}i.attachChange(function(v){var w=v.getParameter("valid");i.data("__mandatoryEmpty",null);if(w){i.setValueState(sap.ui.core.ValueState.None);i.setValueStateText();}else{i.setValueState(sap.ui.core.ValueState.Error);if(t){try{t.parseValue("foo","string");}catch(x){i.setValueStateText(x.message);}}}});}if(e.hasTypeAhead){i.setShowSuggestion(true);i.setFilterSuggests(false);this._associateValueList(i,"suggestionRows",e,true);}if(e.displayFormat==="UpperCase"&&i.attachChange&&i.getValue&&i.setValue){i.attachChange(function(){var v=i.getValue();if(v){i.setValue(v.toUpperCase());}});if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var u=this._mTokenHandler[i.getId()].parser;u.getKeyFields()[0].displayFormat=e.displayFormat;}}if(i instanceof c){if(e.maxLength){k=parseInt(e.maxLength,10);if(!isNaN(k)){if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var u=this._mTokenHandler[i.getId()].parser;u.getKeyFields()[0].maxLength=k;}else{if(!e.hasValueListAnnotation&&!j){i.setMaxLength(k);}}}}}n=function(v){var w=v.getParameter("exception");var x=v.getParameter("element");if(i&&x&&(i.getId()===x.getId())){if(w){if(i.setValueStateText){i.setValueStateText(w.message);}}if(i.setValueState){i.setValueState(sap.ui.core.ValueState.Error);}i.data("__mandatoryEmpty",null);}};i.attachParseError(n);i.attachFormatError(n);i.attachValidationError(n);i.attachValidationSuccess(function(v){var w=v.getParameter("element");if(i&&w&&(i.getId()===w.getId())){if(i.setValueState){i.setValueState(sap.ui.core.ValueState.None);}if(i.setValueStateText){i.setValueStateText();}i.data("__mandatoryEmpty",null);delete i.__sValidationText;}});return i;};s.prototype._getControlConstructor=function(e,P){var i=c,j,k,n;n=P?P+e.fieldName:e.fieldName;if(e.isCustomFilterField){i=undefined;}else{j=(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single);k=(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval);if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.date){e.displayFormat="Date";if(j){i=a;}else{i=k?b:d;}if(e.isCalendarDate){this._aFilterBarStringDateFieldNames.push(n);}else{this._aFilterBarDateFieldNames.push(n);}if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(e.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){if(j){i=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?S:C;}else{i=M;}if(!j){e.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.multiple;}}else if(e.type==="Edm.Time"){if(j){i=T;}else{i=d;}this._aFilterBarTimeFieldNames.push(n);if(k){this._aFilterBarTimeIntervalFieldNames.push(n);}else if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(!k&&e.controlType===sap.ui.comp.smartfilterbar.ControlType.dateTimePicker){if(j){i=D;}else{i=d;}this._aFilterBarDateTimeFieldNames.push(n);if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(k&&e.type==="Edm.DateTimeOffset"){this._aFilterBarDateTimeFieldNames.push(n);}else if(!j&&!k){i=d;}}return i;};s.prototype._handleMultiInput=function(e,i,t){e.setEnableMultiLineMode(true);e.attachTokenChange(function(n){if(this._bUpdatingFilterData||this._bCreatingInitialModel||(n.getParameter("type")!=="tokensChanged")&&(n.getParameter("type")!=="removed")){return;}var u=n.getSource().getTokens(),v=[],L,w=null,R=null,x=[];if(u){L=u.length;while(L--){w=u[L];R=w.data("range");if(R){R.tokenText=w.getText();x.push(R);}else{v.push({key:w.getKey(),text:w.getText()});}}}if(this.oModel){this.oModel.setProperty("/"+i.fieldName+"/items",v);this.oModel.setProperty("/"+i.fieldName+"/ranges",x);}e.fireChange({filterChangeReason:i.fieldName,value:""});}.bind(this));var j,k=((i.type==="Edm.DateTime"&&i.displayFormat==="Date"));if(i.hasValueListAnnotation||(i.type==="Edm.String")||k){e.attachEvent("_validateOnPaste",function(n){var u=n.getParameter("texts"),P,L,v,w,R;L=u?u.length:0;if(L>1){n.preventDefault();P=this.oModel.getProperty("/"+i.fieldName);R=P.ranges||[];e.setValue("");while(L--){v=u[L];if(v){w=null;if(k){j=this._getDateValue(v,t);if(isNaN(j.getDate())){continue;}else{w=v;v=j;}}R.push({"exclude":false,"operation":"EQ","keyField":i.fieldName,"value1":v,"value2":null,"tokenText":w});}}this.oModel.setProperty("/"+i.fieldName+"/ranges",R);this._updateMultiValueControl(e,P.items,R);}}.bind(this));}};s.prototype._getDateValue=function(v,t){var e;try{e=t.parseValue(v,"string");if(e){return e;}}catch(i){}return new Date(v);};s.prototype._associateValueHelpDialog=function(e,i,j,k){var P={loadAnnotation:i.hasValueListAnnotation,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,control:e,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,preventInitialDataFetchInValueHelpDialog:i.preventInitialDataFetchInValueHelpDialog,dateFormatSettings:this._oDateFormatSettings,supportMultiSelect:k,supportRanges:j,isUnrestrictedFilter:i.filterRestriction!==sap.ui.comp.smartfilterbar.FilterType.multiple,isSingleIntervalRange:i.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval,fieldName:i.fieldName,type:i.filterType,scale:i.scale,precision:i.precision,maxLength:i.maxLength,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,fieldViewMetadata:i};if(i.isCalendarDate){P.oType=this._getType(i);}var v=new V(P);v.attachValueListChanged(function(n){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(n);}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===s.BASIC_FILTER_AREA_ID)){v.loadAnnotation();}this._aValueHelpDialogProvider.push(v);if(j&&e.addValidator){var t=new p();t.addKeyField({key:i.fieldName,label:i.label,type:i.filterType,oType:i.ui5Type});t.associateInput(e);this._mTokenHandler[e.getId()]={parser:t};}};s.prototype._determineFieldLabel=function(e){var i,L=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){i=this._oSmartFilter.determineFilterItemByName(e.name);if(i){L=i.getLabel();}}return L;};s.prototype._associateValueList=function(e,A,i,H){var v;if(i.hasValueListAnnotation){v=new l({control:e,fieldName:i.fieldName,typeAheadEnabled:H,aggregation:A,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,dateFormatSettings:this._oDateFormatSettings,loadAnnotation:true,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,fieldViewMetadata:i});v.attachValueListChanged(function(j){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(j);}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===s.BASIC_FILTER_AREA_ID)){v.loadAnnotation();}this._aValueListProvider.push(v);}else if(this._mTokenHandler[e.getId()]&&this._mTokenHandler[e.getId()].parser){this._mTokenHandler[e.getId()].parser.setDefaultOperation("EQ");}};s.prototype._createAnalyticParameters=function(P){var e,i;if(P){i=P.getAllParameterNames();e=P.getEntitySet();if(e){this._createParametersByEntitySetName(e.getQName(),i);}}};s.prototype._createParametersByEntitySetName=function(e,P){var j,k=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var i=0;i<k.length;i++){if(P.indexOf(k[i].name)>=0){j=this._createAnalyticParameterMetadata(k[i]);if(j.visible&&!j.hidden){this._aAnalyticalParameters.push(j);}}}};s.prototype._createAnalyticParameterMetadata=function(P){var e=sap.ui.comp.ANALYTICAL_PARAMETER_PREFIX;P.filterRestriction="single-value";var i=this._createFieldMetadata(P,e);i.fieldName=e+P.name;i.isMandatory=true;i.isParameter=true;i.visibleInAdvancedArea=true;return i;};s.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters;};s.prototype.getSelectionVariants=function(){return this._aSelectionVariants;};s.prototype.getAnalyticBindingPath=function(){var v,P=[],e=this.getAnalyticParameters();e.forEach(function(i){P.push(i.fieldName);});v=this.getFilledFilterData(P);if(this._oParameterization){return this._createAnalyticBindingPath(e,v);}else{return this._createNonAnalyticBindingPath(e,v);}};s.prototype._createAnalyticBindingPath=function(P,v){var e,i="",j;j=this._getParameterizationRequest(this._oParameterization);if(j){P.forEach(function(k){e=v[k.fieldName];if(!e){e="";}else if(k.type==="Edm.Time"&&e instanceof Date){if(this._oDateFormatSettings&&!this._oDateFormatSettings.UTC){e=new Date(e.valueOf()+e.getTimezoneOffset()*60*1000);}e={__edmType:"Edm.Time",ms:(((e.getHours()*60)+e.getMinutes())*60+e.getSeconds())*1000+e.getMilliseconds()};}else if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&e instanceof Date){e=s.getDateInUTCOffset(e);}j.setParameterValue(k.name,e);}.bind(this));i=j.getURIToParameterizationEntry()+'/'+this._oParameterization.getNavigationPropertyToQueryResult();}return i;};s.prototype._createNonAnalyticBindingPath=function(P,v){var e,i="",j="";if(this._oNonAnaParameterization){i="/"+this._oNonAnaParameterization.entitySetName+'(';P.forEach(function(k){e=v[k.fieldName];if(!e){e="";}else if(k.type==="Edm.Time"&&e instanceof Date){e={__edmType:"Edm.Time",ms:(((e.getHours()*60)+e.getMinutes())*60+e.getSeconds())*1000+e.getMilliseconds()};}else if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&e instanceof Date){e=s.getDateInUTCOffset(e);}i+=(j+k.name+"="+q.sap.encodeURL(this._oParentODataModel.formatValue(e,k.type)));j=",";}.bind(this));i+=(")/"+this._oNonAnaParameterization.navPropertyName);}return i;};s.prototype._getParameterizationRequest=function(){return this._oParameterization?new sap.ui.model.analytics.odata4analytics.ParameterizationRequest(this._oParameterization):null;};s.prototype._createFieldMetadata=function(e,P){var i,j;e.fieldName=this._getFieldName(e);e.fieldNameOData=e.fieldName.replace(s.FIELD_NAME_REGEX,"/");j=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName):null;i=q.extend({},e);i.filterRestriction=this._getFilterRestriction(e,j);this._updateValueListMetadata(i,e);i.hasValueHelpDialog=this._hasValueHelpDialog(i,j);i.preventInitialDataFetchInValueHelpDialog=j?j.preventInitialDataFetchInValueHelpDialog:true;i.controlType=this._getControlType(i,j);if(j&&j.displayBehaviour&&j.displayBehaviour!=="auto"){i.displayBehaviour=j.displayBehaviour;}i.isCustomFilterField=!!(j&&j.customControl);i.visibleInAdvancedArea=!!(j&&j.visibleInAdvancedArea);i.label=this._getLabel(e,j);i.isMandatory=this._isMandatory(e,j);i.width=this._getWidth(j);i.isVisible=this._isVisible(j);i.groupId=this._getGroupID(e,j);i.index=this._getIndex(e,j);i.fControlConstructor=this._getControlConstructor(i,P);i.filterType=this._getFilterType(i);i.hasTypeAhead=this._hasTypeAhead(i,e,j);i.customControl=j?j.customControl:undefined;i.ui5Type=this._getType(i);i.fCreateControl=function(v){var w,x;v.control=this._createControl(v);w=this.oModel.getData();x=w[v.fieldName];if(x){this._updateMultiValueControl(v.control,x.items,x.ranges);}}.bind(this);this._applyWidth(i);i.defaultFilterValues=j?j.defaultFilterValues:undefined;if(i.type==="Edm.String"){this._aFilterBarStringFieldNames.push(i.fieldName);}i.conditionType=null;var k=j?j.conditionType:null;if(!k&&this._bUseDateRangeType&&(i.fControlConstructor===b)){k="sap.ui.comp.config.condition.DateRangeType";}if(k){var n="";if(typeof k==="object"){n=k.module;delete k.module;}else{n=k;k=null;}try{q.sap.require(n);var t=q.sap.getObject(n);if(t){i.conditionType=new t(i.fieldName,this,i);this._mConditionTypeFields[i.fieldName]=i;}if(k&&!this._bUseDateRangeType){i.conditionType.applySettings(k);}}catch(u){q.sap.log.error("Module "+n+" could not be loaded");}}this._checkMetadataDefaultValue(i);return i;};s.prototype._getFilterType=function(e){if(e.isDigitSequence){return"numc";}else if(O.isNumeric(e.type)){return"numeric";}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"){return"date";}else if(e.type==="Edm.String"){if(e.isCalendarDate){return"stringdate";}return"string";}else if(e.type==="Edm.Boolean"){return"boolean";}else if(e.type==="Edm.Time"){return"time";}else if(e.type==="Edm.DateTimeOffset"){return"datetime";}return undefined;};s.prototype._updateValueListMetadata=function(e,i){e.hasValueListAnnotation=i["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=i["sap:value-list"]==="fixed-values";}else if(i["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(i["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=h.isValueListWithFixedValues(i);}}};s.prototype._createBasicSearchFieldMetadata=function(){var e;var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");e={};e.filterRestriction=sap.ui.comp.smartfilterbar.FilterType.single;e.name=s.BASIC_SEARCH_FIELD_ID;e.fieldName=s.BASIC_SEARCH_FIELD_ID;e.label=undefined;e.isMandatory=false;e.isVisible=true;e.groupId=s.BASIC_FILTER_AREA_ID;e.index=-1;e.control=new f(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){e.control.setPlaceholder(R.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"));}e.control.bindProperty('value',this.sFilterModelName+">/"+e.fieldName);return e;};s.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&e.control.setWidth&&(typeof e.control.setWidth==='function')){e.control.setWidth(e.width);}};s.prototype._createFieldMetadataForCustomFilterFields=function(e){var i;if(!e||!e.customControl){return undefined;}i={};i.name=e.key;i.fieldName=e.key;i.label=e.label;i.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);i.isVisible=this._isVisible(e);i.groupId=e.groupId;i.isMandatory=this._isMandatory(undefined,e);i.index=e.index;i.width=this._getWidth(e);i.control=e.customControl;i.isCustomFilterField=true;this._applyWidth(i);return i;};s.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name;}else{return e.parentPropertyName+"."+e.name;}};s.prototype._hasValueHelpDialog=function(e,i){var v=true;if(i){if(i.controlType===sap.ui.comp.smartfilterbar.ControlType.dropDownList){v=false;}else if(i.hasValueHelpDialog!==true){v=false;}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single||e.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){v=false;}}return v;};s.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false;}return true;};s.prototype._getWidth=function(e){if(e&&e.width){return e.width;}return undefined;};s.prototype._isMandatory=function(e,i){if(i&&i.mandatory!==sap.ui.comp.smartfilterbar.MandatoryType.auto){return i.mandatory===sap.ui.comp.smartfilterbar.MandatoryType.mandatory;}if(e){return e.requiredFilterField;}return false;};s.prototype._getFilterRestriction=function(e,i){var j;if(i&&i.filterType&&i.filterType!==sap.ui.comp.smartfilterbar.FilterType.auto){j=i.filterType;}else if(e.filterRestriction==="single-value"){j=sap.ui.comp.smartfilterbar.FilterType.single;}else if(e.filterRestriction==="multi-value"){j=sap.ui.comp.smartfilterbar.FilterType.multiple;}else if(e.filterRestriction==="interval"){j=sap.ui.comp.smartfilterbar.FilterType.interval;}else{j=sap.ui.comp.smartfilterbar.FilterType.auto;}return j;};s.prototype._getControlType=function(e,i){var j;if(i&&i.controlType&&i.controlType!==sap.ui.comp.smartfilterbar.ControlType.auto){j=i.controlType;}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.isCalendarDate){j=sap.ui.comp.smartfilterbar.ControlType.date;}else if(e.type==="Edm.DateTimeOffset"){j=sap.ui.comp.smartfilterbar.ControlType.dateTimePicker;}else if(e.hasValueListAnnotation&&e.hasFixedValues){j=sap.ui.comp.smartfilterbar.ControlType.dropDownList;}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){j=sap.ui.comp.smartfilterbar.ControlType.dropDownList;}else{j=sap.ui.comp.smartfilterbar.ControlType.input;}return j;};s.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&(e.filterRestriction==="single")){return true;}return false;};s.prototype._getGroupID=function(e,i){if(i&&i.groupId){return i.groupId;}else if(e&&(e.requiredFilterField||(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1))){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(e);};s.prototype._getGroupIDFromFieldGroup=function(e){var L=0,i=null,G;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){G=i.groupName;break;}}}return G;};s.prototype._getLabel=function(e,i){if(i&&i.label){return i.label;}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName;};s.prototype._getLabelFromFieldGroup=function(e){var L=0,i=null,j;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){j=i.labels[e.fieldNameOData];break;}}}return j;};s.prototype._getIndex=function(e,i){if(i&&(i.index>=0)){return i.index;}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData);}return this._getIndexFromFieldGroup(e);};s.prototype._getIndexFromFieldGroup=function(e){var L=0,i=null,j;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){L=this._aFieldGroupAnnotation.length;while(L--){i=this._aFieldGroupAnnotation[L];if(i&&i.fields){j=i.fields.indexOf(e.fieldNameOData);if(j>-1){break;}j=undefined;}}}return j;};s.prototype._getGroupIndex=function(G){if(G&&(G.index||G.index===0)){return G.index;}};s.prototype._getGroupLabel=function(e,G){if(G&&G.label){return G.label;}return e.groupLabel||e.groupName||e.groupEntityName;};s.prototype._hasTypeAhead=function(e,i,j){var H;H=true;if(j){H=j.hasTypeAhead;}else if(i.type!=="Edm.String"){return false;}if(!(e.fControlConstructor===c||e.fControlConstructor===d)){return false;}return H;};s.prototype.getModel=function(){return this.oModel;};s.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};s.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider;};s.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider;};s.prototype.getParameters=function(){var P,B=null;if(this.oModel){B=this.oModel.getProperty("/"+s.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||B){P={custom:{}};if(this._sBasicSearchFieldName){P.custom["search-focus"]=this._sBasicSearchFieldName;}P.custom["search"]=B||"";}return P;};s.prototype.getFilters=function(e){var i=null;if(this.oModel){i=this.oModel.getData();}return s.generateFilters(e,i,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,viewMetadataData:this._aFilterBarViewMetadata});};s.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};s.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};s.prototype.getFilledFilterData=function(e){var i,j={},k,n,v;i=this.oModel?this.oModel.getData():null;if(i&&e){k=e.length;while(k--){n=e[k];if(n&&n!==s.BASIC_SEARCH_FIELD_ID){v=i[n];if(v&&v.hasOwnProperty("low")){if(v.low){j[n]=v;}}else if(v&&v.hasOwnProperty("items")){if(v.value&&typeof v.value==="string"){v.value=v.value.trim();}if(v.items.length||(v.ranges&&v.ranges.length)||v.value){j[n]=v;}}else if(v){if(typeof v==="string"){v=v.trim();}if(v){j[n]=v;}}}if(k===0){n=s.CUSTOM_FIELDS_MODEL_PROPERTY;v=i[n];if(v){j[n]=v;}}}}return q.extend(true,{},j);};s.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e));};s.prototype.setFilterData=function(j,R){var e=null,i=null,k=null;if(this.oModel&&j){this._bUpdatingFilterData=true;try{if(R){this._createInitialModel(false);}e=this._parseFilterData(j,R);if(e){this.oModel.setData(e,true);i=[];var n=arguments[2];if(n){i.push(n);}for(k in e){i.push(k);}this._handleFilterDataUpdate(i);}}finally{this._bUpdatingFilterData=false;}}};s.prototype.setFilterDataAsString=function(j,R){if(j){this.setFilterData(JSON.parse(j),R);}};s.prototype._parseFilterData=function(j,R){return s.parseFilterData(this.oModel.getData(),j,{stringDateFields:this._aFilterBarStringDateFieldNames,dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames},R);};s.prototype._handleFilterDataUpdate=function(e){var i=0,j,k,n;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!k){k=this.oModel.getData();}if(k){j=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(j.fieldName)>-1){n=k[j.fieldName];if(n){this._updateMultiValueControl(j.control,n.items,n.ranges,j);}}}}this._updateConditionTypeFields();}};s.prototype.clear=function(){this._createInitialModel(false);};s.prototype.reset=function(){this._createInitialModel(true);};s.prototype._initializeConditionTypeFields=function(){var e=function(i){this.setPending(this.isPending());}.bind(this);for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(this.oModel.getData()[n]);if(this._mConditionTypeFields[n].conditionType.getAsync()){this._mConditionTypeFields[n].conditionType.attachPendingChange(e);}}};s.prototype._updateConditionTypeFields=function(){var e=this._oldData;var i=this.oModel.getData();this._oldData=q.extend(true,{},i);if(e!==undefined){var u=[],n;for(n in i){var N=JSON.stringify(i[n]);var j=JSON.stringify(e[n]);if(N!==j){u.push(n);}}if(u.length>0){for(n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.providerDataUpdated(u,i);}}}};s.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(e[n]);}};s.prototype._validateConditionTypeFields=function(){var i=false;for(var n in this._mConditionTypeFields){var v=this._mConditionTypeFields[n].conditionType.validate();if(!v&&!i){i=true;}}return i;};s._getFieldMetadata=function(v,e){var i=null;v.some(function(G){if(G&&G.fields){G.fields.some(function(j){if(j&&j.fieldName===e){i=j;}return i!==null;});}return i!==null;});return i;};s.generateFilters=function(e,i,j){var k=[],A=null,n=null,t=null,u=null,v=s.FIELD_NAME_REGEX,w=null,x,y,z=null,L=0,B=0;var G,H,K,N,U,P,Q,R,W,X=[];if(j){G=j.dateSettings;H=j.useContainsAsDefault;K=j.stringFields;N=j.timeFields;Q=j.dateTimeOffsetValueFields;X=j.viewMetadataData||[];}if(e&&i){B=e.length;while(B--){P=false;R=false;u=e[B];W=s._getFieldMetadata(X,u);if(u&&u!==s.BASIC_SEARCH_FIELD_ID){U=false;if(H&&K){if(K.indexOf(u)>-1){U=true;}}else if(N&&N.indexOf(u)>-1){P=true;}else if(Q&&Q.indexOf(u)>-1){R=true;}w=i[u];u=u.replace(v,"/");if(w&&w.hasOwnProperty("low")){if(w.low&&w.high){x=w.low;y=w.high;if(G&&G.UTC&&x instanceof Date&&y instanceof Date){x=s.getDateInUTCOffset(x);y=s.getDateInUTCOffset(y);}k.push(new F(u,sap.ui.model.FilterOperator.BT,x,y));}else if(w.low){if(w.low instanceof Date){x=w.low;if(G&&G.UTC){x=s.getDateInUTCOffset(x);}k.push(new F(u,sap.ui.model.FilterOperator.EQ,x));}else if(typeof w.low==="string"){if(R){z=m.parseDateTimeOffsetInterval(w.low);if(z){var Y=sap.ui.core.format.DateFormat.getDateTimeInstance({UTC:false});var Z=Y.parse(z[0]);if(z.length===1){z[0]=Z?s.getDateInUTCOffset(Z):s.getDateInUTCOffset(new Date(z[0]));}else if(z.length===2){z[0]=Z?s.getDateInUTCOffset(Z):s.getDateInUTCOffset(new Date(z[0]));Z=Y.parse(z[1]);z[1]=Z?s.getDateInUTCOffset(Z):s.getDateInUTCOffset(new Date(z[1]));}}}else{z=m.parseFilterNumericIntervalData(w.low);}if(z&&z.length===2){k.push(new F(u,sap.ui.model.FilterOperator.BT,z[0],z[1]));}else{k.push(new F(u,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,w.low));}}}}else if(w&&w.hasOwnProperty("items")){A=[];t=[];n=null;if(w&&w.hasOwnProperty("ranges")){z=w.ranges;L=z.length;while(L--){x=z[L].value1;y=z[L].value2;if(P){if(x instanceof Date){x=m.getEdmTimeFromDate(x);}if(y instanceof Date){y=m.getEdmTimeFromDate(y);}}else if(W&&W.isCalendarDate){x=W.ui5Type.parseValue(x);y=W.ui5Type.parseValue(y);}else if(G&&G.UTC){if(x instanceof Date){x=s.getDateInUTCOffset(x);}if(y instanceof Date){y=s.getDateInUTCOffset(y);}}if(z[L].exclude){if(z[L].operation===sap.ui.model.FilterOperator.EQ){t.push(new F(u,sap.ui.model.FilterOperator.NE,x));}}else{if(z[L].operation===sap.ui.model.FilterOperator.BT){A.push(new F(u,z[L].operation,x,y));}else{A.push(new F(u,z[L].operation,x));}}}if(t.length){n=new F(t,true);}}z=w.items;L=z.length;while(L--){A.push(new F(u,sap.ui.model.FilterOperator.EQ,z[L].key));}if(w.value||w.value===0||w.value===false){if(typeof w.value==="string"){w.value=w.value.trim();}if(w.value||w.value===0||w.value===false){A.push(new F(u,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,w.value));}}if(A.length){if(n){k.push(new F([new F(A,false),n],true));}else{k.push(new F(A,false));}}else if(n){k.push(n);}}else if(w||w===0||w===false){if(typeof w==="string"){w=w.trim();}if(w&&w instanceof Date){if(P){w=m.getEdmTimeFromDate(w);}else if(G&&G.UTC){w=s.getDateInUTCOffset(w);}}if(w||w===0||w===false){k.push(new F(u,U?sap.ui.model.FilterOperator.Contains:sap.ui.model.FilterOperator.EQ,w));}}}}}return(k.length>1)?[new F(k,true)]:k;};s.parseFilterData=function(e,j,k,R){var n={},t=null,u=null,v=null,N,w,i,L,x,y,z,A,B,G,H;if(k){y=k.stringDateFields;z=k.dateFields;A=k.timeFields;B=k.timeIntervalFields;G=k.dateTimeMultiValueFields;t=k.conditionTypeFields||{};H=k.dateTimeOffsetValueFields;}if(!y){y=[];}if(!z){z=[];}if(!A){A=[];}if(!B){B=[];}if(!G){G=[];}if(!H){H=[];}if(e&&j){w=q.extend({},j,true);for(u in w){if(e.hasOwnProperty(u)&&u!==s.CUSTOM_FIELDS_MODEL_PROPERTY){v=e[u];N=w[u];if(u in t){if("conditionTypeInfo"in N||(!("conditionTypeInfo"in N)&&N.ranges)){t[u].conditionType.initialize(N);}}else if(v&&v.hasOwnProperty("low")){n[u]=N;if(N){if(N.low&&N.high){if((z.indexOf(u)>-1)||(A.indexOf(u)>-1)){if(!(N.low instanceof Date)){n[u].low=new Date(N.low);}if(!(N.high instanceof Date)){n[u].high=new Date(N.high);}}else if(y.indexOf(u)==-1){n[u].low=N.low+'-'+N.high;n[u].high=null;}}else if((N.low||N.value)&&!N.high){if(!N.low&&N.value){N.low=N.value;}if((z.indexOf(u)>-1||A.indexOf(u)>-1)&&!(N.low instanceof Date)){n[u].low=new Date(N.low);}else{n[u].low=N.low;}n[u].high=null;}}}else if(v&&v.hasOwnProperty("items")){if(N&&(N.items||N.ranges)){if(N.ranges&&N.ranges.length){if(B.indexOf(u)>-1){L=N.ranges.length;for(i=0;i<L;i++){x=N.ranges[i];if(!x.exclude&&(x.operation==="EQ"||x.operation==="BT")){break;}x=null;}if(x){if(x.value1&&typeof x.value1==="string"){x.value1=new Date(x.value1);}if(x.value2&&typeof x.value2==="string"){x.value2=new Date(x.value2);}n[u]={ranges:[x],items:[],value:""};}continue;}else if(z.indexOf(u)>-1||A.indexOf(u)>-1||H.indexOf(u)>-1){L=N.ranges.length;for(i=0;i<L;i++){x=N.ranges[i];if(x.value1&&typeof x.value1==="string"){x.value1=new Date(x.value1);}if(x.value2&&typeof x.value2==="string"){x.value2=new Date(x.value2);}}}else if((N.ranges.length===1)&&(N.ranges[0].operation==="EQ")&&!N.ranges[0].value1){continue;}}n[u]=N;if(!R&&n[u].ranges){for(i=0;i<n[u].ranges.length;i++){n[u].ranges[i].tokenText=null;}}}else if(typeof N==="string"||typeof N==="number"||N instanceof Date){if(N&&(z.indexOf(u)>-1||A.indexOf(u)>-1)){if(typeof N==="string"){N=new Date(N);}n[u]={ranges:[{"exclude":false,"operation":"EQ","keyField":u,"value1":N,"value2":null}],items:[],value:""};}else{n[u]={value:N,items:[]};}}}else{n[u]=null;if(typeof N==="string"||typeof N==="boolean"||typeof N==="number"||N instanceof Date){if(typeof N==="string"&&(z.indexOf(u)>-1||A.indexOf(u)>-1||H.indexOf(u)>-1)){n[u]=new Date(N);}else{n[u]=N;}}else if(N&&(N.value||N.value===0||N.value===false)){n[u]=N.value;}else if(N&&N.items&&N.items.length){n[u]=N.items[0].key;}else if(N&&N.ranges&&N.ranges.length){L=N.ranges.length;for(i=0;i<L;i++){x=N.ranges[i];if(!x.exclude&&x.operation==="EQ"){break;}x=null;}if(x&&x.value1){if(typeof x.value1==="string"&&(z.indexOf(u)>-1||A.indexOf(u)>-1||H.indexOf(u)>-1)){n[u]=new Date(x.value1);}else{n[u]=x.value1;}}}}}else if(R||u===s.CUSTOM_FIELDS_MODEL_PROPERTY){n[u]=w[u];}}}return n;};s.getDateInUTCOffset=function(e){return new Date(e.valueOf()-e.getTimezoneOffset()*60*1000);};s.prototype.destroy=function(){var e=function(A){var i;if(A){i=A.length;while(i--){A[i].destroy();}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oParameterization=null;this._oNonAnaParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarStringDateFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFilterBarDateTimeFieldNames=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var H in this._mTokenHandler){var j=this._mTokenHandler[H];if(j.parser){j.parser.destroy();j.parser=null;}}delete this._mTokenHandler;}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy();}this._oEventProvider=null;}for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.destroy();}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null;}this.bIsDestroyed=true;};return s;},true);
