/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../Scene","./NodeHierarchy","sap/ui/vk/threejs/thirdparty/matai"],function(q,S,N,a){"use strict";var b=S.extend("sap.ui.vk.threejs.Scene",{metadata:{publicMethods:["getDefaultNodeHierarchy","getId","getSceneRef"]},constructor:function(s){S.call(this);this._id=q.sap.uid();this._scene=s;this._state=null;this._defaultNodeHierarchy=null;}});b.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._state=null;this._scene=null;S.prototype.destroy.call(this);};b.prototype.getId=function(){return this._id;};b.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};function c(d,e){var f=d.min,g=d.max,m=e.elements,h=(f.x+g.x)*0.5,i=(f.y+g.y)*0.5,j=(f.z+g.z)*0.5,k=g.x-h,l=g.y-i,n=g.z-j;var t=m[0]*h+m[4]*i+m[8]*j+m[12];var o=m[1]*h+m[5]*i+m[9]*j+m[13];var p=m[2]*h+m[6]*i+m[10]*j+m[14];var r=Math.abs(m[0]*k)+Math.abs(m[4]*l)+Math.abs(m[8]*n);var s=Math.abs(m[1]*k)+Math.abs(m[5]*l)+Math.abs(m[9]*n);var u=Math.abs(m[2]*k)+Math.abs(m[6]*l)+Math.abs(m[10]*n);f.set(t-r,o-s,p-u);g.set(t+r,o+s,p+u);}b.prototype._computeBoundingBox=function(){var d=new THREE.Box3();if(this._scene){var n=new THREE.Box3();this._scene.traverse(function(e){var g=e.geometry;if(g!==undefined){if(!g.boundingBox){g.computeBoundingBox();}if(!g.boundingBox.isEmpty()){n.copy(g.boundingBox);c(n,e.matrixWorld);d.min.min(n.min);d.max.max(n.max);}}var s=e.userData.boundingBox;if(s!==undefined&&!s.isEmpty()){n.copy(s);c(n,e.matrixWorld);d.min.min(n.min);d.max.max(n.max);}});}return d;};b.prototype.getSceneRef=function(){return this._scene;};b.prototype._setState=function(s){this._state=s;};b.prototype.nodeRefToPersistentId=function(n){if(Array.isArray(n)){var i=[];n.forEach(function(d){i.push(Matai.object3DToSid(d));});return i;}else{return Matai.object3DToSid(n);}};b.prototype.persistentIdToNodeRef=function(p){if(Array.isArray(p)){var s=this._state;var n=[];p.forEach(function(d){n.push(Matai.sidToObject3D(s,d));});return n;}else{return Matai.sidToObject3D(this._state,p);}};return b;});
