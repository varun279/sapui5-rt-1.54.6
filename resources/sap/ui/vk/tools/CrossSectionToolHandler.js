sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";var C=E.extend("sap.ui.vk.tools.CrossSectionToolHandler",{metadata:{publicMethods:["hover","beginGesture","move","endGesture","click","doubleClick","contextMenu"]},constructor:function(t){this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new THREE.Vector2();this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0;this._gizmoOrigin=new THREE.Vector3();this._gizmoAxis=new THREE.Vector3();}});C.prototype.destroy=function(){this._tool=null;this._gizmo=null;this._rect=null;this._rayCaster=null;this._gizmoAxis=null;this._gizmoOrigin=null;this._mouse=null;};C.prototype._updateRayCaster=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};C.prototype.hover=function(e){};C.prototype._getAxisOffset=function(){};C.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture&&e.n===1){this._updateRayCaster(e);var t=this._gizmo.getTouchObject();if(t){var i=this._rayCaster.intersectObject(t,true);if(i.length>0){if(this._gizmo._plane.distanceToPoint(this._rayCaster.ray.origin)>0){this._rayCaster.far=i[0].distance;var a=this._rayCaster.intersectObject(this._gizmo._viewport.getScene().getSceneRef(),true);this._rayCaster.far=undefined;if(a.length>0){return;}}this._gizmoOrigin.copy(i[0].point);this._gizmoAxis.set(0,0,0).setComponent(this._gizmo._axis,1);this._gesture=true;e.handled=true;}}}};C.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateRayCaster(e);var r=this._rayCaster.ray;var d=this._gizmoAxis.clone().cross(r.direction).cross(r.direction).normalize();var a=r.origin.clone().sub(this._gizmoOrigin);var o=d.dot(a)/d.dot(this._gizmoAxis);if(!isNaN(o)){this._gizmo._setOffset(this._gizmoOrigin.dot(this._gizmoAxis)+o);}}};C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;}};C.prototype.click=function(e){};C.prototype.doubleClick=function(e){};C.prototype.contextMenu=function(e){};C.prototype.getViewport=function(){return this._tool._viewport;};C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};C.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};return C;},true);
