/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","./Gizmo"],function(q,l,G){"use strict";var C=G.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk.tools",privateMethods:["hasDomElement","setAxis","setFlip","adjustCameraClipPlanes","render"]}});C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._gizmo=new THREE.Scene();this._position=new THREE.Vector3(0,0,0);this._plane=new THREE.Plane(new THREE.Vector3(0,0,1),0);this._flip=false;this.setAxis(0);};C.prototype.hasDomElement=function(){return false;};C.prototype.show=function(v,t){this._viewport=v;this._tool=t;var b=v._scene._computeBoundingBox();this._position.copy(b.getCenter());this._plane.constant=-this._plane.normal.dot(this._position);v.setClippingPlanes([this._plane]);};C.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null;}this._tool=null;};C.prototype.setAxis=function(i){this._axis=i;var d=new THREE.Vector3().setComponent(i,1);this._plane.normal.set(0,0,0).setComponent(i,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);while(this._gizmo.children.length>0){this._gizmo.remove(this._gizmo.children[this._gizmo.children.length-1]);}var a=new THREE.Vector3(d.y,d.z,d.x);var b=new THREE.Vector3(d.z,d.x,d.y);var g=new THREE.BufferGeometry();var v=new Array(15);var p=new THREE.Vector3();p.sub(a).sub(b).multiplyScalar(0.5).toArray(v,0);p.toArray(v,12);p.add(a).toArray(v,3);p.add(b).toArray(v,6);p.sub(a).toArray(v,9);g.addAttribute("position",new THREE.Float32BufferAttribute(v,3));var c=new THREE.Line(g,new THREE.LineBasicMaterial({color:0xFFFFFF,transparent:true,linewidth:window.devicePixelRatio}));this._gizmo.add(c);v.length=12;g=new THREE.BufferGeometry();g.setIndex([0,1,2,0,2,3]);g.addAttribute("position",new THREE.Float32BufferAttribute(v,3));this._touchMesh=new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:0xFFFFFF,visible:false,opacity:0.1,transparent:true,side:THREE.DoubleSide}));this._gizmo.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};C.prototype.setFlip=function(f){this._flip=!!f;this._plane.normal.set(0,0,0).setComponent(this._axis,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};C.prototype.getTouchObject=function(){return this._touchMesh;};C.prototype._setOffset=function(o){var b=this._viewport._scene._computeBoundingBox();o=THREE.Math.clamp(o,b.min.getComponent(this._axis),b.max.getComponent(this._axis));this._position.setComponent(this._axis,o);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame();};C.prototype._adjustBoundingBox=function(b){var s=b.getSize();var d=Math.max(s.x,s.y,s.z)*0.2;b.expandByScalar(d);};C.prototype.adjustCameraClipPlanes=function(c,b){b=b.clone();this._adjustBoundingBox(b);c.adjustClipPlanes(b);};C.prototype.render=function(){var i=this._axis;var b=this._viewport._scene._computeBoundingBox();var o=THREE.Math.clamp(this._position.getComponent(i),b.min.getComponent(i),b.max.getComponent(i));this._position.setComponent(i,o);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(b);this._gizmo.position.copy(b.getCenter());this._gizmo.position.setComponent(i,o);this._gizmo.scale.copy(b.getSize());this._viewport.getRenderer().render(this._gizmo,this._viewport.getCamera().getCameraRef());};C.prototype.onBeforeRendering=function(){};C.prototype.onAfterRendering=function(){};return C;},true);
