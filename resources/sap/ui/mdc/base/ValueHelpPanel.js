/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2018 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/core/XMLComposite',"sap/ui/model/json/JSONModel"],function(q,X,J){"use strict";var V=X.extend("sap.ui.mdc.base.ValueHelpPanel",{metadata:{properties:{showTokenizer:{type:"boolean",group:"Data",defaultValue:true},showFilterbar:{type:"boolean",group:"Data",defaultValue:true}},events:{onBasicSearchChange:{parameters:{value:{type:"string"}}},SearchTemplateChange:{parameters:{key:{type:"string"}}}}},fragment:"sap.ui.mdc.base.ValueHelpPanel",init:function(){if(!this._oTokenizer){this._oTokenizer=this.byId("VHPTokenizer");this._oTokenizer.updateTokens=function(){this.updateAggregation("tokens");};}},initModel:function(c){var f=c.getFilterField();this.sFieldPath=f.getFieldPath();this.setModel(c,"cm");},updateModel:function(c){if(this.getModel("cm")){this.getModel("cm").destroy();this.setModel(null,"cm");}var C=c.clone(this.sFieldPath);this.setModel(C,"cm");},merge:function(c){c.merge(this.sFieldPath,this.getModel("cm"));},exit:function(){if(this.getModel("cm")){this.getModel("cm").destroy();}},setFilterbar:function(f){var s=this.byId("filterbarSplitter");if(this._oFilterbar){s.removeContentArea(this._oFilterbar);}this._oFilterbar=f;if(f){f.setLayoutData(new sap.ui.layout.SplitterLayoutData({size:"280px"}));this._updateFilterbarVisibility(this.getShowFilterbar());}var i=this.byId("iconTabBar");i.getItems()[0].setVisible(i.getItems()[0].getContent().length>0);i.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity();},setTable:function(t){var s=this.byId("filterbarSplitter");if(this._oTable){s.removeContentArea(this._oTable);}this._oTable=t;if(t){t.setLayoutData(new sap.ui.layout.SplitterLayoutData({size:"auto"}));s.insertContentArea(t,1);}var i=this.byId("iconTabBar");i.getItems()[0].setVisible(i.getItems()[0].getContent().length>0);i.setSelectedKey("selectFromList");this._updateITBHeaderVisiblity();},setDefineConditions:function(d){var i=this.byId("iconTabBar");if(this._oDefineConditionPanel){i.getItems()[1].removeContent(this._oDefineConditionPanel);this._oDefineConditionPanel.destroy();}this._oDefineConditionPanel=d;if(d){i.getItems()[1].addContent(d);}i.getItems()[1].setVisible(i.getItems()[1].getContent().length>0);this._updateITBHeaderVisiblity();},_updateITBHeaderVisiblity:function(){var i=this.byId("iconTabBar");if(i.getItems()[0].getVisible()&&i.getItems()[1].getVisible()){i.removeStyleClass("sapMdcNoHeader");}else{i.addStyleClass("sapMdcNoHeader");}},onBeforeRendering:function(){if(this.getModel("cm")){var f=this.getModel("cm").getFilterField();this.sFieldPath=f.getFieldPath();if(!this.oConditionModel){this.oConditionModel=this.getModel("cm");var c=this.oConditionModel.bindProperty("/",this.oConditionModel.getContext("/"));c.attachChange(function(e){});}}},_formatTokenText:function(c){var r="";if(c){var C=this.getModel("cm");var o=C.getFilterOperatorConfig().getOperator(c.operator);var f=C.getFilterField();var d=f._getDataType();r=o.format(c.values,c,d);}return r;},_handleTokenUpdate:function(e){if(e.getParameter("type")==="removed"){var r=e.getParameter("removedTokens");var t=r[0];var c=t.getBindingContext("cm").getObject();var C=this.getModel("cm");C.removeCondition(c);}},_handleBasicSearch:function(e){this.fireOnBasicSearchChange({"value":e.getParameter("query")});},setShowFilterbar:function(v){var o=this.getShowFilterbar();this.setProperty("showFilterbar",v);if(o!==this.getShowFilterbar()){this._oAdvButton=this.byId("AdvancedFilter");this._oAdvButton.setPressed(v);this._updateFilterbarVisibility(v);}return this;},_handleToggleFilterVisibility:function(e){var p=e.getParameter("pressed");this._updateFilterbarVisibility(p);},_updateFilterbarVisibility:function(v){if(!this._oFilterbar){return;}var s=this.byId("filterbarSplitter");if(v){s.insertContentArea(this._oFilterbar,0);}else{s.removeContentArea(this._oFilterbar);}},setShowTokenizer:function(v){var o=this.getShowTokenizer();this.setProperty("showTokenizer",v);if(o!==this.getShowTokenizer()){var s=this.byId("rootSplitter");if(!this._oTokenizerContainer){this._oTokenizer=this.byId("VHPTokenizer");this._oTokenizerContainer=this._oTokenizer.getParent();}if(this.getShowTokenizer()){s.insertContentArea(this._oTokenizerContainer,1);}else{s.removeContentArea(this._oTokenizerContainer);}}return this;},setSearchTemplateModelData:function(s){this._oVM=this.byId("VHPVariantManagementCtrl");this._oVM.setVisible(!!s);var m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");s.popoverTitle=m.getText("valuehelp.SEARCHTEMPLATE_POPOVERTITLE");this._oSearchTemplateModel=new J();var d={};d[this._oVM.getId()]=s;this._oSearchTemplateModel.setData(d);this._oVM.setModel(this._oSearchTemplateModel,"VHPSearchTemplates");var c=this._oSearchTemplateModel.bindProperty("currentVariant",this._oVM.getBindingContext("VHPSearchTemplates"));c.attachChange(function(e){this.fireSearchTemplateChange({"key":e.oSource.oValue});}.bind(this));}});return V;},true);
