// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ui2.srvc.ODataService");var r;r=function(){jQuery.sap.require.apply(this,arguments);};function n(){}var c;if(!sap.ui2.srvc.Map){r("sap.ui2.srvc.utils");}c=new sap.ui2.srvc.Map();sap.ui2.srvc.ODataService=function(o,d){var b;this.getCsrfToken=function(){if(c.get(b)&&c.get(b).token){return c.get(b).token;}return"";};this.getDefaultErrorHandler=function(){return d;};this.openBatchQueue=function(){o.openBatchQueue();};this.refreshCsrfToken=function(s,f){var t;if(typeof s!=="function"){throw new sap.ui2.srvc.Error("Success callback is not a function","sap.ui2.srvc.ODataService");}f=f||d;t=c.get(b);if(!t.fetchingInProgress){t.token=undefined;t.fetchingInProgress=true;o.read("",function(){if(!c.get(b)||!c.get(b).token){f("No CSRF token delivered");t.errorHandlers.forEach(function(h){h("No CSRF token delivered");});}else{s();t.successHandlers.forEach(function(h){h();});}t.successHandlers=[];t.errorHandlers=[];t.fetchingInProgress=false;},f);}else{t.successHandlers.push(s);t.errorHandlers.push(f);}};this.setCsrfToken=function(N){var t;if(N&&typeof N!=="string"){throw new sap.ui2.srvc.Error("Invalid CSRF token: "+N,"sap.ui2.srvc.ODataService");}t=c.get(b);t.token=N;};this.setDefaultErrorHandler=function(N){if(N&&typeof N!=="function"){throw new sap.ui2.srvc.Error("Error callback is not a function","sap.ui2.srvc.ODataService");}d=N||n;};this.submitBatchQueue=function(){o.submitBatchQueue.apply(o,arguments);};this.toString=function(v){var R=['sap.ui2.srvc.ODataService({'];if(v){R.push('csrfToken:"',this.getCsrfToken(),'"');R.push(',oODataWrapper:',o.toString(true));}R.push('})');return R.join('');};if(!sap.ui2.srvc.Error){r("sap.ui2.srvc.error");}if(!o){throw new sap.ui2.srvc.Error("Missing OData wrapper","sap.ui2.srvc.ODataService");}b=o.getBaseUrl();if(!c.get(b)){c.put(b,{fetchingInProgress:false,successHandlers:[],errorHandlers:[]});}this.setDefaultErrorHandler(d);};sap.ui2.srvc.ODataService.resetSharedCsrfTokens=function(){c=new sap.ui2.srvc.Map();};}());
