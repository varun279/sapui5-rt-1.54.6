// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
this.sap=this.sap||{};(function(){"use strict";sap.ui2=sap.ui2||{};sap.ui2.srvc=sap.ui2.srvc||{};var r=String;if(typeof jQuery==="function"&&jQuery.sap){jQuery.sap.declare("sap.ui2.srvc.factory");r=function(){jQuery.sap.require.apply(this,arguments);};}sap.ui2.srvc.Factory=function(p){var c={},C={},m={},R,t=this;this.addRemoteCatalogService=function(b,o){if(!b){throw new sap.ui2.srvc.Error("Invalid base URL","sap.ui2.srvc.Factory");}if(typeof o.readChips!=="function"){throw new sap.ui2.srvc.Error("Invalid remote catalog service","sap.ui2.srvc.Factory");}b=b.replace(/\/$/,"");if(R.containsKey(b)){throw new sap.ui2.srvc.Error("Base URL '"+b+"' already registered","sap.ui2.srvc.Factory");}R.put(b,o);};this.createCatalog=function(v,s,f){var t=this,o,a=typeof v==="object"?v.id:v;function F(){var A;f=f||t.getPageBuildingService().getDefaultErrorHandler();if(f){A=Array.prototype.slice.call(arguments);A.splice(1,0,o);f.apply(null,A);}}function b(){F.apply(null,o.getCachedRemoteFailureArguments());}if(Object.prototype.hasOwnProperty.call(C,a)){o=C[a].catalog;if(typeof v==="object"&&o.getCatalogData()===undefined){sap.ui2.srvc.Catalog.call(o,this,v);}}else{r("sap.ui2.srvc.catalog");o=new sap.ui2.srvc.Catalog(this,v);C[a]={catalog:o,chips:{}};}if(s){if(o.isStub()){o.load(s.bind(null,o),F);}else{if(o.getCachedRemoteFailureArguments()!==undefined){sap.ui2.srvc.call(b,b,true);}else{sap.ui2.srvc.call(s.bind(null,o),F,true);}}}return o;};this.createChip=function(o,s,f){var a=o.remoteCatalogId,b=o.id,d,e;if(a){this.createCatalog(a);d=C[a].chips;}else{d=c;}if(Object.prototype.hasOwnProperty.call(d,b)){e=d[b];e.update(o);}else{r("sap.ui2.srvc.chip");e=new sap.ui2.srvc.Chip(o,this);d[b]=e;}if(s){if(e.isStub()){e.load(s.bind(null,e),f);}else{f=f||this.getPageBuildingService().getDefaultErrorHandler();sap.ui2.srvc.call(s.bind(null,e),f,true);}}return e;};this.createChipDefinition=function(u,s,f){var o,l;function a(O,S,d,A){sap.ui2.srvc.call(S.bind(null,new sap.ui2.srvc.ChipDefinition(O)),d,A);}function b(x){var i,n,o=new sap.ui2.srvc.ChipDefinition(x);m[u]=o;for(i=0,n=l.length;i<n;i+=2){a(o,l[i],l[i+1],false);}}function e(E){var i,n,M;if(typeof E==="string"){M=E;}else{M=E.message;}m[u]=M;for(i=0,n=l.length;i<n;i+=2){l[i+1](M);}}if(!u){throw new sap.ui2.srvc.Error("Missing URL","sap.ui2.srvc.Factory");}if(typeof s!=="function"){throw new sap.ui2.srvc.Error("Missing success handler","sap.ui2.srvc.Factory");}f=f||this.getPageBuildingService().getDefaultErrorHandler();if(window.jQuery&&jQuery.sap&&typeof jQuery.sap.loadResource==="function"){u=sap.ui2.srvc.addCacheBusterTokenUsingUshellConfig(u);}if(Object.prototype.hasOwnProperty.call(m,u)){o=l=m[u];if(sap.ui2.srvc.isArray(l)){l.push(s,f);}else if(o instanceof sap.ui2.srvc.ChipDefinition){a(o,s,f,true);}else{sap.ui2.srvc.call(f.bind(null,o),null,true);}return;}r("sap.ui2.srvc.chipdefinition");l=[s,f];m[u]=l;if(window.jQuery&&jQuery.sap&&typeof jQuery.sap.loadResource==="function"){jQuery.sap.loadResource({dataType:"xml",url:u,async:true}).then(b).catch(e);}else{sap.ui2.srvc.get(u,true,b,e);}};this.createChipInstance=function(o,s,f,P){var a,b;o.Chip=o.Chip||{$proxy:true};o.Chip.id=o.Chip.id||o.chipId;o.Chip.remoteCatalogId=o.Chip.remoteCatalogId||o.remoteCatalogId;if(o.RemoteCatalog&&o.RemoteCatalog.id){this.createCatalog(o.RemoteCatalog);}a=this.createChip(o.Chip);r("sap.ui2.srvc.chipinstance");b=new sap.ui2.srvc.ChipInstance(this,o,a,P);if(s){b.load(s.bind(null,b),f);}return b;};this.createNewCatalog=function(o,s,f){this.getPageBuildingService().createCatalog(o,function(a){var b=t.createCatalog(a);b.load(s.bind(null,b),function(e,E){f(e,b,E);});},function(e,M){f(e,undefined,M);});};this.createNewPageBasedCatalog=function(d,T,s,f){this.getPageBuildingService().createPageBasedCatalog(d,T,function(o){t.createCatalog(o,s,f);},f);};this.createPage=function(P,s,f,b){var o;r("sap.ui2.srvc.page");o=new sap.ui2.srvc.Page(this,P);if(s){o.load(s.bind(null,o),f,b);}return o;};this.createPageSet=function(P,s,f){var o;r("sap.ui2.srvc.pageset");o=new sap.ui2.srvc.PageSet(this,P);if(s){o.load(s.bind(null,o),f);}return o;};this.forgetCatalog=function(o){delete C[o.getId()];};this.getPageBuildingService=function(){return p;};this.getRemoteCatalogService=function(o){var b=o.type==='H'?"/sap/hba/apps/kpi/s/odata/hana_chip_catalog.xsodata":o.baseUrl;return b?R.get(b.replace(/\/$/,"")):undefined;};this.toString=function(v){var a=['sap.ui2.srvc.Factory({oPbs:',p.toString(v)];if(v){a.push(',mChips:',JSON.stringify(c));}a.push('})');return a.join('');};if(!sap.ui2.srvc.Map){r("sap.ui2.srvc.utils");}R=new sap.ui2.srvc.Map();if(!p){throw new sap.ui2.srvc.Error("Missing page building service","sap.ui2.srvc.Factory");}jQuery.sap.log.debug("Created: "+this,null,"sap.ui2.srvc.Factory");};sap.ui2.srvc.createFactory=function(b,d,i){if(!sap.ui2.srvc.createPageBuildingService){r("sap.ui2.srvc.PageBuildingService");}return new sap.ui2.srvc.Factory(sap.ui2.srvc.createPageBuildingService(b,d,i));};}());
