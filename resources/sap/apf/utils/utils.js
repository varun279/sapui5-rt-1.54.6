/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(['sap/ui/core/format/DateFormat'],function(u){'use strict';function c(d){var n=parseInt(d,10);if(n<10){return"0"+n;}return d;}var f;var s=0;var m={renderHeaderOfTextPropertyFile:function(a,b){var t=a.toLowerCase();var d=/^[0-9a-f]+$/;var i=d.test(t);if(!i||a.length!==32){b.putMessage(b.createMessageObject({code:"5409",aParameters:[a]}));t="<please enter valid translation uuid, if you want to upload into a SAP translation system>";}else{t=t.substring(0,8)+'-'+t.substring(8,12)+'-'+t.substring(12,16)+'-'+t.substring(16,20)+'-'+t.substring(20);}return"#FIORI: insert Fiori-Id\n"+"# __ldi.translation.uuid="+t+"\n"+"#ApfApplicationId="+a+"\n\n";},getUriParameters:function(){return jQuery.sap.getUriParameters().mParams;},createPromise:function(v){var d=jQuery.Deferred();d.resolve(v);return d.promise();},renderTextEntries:function(h,d){f=false;var k=h.getKeys();k.sort(function(a,b){var v=h.getItem(a);var e=h.getItem(b);if(v.LastChangeUTCDateTime<e.LastChangeUTCDateTime){return-1;}if(v.LastChangeUTCDateTime>e.LastChangeUTCDateTime){return 1;}return 0;});var l=k.length;var r='';var i;for(i=0;i<l;i++){r=r+sap.apf.utils.renderEntryOfTextPropertyFile(h.getItem(k[i]),d);}return r;},renderEntryOfTextPropertyFile:function(t,a){var d,D;if(!f&&(!t.TextElementType||!t.MaximumLength)){f=true;a.putMessage(a.createMessageObject({code:"5408",aParameters:[t.TextElement]}));}var e="#"+(t.TextElementType||"<Add text type>")+","+(t.MaximumLength||"<Add maximum length>");if(t.TranslationHint&&t.TranslationHint!==""){e=e+':'+t.TranslationHint;}e=e+"\n"+t.TextElement+"="+t.TextElementDescription+"\n";var o=u.getDateTimeInstance({pattern:"yyyy/MM/dd HH:mm:ss"});if(t.LastChangeUTCDateTime&&t.LastChangeUTCDateTime!==""){d=t.LastChangeUTCDateTime.replace(/\/Date\(/,'').replace(/\)\//,'');D=new Date(parseInt(d,10));}else{D=new Date();}e=e+"# LastChangeDate="+o.format(D)+'\n\n';return e;},eliminateDuplicatesInArray:function(M,w){M.check((w!==undefined&&typeof w==='object'&&w.hasOwnProperty('length')===true),'Error - aArray is undefined');var r=[];var i,j;for(i=0;i<w.length;i++){for(j=i+1;j<w.length;j++){if(w[i]===w[j]){j=++i;}}r.push(w[i]);}return r;},hashCode:function(v){var n=0;var i;var a=0;v=v.toString();var l=v.length;for(i=0;i<l;i++){a=v.charCodeAt(i);n=(17*n+a)<<0;}return Math.abs(n);},escapeOdata:function(v){if(typeof v==="string"){return v.replace("'","''");}return v;},json2javascriptFormat:function(v,t){var i;switch(t){case"Edm.Boolean":if(typeof v==="boolean"){return v;}if(typeof v==="string"){return v.toLowerCase()==="true";}return false;case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.String":return v;case"Edm.Int16":case"Edm.Int32":return parseInt(v,10);case"Edm.Single":case"Edm.Float":return parseFloat(v);case"Edm.Time":return v;case"Edm.DateTime":i=v.replace('/Date(','').replace(')/','');i=parseFloat(i);return new Date(i);case"Edm.DateTimeOffset":i=v.replace('/Date(','');i=i.replace(')/','');i=parseFloat(i);return new Date(i);default:return v;}},formatValue:function(a,p){function b(v){var l;var r=new RegExp("^[0-9]*$");if(v instanceof Date){return v;}if(typeof v==='string'){if(v.substring(0,6)==='/Date('){l=v.replace('/Date(','');l=l.replace(')/','');l=parseInt(l,10);return new Date(l);}else if(v.length===8&&r.test(v)){return sap.apf.utils.convertFiscalYearMonthDayToDate(v);}return new Date(v);}return undefined;}var d;var F="";if(a===null||a===undefined){return"null";}var t=p.dataType.type;switch(t){case"Edm.String":if(p["sap-semantics"]==="yearmonthday"){if(typeof a==='object'&&a instanceof Date){var y=a.getUTCFullYear()+"";var e=c(a.getUTCMonth()+1+"");var h=c(a.getUTCDate()+"");a=y+e+h;}}F="'"+String(a).replace(/'/g,"''")+"'";break;case"Edm.Time":if(typeof a==='number'){d=new Date();d.setTime(a);var i=d.getUTCHours();if(i<10){i='0'+i;}var j=d.getUTCMinutes();if(j<10){j='0'+j;}var k=d.getUTCSeconds();if(k<10){k='0'+k;}F="time'"+i+':'+j+':'+k+"'";}else{F="time'"+a+"'";}break;case"Edm.DateTime":if(!sap.apf.utils.formatValue.oDateTimeFormat){sap.apf.utils.formatValue.oDateTimeFormat=u.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''"});}d=b(a);F=sap.apf.utils.formatValue.oDateTimeFormat.format(d,true);break;case"Edm.DateTimeOffset":if(!sap.apf.utils.formatValue.oDateTimeOffsetFormat){sap.apf.utils.formatValue.oDateTimeOffsetFormat=u.getDateInstance({pattern:"'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''"});}d=b(a);F=sap.apf.utils.formatValue.oDateTimeOffsetFormat.format(d,true);break;case"Edm.Guid":F="guid'"+a+"'";break;case"Edm.Decimal":F=a+"M";break;case"Edm.Int64":F=String(a)+"L";break;case"Edm.Single":F=a+"f";break;case"Edm.Binary":F="binary'"+a+"'";break;default:F=a;break;}return F;},extractFunctionFromModulePathString:function(F){if(jQuery.isFunction(F)){return F;}var d,n,a;n=F.split('.');d=window;var i;for(i=0;i<n.length-1;i++){d=d[n[i]];if(!d){return undefined;}}a=n[n.length-1];return d[a];},isValidGuid:function(a){return/^[0-9A-F]{32}$/.test(a);},isValidPseudoGuid:function(a){return/^[0-9A-F]{32}$/.test(a);},createPseudoGuid:function(l){if(!l&&l!==0){l=32;}var a=Date.now().toString();var d=l-a.length;a+=sap.apf.utils.createRandomNumberString(d);return a;},createRandomNumberString:function(l){var r="";var a,b,d;while(r.length<l){a=Math.min(10,l-r.length);b=Math.pow(10,a);d=g(new Date().getTime());r+=Math.floor(d*b);}return r;},migrateConfigToCategoryStepAssignment:function(a,i){var H=(i.constructors&&i.constructors.Hashtable)||sap.apf.utils.Hashtable;var b=new H(i.instances.messageHandler);if(a.steps){a.steps.forEach(function(d){if(d.categories){d.categories.forEach(function(e){var h=b.getItem(e.id);if(!h){h={category:e.id,steps:[{type:"step",id:d.id}]};b.setItem(e.id,h);}else{h.steps.push({type:"step",id:d.id});}});delete d.categories;}});}if(a.categories){a.categories.forEach(function(d){if(!d.steps){var e=b.getItem(d.id);if(e){d.steps=e.steps;}else{d.steps=[];}}});}},executeFilterMapping:function(i,M,t,C,o){M.sendGetInBatch(i,a);function a(r){var F;if(r&&r.type&&r.type==="messageObject"){o.putMessage(r);C(undefined,r);}else{F=new sap.apf.core.utils.Filter(o);r.data.forEach(function(d){var b=new sap.apf.core.utils.Filter(o);t.forEach(function(T){b.addAnd(new sap.apf.core.utils.Filter(o,T,sap.apf.core.constants.FilterOperators.EQ,d[T]));});F.addOr(b);});C(F,undefined,r.data);}}},getComponentNameFromManifest:function(a){var n;if(a["sap.ui5"]&&a["sap.ui5"].componentName){n=a["sap.ui5"].componentName;}else{n=a["sap.app"].id;}if(n.search('Component')>-1){return n;}return n+'.Component';},validateSelectedValues:function(a,b){var r={valid:[],invalid:[]};if(!a||!jQuery.isArray(a)||a.length===0){return r;}if(!b||!jQuery.isArray(b)||b.length===0){r.invalid=a;return r;}a.forEach(function(d){if(jQuery.inArray(d,b)===-1){r.invalid.push(d);}else{r.valid.push(d);}});return r;},extractPathnameFromUrl:function(a){var e='a';var p;var b=document.createElement(e);b.href=a;if(b.pathname){p=b.pathname;if(p&&p[0]!=='/'){p='/'+p;}return p;}return a;},extractOdataErrorResponse:function(r){var a;if(typeof r==='string'){a=JSON.parse(r);}else{a=r;}var b=(a&&a.error&&a.error.message&&a.error.message.value)||(a&&a.error&&a.error.message&&a.error.message)||r;if(a&&a.error&&a.error.innererror&&a.error.innererror.errordetails){b=b+'\n';a.error.innererror.errordetails.forEach(function(d){b=b+d.message+'\n';});}else if(a&&a.error&&a.error.details){b=b+'\n';a.error.details.forEach(function(d){b=b+d.message+'\n';});}return b;},checkAndCloseDialog:function(d){if(d!==undefined){if(d instanceof sap.m.ViewSettingsDialog){d.destroy();}else if(d.isOpen()){d.close();}}},convertFiscalYearMonthDayToDate:function(y){var a=parseInt(y.substr(0,4),10);var b=parseInt(y.substr(4,2),10);var d=parseInt(y.substr(6,2),10);return new Date(Date.UTC(a,b-1,d));},convertFiscalYearMonthDayToDateString:function(y){return sap.apf.utils.convertFiscalYearMonthDayToDate(y).toUTCString();},convertDateListToInternalFormat:function(d,p){function a(e){var n=parseInt(e,10);if(n<10){return"200"+n;}else if(n<100){return"20"+n;}return e;}if(!d||!d.length){return d;}var b=[];d.forEach(function(e){var y,h,i,j,k;if(new RegExp('^[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]+$').test(e)){j=e.split(".");i=c(j[0]);h=c(j[1]);y=a(j[2]);}else if(new RegExp("^[0-9]{1,2}/[0-9]{1,2}/[0-9]+$").test(e)){j=e.split("/");h=c(j[0]);i=c(j[1]);y=a(j[2]);}else if(new RegExp("^[0-9]{4}-[0-9]{2}-[0-9]{2}").test(e)){y=e.slice(0,4);h=e.slice(5,7);i=e.slice(8,10);}if(y!==undefined&&h!==undefined&&i!==undefined){if(p.getAttribute('type')==="Edm.String"){b.push(y+h+i);}else{k=new Date(Date.UTC(parseInt(y,10),parseInt(h,10)-1,parseInt(i,10)));b.push(k);}}else{b.push(e);}});return b;},convertToExternalFormat:function(i,a){var t=a.getAttribute("type");var d,b;var e;switch(t){case"Edm.DateTime":e=a.getAttribute("sap:display-format");if(e==="Date"&&i instanceof Date){d=u.getDateInstance({style:"short"});return d.format(i,true);}else if(e==="Date"&&(typeof i==='string')){if(i.length===8){b=sap.apf.utils.convertFiscalYearMonthDayToDate(i);d=u.getDateInstance({style:"short"});return d.format(b,true);}b=new Date(Date.parse(i));if(isNaN(b.getTime())){return i;}d=u.getDateInstance({style:"short"});return d.format(b,true);}return i.toString();case"Edm.String":e=a.getAttribute('sap:semantics');if(e==="yearmonthday"){if(i.length===8){b=sap.apf.utils.convertFiscalYearMonthDayToDate(i);}else{b=new Date(Date.parse(i));}if(isNaN(b.getTime())){return i;}d=u.getDateInstance({style:"short"});return d.format(b,true);}return i;default:return i;}},sortByProperty:function(a,p,b){if(a.length===0){return[];}var d=b.type;var e=a[0][p];var h;if(typeof e==='number'){return a.sort(function(v,i){return v[p]-i[p];});}else if(typeof e==='object'&&e instanceof Date){return a.sort(function(v,i){return v[p].getTime()-i[p].getTime();});}else if(typeof e==='string'){switch(d){case"Edm.DateTime":return a.sort(function(v,i){return Date.parse(v[p])-Date.parse(i[p]);});case"Edm.String":h=b["sap:semantics"];if(h==="yearmonthday"&&e.length===8){return a.sort(function(v,i){return v[p].localeCompare(i[p]);});}else if(h==="yearmonthday"){return a.sort(function(v,i){return Date.parse(v[p])-Date.parse(i[p]);});}return a.sort(function(v,i){return v[p].localeCompare(i[p]);});default:return a.sort(function(v,i){return v[p].localeCompare(i[p]);});}}},isPropertyTypeWithDateSemantics:function(p){var t=p['type'];var a=p['sap:display-format'];return(t==='Edm.DateTime'&&a==='Date')||(t==='Edm.String'&&p['sap:semantics']==='yearmonthday');}};function g(i){s++;var r,a,b;i=s.toString()+i.toString();r=sap.apf.utils.hashCode(i);a=r.toString().length;b=r/Math.pow(10,a);return b;}sap.apf.utils=sap.apf.utils||{};Object.keys(m).forEach(function(k){sap.apf.utils[k]=m[k];});return m;},true);
