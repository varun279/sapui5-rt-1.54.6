/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){'use strict';jQuery.sap.declare('sap.apf.api');jQuery.sap.require('sap.apf.core.messageHandler');jQuery.sap.require('sap.apf.core.instance');jQuery.sap.require('sap.apf.utils.filter');jQuery.sap.require('sap.apf.utils.externalContext');jQuery.sap.require('sap.apf.utils.startFilterHandler');jQuery.sap.require('sap.apf.utils.startFilter');jQuery.sap.require('sap.apf.utils.filterIdHandler');jQuery.sap.require('sap.apf.utils.serializationMediator');jQuery.sap.require('sap.apf.utils.startParameter');jQuery.sap.require('sap.apf.utils.navigationHandler');jQuery.sap.require('sap.apf.ui.instance');jQuery.sap.require('sap.apf.ui.representations.representationInterface');jQuery.sap.require("sap.apf.ui.representations.lineChart");jQuery.sap.require("sap.apf.ui.representations.columnChart");jQuery.sap.require("sap.apf.ui.representations.scatterPlotChart");jQuery.sap.require("sap.apf.ui.representations.table");jQuery.sap.require("sap.apf.ui.representations.stackedColumnChart");jQuery.sap.require("sap.apf.ui.representations.pieChart");jQuery.sap.require("sap.apf.ui.representations.percentageStackedColumnChart");jQuery.sap.require('sap.apf.ui.representations.bubbleChart');jQuery.sap.require("sap.apf.ui.representations.treeTable");jQuery.sap.require('sap.apf.messageCallbackForStartup');jQuery.sap.require("sap.ui.thirdparty.datajs");jQuery.sap.require("sap.apf.core.utils.filterSimplify");sap.apf.Api=function(c,i,m){var M;var C;var s;var n;var S;var E;var f;var a;var b;var d;var o;var u;var g;var h=true;var j=jQuery.Deferred();var k=new jQuery.Deferred();var l;var p;this.type='api';this.constants={};this.constants.eventTypes=sap.apf.core.constants.eventTypes;this.destroy=function(){M.activateOnErrorHandling(false);M.setMessageCallback(undefined);M.setLifeTimePhaseShutdown();if(u&&u.destroy){u.destroy();}if(C){C.destroy();}u=undefined;C=undefined;M=undefined;s=undefined;n=undefined;};this.activateOnErrorHandling=function(H){return C.activateOnErrorHandling(H);};this.getStartParameterFacade=function(){return C.getStartParameterFacade();};this.getLogMessages=function(){return C.getLogMessages();};this.createStep=function(e,t,R){return C.createStep(e,t,R);};this.getActiveStep=function(){return C.getActiveStep();};this.getCategories=function(){return C.getCategories();};this.getSteps=function(){return C.getSteps();};this.getStepTemplates=function(){return C.getStepTemplates();};this.getFacetFilterConfigurations=function(){return C.getFacetFilterConfigurations();};this.getApplicationConfigProperties=function(){return C.getApplicationConfigProperties();};this.moveStepToPosition=function(e,t,v){return C.moveStepToPosition(e,t,v);};this.removeStep=function(e,t){return C.removeStep(e,t);};this.resetPath=function(){return C.resetPath();};this.setActiveStep=function(e){return C.setActiveStep(e);};this.stepIsActive=function(e){return C.stepIsActive(e);};this.updatePath=function(e){return C.updatePath(e);};this.getApfLocation=function(){return C.getUriGenerator().getApfLocation();};this.readPaths=function(e){return C.readPaths(e);};this.savePath=function(P,N,e){C.savePath(P,N,e);};this.openPath=function(P,e,t){return C.openPath(P,e,t);};this.deletePath=function(P,e){return C.deletePath(P,e);};this.addFacetFilter=function(e){u.getLayoutView().getController().addFacetFilter(e);};this.getEventCallback=function(e){return u.getEventCallback(e);};this.putMessage=function(e){return C.putMessage(e);};this.createMessageObject=function(e){return C.createMessageObject(e);};this.getTextHtmlEncoded=function(L,P){return C.getTextHtmlEncoded(L,P);};this.getTextNotHtmlEncoded=function(L,P){return C.getTextNotHtmlEncoded(L,P);};if(!m){this.loadApplicationConfig=function(F){C.loadApplicationConfig(F);};}else{this.loadApplicationConfig=function(F){};}this.createFilter=function(){return C.createFilter();};this.addPathFilter=function(e){return f.add(e);};this.updatePathFilter=function(e,t){f.update(e,t);};this.getPathFilter=function(e){return f.get(e);};this.createReadRequest=function(e){return C.createReadRequest(e);};this.createReadRequestByRequiredFilter=function(e){return C.createReadRequestByRequiredFilter(e);};this.selectionChanged=function(R){u.selectionChanged(R);};this.createApplicationLayout=function(){if(!l){l=new sap.m.App().addStyleClass("sapApf");}return l;};this.startApf=function(){var t;var v=this;var w=this.createApplicationLayout();k.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(c,[this]);}j.resolve();u.createApplicationLayout(w);t=n.checkMode();var x=u.handleStartup(t);x.done(function(){if(v.fnAfterApfStartupCallback&&typeof v.fnAfterApfStartupCallback==="function"){v.fnAfterApfStartupCallback.apply(c,[v]);}M.setLifeTimePhaseRunning();});}catch(e){h=false;}}.bind(this));return w;};this.addMasterFooterContent=function(e){return u.addMasterFooterContentRight(e);};this.setEventCallback=function(e,t){switch(e){case sap.apf.core.constants.eventTypes.contextChanged:u.setEventCallback(e,t);return true;case sap.apf.core.constants.eventTypes.printTriggered:u.setEventCallback(e,t);return true;case sap.apf.core.constants.eventTypes.format:this.customFormat(t);return true;default:return false;}};this.customFormat=function(e){u.setCustomFormatExit(e);};this.setCallbackBeforeApfStartup=function(e){this.fnBeforeApfStartupCallback=e;};this.setCallbackAfterApfStartup=function(e){this.fnAfterApfStartupCallback=e;};this.getPropertyValuesOfExternalContext=function(e){var t=jQuery.Deferred();E.getCombinedContext().then(function(v){var w=v.getFilterTermsForProperty(e);var x=[];w.forEach(function(y){var z={Low:y.getValue(),Option:y.getOp(),High:y.getHighValue()};x.push(z);});t.resolve(x);});return t.promise();};this.startupSucceeded=function(){return h;};if(c&&c.getInjections instanceof Function){if(!i){i={};}jQuery.extend(i,i,c.getInjections());}s=new(i&&i.constructors&&i.constructors.StartParameter||sap.apf.utils.StartParameter)(c,m);M=new(i&&i.constructors&&i.constructors.MessageHandler||sap.apf.core.MessageHandler)();M.activateOnErrorHandling(true);M.setLifeTimePhaseStartup();M.loadConfig(sap.apf.core.messageDefinition,true);g=i&&i.functions&&i.functions.messageCallbackForStartup||sap.apf.messageCallbackForStartup;M.setMessageCallback(g);if(i&&i.functions&&i.functions.isUsingCloudFoundryProxy){p=i.functions.isUsingCloudFoundryProxy;}else{p=function(){return false;};}try{C=new(i&&i.constructors&&i.constructors.CoreInstance||sap.apf.core.Instance)({functions:{isUsingCloudFoundryProxy:p,getCumulativeFilter:function(){return S.getCumulativeFilter();},getCombinedContext:function(){return E.getCombinedContext();},ajax:(i&&i.functions&&i.functions.ajax),serializeApfState:function(e,t){return o.serialize(e,t);},deserializeApfState:function(e){return o.deserialize(e);},odataRequest:(i&&i.functions&&i.functions.odataRequest),getComponentName:function(){if(m&&m.manifest&&m.manifest["sap.app"]){return m.manifest["sap.app"].id;}return c.getMetadata().getComponentName();}},instances:{messageHandler:M,startParameter:s,datajs:(i&&i.instances&&i.instances.datajs)||OData},constructors:{Request:(i&&i.constructors&&i.constructors.Request),Metadata:(i&&i.constructors&&i.constructors.Metadata),MetadataFactory:(i&&i.constructors&&i.constructors.MetadataFactory),ResourcePathHandler:(i&&i.constructors&&i.constructors.ResourcePathHandler),TextResourceHandler:(i&&i.constructors&&i.constructors.TextResourceHandler),SessionHandler:(i&&i.constructors&&i.constructors.SessionHandler),Persistence:(i&&i.constructors&&i.constructors.Persistence)},manifests:m,exits:(i&&i.exits),coreProbe:(i&&i.coreProbe),corePromise:k});b={instances:{startParameter:s,component:c,messageHandler:M},functions:{getConfigurationProperties:C.getApplicationConfigProperties,ajax:C.ajax}};E=new((i&&i.constructors&&i.constructors.ExternalContext)||sap.apf.utils.ExternalContext)(b);a={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getReducedCombinedContext:C.getReducedCombinedContext,createRequest:C.getFunctionCreateRequest()},instances:{messageHandler:M,onBeforeApfStartupPromise:j.promise()},constructors:{StartFilter:sap.apf.utils.StartFilter}};S=new((i&&i.constructors&&i.constructors.StartFilterHandler)||sap.apf.utils.StartFilterHandler)(a);d={functions:{setRestrictionByProperty:S.setRestrictionByProperty,getRestrictionByProperty:S.getRestrictionByProperty},instances:{messageHandler:M}};f=new((i&&i.constructors&&i.constructors.FilterIdHandler)||sap.apf.utils.FilterIdHandler)(d);o=new((i&&i.constructors&&i.constructors.SerializationMediator)||sap.apf.utils.SerializationMediator)({instances:{coreApi:C,filterIdHandler:f,startFilterHandler:S,messageHandler:M}});var q={constructors:{FilterReduction:sap.apf.core.utils.FilterReduction},functions:{getCumulativeFilterUpToActiveStep:C.getCumulativeFilterUpToActiveStep,getNavigationTargets:C.getNavigationTargets,getActiveStep:C.getActiveStep,createRequest:C.getFunctionCreateRequest(),getXappStateId:C.getStartParameterFacade().getXappStateId,isFilterReductionActive:C.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:C.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:M,component:c,serializationMediator:o}};n=new((i&&i.constructors&&i.constructors.NavigationHandler)||sap.apf.utils.NavigationHandler)(q);u=new(i&&i.constructors&&i.constructors.UiInstance||sap.apf.ui.Instance)({oCoreApi:C,oFilterIdHandler:f,oSerializationMediator:o,oNavigationHandler:n,oComponent:c,oStartParameter:s,oStartFilterHandler:S,exits:i&&i.exits||{}});}catch(r){h=false;this.startApf=function(){return new sap.m.Text({text:""});};this.loadApplicationConfig=function(){return"";};jQuery.sap.log.error("Caught exception during creation of APF API");}if(C){C.createRepresentation=function(R,e){var t=new sap.apf.ui.representations.RepresentationInterfaceProxy(C,u);var v=sap.apf.utils.extractFunctionFromModulePathString(R);return new v(t,e);};}if(i&&i.probe&&typeof i.probe==='function'){i.probe({apfApi:this,coreApi:C,component:c,uiApi:u,messageHandler:M,serializationMediator:o,navigationHandler:n,startParameter:s,injectedFunctionsNavigationHandler:q&&q.functions,startFilterHandler:S,externalContext:E,filterIdHandler:f,corePromise:k});}};}());
